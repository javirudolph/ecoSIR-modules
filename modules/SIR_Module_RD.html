<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Computational Thinking with SIR Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="SIR_Module_RD_files/libs/clipboard/clipboard.min.js"></script>
<script src="SIR_Module_RD_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="SIR_Module_RD_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="SIR_Module_RD_files/libs/quarto-html/popper.min.js"></script>
<script src="SIR_Module_RD_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SIR_Module_RD_files/libs/quarto-html/anchor.min.js"></script>
<link href="SIR_Module_RD_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SIR_Module_RD_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SIR_Module_RD_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SIR_Module_RD_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SIR_Module_RD_files/libs/bootstrap/bootstrap-813c323200a87c37e262811031999de4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="SIR_Module_RD_files/libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="SIR_Module_RD_files/libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<script type="module" src="SIR_Module_RD_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="SIR_Module_RD_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link href="SIR_Module_RD_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="SIR_Module_RD_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="SIR_Module_RD_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="SIR_Module_RD_files/libs/datatables-binding-0.34.0/datatables.js"></script>

<script src="SIR_Module_RD_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="SIR_Module_RD_files/libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="SIR_Module_RD_files/libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="SIR_Module_RD_files/libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="SIR_Module_RD_files/libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">

<script src="SIR_Module_RD_files/libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-and-course-learning-objectives" id="toc-introduction-and-course-learning-objectives" class="nav-link active" data-scroll-target="#introduction-and-course-learning-objectives"><span class="header-section-number">1</span> Introduction and Course Learning Objectives</a></li>
  <li><a href="#introduction-and-the-classic-epidemic-model" id="toc-introduction-and-the-classic-epidemic-model" class="nav-link" data-scroll-target="#introduction-and-the-classic-epidemic-model"><span class="header-section-number">2</span> Introduction and The Classic Epidemic Model</a>
  <ul>
  <li><a href="#sec-epidemiology-terms" id="toc-sec-epidemiology-terms" class="nav-link" data-scroll-target="#sec-epidemiology-terms"><span class="header-section-number">2.1</span> Epidemiology Terms</a></li>
  <li><a href="#sec-introducing-compartmental-models" id="toc-sec-introducing-compartmental-models" class="nav-link" data-scroll-target="#sec-introducing-compartmental-models"><span class="header-section-number">2.2</span> Introducing Compartmental Models</a></li>
  <li><a href="#sec-the-classic-sir-epidemic-model" id="toc-sec-the-classic-sir-epidemic-model" class="nav-link" data-scroll-target="#sec-the-classic-sir-epidemic-model"><span class="header-section-number">2.3</span> The Classic SIR Epidemic Model</a>
  <ul class="collapse">
  <li><a href="#sec-formulating-foi" id="toc-sec-formulating-foi" class="nav-link" data-scroll-target="#sec-formulating-foi"><span class="header-section-number">2.3.1</span> Formulating the Force of Infection</a></li>
  <li><a href="#sec-formulating-the-recovery-rate" id="toc-sec-formulating-the-recovery-rate" class="nav-link" data-scroll-target="#sec-formulating-the-recovery-rate"><span class="header-section-number">2.3.2</span> Formulating the Recovery Rate</a></li>
  </ul></li>
  <li><a href="#sec-solving-sir-equations" id="toc-sec-solving-sir-equations" class="nav-link" data-scroll-target="#sec-solving-sir-equations"><span class="header-section-number">2.4</span> Solving SIR Equations</a>
  <ul class="collapse">
  <li><a href="#sec-euler-method" id="toc-sec-euler-method" class="nav-link" data-scroll-target="#sec-euler-method"><span class="header-section-number">2.4.1</span> Euler’s method</a>
  <ul class="collapse">
  <li><a href="#sec-euler-code" id="toc-sec-euler-code" class="nav-link" data-scroll-target="#sec-euler-code"><span class="header-section-number">2.4.1.1</span> Euler’s Method Code Demonstration</a></li>
  </ul></li>
  <li><a href="#sec-pracma" id="toc-sec-pracma" class="nav-link" data-scroll-target="#sec-pracma"><span class="header-section-number">2.4.2</span> Solving SIR Equations in R Using <code>pracma</code></a></li>
  <li><a href="#sec-evaluating-and-comparing-both-methods" id="toc-sec-evaluating-and-comparing-both-methods" class="nav-link" data-scroll-target="#sec-evaluating-and-comparing-both-methods"><span class="header-section-number">2.4.3</span> Evaluating and Comparing Both Methods</a></li>
  </ul></li>
  <li><a href="#sec-formulating-transmission-rate" id="toc-sec-formulating-transmission-rate" class="nav-link" data-scroll-target="#sec-formulating-transmission-rate"><span class="header-section-number">2.5</span> Finding the Transmission Rate Using MLE</a>
  <ul class="collapse">
  <li><a href="#sec-coding-scratch" id="toc-sec-coding-scratch" class="nav-link" data-scroll-target="#sec-coding-scratch"><span class="header-section-number">2.5.0.1</span> Coding An MLE Algorithm From Scratch</a></li>
  <li><a href="#sec-bbmle" id="toc-sec-bbmle" class="nav-link" data-scroll-target="#sec-bbmle"><span class="header-section-number">2.5.0.2</span> MLE Using the bbmle Package in R</a></li>
  </ul></li>
  <li><a href="#sec-reproduction-numbers" id="toc-sec-reproduction-numbers" class="nav-link" data-scroll-target="#sec-reproduction-numbers"><span class="header-section-number">2.6</span> Reproduction Numbers</a>
  <ul class="collapse">
  <li><a href="#sec-the-threshold-phenomenon" id="toc-sec-the-threshold-phenomenon" class="nav-link" data-scroll-target="#sec-the-threshold-phenomenon"><span class="header-section-number">2.6.1</span> The Threshold Phenomenon</a></li>
  <li><a href="#sec-choosing-how-many-people-to-vaccinate" id="toc-sec-choosing-how-many-people-to-vaccinate" class="nav-link" data-scroll-target="#sec-choosing-how-many-people-to-vaccinate"><span class="header-section-number">2.6.2</span> Choosing How Many People to Vaccinate</a></li>
  </ul></li>
  <li><a href="#example-of-the-classic-epidemic-model" id="toc-example-of-the-classic-epidemic-model" class="nav-link" data-scroll-target="#example-of-the-classic-epidemic-model"><span class="header-section-number">2.7</span> Example of the Classic Epidemic Model</a></li>
  </ul></li>
  <li><a href="#the-classic-endemic-model" id="toc-the-classic-endemic-model" class="nav-link" data-scroll-target="#the-classic-endemic-model"><span class="header-section-number">3</span> The Classic Endemic Model</a>
  <ul>
  <li><a href="#the-classic-sir-endemic-model" id="toc-the-classic-sir-endemic-model" class="nav-link" data-scroll-target="#the-classic-sir-endemic-model"><span class="header-section-number">3.1</span> The Classic SIR Endemic Model</a></li>
  <li><a href="#formulating-the-death-rate" id="toc-formulating-the-death-rate" class="nav-link" data-scroll-target="#formulating-the-death-rate"><span class="header-section-number">3.2</span> Formulating the Death Rate</a></li>
  <li><a href="#solving-the-endemic-sir-model---example" id="toc-solving-the-endemic-sir-model---example" class="nav-link" data-scroll-target="#solving-the-endemic-sir-model---example"><span class="header-section-number">3.3</span> Solving the Endemic SIR Model - Example</a></li>
  <li><a href="#reproduction-numbers" id="toc-reproduction-numbers" class="nav-link" data-scroll-target="#reproduction-numbers"><span class="header-section-number">3.4</span> Reproduction Numbers</a></li>
  <li><a href="#sec-dfe-ee" id="toc-sec-dfe-ee" class="nav-link" data-scroll-target="#sec-dfe-ee"><span class="header-section-number">3.5</span> Disease Free and Endemic Equilibrium</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Computational Thinking with SIR Models</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">A Disease Ecology Module</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction-and-course-learning-objectives" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction and Course Learning Objectives</h1>
</section>
<section id="introduction-and-the-classic-epidemic-model" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Introduction and The Classic Epidemic Model</h1>
<section id="sec-epidemiology-terms" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sec-epidemiology-terms"><span class="header-section-number">2.1</span> Epidemiology Terms</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li>Define basic terms in epidemiology.</li>
</ul>
</div>
</div>
<p>For the purposes of mathematical models in epidemiology, such as the SIR model, individuals are classified based solely on their ability to transmit a pathogen, not their diseased status (whether or not they exhibit symptoms). For the purposes of epidemiological models, individuals are generally classified into four primary categories:</p>
<ul>
<li><p><strong>Susceptible:</strong> No pathogen is present in the individual. The individual only has a low level of non-specific immunity to incoming infection.</p></li>
<li><p><strong>Exposed:</strong> The individual has encountered an infected individual and is infected with the pathogen. The levels of pathogen in this individual are too low to allow them to transmit the disease to another person. This individual is hence considered “exposed” to the pathogen but not yet able to infect others with it.</p></li>
<li><p><strong>Infectious:</strong> The individual has surpassed the exposed stage and the pathogen levels within them are high enough to allow for transmission. This individual is no longer just exposed to the pathogen, but can actively spread it now.</p></li>
<li><p><strong>Recovered:</strong> The individual has surpassed the infectious stage, their immune system has cleared enough of the pathogen that they can no longer transmit it. This individual has some amount of immunity to the pathogen now, but for how long this immunity lasts depends on the specific pathogen.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The individual can still exhibit symptoms of the disease while in the recovered compartment, so it is best to think of this compartment as individuals who have “recovered” from their ability to spread the infection but not necessarily all symptomatic implications of that infection.</p>
</div>
</div>
<p>These categories are not exhaustive, and individuals can be classified into further categories based on their stage of infection or immunity status, just to name a few. These four categories are highlighted since they come up most often while discussing SIR-type models and epidemiological models in general. It is important to note that, at the same time individuals fall into these categories, they can also be classified based on whether or not they exhibit symptoms of infection:</p>
<ul>
<li><p><strong>Incubation Period:</strong> The individual has been infected with the pathogen but does not show disease symptoms. This is also commonly refferred to as the <em>asymptomatic period</em>.</p></li>
<li><p><strong>Diseased period:</strong> The individual has surpassed the incubation period and begins to show symptoms of the disease.</p></li>
</ul>
<p>Although these classifications are more commonly used in a medical, rather than an epidemiological, contexts, we still provide them here to clarify the fact that an individual can still be infectious while in the incubation period and showing no symptoms of the disease. Similarly, an individual can still be in the diseased period and show lingering symptoms of infection while being recovered since their immune system has cleared enough of the pathogen that they are not longer infectious.</p>
<p>(PLACE GRAPH HERE OF ALL THESE PERIODS)</p>
<p><strong>Section References</strong></p>
<p><span class="citation" data-cites="keeling_modeling_2008">Keeling and Rohani (<a href="#ref-keeling_modeling_2008" role="doc-biblioref">2008</a>)</span></p>
</section>
<section id="sec-introducing-compartmental-models" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="sec-introducing-compartmental-models"><span class="header-section-number">2.2</span> Introducing Compartmental Models</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li>Define what a compartmental model is.</li>
<li>Identify which differential equation models can be called compartmental models.</li>
</ul>
</div>
</div>
<p>Generally speaking, compartmental models are a way to represent the flow of populations between different states, known as compartments, using differential equations. Compartmental models show up in a wide variety of fields, not just epidemiology. Any field that can benefit from knowing how information flows between states can benefit from compartmental models.</p>
<p>In the epidemiological context, compartmental models are analyzing how people flow through the four categories, which will be referred to simply as “compartments” from now on, introduced in <a href="#sec-epidemiology-terms" class="quarto-xref">Section&nbsp;2.1</a>: susceptible (S), exposed (E), infectious (I), and recovered (R). The relationships between these compartments are often represented using flowcharts like the one seen below.</p>
<div class="cell" data-fig-width="8" data-fig-height="2" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="768" height="192" viewbox="0.00 0.00 350.00 44.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
<title>SEIR</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-40 346,-40 346,4 -4,4"></polygon>
<!-- S -->
<g id="node1" class="node">
<title>S</title>
<path fill="none" stroke="black" d="M42,-36C42,-36 12,-36 12,-36 6,-36 0,-30 0,-24 0,-24 0,-12 0,-12 0,-6 6,0 12,0 12,0 42,0 42,0 48,0 54,-6 54,-12 54,-12 54,-24 54,-24 54,-30 48,-36 42,-36"></path>
<text text-anchor="middle" x="27" y="-13.8" font-family="Times,serif" font-size="14.00">S</text>
</g>
<!-- E -->
<g id="node2" class="node">
<title>E</title>
<path fill="none" stroke="black" d="M138,-36C138,-36 108,-36 108,-36 102,-36 96,-30 96,-24 96,-24 96,-12 96,-12 96,-6 102,0 108,0 108,0 138,0 138,0 144,0 150,-6 150,-12 150,-12 150,-24 150,-24 150,-30 144,-36 138,-36"></path>
<text text-anchor="middle" x="123" y="-13.8" font-family="Times,serif" font-size="14.00">E</text>
</g>
<!-- S&#45;&gt;E -->
<g id="edge1" class="edge">
<title>S-&gt;E</title>
<path fill="none" stroke="black" d="M54.18,-18C63.96,-18 75.25,-18 85.77,-18"></path>
<polygon fill="black" stroke="black" points="85.96,-21.5 95.96,-18 85.96,-14.5 85.96,-21.5"></polygon>
<text text-anchor="middle" x="75" y="-21.6" font-family="Times,serif" font-size="12.00">λ</text>
</g>
<!-- I -->
<g id="node3" class="node">
<title>I</title>
<path fill="none" stroke="black" d="M234,-36C234,-36 204,-36 204,-36 198,-36 192,-30 192,-24 192,-24 192,-12 192,-12 192,-6 198,0 204,0 204,0 234,0 234,0 240,0 246,-6 246,-12 246,-12 246,-24 246,-24 246,-30 240,-36 234,-36"></path>
<text text-anchor="middle" x="219" y="-13.8" font-family="Times,serif" font-size="14.00">I</text>
</g>
<!-- E&#45;&gt;I -->
<g id="edge2" class="edge">
<title>E-&gt;I</title>
<path fill="none" stroke="black" d="M150.18,-18C159.96,-18 171.25,-18 181.77,-18"></path>
<polygon fill="black" stroke="black" points="181.96,-21.5 191.96,-18 181.96,-14.5 181.96,-21.5"></polygon>
<text text-anchor="middle" x="171" y="-21.6" font-family="Times,serif" font-size="12.00">σ</text>
</g>
<!-- R -->
<g id="node4" class="node">
<title>R</title>
<path fill="none" stroke="black" d="M330,-36C330,-36 300,-36 300,-36 294,-36 288,-30 288,-24 288,-24 288,-12 288,-12 288,-6 294,0 300,0 300,0 330,0 330,0 336,0 342,-6 342,-12 342,-12 342,-24 342,-24 342,-30 336,-36 330,-36"></path>
<text text-anchor="middle" x="315" y="-13.8" font-family="Times,serif" font-size="14.00">R</text>
</g>
<!-- I&#45;&gt;R -->
<g id="edge3" class="edge">
<title>I-&gt;R</title>
<path fill="none" stroke="black" d="M246.18,-18C255.96,-18 267.25,-18 277.77,-18"></path>
<polygon fill="black" stroke="black" points="277.96,-21.5 287.96,-18 277.96,-14.5 277.96,-21.5"></polygon>
<text text-anchor="middle" x="267" y="-21.6" font-family="Times,serif" font-size="12.00">γ</text>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The arrows between these compartments represent the direction of flow (susceptible individuals becoming exposed, exposed individuals becoming infectious, etc.) and the symbols above each arrow represent the <em>flow rates</em> between each compartment with respect to time.</p>
<p>It’s easiest to understand this conceptually through an example. Say in a very large population with the established presence of a pathogen, on average, 300 new people become exposed to a pathogen every day. Of those that are exposed to the pathogen, on average, 50 of them reach pathogen levels high enough to become infectious per day. Then, of those that are infectious and able to transmit the pathogen, on average, 40 of them recover from the pathogen (in the sense that they can no longer transmit it). We can model this specific example with the modified flowchart below:</p>
<div class="cell" data-fig-width="8" data-fig-height="2" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="768" height="192" viewbox="0.00 0.00 430.30 44.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
<title>SEIRmod</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-40 426.3,-40 426.3,4 -4,4"></polygon>
<!-- S -->
<g id="node1" class="node">
<title>S</title>
<path fill="none" stroke="black" d="M42,-36C42,-36 12,-36 12,-36 6,-36 0,-30 0,-24 0,-24 0,-12 0,-12 0,-6 6,0 12,0 12,0 42,0 42,0 48,0 54,-6 54,-12 54,-12 54,-24 54,-24 54,-30 48,-36 42,-36"></path>
<text text-anchor="middle" x="27" y="-13.8" font-family="Times,serif" font-size="14.00">S</text>
</g>
<!-- E -->
<g id="node2" class="node">
<title>E</title>
<path fill="none" stroke="black" d="M168.77,-36C168.77,-36 138.77,-36 138.77,-36 132.77,-36 126.77,-30 126.77,-24 126.77,-24 126.77,-12 126.77,-12 126.77,-6 132.77,0 138.77,0 138.77,0 168.77,0 168.77,0 174.77,0 180.77,-6 180.77,-12 180.77,-12 180.77,-24 180.77,-24 180.77,-30 174.77,-36 168.77,-36"></path>
<text text-anchor="middle" x="153.77" y="-13.8" font-family="Times,serif" font-size="14.00">E</text>
</g>
<!-- S&#45;&gt;E -->
<g id="edge1" class="edge">
<title>S-&gt;E</title>
<path fill="none" stroke="black" d="M54.16,-18C72.21,-18 96.45,-18 116.38,-18"></path>
<polygon fill="black" stroke="black" points="116.65,-21.5 126.65,-18 116.65,-14.5 116.65,-21.5"></polygon>
<text text-anchor="middle" x="90.38" y="-21.6" font-family="Times,serif" font-size="12.00">λ = 300</text>
</g>
<!-- I -->
<g id="node3" class="node">
<title>I</title>
<path fill="none" stroke="black" d="M289.54,-36C289.54,-36 259.54,-36 259.54,-36 253.54,-36 247.54,-30 247.54,-24 247.54,-24 247.54,-12 247.54,-12 247.54,-6 253.54,0 259.54,0 259.54,0 289.54,0 289.54,0 295.54,0 301.54,-6 301.54,-12 301.54,-12 301.54,-24 301.54,-24 301.54,-30 295.54,-36 289.54,-36"></path>
<text text-anchor="middle" x="274.54" y="-13.8" font-family="Times,serif" font-size="14.00">I</text>
</g>
<!-- E&#45;&gt;I -->
<g id="edge2" class="edge">
<title>E-&gt;I</title>
<path fill="none" stroke="black" d="M180.83,-18C197.46,-18 219.25,-18 237.52,-18"></path>
<polygon fill="black" stroke="black" points="237.53,-21.5 247.53,-18 237.53,-14.5 237.53,-21.5"></polygon>
<text text-anchor="middle" x="214.15" y="-21.6" font-family="Times,serif" font-size="12.00">σ = 50</text>
</g>
<!-- R -->
<g id="node4" class="node">
<title>R</title>
<path fill="none" stroke="black" d="M410.3,-36C410.3,-36 380.3,-36 380.3,-36 374.3,-36 368.3,-30 368.3,-24 368.3,-24 368.3,-12 368.3,-12 368.3,-6 374.3,0 380.3,0 380.3,0 410.3,0 410.3,0 416.3,0 422.3,-6 422.3,-12 422.3,-12 422.3,-24 422.3,-24 422.3,-30 416.3,-36 410.3,-36"></path>
<text text-anchor="middle" x="395.3" y="-13.8" font-family="Times,serif" font-size="14.00">R</text>
</g>
<!-- I&#45;&gt;R -->
<g id="edge3" class="edge">
<title>I-&gt;R</title>
<path fill="none" stroke="black" d="M301.6,-18C318.23,-18 340.02,-18 358.29,-18"></path>
<polygon fill="black" stroke="black" points="358.3,-21.5 368.3,-18 358.3,-14.5 358.3,-21.5"></polygon>
<text text-anchor="middle" x="334.92" y="-21.6" font-family="Times,serif" font-size="12.00">γ = 40</text>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>Which compartments we choose to include depends on the specific pathogen and disease we are modeling. Models where the exposed period is so small it can be considered negligible, or is ommited for the sake of simplicity, are specifically known as <em>SIR models</em> (standing for the three different compartments included in the model: susceptible, infectious, and recovered).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some sources will refer generally to any compartmental epidemiological model as an “SIR model,” but in our context we will make the distinction between SIR models and models that include different compartments than just susceptible, infectious, and recovered.</p>
<p>We will, however, refer to the general idea of compartmental epidemiological models as “SIR-type models.”</p>
</div>
</div>
<p><a href="#sec-the-classic-sir-epidemic-model" class="quarto-xref">Section&nbsp;2.3</a> covers the specific formulation and assumptions of this model.</p>
<p><strong>Section References</strong></p>
<p><span class="citation" data-cites="keeling_modeling_2008">Keeling and Rohani (<a href="#ref-keeling_modeling_2008" role="doc-biblioref">2008</a>)</span></p>
</section>
<section id="sec-the-classic-sir-epidemic-model" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-the-classic-sir-epidemic-model"><span class="header-section-number">2.3</span> The Classic SIR Epidemic Model</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li><p>Recall the classic epidemic model’s equations.</p></li>
<li><p>Construct equations for novel compartmental models given the flow rates between each of the compartments.</p></li>
<li><p>Identify the assumptions (and their justifications) made in the formulation of the classic epidemic model, including the assumptions made in relation to how its parameters were obtained / formulated.</p></li>
<li><p>Recall what parameters go into the construction of the classic epidemic model, including the typical symbols for each.</p></li>
<li><p>Explain how the classic epidemic model deviates from reality in relation to the assumptions it makes.</p></li>
<li><p>Differentiate situations where an empirically deduced transmission rate is more accurate and beneficial to one calculated based on first principles.</p></li>
<li><p>Discern what situations are best modeled by frequency or density dependent transmission rates, or a combination of both.</p></li>
</ul>
</div>
</div>
<p>The classic SIR epidemic model is a type of compartmental model that makes the following key assumptions:</p>
<ol type="1">
<li><p>The epidemic invades the population and concludes itself quickly enough that demographic processes, namely births and deaths, are not very influential to the overall process and can be omitted from the model. This is also known as the <em>closed population</em> assumption.</p></li>
<li><p>Individuals move between the compartments of susceptible, infectious, and recovered only. Other compartments, namely the exposed compartment, are omitted for simplicity.</p></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Since this module covers only the epidemic and endemic SIR models, neither of which include the exposed compartment, the terms “infected” and “infectious” will be used interchangeably moving forward. This is because with only the susceptible, infectious, and recovered compartments, once an individual gets infected with the pathogen we assume they are infectious as well.</p>
<p>It is important to note that although “infected” and “infectious” are used interchangeably within the context of this learning module, they are not synonymous all the time. As model complexity increases and the exposed compartment is included, a distinction must be made between the two, as an individual can be considered “infected” but not “infectious” (i.e.&nbsp;they belong to the exposed compartment).</p>
</div>
</div>
<p>These are not the only assumptions made by the epidemic SIR model, but they do clearly distinguish it from other compartmental models such as the SEIR model, which includes exposed compartment, and the endemic SIR model, which includes the flow in and out of each compartment due to demographics (births and death).</p>
<p>Moving forward, <span class="math inline">\(S\)</span>. <span class="math inline">\(I\)</span>, and <span class="math inline">\(R\)</span> will refer to the <em>number</em> of individuals in the susceptible, infectious, and recovered compartments, respectively. The variables <span class="math inline">\(\tilde{S}=\frac{S}{N}\)</span>, <span class="math inline">\(\tilde{I}=\frac{I}{N}\)</span>, and <span class="math inline">\(\tilde{R}=\frac{webr}{N}\)</span>, will be used to refer to the <em>proportion</em> of individuals in the susceptible, infectious, and recovered compartments, respectively, where <span class="math inline">\(N\)</span> is the total number of individuals in the population defined as <span class="math inline">\(N=S+I+R\)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Since the epidemic model assumes a closed population with no births or deaths, <span class="math inline">\(N\)</span> is not a variable that can change but a constant.</p></li>
<li><p>Notice that <span class="math inline">\(\tilde{S}+\tilde{I}+\tilde{R}=1\)</span></p></li>
</ul>
</div>
</div>
<p>The following equations provide the rates of change, with respect to time, for the number of individuals in each of the three compartments of the epidemic SIR model:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS}{dt} &amp;= -\lambda S \\[10pt]
\frac{dI}{dt} &amp;= \lambda S - \gamma I \\[10pt]
\frac{dR}{dt} &amp;= \gamma I
\end{aligned}
\]</span></p>
<p>Dividing each equation by the population size <span class="math inline">\(N\)</span>, we can rewrite the SIR equations above to provide the rates of change, with respect to time, for the proportion of individuals in each compartment:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d\tilde{S}}{dt} &amp;= -\lambda \tilde{S} \\[10pt]
\frac{d\tilde{I}}{dt} &amp;= \lambda \tilde{S} - \gamma \tilde{I} \\[10pt]
\frac{d\tilde{R}}{dt} &amp;= \gamma \tilde{I}
\end{aligned}
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The rate of change of the number of people in each compartment can be understood as following the basic pattern of <span class="math inline">\(R_i-R_o\)</span> where <span class="math inline">\(R_i\)</span> is the rate that people are flowing into the compartment per unit time and <span class="math inline">\(R_o\)</span> is the rate that people are flowing out of the compartment per unit time. This pattern can be used to construct any number of novel compartmental models.</p>
</div>
</div>
<p>Notice that these equations mirror exactly the compartmental flowcharts introduced in the <a href="#sec-introducing-compartmental-models" class="quarto-xref">Section&nbsp;2.2</a>. The epidemic SIR model can be representing with the following flowchart:</p>
<div class="cell" data-fig-width="8" data-fig-height="1" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="768" height="96" viewbox="0.00 0.00 254.00 44.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
<title>SIRepi</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-40 250,-40 250,4 -4,4"></polygon>
<!-- S -->
<g id="node1" class="node">
<title>S</title>
<path fill="none" stroke="black" d="M42,-36C42,-36 12,-36 12,-36 6,-36 0,-30 0,-24 0,-24 0,-12 0,-12 0,-6 6,0 12,0 12,0 42,0 42,0 48,0 54,-6 54,-12 54,-12 54,-24 54,-24 54,-30 48,-36 42,-36"></path>
<text text-anchor="middle" x="27" y="-13.8" font-family="Times,serif" font-size="14.00">S</text>
</g>
<!-- I -->
<g id="node2" class="node">
<title>I</title>
<path fill="none" stroke="black" d="M138,-36C138,-36 108,-36 108,-36 102,-36 96,-30 96,-24 96,-24 96,-12 96,-12 96,-6 102,0 108,0 108,0 138,0 138,0 144,0 150,-6 150,-12 150,-12 150,-24 150,-24 150,-30 144,-36 138,-36"></path>
<text text-anchor="middle" x="123" y="-13.8" font-family="Times,serif" font-size="14.00">I</text>
</g>
<!-- S&#45;&gt;I -->
<g id="edge1" class="edge">
<title>S-&gt;I</title>
<path fill="none" stroke="black" d="M54.18,-18C63.96,-18 75.25,-18 85.77,-18"></path>
<polygon fill="black" stroke="black" points="85.96,-21.5 95.96,-18 85.96,-14.5 85.96,-21.5"></polygon>
<text text-anchor="middle" x="75" y="-21.6" font-family="Times,serif" font-size="12.00">λ</text>
</g>
<!-- R -->
<g id="node3" class="node">
<title>R</title>
<path fill="none" stroke="black" d="M234,-36C234,-36 204,-36 204,-36 198,-36 192,-30 192,-24 192,-24 192,-12 192,-12 192,-6 198,0 204,0 204,0 234,0 234,0 240,0 246,-6 246,-12 246,-12 246,-24 246,-24 246,-30 240,-36 234,-36"></path>
<text text-anchor="middle" x="219" y="-13.8" font-family="Times,serif" font-size="14.00">R</text>
</g>
<!-- I&#45;&gt;R -->
<g id="edge2" class="edge">
<title>I-&gt;R</title>
<path fill="none" stroke="black" d="M150.18,-18C159.96,-18 171.25,-18 181.77,-18"></path>
<polygon fill="black" stroke="black" points="181.96,-21.5 191.96,-18 181.96,-14.5 181.96,-21.5"></polygon>
<text text-anchor="middle" x="171" y="-21.6" font-family="Times,serif" font-size="12.00">γ</text>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The flow rates between each compartment have specific names and symbology, summarized in the table below:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 25%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Terminology / Name</strong></th>
<th><strong>Common Symbol</strong></th>
<th><strong>Interpretation</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Force of Infection</td>
<td><span class="math inline">\(\lambda\)</span></td>
<td>The per capita rate at which susceptible individuals are becoming infectious per unit time.</td>
</tr>
<tr class="even">
<td>Recovery Rate</td>
<td><span class="math inline">\(\gamma\)</span></td>
<td>The per capita rate at which infectious individuals are recovering from infection per unit time.</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The phrase “per capita” here refers to a rate that is divided among each person in the given compartment. Take the following example: if 3 people are pouring water into a large bucket and each are adding 5 cups per minute, then the per capita rate at which water is being added is 5 cups per minute. To obtain the total rate at which water is being poured into the bucket, we would multiply the number of people pouring, 3, by their per capita rate, 5, to get a total inflow of 15 cups per minute.</p>
<p>A similar logic is being utilized in the SIR equations: the number of susceptible people at a given time, <span class="math inline">\(S\)</span>, is multiplied by the per capita rate they are becoming infectious to get the total rate at which people are entering the infectious compartment Similarly, the number of infectious people at a given time, <span class="math inline">\(I\)</span>, is multiplied by the per capita rate they are recovering to get the total rate at which people are entering the recovered compartment</p>
</div>
</div>
<p><strong>Section References</strong></p>
<p><span class="citation" data-cites="keeling_modeling_2008">Keeling and Rohani (<a href="#ref-keeling_modeling_2008" role="doc-biblioref">2008</a>)</span></p>
<section id="sec-formulating-foi" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="sec-formulating-foi"><span class="header-section-number">2.3.1</span> Formulating the Force of Infection</h3>
<p>The force of infection, or the rate at which susceptible individuals are becoming infected per unit time, can be understood and formulated based on first principles in epidemiology as follows:</p>
<blockquote class="blockquote">
<p>Consider the perspective of a susceptible individual in the population at any given time. Let’s say this individual makes, on average, <span class="math inline">\(c\)</span> contacts with other people per unit time. Then, suppose that of those <span class="math inline">\(c\)</span> people this individual makes contact with per unit time, the proportion of them that will be infectious is <span class="math inline">\(\tilde{I}\)</span>. Then, of those <span class="math inline">\(c\tilde{I}\)</span> contacts this individual makes with infectious people, the proportion of them that will actually succeed at spreading the infection to them is <span class="math inline">\(p\)</span>. Multiplying these together, we can obtain the per capita (per person) rate which susceptible people are becoming infectious, or the force of infection as follows: <span class="math display">\[
\lambda=cp\tilde{I}
\]</span></p>
</blockquote>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Although this formulation for <span class="math inline">\(\lambda\)</span> is based on first principles, there are still a number of assumptions being made. Namely:</p>
<ol type="1">
<li><p>We assume every individual in the population comes into contact with other individuals at a constant rate <span class="math inline">\(c\)</span>. This means we assume everyone in the population is equally sociable and, on average, comes into contact with the same number of people per unit time.</p></li>
<li><p>We assume <em>homogeneous mixing</em> of the population. That is, we assume everyone has an equal probability of contacting any other individual in the population. In real life, this is of course not true: infectious individuals are more likely to come into contact with other infectious individuals if they go to the hospital and are less likely to come into contact with susceptible individuals if they quarantine, just to name a few examples.</p></li>
</ol>
</div>
</div>
<p>The force of infection is calculated in many ways; we just provide one of many possible formulations and rationales here. Notice that the terms <span class="math inline">\(c\)</span> and <span class="math inline">\(p\)</span> in the formulation of <span class="math inline">\(\lambda\)</span> are independent of the number of individuals in each compartment throughout time. For this reason, they are grouped together into a singular term, known as the <em>transmission rate</em>.</p>
<p>Putting this all together, we can rewrite the SIR model equations from <a href="#sec-the-classic-sir-epidemic-model" class="quarto-xref">Section&nbsp;2.3</a> as follows:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS}{dt} &amp;= -\beta \tilde{I} S \\[10pt]
\frac{dI}{dt} &amp;= \beta \tilde{I} S - \gamma I \\[10pt]
\frac{dR}{dt} &amp;= \gamma I
\end{aligned}
\]</span></p>
<p>And for proportions:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d\tilde{S}}{dt} &amp;= -\beta \tilde{I} \tilde{S} \\[10pt]
\frac{d\tilde{I}}{dt} &amp;= \beta \tilde{I} \tilde{S} - \gamma \tilde{I} \\[10pt]
\frac{d\tilde{R}}{dt} &amp;= \gamma \tilde{I}
\end{aligned}
\]</span></p>
<p>Now comes the question of how we even find <span class="math inline">\(\beta\)</span>? The table below presents two common methods for calculating <span class="math inline">\(\beta\)</span>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 46%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Method</strong></th>
<th><strong>What is it?</strong></th>
<th><strong>Best Used When . . .</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Blackbox method</td>
<td>This is a data-driven method wherein <span class="math inline">\(\beta\)</span> is calculated empirically using epidemiological data. We can think of this as “fitting” a value of <span class="math inline">\(\beta\)</span> in our model to most accurately reflect the dynamics we observe in the real world.</td>
<td>There is an abundance of accurate real-world data available on the number of susceptible and infectious people over time.</td>
</tr>
<tr class="even">
<td>First-Principles method</td>
<td>This method utilizes the formulation <span class="math inline">\(\beta=cp\)</span>, which was obtained using first-principles, and separately calculates appropriate values for <span class="math inline">\(c\)</span> and <span class="math inline">\(p\)</span>.</td>
<td>Real-world data is scarcer or there the data available lends itself better to calculating <span class="math inline">\(c\)</span> and <span class="math inline">\(p\)</span> separately rather than fitting an overall <span class="math inline">\(\beta\)</span>.</td>
</tr>
</tbody>
</table>
<p>For the purposes and scope of this introductory module, we will only provide examples and insights into the blackbox method for calculating the transmission rate <span class="math inline">\(\beta\)</span>. This is because specifics of how <span class="math inline">\(c\)</span> and <span class="math inline">\(p\)</span> are calculated using the first-principles method depends heavily on model context and complexity, meaning there is no “one size fits all” way of finding <span class="math inline">\(\beta\)</span> using this method.</p>
<p>Models will often formulate <span class="math inline">\(c\)</span> and <span class="math inline">\(p\)</span> as functions of their own depending on a number of external variables. An example of this can be found in this paper <span class="citation" data-cites="deer_covid">(<a href="#ref-deer_covid" role="doc-biblioref">Rosenblatt et al. 2023</a>)</span>, where the transmission rate <span class="math inline">\(\beta\)</span> is formulated as the product of the proximity rate <span class="math inline">\(\omega_{ij}\)</span>, or “frequency per day that host <span class="math inline">\(i\)</span> and recipient <span class="math inline">\(j\)</span> are within 1.5 meters (m) of each other” and <span class="math inline">\(\sigma^{Aero}\)</span>, or the “probability of infection from aerosols.” The paper further decomposes <span class="math inline">\(\omega_{ij}\)</span> and <span class="math inline">\(\sigma^{Aero}\)</span> into functions of their own depending on a variety of external variables.</p>
<p>The specific formulations for the contact rate (or proximity rate) and infection probability utilized by this paper are unique to its context (the pathogen it is analyzing, the host population(s), etc.) and will vary widely from paper to paper. PROVIDE CITATIONS FOR MORE EXAMPLES OF DIFFERENT BETA CALCULATIONS HERE.</p>
<p>However, there are standardized procedures to obtain <span class="math inline">\(\beta\)</span> using the blackbox approach, of which one common method known as <em>maximum likelihood estimation</em>, or MLE for short, is covered in <a href="#sec-formulating-transmission-rate" class="quarto-xref">Section&nbsp;2.5</a>. But before we can cover MLE, we must go over how to solve our SIR model equations first, which is the topic of <a href="#sec-solving-sir-equations" class="quarto-xref">Section&nbsp;2.4</a>.</p>
</section>
<section id="sec-formulating-the-recovery-rate" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="sec-formulating-the-recovery-rate"><span class="header-section-number">2.3.2</span> Formulating the Recovery Rate</h3>
<p>In the classic epidemic SIR model, there are only two parameters we must estimate: the transmission rate <span class="math inline">\(\beta\)</span> and the recovery rate <span class="math inline">\(\gamma\)</span>. In <a href="#sec-formulating-foi" class="quarto-xref">Section&nbsp;2.3.1</a>, we introduce the blackbox and first-principles approach for estimating the value of <span class="math inline">\(\beta\)</span>.</p>
<p>The other parameter we must estimate—the recovery rate—is often estimated based on prior literature instead of real-world data like <span class="math inline">\(\beta\)</span>. The reason for this is because <span class="math inline">\(\beta\)</span> is heavily dependent on many real-world factors like population density, demographics, and public-health measures, all of which vary greatly depending on the context of the model. The recovery rate, on the other hand, is often formulated as simply the reciprocal of the average duration of infection and thus is considered to be “more stable compared with <span class="math inline">\(\beta\)</span>” <span class="citation" data-cites="parameter_estimation">(<a href="#ref-parameter_estimation" role="doc-biblioref">Senel, Ozdinc, and Ozturkcan 2021</a>)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>When we say the recovery rate is ‘more stable’ than the transmission rate, we are simply saying that it varies less based on disease context and it stays relatively constant over the course of the epidemic.</p>
<p>To illustrate just how differently disease contexts affect <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span>, suppose the following two situations: we have a measles outbreak in a city that mandates sick individuals wear masks and quarantine themselves of a week and another measles outbreak in a rural town with very little control measures. We would expect the transmission rate for the city with high control measures to be much lower than the transmission rate for the rural town since infectious people in the city are interacting less with individuals (due to the quarantine mandate) and are less likely to spread the disease from those interactions (due to the mask mandates) compared to the rural town. However, we would expect the recovery rate in these two contexts to be approximately the same as sick people in the city will, on average, be infectious for the same amount of time as people in the rural town.</p>
<p>We can think of the recovery rate as dependent on the biology of the disease itself whereas the transmission rate is dependent on context-specific factors.</p>
</div>
</div>
<p>To recap the methods of estimating our model parameters:</p>
<ul>
<li>Recovery rate (<span class="math inline">\(\gamma\)</span>)
<ul>
<li>Literature Review: Estimated using past literature on the average duration of infection / infectious period <span class="math inline">\(d\)</span> and calculated as <span class="math inline">\(\gamma=\frac{1}{d}\)</span></li>
</ul></li>
<li>Transmission rate (<span class="math inline">\(\beta\)</span>)
<ul>
<li>Blackbox Method: “Fitting” a suitable value of <span class="math inline">\(\beta\)</span> using real-world data from the scenario we are trying to model (i.e.&nbsp;finding which value of <span class="math inline">\(\beta\)</span> produces a model that describes what we see in the real-world most accurately)</li>
<li>First-Principles Method: Using a combination of real-world data and theory to produce estimates for the average contact rate <span class="math inline">\(c\)</span> and probability of infection <span class="math inline">\(p\)</span> separately and calculating the transmission rate as <span class="math inline">\(\beta=cp\)</span></li>
</ul></li>
</ul>
<p>The table below provides some empirically-deduced average infectious periods for various common diseases <span class="citation" data-cites="anderson_may_1982">(<a href="#ref-anderson_may_1982" role="doc-biblioref">Anderson and May 1982</a>)</span>:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>Infectious Disease</strong></th>
<th><strong>Infectious Period (days)</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Measles</td>
<td>6 to 7</td>
</tr>
<tr class="even">
<td>Whooping cough</td>
<td>21 to 23</td>
</tr>
<tr class="odd">
<td>Poliomyelitis</td>
<td>14 to 20</td>
</tr>
<tr class="even">
<td>Chicken pox</td>
<td>10 to 11</td>
</tr>
<tr class="odd">
<td>Rubella</td>
<td>11 to 12</td>
</tr>
<tr class="even">
<td>Mumps</td>
<td>4 to 8</td>
</tr>
<tr class="odd">
<td>Diphtheria</td>
<td>14 to 21</td>
</tr>
<tr class="even">
<td>Scarlet fever</td>
<td>14 to 21</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="sec-solving-sir-equations" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sec-solving-sir-equations"><span class="header-section-number">2.4</span> Solving SIR Equations</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li><p>Solve basic SIR model equations using a combination of mathematical and computational techniques.</p></li>
<li><p>Identify the difference between common methods of solving SIR-type models, including Euler’s method and using function in the <code>pracma</code> package in R.</p></li>
</ul>
</div>
</div>
<p>Two common methods of solving differential equations that are difficult to solve by hand (in an exact method, that is) is:</p>
<ol type="1">
<li>Euler’s method</li>
<li>The <code>pracma</code> package in R</li>
</ol>
<p>We will go over each method in <a href="#sec-euler-method" class="quarto-xref">Sections&nbsp;2.4.1</a> and <a href="#sec-pracma" class="quarto-xref">Section&nbsp;2.4.2</a> and the differences between the two.</p>
<section id="sec-euler-method" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="sec-euler-method"><span class="header-section-number">2.4.1</span> Euler’s method</h3>
<p>Euler’s method estimates the solution to a differential equation using a series of short, connected linear approximations at a discrete set of times. Although Euler’s method is widely regarded to be a relatively inefficient method for solving otherwise “unsolvable” (at least in the elementary sense) ordinary differential equations, it is still valued for its simplicity and accessibility.</p>
<p>Suppose we have approximate initial values for the variables of interest (which, in the case of the SIR model, is the number or proportion of susceptible, infectious, and recovered individuals at the beginning of our study period). We will denote the number of susceptible, infectious, and recovered individuals at starting time <span class="math inline">\(t\)</span> as <span class="math inline">\(S(0)\)</span>, <span class="math inline">\(I(0)\)</span>, and <span class="math inline">\(R(0)\)</span>, respectively.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To keep it simple, we will only discuss the process of Euler’s method as it is applied to the number of individuals in each compartment, but keep in mind this process can be applied in exactly the same way to proportions as well.</p>
</div>
</div>
<p>Our goal is to find an approximate solutions to <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(I(t)\)</span>, and <span class="math inline">\(R(t)\)</span>—the number of individuals in each compartment at time <span class="math inline">\(t\)</span>—using <span class="math inline">\(s(0)\)</span>, <span class="math inline">\(i(0)\)</span>, and <span class="math inline">\(r(0)\)</span> and the rates of change given by the system of SIR equations formulated in <a href="#sec-the-classic-sir-epidemic-model" class="quarto-xref">Section&nbsp;2.3</a>. For clarity, <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(I(t)\)</span>, and <span class="math inline">\(R(t)\)</span> represent the exact solutions to the SIR equations, and the approximation solutions given by Euler’s method are represent as <span class="math inline">\(s(t)\)</span>, <span class="math inline">\(i(t)\)</span>, and <span class="math inline">\(r(t)\)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>These types of problems, one where we are given a set of intial values and corresponding differential equations, are known as initial-value problems (or IVPs).</p>
</div>
</div>
<p>Euler’s method involves repeatedly finding tangent line approximations to <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(I(t)\)</span>, and <span class="math inline">\(R(t)\)</span> at a discrete set of times (often called nodes):</p>
<ul>
<li><span class="math inline">\(s_0,\dots,s_t,\dots,s_b\)</span></li>
<li><span class="math inline">\(i_0,\dots,i_t,\dots,i_b\)</span></li>
<li><span class="math inline">\(r_0,\dots,r_t,\dots,r_b\)</span></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math inline">\(s_t\)</span>, <span class="math inline">\(i_t\)</span>, and <span class="math inline">\(r_t\)</span> represent approximations to <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(I(t)\)</span>, and <span class="math inline">\(R(t)\)</span> at a time <span class="math inline">\(t\)</span>. Additionally, <span class="math inline">\(s_b\)</span>, <span class="math inline">\(i_b\)</span>, and <span class="math inline">\(r_b\)</span> just represent the approximation at the final time <span class="math inline">\(b\)</span> of the interval we wish to find an approximate solution to, or <span class="math inline">\([0,b]\)</span> .</p>
</div>
</div>
<p>These approximations are found using the following recursive formulas:</p>
<p><span class="math display">\[
\begin{aligned}
s_{t+1} &amp;= s_t - \Delta t \, \beta i_t s_t \\[10pt]
i_{t+1} &amp;= i_t + \Delta t \, (\beta i_t s_t - \gamma i_t) \\[10pt]
r_{t+1} &amp;= r_t + \Delta t \, \gamma i_t
\end{aligned}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(s_{t+1}\)</span>, <span class="math inline">\(i_{t+1}\)</span>, and <span class="math inline">\(r_{t+1}\)</span> are the approximations for <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(I(t)\)</span>, and <span class="math inline">\(R(t)\)</span> at the next node</li>
<li><span class="math inline">\(s_{t}\)</span>, <span class="math inline">\(i_{t}\)</span>, and <span class="math inline">\(r_{t}\)</span> are the approximations for <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(I(t)\)</span>, and <span class="math inline">\(R(t)\)</span> at the previous node</li>
<li><span class="math inline">\(\Delta t\)</span> is the step size (how far each node is spaced apart on the <span class="math inline">\(t\)</span>-axis)</li>
<li><span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span> are the transmission and recovery rate, respectively</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This formula is just an application of the generalized Euler’s method for first-order differential equation <span class="math inline">\(Y'(t)=f(t,Y(t))\)</span>, true solution <span class="math inline">\(Y(t)\)</span>, and approximate solutions <span class="math inline">\(y_0,\dots,y_t,\dots,y_b\)</span>, which are calculated at evenly spaced <span class="math inline">\(t_n\)</span> as:</p>
<p><span class="math inline">\(y_{t+1}=y_t+ \Delta t f(t_n,Y(t_n)\)</span></p>
<p>Where again <span class="math inline">\(\Delta t\)</span> is how far each <span class="math inline">\(t_n\)</span> are apart.</p>
<p>Specifically, the formulas provided above substitute the rate of change functions <span class="math inline">\(\frac{dS}{dt}\)</span>, <span class="math inline">\(\frac{dI}{dt}\)</span>, and <span class="math inline">\(\frac{dR}{dt}\)</span> in directly.</p>
</div>
</div>
<p>This process can be a little confusing to grasp at first, so let’s do an example.</p>
<p>Suppose the following SIR model equations with initial values <span class="math inline">\(s(0)=99\)</span>, <span class="math inline">\(i(0)=1\)</span>, <span class="math inline">\(r(0)=0\)</span>, transmission rate <span class="math inline">\(\beta=1.5\)</span>, and recovery rate <span class="math inline">\(\gamma=0.5\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS}{dt} &amp;= -1.5 \tilde{I} S \\[10pt]
\frac{dI}{dt} &amp;= 1.5 \tilde{I} S - 0.5 I \\[10pt]
\frac{dR}{dt} &amp;= 0.5 I
\end{aligned}
\]</span></p>
<p>The following table illustrates the calculation process until <span class="math inline">\(t=5\)</span> with a step size of <span class="math inline">\(\Delta t=1\)</span>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 33%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Time</strong></th>
<th><strong>Approximations</strong></th>
<th><strong>Calculation Process</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(t=0\)</span></td>
<td><span class="math inline">\(s\left(0\right)=99.0\)</span><br><span class="math inline">\(i\left(0\right)=1.0\)</span><br><span class="math inline">\(r\left(0\right)=0.0\)</span></td>
<td>—</td>
</tr>
<tr class="even">
<td><span class="math inline">\(t=1\)</span></td>
<td><span class="math inline">\(s\left(1\right)\approx 97.5\)</span><br><span class="math inline">\(i\left(1\right)\approx 2.0\)</span><br><span class="math inline">\(r\left(1\right)=0.5\)</span></td>
<td><span class="math inline">\(s\left(1\right)=99-\left(1\right)\left(1.5\right)\left(\frac{1}{100}\right)\left(99\right)\)</span><br><span class="math inline">\(i\left(1\right)=1+\left(1\right)\left[\left(1.5\right)\left(\frac{1}{100}\right)\left(99\right)-0.5\left(1\right)\right]\)</span><br><span class="math inline">\(r\left(1\right)=0+\left(1\right)\left(0.5\right)\left(1\right)\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(t=2\)</span></td>
<td><span class="math inline">\(s\left(2\right)\approx 94.6\)</span><br><span class="math inline">\(i\left(2\right)\approx 3.9\)</span><br><span class="math inline">\(r\left(2\right)\approx 2.0\)</span></td>
<td><span class="math inline">\(s\left(2\right)=97.5-\left(1\right)\left(1.5\right)\left(\frac{2.0}{100}\right)\left(97.5\right)\)</span><br><span class="math inline">\(i\left(2\right)=2.0+\left(1\right)\left[\left(1.5\right)\left(\frac{2.0}{100}\right)\left(97.5\right)-0.5\left(2.0\right)\right]\)</span><br><span class="math inline">\(r\left(2\right)=0.5+\left(1\right)\left(0.5\right)\left(2.0\right)\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(t=3\)</span></td>
<td><span class="math inline">\(s\left(3\right)\approx 89.1\)</span><br><span class="math inline">\(i\left(3\right)\approx 7.5\)</span><br><span class="math inline">\(r\left(3\right)\approx 3.4\)</span></td>
<td><span class="math inline">\(s\left(3\right)=94.6-\left(1\right)\left(1.5\right)\left(\frac{3.9}{100}\right)\left(94.6\right)\)</span><br><span class="math inline">\(i\left(3\right)=3.9+\left(1\right)\left[\left(1.5\right)\left(\frac{3.9}{100}\right)\left(94.6\right)-0.5\left(3.9\right)\right]\)</span><br><span class="math inline">\(r\left(3\right)=2.0+\left(1\right)\left(0.5\right)\left(3.9\right)\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(t=4\)</span></td>
<td><span class="math inline">\(s\left(4\right)\approx 79.1\)</span><br><span class="math inline">\(i\left(4\right)\approx 13.7\)</span><br><span class="math inline">\(r\left(4\right)\approx 7.2\)</span></td>
<td><span class="math inline">\(s\left(4\right)=89.1-\left(1\right)\left(1.5\right)\left(\frac{7.5}{100}\right)\left(89.1\right)\)</span><br><span class="math inline">\(i\left(4\right)=7.5+\left(1\right)\left[\left(1.5\right)\left(\frac{7.5}{100}\right)\left(89.1\right)-0.5\left(7.5\right)\right]\)</span><br><span class="math inline">\(r\left(4\right)=3.4+\left(1\right)\left(0.5\right)\left(7.5\right)\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(t=5\)</span></td>
<td><span class="math inline">\(s\left(5\right)\approx 62.8\)</span><br><span class="math inline">\(i\left(5\right)\approx 23.1\)</span><br><span class="math inline">\(r\left(5\right)\approx 14.0\)</span></td>
<td><span class="math inline">\(s\left(5\right)=79.1-\left(1\right)\left(1.5\right)\left(\frac{13.7}{100}\right)\left(79.1\right)\)</span><br><span class="math inline">\(i\left(5\right)=13.7+\left(1\right)\left[\left(1.5\right)\left(\frac{13.7}{100}\right)\left(79.1\right)-0.5\left(13.7\right)\right]\)</span><br><span class="math inline">\(r\left(5\right)=7.2+\left(1\right)\left(0.5\right)\left(13.7\right)\)</span></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-tip callout-titled" title="Note">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The accuracy of the solution produced by Euler’s method is a direct result of what we choose the step size to be. If the step size is larger, then the curvature of the true solution will be lost since we are repeatedly taking linear approximations, resulting in an approximate solution that deviates a lot from the true solution curve. On the other hand, as the step size gets smaller, the approximate solution provided by Euler’s method converges to the true solution curve.</p>
<p>See <a href="#sec-evaluating-and-comparing-both-methods" class="quarto-xref">Section&nbsp;2.4.3</a> for a simulation demonstrating what happens when you change the step size.</p>
</div>
</div>
<p>As you might notice, the calculations above are very tedious, which is why Euler’s method is most often calculated using code rather than by hand. Read on to <a href="#sec-euler-code" class="quarto-xref">Section&nbsp;2.4.1.1</a> for a demonstration on how to code Euler’s Method.</p>
<section id="sec-euler-code" class="level4" data-number="2.4.1.1">
<h4 data-number="2.4.1.1" class="anchored" data-anchor-id="sec-euler-code"><span class="header-section-number">2.4.1.1</span> Euler’s Method Code Demonstration</h4>
<p>This section contains a step by step walkthrough of how to code an Euler’s Method algorithm in R.</p>
<p><strong>Step 1: Define the biological parameters.</strong></p>
<p>Every model starts with its parameters: the biological quantities that characterize the disease and host system. Here, we have two: how fast the disease spreads (<span class="math inline">\(\beta\)</span>) and how fast individuals recover (<span class="math inline">\(\gamma\)</span>).</p>
<div class="cell">
<div>
<div id="webr-1" class="exercise-cell">

</div>
<script type="webr-1-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBUcmFuc21pc3Npb24gcmF0ZTogY29udGFjdHMgw5cgcHJvYmFiaWxpdHkgb2YgdHJhbnNtaXNzaW9uIHBlciB1bml0IHRpbWVcbmJldGEgPC0gMS41XG5cbiMgUmVjb3ZlcnkgcmF0ZTogMS9nYW1tYSBnaXZlcyB0aGUgYXZlcmFnZSBkdXJhdGlvbiBvZiBpbmZlY3Rpb25cbmdhbW1hIDwtIDAuNVxuXG4jIFdpdGggdGhlc2UgdmFsdWVzLCB0aGUgYXZlcmFnZSBpbmZlY3Rpb3VzIHBlcmlvZCBpczpcbmNhdChcIkF2ZXJhZ2UgaW5mZWN0aW91cyBwZXJpb2Q6XCIsIDEvZ2FtbWEsIFwidGltZSB1bml0c1wiKSJ9
</script>
</div>
</div>
<hr>
<p><strong>Step 2: Set the initial conditions.</strong></p>
<p>Before the model can run, we need to specify where the system starts. In an epidemic model, this means the proportion of the population in each compartment at time zero.</p>
<div class="cell">
<div>
<div id="webr-2" class="exercise-cell">

</div>
<script type="webr-2-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBTdGFydGluZyBwcm9wb3J0aW9ucyDigJQgbXVzdCBzdW0gdG8gMVxuUzAgPC0gMC45OSAgICMgOTklIHN1c2NlcHRpYmxlOiBuZWFybHkgZXZlcnlvbmUgaXMgc3VzY2VwdGlibGUgYXQgdGhlIHN0YXJ0XG5JMCA8LSAwLjAxICAgIyAxJSBpbmZlY3Rpb3VzOiBhIHNtYWxsIFwic3BhcmtcIiBvZiBpbmZlY3Rpb24gZW50ZXJzIHRoZSBwb3B1bGF0aW9uXG5SMF9zdGFydCA8LSAwLjAwICAgIyAwJSByZWNvdmVyZWQ6IG5vIHByaW9yIGltbXVuaXR5XG5cbiMgVmVyaWZ5IHRoZXkgc3VtIHRvIDEgKGEgZ29vZCBzYW5pdHkgY2hlY2sgdG8gYnVpbGQgaW50byB5b3VyIGNvZGUpXG5jYXQoXCJTMCArIEkwICsgUjAgPVwiLCBTMCArIEkwICsgUjBfc3RhcnQsIFwiXFxuXCIpIn0=
</script>
</div>
</div>
<p>This sanity check, confirming that proportions sum to 1 — is a simple example of a habit that will save you debugging time later. When you add more compartments (SEIR, endemic model), this check generalizes naturally.</p>
<hr>
<p><strong>Step 3: Set up the time grid.</strong></p>
<p>Euler’s method steps through time discretely. We need to decide how far apart those steps are (<span class="math inline">\(\Delta t\)</span>, the step size) and how long to simulate.</p>
<div class="cell">
<div>
<div id="webr-3" class="exercise-cell">

</div>
<script type="webr-3-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZHQgICAgPC0gMC4xICAgIyBzdGVwIHNpemUg4oCUIHRyeSBtYWtpbmcgdGhpcyBsYXJnZXIgbGF0ZXIgdG8gc2VlIHdoYXQgYnJlYWtzXG50X2VuZCA8LSA1MCAgICAjIHRvdGFsIHNpbXVsYXRpb24gdGltZVxuXG4jIENyZWF0ZSBhIHZlY3RvciBvZiBhbGwgdGltZSBwb2ludHNcbnRpbWVzICAgPC0gc2VxKDAsIHRfZW5kLCBieSA9IGR0KVxubl9zdGVwcyA8LSBsZW5ndGgodGltZXMpXG5cbmNhdChcIk51bWJlciBvZiB0aW1lIHN0ZXBzOlwiLCBuX3N0ZXBzLCBcIlxcblwiKVxuY2F0KFwiVGltZSBwb2ludHMgcnVuIGZyb21cIiwgdGltZXNbMV0sIFwidG9cIiwgdGltZXNbbl9zdGVwc10sIFwiXFxuXCIpIn0=
</script>
</div>
</div>
<p>The step size is a computational choice, not a biological one, but it affects accuracy. A smaller <span class="math inline">\(\Delta t\)</span> gives a more accurate approximation of the continuous solution, at the cost of more computation. We will explore this tradeoff shortly.</p>
<hr>
<p><strong>Step 4: Pre-allocate storage.</strong></p>
<p>Before running the loop, we create empty vectors to hold the results at each time step. This is more efficient than growing a vector inside the loop.</p>
<div class="cell">
<div>
<div id="webr-4" class="exercise-cell">

</div>
<script type="webr-4-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBFbXB0eSB2ZWN0b3JzOiBvbmUgc2xvdCBwZXIgdGltZSBzdGVwLCBmaWxsZWQgd2l0aCB6ZXJvcyBmb3Igbm93XG5TIDwtIG51bWVyaWMobl9zdGVwcylcbkkgPC0gbnVtZXJpYyhuX3N0ZXBzKVxuUiA8LSBudW1lcmljKG5fc3RlcHMpXG5cbiMgRmlsbCBpbiB0aGUgc3RhcnRpbmcgdmFsdWVzXG5TWzFdIDwtIFMwXG5JWzFdIDwtIEkwXG5SWzFdIDwtIFIwX3N0YXJ0XG5cbmNhdChcIlN0b3JhZ2UgcmVhZHkuIEZpcnN0IHZhbHVlczogUyA9XCIsIFNbMV0sIFwiIEkgPVwiLCBJWzFdLCBcIiBSID1cIiwgUlsxXSwgXCJcXG5cIikifQ==
</script>
</div>
</div>
<p>Think of these vectors as the model’s memory: they store the entire trajectory of the epidemic, one row per time step.</p>
<hr>
<p><strong>Step 5: Run the Euler loop.</strong></p>
<p>This is where the model actually runs. At each time step, we calculate the rates of change using the SIR equations and use them to update the compartment values. Each line in the loop maps directly to an equation.</p>
<div class="cell">
<div>
<div id="webr-5" class="exercise-cell">

</div>
<script type="webr-5-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZm9yICh0IGluIDE6KG5fc3RlcHMgLSAxKSkge1xuXG4gICMgUmF0ZSBvZiBjaGFuZ2U6IHRoZXNlIEFSRSB0aGUgU0lSIGVxdWF0aW9ucywgd3JpdHRlbiBhcyBjb2RlXG4gIGRTIDwtIC1iZXRhICogSVt0XSAqIFNbdF0gICAgICAgICAgICAgICAgICAgICMgbmV3IGluZmVjdGlvbnMgbGVhdmluZyBTXG4gIGRJIDwtICBiZXRhICogSVt0XSAqIFNbdF0gLSBnYW1tYSAqIElbdF0gICAgICMgZ2FpbiBpbmZlY3Rpb25zLCBsb3NlIHJlY292ZXJpZXNcbiAgZFIgPC0gIGdhbW1hICogSVt0XSAgICAgICAgICAgICAgICAgICAgICAgICAgIyByZWNvdmVyaWVzIGVudGVyaW5nIFJcblxuICAjIFN0ZXAgZm9yd2FyZDogY3VycmVudCB2YWx1ZSArIChzdGVwIHNpemUgw5cgcmF0ZSBvZiBjaGFuZ2UpXG4gIFNbdCsxXSA8LSBTW3RdICsgZHQgKiBkU1xuICBJW3QrMV0gPC0gSVt0XSArIGR0ICogZElcbiAgUlt0KzFdIDwtIFJbdF0gKyBkdCAqIGRSXG59XG5cbiMgUXVpY2sgY2hlY2s6IGRvIHRoZSBjb21wYXJ0bWVudHMgc3RpbGwgc3VtIHRvIDEgYXQgdGhlIGVuZD9cbmNhdChcIkZpbmFsIHZhbHVlczogUyA9XCIsIHJvdW5kKFNbbl9zdGVwc10sIDQpLFxuICAgIFwiIEkgPVwiLCByb3VuZChJW25fc3RlcHNdLCA0KSxcbiAgICBcIiBSID1cIiwgcm91bmQoUltuX3N0ZXBzXSwgNCksIFwiXFxuXCIpXG5jYXQoXCJTdW06XCIsIHJvdW5kKFNbbl9zdGVwc10gKyBJW25fc3RlcHNdICsgUltuX3N0ZXBzXSwgNiksIFwiXFxuXCIpIn0=
</script>
</div>
</div>
<p>The loop is doing exactly what the Euler update formulas say, mechanically, one step at a time. This is the computational equivalent of doing the hand calculations from the table shown earlier, just thousands of times faster.</p>
<hr>
<p><strong>Step 6: Visualize the results.</strong></p>
<p>The vectors <code>S</code>, <code>I</code>, and <code>R</code> now hold the full epidemic trajectory. We can plot them against time.</p>
<div class="cell">
<div>
<div id="webr-6" class="exercise-cell">

</div>
<script type="webr-6-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoicGxvdCh0aW1lcywgUywgdHlwZSA9IFwibFwiLCBjb2wgPSBcInN0ZWVsYmx1ZVwiLCBsd2QgPSAyLFxuICAgICB5bGltID0gYygwLCAxKSwgeGxhYiA9IFwiVGltZVwiLCB5bGFiID0gXCJQcm9wb3J0aW9uXCIsXG4gICAgIG1haW4gPSBwYXN0ZTAoXCJTSVIgRXBpZGVtaWMgKEV1bGVyKSAgfCAgzrI9XCIsIGJldGEsXG4gICAgICAgICAgICAgICAgICAgXCIgIM6zPVwiLCBnYW1tYSwgXCIgIFLigoA9XCIsIHJvdW5kKGJldGEvZ2FtbWEsIDIpKSlcbmxpbmVzKHRpbWVzLCBJLCBjb2wgPSBcImZpcmVicmlja1wiLCBsd2QgPSAyKVxubGluZXModGltZXMsIFIsIGNvbCA9IFwic2VhZ3JlZW5cIiwgIGx3ZCA9IDIpXG5sZWdlbmQoXCJyaWdodFwiLCBsZWdlbmQgPSBjKFwiU3VzY2VwdGlibGVcIiwgXCJJbmZlY3Rpb3VzXCIsIFwiUmVjb3ZlcmVkXCIpLFxuICAgICAgIGNvbCA9IGMoXCJzdGVlbGJsdWVcIiwgXCJmaXJlYnJpY2tcIiwgXCJzZWFncmVlblwiKSwgbHdkID0gMiwgYnR5ID0gXCJuXCIpIn0=
</script>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Try this">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try this
</div>
</div>
<div class="callout-body-container callout-body">
<p>Go back to <strong>Step 1</strong> and try the following changes, re-running each step in order:</p>
<ol type="1">
<li>Change <code>gamma &lt;- 0.5</code> to <code>gamma &lt;- 0.2</code>. What does a slower recovery rate do to the epidemic peak?</li>
<li>Change <code>beta &lt;- 1.5</code> to <code>beta &lt;- 0.4</code>. What happens when <span class="math inline">\(\beta &lt; \gamma\)</span>? Can you explain why biologically?</li>
<li>Go back to <strong>Step 3</strong> and change <code>dt &lt;- 0.1</code> to <code>dt &lt;- 2.0</code>. What happens to the curves? This is the cost of a large step size.</li>
</ol>
</div>
</div>
<p><strong>Section References</strong></p>
<p><span class="citation" data-cites="ode_book">Atkinson, Han, and Stewart (<a href="#ref-ode_book" role="doc-biblioref">2009</a>)</span></p>
</section>
</section>
<section id="sec-pracma" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="sec-pracma"><span class="header-section-number">2.4.2</span> Solving SIR Equations in R Using <code>pracma</code></h3>
<p>The package <code>pracma</code> in R, short for “Practical Numerical Math Functions,” provides a large repertoire of functions used in numerical analysis, linear algebra, numerical optimization, and differential equations <span class="citation" data-cites="pracma_cran">(<a href="#ref-pracma_cran" role="doc-biblioref">Borchers 2025</a>)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The SIR-type models we are going to cover deal with systems of first-order ordinary differential equations.</p>
<p>Breaking up each word in this description, we have:</p>
<ul>
<li><p>“First-order”: This just means we are only dealing with equations involving the first derivative and not subsequent derivatives (the second, third, fourth, etc. derivative)</p></li>
<li><p>“Ordinary”: The unknown function which we are trying to solve for depends only one independent variable.</p></li>
</ul>
</div>
</div>
<p>Although <code>pracma</code> contains many mathematical functions, we are primarily interested in <code>rk4sys</code>, a function to solve systems of differential equations using an advanced method known as the <em>Classic Fourth-Order Runge-Kutta Method</em>. This method for solving differential equations is much more complex than Euler’s method but outputs solutions to a much greater accuracy. In simple terms, the Fourth-Order Runge–Kutta method estimates the value of a solution at the next point by taking a weighted average of four slope calculations, each computed at different points within the step interval <span class="citation" data-cites="runge_kutta_background">(<a href="#ref-runge_kutta_background" role="doc-biblioref">Cheever, n.d.</a>)</span>.</p>
<p>The following table summarizes the values <code>rk4sys</code> takes in:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 81%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter Name</strong></th>
<th><strong>What Does It Take In?</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>f</code></td>
<td>A user-defined function that defines the system of differential equations to be solved.</td>
</tr>
<tr class="even">
<td><code>a</code></td>
<td>A number specifying the starting point of the interval we want solutions for.</td>
</tr>
<tr class="odd">
<td><code>b</code></td>
<td>A number specifying the endpoint of the interval we want solutions for.</td>
</tr>
<tr class="even">
<td><code>y0</code></td>
<td>A vector specifying the initial values of the system. A system of <span class="math inline">\(m\)</span> differential equations must have a <code>y0</code> of length <span class="math inline">\(m\)</span>.</td>
</tr>
<tr class="odd">
<td><code>n</code></td>
<td>A number specifying the step size (i.e.&nbsp;the number of steps that should be taken from <code>a</code> to <code>b</code>.</td>
</tr>
</tbody>
</table>
<p>The function <code>rk4sys</code> returns a matrix. When that matrix is converted to a data frame using the function <code>as.data.frame</code>, its first column provides the time points at which the SIR model was solved and subsequent columns are the solutions to the model’s state variables at those times. The state variables for an SIR model are the number or proportion of individuals susceptible, infectious, and recovered at a given time.</p>
<p>Before we can call <code>rk4sys</code>, let’s go over how to code the function to be passed into the parameter <code>f</code>. The function below is specifying a classic SIR model on the proportion of individuals in each compartment (see <a href="#sec-the-classic-sir-epidemic-model" class="quarto-xref">Section&nbsp;2.3</a>).</p>
<p><strong>Step 1: Code the model function.</strong></p>
<div class="cell">
<div>
<div id="webr-7" class="exercise-cell">

</div>
<script type="webr-7-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiTW9kZWxGdW5jIDwtIGZ1bmN0aW9uKHRpbWUsc3RhdGUpe1xuICAjIEV4dHJhY3RpbmcgdGhlIHN0YXRlIHZhcmlhYmxlc1xuICAjIFdlIGhhdmUgdGhlIHN0YXRlIHZhcmlhYmxlcyBzdXNjZXB0aWJsZSwgaW5mZWN0ZWQsIGFuZCByZWNvdmVyZWQgKFMsSSxSKVxuICBTIDwtIHN0YXRlWzFdXG4gIEkgPC0gc3RhdGVbMl1cbiAgUiA8LSBzdGF0ZVszXVxuICBcbiAgIyBTcGVjaWZ5aW5nIHRoZSBtb2RlbCBwYXJhbWV0ZXJzXG4gICMgV2Ugb25seSBoYXZlIHR3byBwYXJhbWV0ZXJzIC0gdGhlIHRyYW5zbWlzc2lvbiBhbmQgcmVjb3ZlcnkgcmF0ZVxuICAjIFRoZXNlIHBhcmFtZXRlcnMgd2lsbCBjaGFuZ2UgZGVwZW5kaW5nIG9uIHRoZSBtb2RlbFxuICBiZXRhIDwtIDEuNVxuICBnYW1tYSA8LSAwLjVcbiAgXG4gICMgQ29uc3RydWN0aW5nIG91ciBTSVIgbW9kZWwgZXF1YXRpb25zXG4gIGRTIDwtIC0oYmV0YSpJKlMpXG4gIGRJIDwtIChiZXRhKkkqUykgLSAoZ2FtbWEqSSlcbiAgZFIgPC0gKGdhbW1hKkkpXG4gIFxuICAjIE5vdyB3ZSB3aWxsIHJldHVybiB0aG9zZSBtb2RlbCBlcXVhdGlvbnMgYXMgYSB2ZWN0b3JcbiAgcmV0dXJuKGMoZFMsZEksZFIpKVxufVxuXG4jIEV4YW1wbGUgY2FsbCAtIE91dHB1dHMgdGhlIHJhdGVzIG9mIGNoYW5nZSBmb3IgUywgSSwgYW5kIFIgZ2l2ZW4gdGhlIGlucHV0c1xuTW9kZWxGdW5jKDEsYyhTPTAuOTksST0wLjAxLFI9MCkpIn0=
</script>
</div>
</div>
<p><strong>Step 2: Specify the other parameters and call <code>rk4sys</code>.</strong></p>
<div class="cell">
<div>
<div id="webr-8" class="exercise-cell">

</div>
<script type="webr-8-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoibGlicmFyeShwcmFjbWEpXG5cbiMgSGVyZSB3ZSBhcmUgc3BlY2lmeWluZyB0aGUgc3RhcnQgYW5kIGVuZGluZyBwb2ludHMgb2YgdGhlIHNvbHV0aW9uIGludGVydmFsXG5zdGFydCA8LSAwXG5lbmQgPC0gMjBcblxuIyBIZXJlIHdlIGFyZSBzcGVjaWZ5aW5nIHRoZSBpbml0aWFsIHZhbHVlcyB0byBiZSBwYXNzZWQgaW50byB0aGUgcGFyYW1ldGVyIHlcbiMgTWFrZSBzdXJlIHZhbHVlcyBsaW5lIHVwIHdpdGggdGhlIHN0YXRlIHZhcmlhYmxlcyBpbiB0aGUgbW9kZWwgZnVuY3Rpb25cbmluaXRpYWxfdmFscyA8LSBjKFM9MC45OSxJPTAuMDEsUj0wKVxuXG4jIEhlcmUgd2UgYXJlIHNwZWNpZnlpbmcgaG93IG1hbnkgc3RlcHMgdG8gdGFrZSBmcm9tIGEgdG8gYlxuIyBBIGNvbW1vbiBjaG9pY2UgaXMgdG8gc2ltcGx5IHRha2UgYi1hIG51bWJlciBvZiBzdGVwcyBcbiMgVGhlIG1vcmUgc3RlcHMgd2UgdGFrZSwgdGhlIG1vcmUgYWNjdXJhdGUgb3VyIHJlc3VsdGluZyBzb2x1dGlvbnMgd2lsbCBiZVxuc3RlcF9zaXplIDwtIGVuZC1zdGFydFxuXG4jIE5vdyB3ZSBjYW4gY2FsbCB0aGUgZnVuY3Rpb24gcms0c3lzXG4jIFdlIGFyZSB3cmFwcGluZyB0aGUgZnVuY3Rpb24gTW9kZWxGdW5jIGluIGFub3RoZXIgZnVuY3Rpb24gc28gd2UgY2FuIHBhc3MgXG5vdXRwdXQgPC0gcms0c3lzKGY9TW9kZWxGdW5jLFxuICAgICAgICAgICAgICAgICBhPXN0YXJ0LFxuICAgICAgICAgICAgICAgICBiPWVuZCxcbiAgICAgICAgICAgICAgICAgeTA9aW5pdGlhbF92YWxzLFxuICAgICAgICAgICAgICAgICBuPXN0ZXBfc2l6ZSlcblxuIyBDb252ZXJ0aW5nIHRoZSBvdXRwdXQgbWF0cml4IHRvIGEgZGF0YSBmcmFtZSBhbmQgcHJpbnRpbmcgaXRcbm91dHB1dCA8LSBhcy5kYXRhLmZyYW1lKG91dHB1dClcbnByaW50KG91dHB1dCkifQ==
</script>
</div>
</div>
<p>Now that we have this matrix of the solved SIR model equations are at specified times, we can plot it.</p>
<p><strong>Step 3: Plot the results.</strong></p>
<div class="cell">
<div>
<div id="webr-9" class="exercise-cell">

</div>
<script type="webr-9-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoidGltZXMgPC0gb3V0cHV0JHhcblMgPC0gb3V0cHV0JHkuU1xuSSA8LSBvdXRwdXQkeS5JXG5SIDwtIG91dHB1dCR5LlJcbmJldGEgPC0gMS41XG5nYW1tYSA8LSAwLjVcblxucGxvdCh0aW1lcywgUywgdHlwZSA9IFwibFwiLCBjb2wgPSBcInN0ZWVsYmx1ZVwiLCBsd2QgPSAyLFxuICAgICB5bGltID0gYygwLCAxKSwgeGxhYiA9IFwiVGltZVwiLCB5bGFiID0gXCJQcm9wb3J0aW9uXCIsXG4gICAgIG1haW4gPSBwYXN0ZTAoXCJTSVIgRXBpZGVtaWMgKFJ1bmdlLUt1dHRhKSAgfCAgzrI9XCIsIGJldGEsXG4gICAgICAgICAgICAgICAgICAgXCIgIM6zPVwiLCBnYW1tYSwgXCIgIFLigoA9XCIsIHJvdW5kKGJldGEvZ2FtbWEsIDIpKSlcbmxpbmVzKHRpbWVzLCBJLCBjb2wgPSBcImZpcmVicmlja1wiLCBsd2QgPSAyKVxubGluZXModGltZXMsIFIsIGNvbCA9IFwic2VhZ3JlZW5cIiwgIGx3ZCA9IDIpXG5cbmxlZ2VuZChcInJpZ2h0XCIsIGxlZ2VuZCA9IGMoXCJTdXNjZXB0aWJsZVwiLCBcIkluZmVjdGlvdXNcIiwgXCJSZWNvdmVyZWRcIiksXG4gICAgICAgY29sID0gYyhcInN0ZWVsYmx1ZVwiLCBcImZpcmVicmlja1wiLCBcInNlYWdyZWVuXCIpLCBsd2QgPSAyLCBidHkgPSBcIm5cIikifQ==
</script>
</div>
</div>
</section>
<section id="sec-evaluating-and-comparing-both-methods" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="sec-evaluating-and-comparing-both-methods"><span class="header-section-number">2.4.3</span> Evaluating and Comparing Both Methods</h3>
<p>The following table summarizes some potential benefits and drawbacks to using Euler’s method or <code>rk4sys</code> in <code>pracma</code>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 31%">
<col style="width: 49%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Solving Method</strong></th>
<th><strong>Potential Benefits</strong></th>
<th><strong>Potential Drawbacks</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Euler’s Method</td>
<td>- Can be done by hand or implemented in code<br>- Simple to understand<br>- Full control over accuracy of model <br>- No external packages required</td>
<td>- Low accuracy unless an extremely small step size is used<br>- Computationally inefficient for small step sizes or complex models<br>- Can be tedious to calculate by hand</td>
</tr>
<tr class="even">
<td><code>rk4sys</code></td>
<td>- Uses an advanced solving method (Fourth-Order Runge-Kutta) that has a high accuracy<br>- Handles large models with many system equations well<br>- Efficient for complex models</td>
<td>- Less transparent approach; not much understanding of what is going on “under the hood”<br>- Requires learning new functions and syntax<br>- Depends on the external package <code>pracma</code><br> - Output accuracy depends greatly on step size</td>
</tr>
</tbody>
</table>
<p>The following simulation shows the difference between the solution curves produced by Euler’s method and <code>rk4sys</code> for different values of the model parameters and step size:</p>
<iframe src="http://127.0.0.1:4570" width="100%" height="700" style="border:none;">
</iframe>
</section>
</section>
<section id="sec-formulating-transmission-rate" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="sec-formulating-transmission-rate"><span class="header-section-number">2.5</span> Finding the Transmission Rate Using MLE</h2>
<p><em>Maximum likelihood estimation</em>, often shorthanded as MLE, is a statistical technique that estimates the value of an unknown parameter to be that which maximizes the probability of observing real-world data from the scenario of interest. Recalling from <a href="#sec-formulating-the-recovery-rate" class="quarto-xref">Section&nbsp;2.3.2</a>, the recovery rate is often found based on prior literature and held as a constant equal to the reciprocal of the average duration of infection. As such, for the epidemic SIR model, we generally only use MLE to estimate the value of the transmission rate <span class="math inline">\(\beta\)</span> <span class="citation" data-cites="parameter_estimation">(<a href="#ref-parameter_estimation" role="doc-biblioref">Senel, Ozdinc, and Ozturkcan 2021</a>)</span>.</p>
<p>MLE works by maximizing the <em>likelihood function</em>. The likelihood function provides the <em>likelihood</em>, or the probability of a given piece of data <span class="math inline">\(D_n\)</span> having occurred under a particular hypothesis (or model) <span class="math inline">\(H\)</span>, and is typically noted as <span class="math inline">\(\mathcal{L}(H,D_i)\)</span>. In other words, the likelihood function treats the model (i.e.&nbsp;particular values of <span class="math inline">\(\beta\)</span>) as an independent variable, or input, and outputs the probability of observing a particular piece of disease data collected. The likelihood function only provides the probability of observing a particular piece of data under different values of <span class="math inline">\(\beta\)</span>, but we are generally interested in finding and maximizing the probability of observing entire sets of data not just individual observations. Assuming the entire data set is <em>independent</em> (i.e.&nbsp;one observation in the data set does not affect what the other observations in the data set are), we can accomplish this by multiplying the individual likelihood functions <span class="math inline">\(\mathcal{L}(H,D_n)\)</span> for every individual piece of data <span class="math inline">\(D_1,D_2 \cdots , D_n\)</span> in the data set <span class="math inline">\(D\)</span> to get the overall likelihood of the entire set of data <span class="math inline">\(\mathcal{L}(H,D)\)</span>:</p>
<p><span class="math display">\[
\mathcal{L}(H,D)=\mathcal{L}(H,D_1) \times \mathcal{L}(H,D_2) \times \cdots \times \mathcal{L}(H,D_n)
\]</span></p>
<p>What this likelihood function looks like highly depends on the disease data we have available to us. Disease data often comes in two forms:</p>
<ul>
<li><p>Prevalence Count Data: Data that reports the total number of infected individuals at a time <span class="math inline">\(t\)</span>.</p></li>
<li><p>Incidence Data: Data that reports the number new infected individuals over a period of time from <span class="math inline">\(t\)</span> to <span class="math inline">\(t+\Delta t\)</span></p></li>
</ul>
<p>In this learning module, we will only cover the process for finding <span class="math inline">\(\beta\)</span> using MLE when we have prevalence count data, however. The MLE algorithm for prevalence count data follows these general steps:</p>
<ol type="1">
<li>Make an assumption about the distribution of the likelihood function. Oftentimes, this means assuming that every piece of observed data was randomly drawn from a Poisson distribution whose mean <span class="math inline">\(\lambda\)</span> is equal to the predicted value for the number of infectious individuals given by the SIR model at a time <span class="math inline">\(t\)</span>.</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this context, the Poisson distribution describes the probability of having observed a particular count of infected individuals at a time <span class="math inline">\(t\)</span> when the the average number of infectious individuals <span class="math inline">\(\lambda\)</span> is known. It’s important to note that we are not saying the prediction from the SIR model is random but rather that each data point was drawn randomly from a distribution centered around the predicted value given by the SIR model, and that distribution is Poisson. We can imagine that for every time <span class="math inline">\(t\)</span> there is a separate Poisson distribution centered around the predicted prevalence count obtained from the SIR model from which the observed prevalence counts were drawn.</p>
</div>
</div>
<ol start="2" type="1">
<li><p>Set a range of plausible values for the parameter of interest (<span class="math inline">\(\beta\)</span>) and iterate through all of them in tiny increments.</p></li>
<li><p>For each plausible value of <span class="math inline">\(\beta\)</span>, iterate through every data point in the set and calculate its likelihood <span class="math inline">\(\mathcal{L}(H,D_n)\)</span>. Multiply the likelihoods of all the data points together and store that value as <span class="math inline">\(\mathcal{L}(H,D)\)</span>.</p></li>
<li><p>Repeat step 3 for every value of <span class="math inline">\(\beta\)</span> in the plausible range.</p></li>
<li><p>Now that we have a collection of likelihoods for different SIR models, given by different values of <span class="math inline">\(\beta\)</span>, we should find the maximum among them and estimate the value of <span class="math inline">\(\beta\)</span> to be what provides that maximum likelihood (i.e.&nbsp;the maximum likelihood estimator). We can also graph the likelihoods to get a better idea of what pattern they follow and a visual representation of where the maximum occurs.</p></li>
</ol>
<p>There are a few small optimizations we often make to the maximum likelihood algorithm, firstly:</p>
<ul>
<li><p>We use <em>log-likelihoods</em> instead of raw likelihoods.</p>
<ul>
<li>Why do we do this?: The individual likelihoods <span class="math inline">\(\mathcal{L}(H,D_i)\)</span> represent the probability of observing a piece of data under a particular model, they are small numbers between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span> (since probability is always lies in the interval <span class="math inline">\([0,1]\)</span>). The MLE algorithm requires multiplying many of these small likelihoods together, and after a certain point (if our data set is big enough and we are multiplying enough individual likelihoods together), the computer might not be precise enough to represent such small number and simply round out our overall likelihood <span class="math inline">\(\mathcal{L}(H,D)\)</span> to be <span class="math inline">\(0\)</span>! We obviously want to avoid this, so we often opt to using <em>log-likelihoods</em> instead since logarithms convert very small numbers between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span> into numbers larger in magnitude but negative (thus avoiding potential rounding errors). Log-likelihoods are simply obtained by taking the logarithm of the likelihood function <span class="math inline">\(\mathcal{L}(H,D)\)</span>. When we do this, we must modify the way we calculate <span class="math inline">\(\mathcal{L}(H,D)\)</span>, since we would no longer be multiplying the individual likelihoods <span class="math inline">\(\mathcal{L}(H,D_i)\)</span> but rather adding them. Remembering back to our properties of logarithms, we have:</li>
</ul></li>
</ul>
<p><span class="math display">\[
\log(a \times b) = \log(a) + \log(b)
\]</span> And from this we get:</p>
<p><span class="math display">\[
\log[\mathcal{L}(H,D)]=\log[\mathcal{L}(H,D_1) \times \cdots \times \mathcal{L}(H,D_n)]=\log[\mathcal{L}(H,D_1)] + \cdots +  \log[\mathcal{L}(H,D_n)]
\]</span></p>
<p>Taking the logarithm of the likelihood function will not change the results of MLE, making our maximum likelihood estimator for <span class="math inline">\(\beta\)</span> the same whether we use log-likelihoods or raw likelihoods.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Why doesn’t taking the logarithm of the likelihood function change the results of MLE?: The reason using log-likelihoods doesn’t affect MLE is because the logarithm function is always increasing, so it doesn’t actually change where the relative maxima of a function occur. If we have a function <span class="math inline">\(f(x)\)</span> with, say, relative maxima at <span class="math inline">\(x=2,3,4\)</span>, then <span class="math inline">\(\log[f(x)]\)</span> would still have relative maxima at <span class="math inline">\(x=2,3,4\)</span>. The process for MLE is dependent directly on finding where the relative maxima of the likelihood function occurs, so taking the logarithm doesn’t affect its output.</p>
</div>
</div>
<p>Including this optimization, our final modified MLE algorithm goes like so:</p>
<ol type="1">
<li><p>Make an assumption about the distribution of the likelihood function. Oftentimes, this means assuming that every piece of observed data was randomly drawn from a Poisson distribution whose mean <span class="math inline">\(\lambda\)</span> is equal to the predicted value for the number of infectious individuals given by the SIR model at a time <span class="math inline">\(t\)</span>.</p></li>
<li><p>Set a range of plausible values for the parameter of interest (<span class="math inline">\(\beta\)</span>) and iterate through all of them in tiny increments.</p></li>
<li><p>For each plausible value of <span class="math inline">\(\beta\)</span>, iterate through every data point in the set and calculate its log-likelihood <span class="math inline">\(\log[\mathcal{L}(H,D_i)]\)</span>. Add the log-likelihoods of all the data points together and store that value as <span class="math inline">\(\log[\mathcal{L}(H,D)]\)</span>.</p></li>
<li><p>Repeat step 3 for every value of <span class="math inline">\(\beta\)</span> in the plausible range.</p></li>
<li><p>Now that we have a collection of likelihoods for different SIR models, given by different values of <span class="math inline">\(\beta\)</span>, we should find the maximum among them and estimate the value of <span class="math inline">\(\beta\)</span> to be what provides that maximum likelihood (i.e.&nbsp;the maximum likelihood estimator). We can also graph the likelihoods to get a better idea of what pattern they follow and a visual representation of where the maximum occurs.</p></li>
</ol>
<p>This whole process can be really hard to conceptualize at first without concrete examples. We go over a few code examples of MLE coded from stratch and MLE using the <code>bbmle</code> package in R in <a href="#sec-coding-scratch" class="quarto-xref">Sections&nbsp;2.5.0.1</a> and <a href="#sec-bbmle" class="quarto-xref">Section&nbsp;2.5.0.2</a>.</p>
<section id="sec-coding-scratch" class="level4" data-number="2.5.0.1">
<h4 data-number="2.5.0.1" class="anchored" data-anchor-id="sec-coding-scratch"><span class="header-section-number">2.5.0.1</span> Coding An MLE Algorithm From Scratch</h4>
<p>Suppose we have the following SIR epidemic model and we wish to use MLE to estimate the value of <span class="math inline">\(\beta\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS}{dt} &amp;= -\beta \left(\frac{I}{N}\right) S \\[10pt]
\frac{dI}{dt} &amp;= \beta \left(\frac{I}{N}\right)  S - \gamma I \\[10pt]
\frac{dR}{dt} &amp;= \gamma I
\end{aligned}
\]</span></p>
<p>For this model, <span class="math inline">\(t\)</span> is in units of days, the total size of the population we are modelling is <span class="math inline">\(N=1000\)</span> people, and the initial number of susceptible, infected, and recovered individuals is <span class="math inline">\(S=999\)</span>, <span class="math inline">\(I=1\)</span>, and <span class="math inline">\(R=0\)</span>, respectively.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>These SIR equations are providing the number, not proportion, of individuals in each compartment. This is important because the prevalence count data we will be using to find <span class="math inline">\(\beta\)</span> is also a number, not a proportion. Additionally, our assumption mentioned in <a href="#sec-formulating-transmission-rate" class="quarto-xref">Section&nbsp;2.5</a> that the data follows a Poisson distribution is only valid if both our data and model are counts of people, not proportions, since the Poisson distribution is a discrete distribution only able to take on non-negative integer values.</p>
</div>
</div>
<p>Let’s also assume that we know the recovery rate to be <span class="math inline">\(\gamma=0.7\)</span> people per day based on past literature. Substituting this into our SIR equations we have:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS}{dt} &amp;= -\beta \left(\frac{I}{N}\right)  S \\[10pt]
\frac{dI}{dt} &amp;= \beta \left(\frac{I}{N}\right)  S - 0.7 I \\[10pt]
\frac{dR}{dt} &amp;= 0.7 I
\end{aligned}
\]</span></p>
<p>Now that we have our basic model equations, let’s code an algorithm to find the maximum likelihood estimator for <span class="math inline">\(\beta\)</span>.</p>
<p><strong>Step 1: Generate test prevalence data.</strong></p>
<div class="cell">
<div>
<div id="webr-10" class="exercise-cell">

</div>
<script type="webr-10-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoibGlicmFyeShwcmFjbWEpXG5cbiMgRW5zdXJlcyB0aGF0IHRoZSByYW5kb20gcHJvY2Vzc2VzIHJ1biB0aGUgc2FtZSBldmVyeSB0aW1lXG5zZXQuc2VlZCgxMjMpXG5cbiMgQ29kaW5nIHRoZSBTSVIgbW9kZWwgZnVuY3Rpb25cbk1vZGVsRnVuYyA8LSBmdW5jdGlvbih0aW1lLHN0YXRlLHBhcmFtZXRlcnMpe1xuICBTIDwtIHN0YXRlWzFdXG4gIEkgPC0gc3RhdGVbMl1cbiAgUiA8LSBzdGF0ZVszXVxuXG4gIGJldGEgPC0gcGFyYW1ldGVyc1tcImJldGFcIl1cbiAgZ2FtbWEgPC0gcGFyYW1ldGVyc1tcImdhbW1hXCJdXG4gIE4gPC0gcGFyYW1ldGVyc1tcIk5cIl1cblxuICBkUyA8LSAtKGJldGEqSSpTL04pXG4gIGRJIDwtIChiZXRhKkkqUy9OKSAtIChnYW1tYSpJKVxuICBkUiA8LSAoZ2FtbWEqSSlcblxuICByZXR1cm4oYyhkUyxkSSxkUikpXG59XG5cbiMgUGFyYW1ldGVycyBvZiB0aGUgU0lSIG1vZGVsIGZyb20gd2hpY2ggb3VyIGRhdGEgd2lsbCBiZSBnZW5lcmF0ZWRcbm1vZGVsX3BhcmFtZXRlcnMgPC0gYyhiZXRhID0gMS4yLCBnYW1tYSA9IDAuNywgTiA9IDEwMDApXG5cbiMgTnVtYmVyIG9mIFMsSSxSIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGVwaWRlbWljIChpbml0aWFsIHN0YXRlIHZhcmlhYmxlcylcbmluaXRpYWxfdmFscyA8LSBjKFMgPSA5OTksIEkgPSAxLCBSID0gMClcblxuIyBTcGVjaWZ5aW5nIGhvdyBtYW55IGRheXMgdG8gZ2VuZXJhdGUgZGF0YSBmb3JcbnRfc3RhcnQgPC0gMFxudF9lbmQgPC0gMzVcbnN0ZXBfc2l6ZSA8LSB0X2VuZCAtIHRfc3RhcnRcblxuIyBTb2x2aW5nIFNJUiBlcXVhdGlvbiBhdCBzcGVjaWZpZWQgb3V0cHV0IHRpbWVzXG5vdXRwdXQgPC0gcms0c3lzKHkwPWluaXRpYWxfdmFscyxcbiAgICAgICAgICAgICAgICAgYSA9IHRfc3RhcnQsXG4gICAgICAgICAgICAgICAgIGIgPSB0X2VuZCxcbiAgICAgICAgICAgICAgICAgZiA9IGZ1bmN0aW9uKHQseSkgTW9kZWxGdW5jKHQseSxtb2RlbF9wYXJhbWV0ZXJzKSxcbiAgICAgICAgICAgICAgICAgbiA9IHN0ZXBfc2l6ZSlcblxuIyBFeHRyYWN0aW5nIHRoZSB0cnVlIHByZXZhbGVuY2UgY291bnRzXG5vdXRwdXRfZGYgPC0gYXMuZGF0YS5mcmFtZShvdXRwdXQpXG5JX3RydWUgPC0gb3V0cHV0X2RmJHkuSVxuXG4jIEFkZGluZyBub2lzZSB0byB0aGUgdHJ1ZSBwcmV2YWxlbmNlIGNvdW50cyAodG8gbWltaWMgcmFuZG9tIHNhbXBsaW5nKVxuSV9vYnNlcnZlZCA8LSBycG9pcyhsZW5ndGgoSV90cnVlKSwgbGFtYmRhID0gSV90cnVlKVxuXG4jIFNhdmluZyB0aGUgdHJ1ZSBhbmQgcHNldWRvLXNhbXBsZWQgcHJldmFsZW5jZSBjb3VudHMgYXMgYSBkYXRhIGZyYW1lXG5kYXRhIDwtIGRhdGEuZnJhbWUoZGF5ID0gdF9zdGFydDp0X2VuZCxcbiAgICAgICAgICAgICAgICAgICBwcmV2YWxlbmNlX2NvdW50ID0gSV9vYnNlcnZlZClcblxucHJpbnQoZGF0YSkifQ==
</script>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We can actually test how accurate our estimate for <span class="math inline">\(\beta\)</span> found using MLE is by seeing how close it is to the <span class="math inline">\(\beta\)</span> used to generate the data (i.e.&nbsp;the value of <code>beta</code> in the named vector <code>model_parameters</code> in the code above)!</p>
</div>
</div>
<p>Now that we have our data and a function for our SIR model called <code>ModelFunc</code>, our next step is to is to code a function to solve our SIR model for any value of <span class="math inline">\(\beta\)</span> and output what it predicts the number of infected individuals to be at various times.</p>
<p><strong>Step 2: Code a function to return predicted prevalences.</strong></p>
<div class="cell">
<div>
<div id="webr-11" class="exercise-cell">

</div>
<script type="webr-11-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBGdW5jdGlvbiBJbnB1dHM6IE1vZGVsIHBhcmFtZXRlcnMgYW5kIGEgdmVjdG9yIG9mIHRpbWVzXG4jIEZ1bmN0aW9uIE91dHB1dHM6IFByZWRpY3RlZCBwcmV2YWxlbmNlIGNvdW50cyBhdCBpbnB1dCB0aW1lc1xuXG5wcmVkIDwtIGZ1bmN0aW9uKHBhcmFtZXRlcnMsdCl7XG4gIGluaXRpYWxfdmFscyA8LSBjKFM9OTk5LEk9MSxSPTApXG4gIHRfc3RhcnQgPC0gMFxuICB0X2VuZCA8LSBtYXgodClcbiAgc3RlcF9zaXplIDwtIHRfZW5kIC0gdF9zdGFydFxuICBvdXRwdXQgPC0gcms0c3lzKHkwPWluaXRpYWxfdmFscyxcbiAgICAgICAgICAgICAgICAgYT10X3N0YXJ0LFxuICAgICAgICAgICAgICAgICBiPXRfZW5kLFxuICAgICAgICAgICAgICAgICBmPWZ1bmN0aW9uKHQseSkgTW9kZWxGdW5jKHQseSxwYXJhbWV0ZXJzKSxcbiAgICAgICAgICAgICAgICAgbj1zdGVwX3NpemUpXG4gIFxuICAjIEV4dHJhY3Rpbmcgb25seSB0aGUgcHJlZGljdGVkIHByZXZhbGVuY2VzIGF0IHRoZSBpbnB1dCB0aW1lc1xuICBvdXRwdXRfZGYgPC0gYXMuZGF0YS5mcmFtZShvdXRwdXQpXG4gIHByZXZhbGVuY2VzIDwtIG91dHB1dF9kZiR5LklbdF1cblxuICAjIEVuc3VyaW5nIHRoZXJlIGFyZSBubyBOYU5zIG9yIG91dCBvZiBib3VuZHMgbnVtYmVycyBpbiB0aGUgb3V0cHV0XG4gICMgTmFOcyBhcmUgcHJvZHVjZWQgd2hlbiBhIGRlY2ltYWwgYmVjb21lcyB0b28gc21hbGwgdG8gcmVwcmVzZW50XG4gIHByZXZhbGVuY2VzW2lzLm5hbihwcmV2YWxlbmNlcykgfCBwcmV2YWxlbmNlcyA8IDAgXSA8LSAwXG4gIHJldHVybihwcmV2YWxlbmNlcylcbn1cblxuIyBFeGFtcGxlIGNhbGxzXG5wcmVkKGMoYmV0YT0xLjIsZ2FtbWE9MC43LE49MTAwMCksYygxMywxNCwxNSkpIn0=
</script>
</div>
</div>
<p>Now that we have our function to output the predicted prevalence counts given by our SIR model, we need to code a function to calculate the log-likelihood of the entire data set given certain model parameters.</p>
<p><strong>Step 3: Code a function to calculate log-likelihoods given different parameter values.</strong></p>
<div class="cell">
<div>
<div id="webr-12" class="exercise-cell">

</div>
<script type="webr-12-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBGdW5jdGlvbiBJbnB1dHM6IE5hbWVkIHZlY3RvciBvZiBtb2RlbCBwYXJhbWV0ZXJzIGFuZCB0aGUgZGF0YSBzZXRcbiMgRnVuY3Rpb24gT3V0cHV0czogTG9nLWxpa2VsaWhvb2Qgb2YgZW50aXJlIGRhdGEgc2V0XG5sb2dfbGlrZWxpaG9vZCA8LSBmdW5jdGlvbihwYXJhbWV0ZXJzLGRhdGEpe1xuICB0aW1lcyA8LSBkYXRhJGRheVxuICBwcmVkaWN0ZWQgPC0gcHJlZChwYXJhbWV0ZXJzLHRpbWVzKVxuICBcbiAgIyBOb3RlOiBUaGUgZnVuY3Rpb24gZHBvaXMgZ2l2ZXMgUG9pc3NvbiBwcm9iYWJpbGl0aWVzXG4gIHN1bShkcG9pcyh4PWRhdGEkcHJldmFsZW5jZV9jb3VudCxsYW1iZGE9cHJlZGljdGVkLGxvZz1UUlVFKSlcbn1cblxuIyBFeGFtcGxlIGNhbGxcbmxvZ19saWtlbGlob29kKGMoYmV0YT0xLjQsZ2FtbWE9MC43LE49MTAwMCksZGF0YSlcbmxvZ19saWtlbGlob29kKGMoYmV0YT0yLjMsZ2FtbWE9MC43LE49MTAwMCksZGF0YSkifQ==
</script>
</div>
</div>
<p>Our final step is to code a driver function that iterates through plausible values of <span class="math inline">\(\beta\)</span>, calculating the log-likelihood of the entire set of data for each, and outputs the maximum likelihood estimator for <span class="math inline">\(\beta\)</span> (i.e.&nbsp;the <span class="math inline">\(\beta\)</span> which produces the greatest log-likelihood).</p>
<p><strong>Step 4: Code a function to return the maximum likelihood estimator.</strong></p>
<div class="cell">
<div>
<div id="webr-13" class="exercise-cell">

</div>
<script type="webr-13-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBGdW5jdGlvbiBJbnB1dHM6IFVwcGVyIGxpbWl0IG9uIHRoZSB2YWx1ZSBvZiBiZXRhIGFuZCB0aGUgZGF0YSBzZXRcbiMgRnVuY3Rpb24gT3VwdXRzOiBBIHBsb3Qgb2YgdGhlIGxvZy1saWtlbGlob29kcyBhbmQgdGhlIGVzdGltYXRlIGZvciBiZXRhXG5tbGUgPC0gZnVuY3Rpb24ocGxhdXNpYmxlX2JldGEsZGF0YSl7XG4gIHJhbmdlX2JldGEgPC0gc2VxKDEscGxhdXNpYmxlX2JldGEsYnk9MC4wMSlcbiAgXG4gICMgRGF0YSBmcmFtZSBvZiBsb2ctbGlrZWxpaG9vZHMgZm9yIGVhY2ggYmV0YVxuICBhbGxfbGwgPC0gZGF0YS5mcmFtZSgpXG4gIFxuICBmb3IgKGJldGEgaW4gcmFuZ2VfYmV0YSl7XG4gICAgcGFyYW1zIDwtIGMoYmV0YT1iZXRhLGdhbW1hPTAuNyxOPTEwMDApXG4gICAgbmV3X2xsIDwtIGRhdGEuZnJhbWUoYmV0YT1iZXRhLGxsPWxvZ19saWtlbGlob29kKHBhcmFtcyxkYXRhKSlcbiAgICBhbGxfbGwgPC0gcmJpbmQoYWxsX2xsLG5ld19sbClcbiAgfVxuICBcbiAgIyBGaW5kaW5nIHRoZSBiZXRhIHRoYXQgcmVzdWx0cyBpbiB0aGUgZ3JlYXRlc3QgbG9nLWxpa2VsaWhvb2RcbiAgYmV0YV9tbGUgPC0gYWxsX2xsJGJldGFbd2hpY2gubWF4KGFsbF9sbCRsbCldXG4gIFxuICBcbiAgIyBQbG90dGluZyBhbGwgdGhlIGxvZy1saWtlbGlob29kcyBhZ2FpbnN0IHRoZSBiZXRhc1xuICBwbG90KGFsbF9sbCRiZXRhLFxuICAgICAgIGFsbF9sbCRsbCxcbiAgICAgICB0eXBlPVwibFwiLHhsYWI9XCJiZXRhXCIsXG4gICAgICAgeWxhYj1cImxvZy1saWtlbGlob29kXCIsXG4gICAgICAgbWFpbj1cIkxvZy1saWtlbGlob29kIHZzIEJldGFcIilcbiAgXG4gICMgUGxvdHRpbmcgYSBzZXBhcmF0ZSBsaW5lIHdoZXJlIHRoZSBtYXhpbXVtIGxpa2VsaWhvb2QgZXN0aW1hdGUgZm9yIGJldGEgaXMgXG4gIGJldGFfbWxlIDwtIGFsbF9sbCRiZXRhW3doaWNoLm1heChhbGxfbGwkbGwpXVxuICBhYmxpbmUodj1iZXRhX21sZSxsdHk9MilcblxuICAjIFJldHVybmluZyB0aGUgZXN0aW1hdGVcbiAgcmV0dXJuKGJldGFfbWxlKVxufVxuXG5tbGUoNSxkYXRhKSJ9
</script>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Try this">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try this
</div>
</div>
<div class="callout-body-container callout-body">
<p>Go back to <strong>Step 1</strong> and try the following changes, re-running each step in order:</p>
<ol type="1">
<li>Change <code>model_parameters &lt;- c(beta = 1.2, gamma = 0.7, N = 1000)</code> to <code>model_parameters &lt;- c(beta = 1.7, gamma = 0.7, N = 1000)</code> and re-run the other steps. Does the maximum likelihood estimate for <span class="math inline">\(\beta\)</span> returned in <strong>Step 4</strong> reflect this change? What about for other values of <code>beta</code>?</li>
</ol>
</div>
</div>
<p>This code might seem like a lot, but not to worry: there is a much easier way of doing MLE in R using the <code>bbmle</code> package! Read on to <a href="#sec-bbmle" class="quarto-xref">Section&nbsp;2.5.0.2</a> to learn how we can utilize the function <code>mle2</code> in the <code>bbmle</code> package to simplify conducting MLE in R.</p>
<p><strong>SECTION REFERENCE</strong></p>
<p>https://daphnia.ecology.uga.edu/drakelab/wp-content/uploads/2014/07/likelihood.pdf</p>
</section>
<section id="sec-bbmle" class="level4" data-number="2.5.0.2">
<h4 data-number="2.5.0.2" class="anchored" data-anchor-id="sec-bbmle"><span class="header-section-number">2.5.0.2</span> MLE Using the bbmle Package in R</h4>
<p>Although knowing how to code an MLE algorithm by hand is useful to first grasp the concept, in practicality it is inefficient which is why we often opt to use packages such as <code>bbmle</code> in R, which has the function <code>mle2</code> that makes it much easier.</p>
<p>Before we can use <code>bbmle</code> we must generate our data. This is the same code used to generate data in <a href="#sec-coding-scratch" class="quarto-xref">Section&nbsp;2.5.0.1</a>.</p>
<p><strong>Step 1: Generate test prevalence data.</strong></p>
<div class="cell">
<div>
<div id="webr-14" class="exercise-cell">

</div>
<script type="webr-14-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoibGlicmFyeShwcmFjbWEpXG5cbiMgRW5zdXJlcyB0aGF0IHRoZSByYW5kb20gcHJvY2Vzc2VzIHJ1biB0aGUgc2FtZSBldmVyeSB0aW1lXG5zZXQuc2VlZCgxMjMpXG5cbiMgU0lSIG1vZGVsIGZ1bmN0aW9uXG5Nb2RlbEZ1bmMgPC0gZnVuY3Rpb24odGltZSxzdGF0ZSxwYXJhbWV0ZXJzKXtcbiAgUyA8LSBzdGF0ZVsxXVxuICBJIDwtIHN0YXRlWzJdXG4gIFIgPC0gc3RhdGVbM11cblxuICBiZXRhIDwtIHBhcmFtZXRlcnNbXCJiZXRhXCJdXG4gIGdhbW1hIDwtIHBhcmFtZXRlcnNbXCJnYW1tYVwiXVxuICBOIDwtIHBhcmFtZXRlcnNbXCJOXCJdXG5cbiAgZFMgPC0gLShiZXRhKkkqUy9OKVxuICBkSSA8LSAoYmV0YSpJKlMvTikgLSAoZ2FtbWEqSSlcbiAgZFIgPC0gKGdhbW1hKkkpXG5cbiAgcmV0dXJuKGMoZFMsZEksZFIpKVxufVxuXG4jIFBhcmFtZXRlcnMgb2YgdGhlIFNJUiBtb2RlbCBmcm9tIHdoaWNoIG91ciBkYXRhIHdpbGwgYmUgZ2VuZXJhdGVkXG5tb2RlbF9wYXJhbWV0ZXJzIDwtIGMoYmV0YSA9IDEuMiwgZ2FtbWEgPSAwLjcsIE4gPSAxMDAwKVxuXG4jIE51bWJlciBvZiBTLEksUiBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBlcGlkZW1pYyAoaW5pdGlhbCBzdGF0ZSB2YXJpYWJsZXMpXG5pbml0aWFsX3ZhbHMgPC0gYyhTID0gOTk5LCBJID0gMSwgUiA9IDApXG5cbiMgU3BlY2lmeWluZyBob3cgbWFueSBkYXlzIHRvIGdlbmVyYXRlIGRhdGEgZm9yXG50X3N0YXJ0IDwtIDBcbnRfZW5kIDwtIDM1XG5zdGVwX3NpemUgPC0gdF9lbmQgLSB0X3N0YXJ0XG5cbiMgU29sdmluZyBTSVIgZXF1YXRpb24gYXQgc3BlY2lmaWVkIG91dHB1dCB0aW1lc1xub3V0cHV0IDwtIHJrNHN5cyh5MD1pbml0aWFsX3ZhbHMsXG4gICAgICAgICAgICAgICAgIGEgPSB0X3N0YXJ0LFxuICAgICAgICAgICAgICAgICBiID0gdF9lbmQsXG4gICAgICAgICAgICAgICAgIGYgPSBmdW5jdGlvbih0LHkpIE1vZGVsRnVuYyh0LHksbW9kZWxfcGFyYW1ldGVycyksXG4gICAgICAgICAgICAgICAgIG4gPSBzdGVwX3NpemUpXG5cbiMgRXh0cmFjdGluZyB0aGUgdHJ1ZSBwcmV2YWxlbmNlIGNvdW50c1xub3V0cHV0X2RmIDwtIGFzLmRhdGEuZnJhbWUob3V0cHV0KVxuSV90cnVlIDwtIG91dHB1dF9kZiR5LklcblxuIyBBZGRpbmcgbm9pc2UgdG8gdGhlIHRydWUgcHJldmFsZW5jZSBjb3VudHMgKHRvIG1pbWljIHJhbmRvbSBzYW1wbGluZylcbklfb2JzZXJ2ZWQgPC0gcnBvaXMobGVuZ3RoKElfdHJ1ZSksIGxhbWJkYSA9IElfdHJ1ZSlcblxuIyBTYXZpbmcgdGhlIHRydWUgYW5kIHBzZXVkby1zYW1wbGVkIHByZXZhbGVuY2UgY291bnRzIGFzIGEgZGF0YSBmcmFtZVxuZGF0YSA8LSBkYXRhLmZyYW1lKGRheSA9IHRfc3RhcnQ6dF9lbmQsXG4gICAgICAgICAgICAgICAgICAgcHJldmFsZW5jZV9jb3VudCA9IElfb2JzZXJ2ZWQpXG5cbnByaW50KGRhdGEpIn0=
</script>
</div>
</div>
<p>Now that we have our data, let’s go over the basics <code>mle2</code>. <code>mle2</code> has many arguments, which can be read up on in the (R documentation for the <code>mle2</code> function)<span class="citation" data-cites="docs_bbmle_mle2">(<a href="#ref-docs_bbmle_mle2" role="doc-biblioref"><span>“Mle2: Maximum Likelihood Estimation,”</span> n.d.</a>)</span>, however there are only two required parameters:</p>
<ul>
<li><p><code>minuslogl</code>: A function or formula to calculate the <em>negative</em> log-likelihood given a value for our parameter of interest (<span class="math inline">\(\beta\)</span>)</p></li>
<li><p><code>start</code>: An initial guess for the value of the parameter of interest (<span class="math inline">\(\beta\)</span>)</p></li>
</ul>
<p>We will also make use of two other parameters to ensure our code runs smoothly:</p>
<ul>
<li><p><code>method</code>: A string indicating what MLE algorithm method should be used. A summary of each method and how they change the MLE algorithm can be read up in the <span class="citation" data-cites="docs_stats_optim">(R Documentation for the <code>optim</code> function <a href="#ref-docs_stats_optim" role="doc-biblioref"><span>“Optim: General-Purpose Optimization,”</span> n.d.</a>)</span>. We will only make use of the method <code>"L-BFGS-B"</code>, or the <em>box constraint</em> method. This method allows for us to set a lower / upper bound on our parameter of interest <span class="math inline">\(\beta\)</span>. This is useful since we know <span class="math inline">\(\beta&gt;=0\)</span>, so we can set our lower bound to be a very small number such as <span class="math inline">\(0.01\)</span> to ensure that no <code>NaN</code>s are produced when we call <code>mle2</code>. Likewise, we can set an optional upper bound on <span class="math inline">\(\beta\)</span> so we can avoid unnecessary computations if we reasonably know it to be below a certain value.</p></li>
<li><p><code>lower</code> / <code>upper</code>: These parameters are specified when using the <code>"L-BFGS-B"</code> method. These take a named vector including the lower and upper bounds of the parameter(s) of interest. Note that <code>lower</code> is a required parameter when using the <code>"L-BFGS-B"</code> method but <code>upper</code> is an optional parameter.</p></li>
</ul>
<p><strong>Step 2: Call <code>mle2</code> and return maximum likelihood estimate.</strong></p>
<div class="cell">
<div>
<div id="webr-15" class="exercise-cell">

</div>
<script type="webr-15-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoibGlicmFyeShiYm1sZSlcblxuIyBGdW5jdGlvbiBJbnB1dHM6IEEgbmFtZWQgdmVjdG9yIG9mIG1vZGVsIFBhcmFtZXRlcnMgYW5kIGEgdGltZSB0XG4jIEZ1bmN0aW9uIE91dHB1dHM6IFRoZSBwcmVkaWN0ZWQgcHJldmFsZW5jZSBjb3VudCBhdCB0aW1lIHRcbnByZWQgPC0gZnVuY3Rpb24ocGFyYW1ldGVycyx0KXtcbiAgaW5pdGlhbF92YWxzIDwtIGMoUz05OTksST0xLFI9MClcbiAgdF9zdGFydCA8LSAwXG4gIHRfZW5kIDwtIG1heCh0KVxuICBzdGVwX3NpemUgPC0gdF9lbmQgLSB0X3N0YXJ0XG4gIG91dHB1dCA8LSByazRzeXMoeTA9aW5pdGlhbF92YWxzLFxuICAgICAgICAgICAgICAgICBhPXRfc3RhcnQsXG4gICAgICAgICAgICAgICAgIGI9dF9lbmQsXG4gICAgICAgICAgICAgICAgIGY9ZnVuY3Rpb24odCx5KSBNb2RlbEZ1bmModCx5LHBhcmFtZXRlcnMpLFxuICAgICAgICAgICAgICAgICBuPXN0ZXBfc2l6ZSlcbiAgXG4gICMgRXh0cmFjdGluZyBwcmVkaWN0ZWQgcHJldmFsZW5jZXNcbiAgb3V0cHV0X2RmIDwtIGFzLmRhdGEuZnJhbWUob3V0cHV0KVxuICBwcmV2YWxlbmNlcyA8LSBvdXRwdXRfZGYkeS5JW3RdXG5cbiAgIyBFbnN1cmluZyB0aGVyZSBhcmUgbm8gTmFOcyBvciBvdXQgb2YgYm91bmRzIG51bWJlcnMgaW4gdGhlIG91dHB1dFxuICBwcmV2YWxlbmNlc1tpcy5uYW4ocHJldmFsZW5jZXMpIHwgcHJldmFsZW5jZXMgPCAwIF0gPC0gMFxuICByZXR1cm4ocHJldmFsZW5jZXMpXG59XG4gIFxuIyBGdW5jdGlvbiBJbnB1dHM6IEEgbmFtZWQgbGlzdCBjb250YWluaW5nIGEgdmFsdWUgZm9yIGJldGFcbiMgRnVuY3Rpb24gT3VwdXRzOiBUaGUgbG9nLWxpa2VsaWhvb2Qgb2YgdGhlIGRhdGEgZ2l2ZW4gdGhlIGlucHV0IGJldGFcbnBvaXNzb25fbGwgPC0gZnVuY3Rpb24oYil7XG4gIHRpbWVzIDwtIGRhdGEkZGF5XG4gIHBhcmFtZXRlcnMgPC0gYyhiZXRhPWIsZ2FtbWE9MC43LE49MTAwMClcbiAgcHJlZGljdGVkIDwtIHByZWQocGFyYW1ldGVycyx0aW1lcylcbiAgLXN1bShkcG9pcyh4PWRhdGEkcHJldmFsZW5jZV9jb3VudCxsYW1iZGE9cHJlZGljdGVkLGxvZz1UUlVFKSlcbn1cblxuIyBPdXIgaW5pdGlhbCBndWVzcyBmb3Igd2hhdCBiZXRhIGlzXG4jIFRyeSBtYWtpbmcgdGhlIGluaXRpYWwgZ3Vlc3Mgb25lIHRoYXQgaXMgcGxhdXNpYmx5IGNsb3NlIHRvIHRoZSB0cnVlIHBhcmFtZXRlclxuIyBJZiBvdXIgZ3Vlc3MgaXMgdG9vIGZhciBvZmYgdGhlbiBtbGUyIG1pZ2h0IHJldHVybiBzb21lIGVycm9yc1xuc3RhcnQgPC0gbGlzdChiPTIpXG5cbiMgVXNpbmcgdGhlIEwtQkZHUy1CIGFsZ29yaXRobSAvIG1ldGhvZCBmb3IgTUxFIFxuIyBTZXR0aW5nIHRoZSBsb3dlciBib3VuZCB0byBiZSBzbWFsbCBidXQgcG9zaXRpdmUgc2luY2UgYmV0YSBpcyBub24tbmVnYXRpdmVcbnJlc3VsdCA8LSBtbGUyKG1pbnVzbG9nbD1wb2lzc29uX2xsLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0PXN0YXJ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZD1cIkwtQkZHUy1CXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXI9YyhiPTAuMDEpKVxuXG4jIFByaW50aW5nIHRoZSByZXN1bHRcbnJlc3VsdFxuXG4jIEV4dHJhY3RpbmcganVzdCB0aGUgbWF4aW11bSBsaWtlbGlob29kIGVzdGltYXRlIGZvciBiZXRhXG5jb2VmKHJlc3VsdCkifQ==
</script>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You’ll notice that the estimate we get for <span class="math inline">\(\beta\)</span> using <code>mle2</code> is approximately equal to the one we obtain from our MLE algorithm coded by scratch (as we would expect) except that it is accurate to a far greater decimal place. This is because our MLE algorithm coded by hand is only incrementing through values of <span class="math inline">\(\beta\)</span> in steps of size <span class="math inline">\(0.01\)</span> for computational efficiency. The function <code>mle2</code> on the other hand employs much more sophisticated techniques to iterate through values of <span class="math inline">\(\beta\)</span> and calculating their log-likelihood, making the estimate it returns much more precise.</p>
</div>
</div>
</section>
</section>
<section id="sec-reproduction-numbers" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="sec-reproduction-numbers"><span class="header-section-number">2.6</span> Reproduction Numbers</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li><p>Define what the basic and effective reproduction number is and recall primary differences between the two.</p></li>
<li><p>Interpret the basic and effective reproduction number in context.</p></li>
<li><p>Recall the formulas for the basic and effective reproduction numbers.</p></li>
<li><p>Explain what the “threshold phenomenon” is.</p></li>
</ul>
</div>
</div>
<p>The reproductive number is defined as “the average number of secondary infectious cases caused by one infectious individual (before they recover or die or are otherwise not able to further transmit)” <span class="citation" data-cites="Handel2021_IDEMA_ch5">(<a href="#ref-Handel2021_IDEMA_ch5" role="doc-biblioref">Handel 2021</a>)</span>.</p>
<p>The table below summarizes the two types of reproduction numbers we will focus on:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Name</strong></th>
<th><strong>Symbol</strong></th>
<th><strong>Interpretation</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Basic Reproduction Number</td>
<td><span class="math inline">\(R_0\)</span></td>
<td>The average number of secondary infections produced by a single infectious individual in a <em>completely susceptible</em> population. This can also be thought of as the reproduction number calculated at the beginning of an outbreak (when basically everyone is suceptible).</td>
</tr>
<tr class="even">
<td>Effective Reproduction Number</td>
<td><span class="math inline">\(R_{e}\)</span></td>
<td>The average number of secondary infections produced by a single infectious individual in a population with a susceptible proportion equal to <span class="math inline">\(\frac{S}{N}\)</span></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some common misconceptions about <span class="math inline">\(R_0\)</span> and <span class="math inline">\(R_e\)</span> are:</p>
<ul>
<li><p>“Must <span class="math inline">\(R_0\)</span> and <span class="math inline">\(R_e\)</span> be whole numbers because nobody can transmit the disease to, say, half a person?”</p>
<ul>
<li>No, <span class="math inline">\(R_0\)</span> and <span class="math inline">\(R_e\)</span> do not have to be whole numbers because they refer to <em>averages</em>, not the exact number of secondary infections produced by one person. An infectious person might infect nobody or tons of people but the reproduction numbers don’t capture every detail just the overall picture of how many secondary infectious are produced.</li>
</ul>
<p><br></p></li>
<li><p>“Is the reproduction number a rate?”</p>
<ul>
<li>No, the reproduction number is not a rate. Take the example of HIV and SARS, which both have <span class="math inline">\(R_e\approx4\)</span>. However, SARS has an extremely rapid spread while HIV is much slower spreading. One individual infected with SARS might cause 4 secondary infections within the span of a week while an individual with HIV most likely infects 4 other people within the span of a few years. <span class="math inline">\(R_0\)</span> and <span class="math inline">\(R_e\)</span> don’t tell us anything about the timeframe of infections, so they are not rates.</li>
</ul></li>
</ul>
</div>
</div>
<p>The formula for the basic reproduction number is:</p>
<p><span class="math display">\[
R_0=\frac{\beta}{\gamma}
\]</span></p>
<p>And similarly, the formula for the effective reproduction number is:</p>
<p><span class="math display">\[
R_e=\frac{\beta}{\gamma} \left( \frac{S}{N} \right) =R_0\tilde{S}
\]</span> These formulas should make sense, as they are multiplying the transmission rate <span class="math inline">\(\beta\)</span> by the average duration of infection <span class="math inline">\(\frac{1}{\gamma}\)</span> to obtain the average number of secondary infections by one infectious individual throughout their entire duration of infectivity.</p>
<p>The point where these two formulas differ is in their assumption about the proportion of susceptible individuals in the population. <span class="math inline">\(R_0\)</span> assumes a completely susceptible population, so it is multiplying the expression <span class="math inline">\(\frac{\beta}{\gamma}\)</span> by an invisible <span class="math inline">\(1\)</span>. Meanwhile, <span class="math inline">\(R_e\)</span> assumes a susceptible proportion equal to <span class="math inline">\(\frac{S}{N}\)</span> hence the final expression <span class="math inline">\(\frac{\beta}{\gamma}(\frac{S}{N})\)</span>.</p>
<p>Make sure you understand the definitions and intuition behind the formulas for <span class="math inline">\(R_0\)</span> and <span class="math inline">\(R_e\)</span>. <a href="#sec-the-threshold-phenomenon" class="quarto-xref">Section&nbsp;2.6.1</a> on the threshold phenomenon applies the reproduction number in learning how to control the spread of infection.</p>
<p><strong>Section References</strong></p>
<p><span class="citation" data-cites="Handel2021_IDEMA_ch5">Handel (<a href="#ref-Handel2021_IDEMA_ch5" role="doc-biblioref">2021</a>)</span></p>
<section id="sec-the-threshold-phenomenon" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="sec-the-threshold-phenomenon"><span class="header-section-number">2.6.1</span> The Threshold Phenomenon</h3>
<p><span class="math display">\[
\frac{d\tilde{I}}{dt} = \beta \tilde{I} \tilde{S} - \gamma \tilde{I}
\]</span></p>
<p>Factoring out the <span class="math inline">\(\tilde{I}\)</span>, we have:</p>
<p><span class="math display">\[
\frac{d\tilde{I}}{dt} = \tilde{I}(\beta \tilde{S} - \gamma)
\]</span></p>
<p>If we wish to find the point at which the infection either invades or fails to, we can solve for when <span class="math inline">\(\frac{d\tilde{I}}{dt}&lt;0\)</span> (the proportion of infectious individuals is decreasing, or the disease is “dying off”) and <span class="math inline">\(\frac{d\tilde{I}}{dt}&gt;0\)</span> (the proportion of infectious individuals is increasing, or the disease is “growing”).</p>
<p>First, let’s analyze when <span class="math inline">\(\frac{d\tilde{I}}{dt}&lt;0\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d\tilde{I}}{dt} &amp;&lt; 0  &amp;&amp; \text{Condition that the infected population is decreasing} \\[10pt]
\tilde{I}(\beta \tilde{S} - \gamma) &amp;&lt; 0  &amp;&amp; \text{Substitute } \frac{d\tilde{I}}{dt} = \tilde{I}(\beta \tilde{S} - \gamma) \\[10pt]
\beta \tilde{S} - \gamma &amp;&lt; 0  &amp;&amp; \text{Divide both sides by } \tilde{I} &gt; 0 \\[10pt]
\tilde{S} &amp;&lt; \frac{\gamma}{\beta}  &amp;&amp; \text{Add } \gamma \text{ to both sides, then divide by } \beta &gt; 0
\end{aligned}
\]</span></p>
<p>Reproducing this procedure, we obtain the following similar result:</p>
<p><span class="math display">\[
\frac{d\tilde{I}}{dt} &gt; 0
\;\Longleftrightarrow\;
\tilde{S} &gt; \frac{\gamma}{\beta}
\]</span></p>
<p>From this, we can deduce that for an infection to even invade the population and start spreading, the initial proportion of susceptibles must be greater than <span class="math inline">\(\frac{\gamma}{\beta}\)</span>. This result is what is specifically known as the <em>threshold phenomenon</em>, with <span class="math inline">\(\frac{\gamma}{\beta}\)</span> known as the <em>threshold value</em>. Notice that <span class="math inline">\(\frac{\gamma}{\beta}\)</span> is exactly equal to the inverse of the basic reproduction number <span class="math inline">\(\frac{1}{R_0}\)</span>, which means we can also rewrite these conditions like so:</p>
<p><span class="math display">\[
\begin{aligned}
\text{Disease will not invade the population and / or spread:}
\qquad
\tilde{S} &amp;&lt; \frac{1}{R_0}
\\[10pt]
\text{Disease will invade the population and / or spread:}
\qquad
\tilde{S} &amp;&gt; \frac{1}{R_0}
\end{aligned}
\]</span></p>
<p>The simulation below let’s you see the threshold phenomenon in action:</p>
<iframe src="http://127.0.0.1:4567" width="100%" height="700" style="border:none;">
</iframe>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try changing the initial proportion of susceptible individuals <span class="math inline">\(S(0)\)</span> to be above and below the rounded threshold value (<span class="math inline">\(\frac{\gamma}{\beta}\)</span> ) shown. Notice that the proportion of infected individuals never increases if <span class="math inline">\(S(0)&lt;\frac{\gamma}{\beta}\)</span> but does increase if <span class="math inline">\(S(0)&gt;\frac{\gamma}{\beta}\)</span>.</p>
</div>
</div>
<p>Connecting this even further to reproduction numbers, we can rewrite the inequalities found above in terms of <span class="math inline">\(R_e\)</span> as follows:</p>
<p><span class="math display">\[
\begin{aligned}
\qquad
\tilde{S} &amp;&lt; \frac{\beta}{\gamma}
\qquad \Longleftrightarrow \qquad
R_e &lt; 1
\\[10pt]
\qquad
\tilde{S} &amp;&gt; \frac{\beta}{\gamma}
\qquad \Longleftrightarrow \qquad
R_e &gt; 1
\end{aligned}
\]</span></p>
<p>The result above is a really important one: it tells us that <span class="math inline">\(R_e\)</span> is another threshold for determining whether or not a disease will spread. Specifically, if <span class="math inline">\(R_e&lt;1\)</span>, the disease is dying off but if <span class="math inline">\(R_e&gt;1\)</span> the disease is spreading.</p>
<p>This should come as no surprise though, as it can be inferred from the definition of <span class="math inline">\(R_e\)</span> itself: if every single infectious person in the population (assuming the true value for the susceptible population, unlike <span class="math inline">\(R_0\)</span> which assumes a completely naive population), on average “replaces” themselves with more than <span class="math inline">\(1\)</span> infection, the disease will spread. Moreover, the point at which <span class="math inline">\(R_e\)</span> reaches exactly <span class="math inline">\(1\)</span> marks the maximum for the infected population since it is the point at which the disease goes from spreading (number of individuals infected rising) to dying off (number of individuals infected falling).</p>
<p>The simulation below demonstrates how the infected population increases, decreases, and reaches its maximum at different values of <span class="math inline">\(R_e\)</span>:</p>
<iframe src="http://127.0.0.1:4568" width="100%" height="700" style="border:none;">
</iframe>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice how <span class="math inline">\(R_e\)</span> starts off at its highest (when the population is almost entirely susceptible and it is equal to <span class="math inline">\(R_0\)</span>), then decreases over time to be equal to <span class="math inline">\(1\)</span>. At the point <span class="math inline">\(R_e=1\)</span>, the proportion of infected individuals reaches a maximum. Then, as <span class="math inline">\(R_e\)</span> further decreases below <span class="math inline">\(1\)</span> the proportion of infected individuals starts decreasing as the epidemic “dies off.”</p>
</div>
</div>
<p>Try expanding the window size in the simulation above and observe what happens to <span class="math inline">\(R_e\)</span> as <span class="math inline">\(t \rightarrow \infty\)</span>. Notice that <span class="math inline">\(R_e\)</span> never reaches <span class="math inline">\(0\)</span>! This demonstrates another important result: for an epidemic to end, it is not necessary to completely exhaust the susceptible population and attain <span class="math inline">\(R_e=0\)</span>. The epidemic will start to end its course as soon as the proportion of susceptibles dips low enough to where <span class="math inline">\(R_e&lt;1\)</span>. When this happens, the infectious individuals will, on average, no longer be “replacing” themselves with another infectious person despite there still being a non-zero population of susceptible people. If this goes on for a long enough time, the chain of transmission will break because there will be no more infectious people to spread the infection not because there were no more susceptible people to infect. This means that at the end of every epidemic, there will always be some people who were never infected and are still susceptible.</p>
<p>INSERT FLOW DIAGRAM THAT SHOWS EFF R AT VARIOUS FINITE STAGES AND ARROWS BETWEEN PEOPLE SPREADING THE INFECTION AND SAY THAT IF THERE IS LIKE 50 INFECTIOUS PEOPLE AND AN RE = 0.1 THEN 5 PEOPLE WILL GET INFECTED NEXT STAGE; ONCE THIS AVERAGE DIPS BELOW 1 PERSON FOR THE WHOLE INFECTIOUS POPULATION, DISEASE DIES OFF</p>
<p>Of course, one of our primary goals is to expedite the natural decrease of <span class="math inline">\(R_e\)</span> to be below <span class="math inline">\(1\)</span> as quickly as possible, thus reducing and eventually fully stopping the spread of infection. One of the most effective public health measures to accomplish this is vaccination <span class="citation" data-cites="vaccines13050479">(<a href="#ref-vaccines13050479" role="doc-biblioref">Boccalini 2025</a>)</span>. <a href="#sec-choosing-how-many-people-to-vaccinate" class="quarto-xref">Section&nbsp;2.6.2</a> answers the crucial following question: “How many vaccinated people is enough?”.</p>
<p><strong>Section References</strong></p>
<p><span class="citation" data-cites="keeling_modeling_2008">Keeling and Rohani (<a href="#ref-keeling_modeling_2008" role="doc-biblioref">2008</a>)</span></p>
</section>
<section id="sec-choosing-how-many-people-to-vaccinate" class="level3" data-number="2.6.2">
<h3 data-number="2.6.2" class="anchored" data-anchor-id="sec-choosing-how-many-people-to-vaccinate"><span class="header-section-number">2.6.2</span> Choosing How Many People to Vaccinate</h3>
<p>Recall from <a href="#sec-the-threshold-phenomenon" class="quarto-xref">Section&nbsp;2.6.1</a> that the disease will begin to die off when <span class="math inline">\(R_e\)</span> drops below <span class="math inline">\(1\)</span>. The proportion of susceptible individuals <span class="math inline">\(\tilde{S}\)</span> can be considered to be equal to <span class="math inline">\(1-i\)</span>, where <span class="math inline">\(i\)</span> is the proportion of people in the population who are infectious or immune to the disease. We can rearrange the expression <span class="math inline">\(R_e&lt;1\)</span> and solve for <span class="math inline">\(i\)</span>:</p>
<p><br></p>
<p><span class="math display">\[
\begin{aligned}
R_e &amp;&lt; 1 &amp;&amp; \text{Condition for disease to die off} \\[10pt]
R_0 \tilde{S} &amp;&lt; 1 &amp;&amp; \text{Definition of $R_e$} \\[10pt]
R_0 (1-i) &amp;&lt; 1 &amp;&amp; \text{$\tilde{S}=1-i$} \\[10pt]
i &amp;&gt; 1-\frac{1}{R_0} &amp;&amp; \text{Rearranging and solving for $i$}
\end{aligned}
\]</span></p>
<p><br></p>
<p>At the beginning of the outbreak, when nearly all individuals are susceptible and there are very few infectious, the proportion of individuals immune to the disease or infectious with it <span class="math inline">\(i\)</span> can be considered approximately equal to the proportion of individuals <em>successfully</em> vaccinated against the disease. This is because, generally speaking, vaccination confers immunity, though most of the time only temporary, to a disease (https://www.who.int/news-room/feature-stories/detail/how-do-vaccines-work). Since we are analyzing a relatively small time-frame with epidemics, the temporary nature of vaccine-conferred immunity can be safely disregarded.</p>
<p>Notice the emphasis on the word “successfully.” This is because most vaccines are not <span class="math inline">\(100%\)</span> effective; there will always be a percentage of people, though however small, that are vaccinated but can still contract the disease. Assuming a vaccine efficacy rate of <span class="math inline">\(e\)</span>, or the proportion of people who are vaccinated <span class="math inline">\(p\)</span> that are truly granted immunity, the proportion of individuals successfully vaccinated is <span class="math inline">\(i=ep\)</span>. We can rearrange the expression found previously to find the proportion of the population <span class="math inline">\(p\)</span> that should be vaccinated at the start of the outbreak:</p>
<p><br></p>
<p><span class="math display">\[
\begin{aligned}
i &amp;&gt; 1-\frac{1}{R_0} &amp;&amp; \text{Minimum proportion of immune individuals i} \\[10pt]
ep &amp;&gt; 1-\frac{1}{R_0} &amp;&amp; \text{Considering i=ep} \\[10pt]
p &amp;&gt; \frac{1}{e}\left(1-\frac{1}{R_0} \right) &amp;&amp; \text{Rearranging for p}
\end{aligned}
\]</span></p>
<p><br></p>
<p>This means that, for a vaccine with an efficacy rate <span class="math inline">\(e\)</span>, at the proportion of people that should be vaccinated at the start of an outbreak to prevent further spread should be at least <span class="math inline">\(\frac{1}{e}(1-\frac{1}{R_0}\)</span>. Not everyone in the population must be vaccinated to stop the spread of a disease, an idea known as <em>herd immunity</em>.</p>
<p>However, sometimes herd immunity cannot be obtained. Take the case when <span class="math inline">\(R_0=3\)</span> and the best available vaccine has an efficacy rate of <span class="math inline">\(e=0.6\)</span> (meaning that of the people who are vaccinated, only about <span class="math inline">\(60%\)</span> of them will actually be immune and unable to contract the disease). Using the formula above, we find that the proportion of people who are vaccinated at the beginning of the outrbreak must be at least <span class="math inline">\(\frac{1}{0.6}(1-\frac{1}{3})\approx1.1\)</span>. However, this is impossible: we cannot possible vaccinate more than <span class="math inline">\(100%\)</span> of the population! This means that, due to a combination of the high transmissibility of the disease and the relatively low vaccine efficacy rate, even if <span class="math inline">\(100%\)</span> of the population were to be vaccinated, there would still be enough susceptible people (i.e.&nbsp;people whose vaccines were not effective) for an outbreak to occur.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the above calculations and statements are assuming ideal vaccination practices at the beginning of an outbreak when nearly all individuals are susceptible and almost none are recovered or infectious. If vaccination is implemented mid-outbreak, when the number of recovered individuals with natural immunity and infectious people are not negligible, the calculations must be modified. In general, fewer individuals will have to be vaccinated than at the beginning of an outbreak since the proportion of susceptible individuals <span class="math inline">\(\tilde{S}\)</span> will be equal to the complement of the sum of: the proportion of people who are infectious, those who have natural immunity due to recovery, and those who are successfully vaccinated.</p>
</div>
</div>
<p><strong>Section References</strong></p>
<p><span class="citation" data-cites="Handel2021_IDEMA_ch5">Handel (<a href="#ref-Handel2021_IDEMA_ch5" role="doc-biblioref">2021</a>)</span></p>
</section>
</section>
<section id="example-of-the-classic-epidemic-model" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="example-of-the-classic-epidemic-model"><span class="header-section-number">2.7</span> Example of the Classic Epidemic Model</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li>Identify examples of situations where the classic epidemic model is a useful tool for modeling.</li>
</ul>
</div>
</div>
<p>https://scholarworks.lib.csusb.edu/cgi/viewcontent.cgi?article=2232&amp;context=etd</p>
<p>A disease commonly modeled using SIR-type models is measles due to its high infectivity and life-long immunity once recovered <span class="citation" data-cites="review_measles">(<a href="#ref-review_measles" role="doc-biblioref">Arsal, Aldila, and Handari 2020</a>)</span>. Although the mathematical modelling of measles epidemics can get very complicated with the inclusion of stochasticity (randomness) and time-series analysis <span class="citation" data-cites="bjornstad_measles">(<a href="#ref-bjornstad_measles" role="doc-biblioref">Bjørnstad, Finkenstädt, and Grenfell 2002</a>)</span>, the example we present here is a relatively simple one that applies the concepts we discussed previously.</p>
<p><strong>Context</strong></p>
<p>Prior to mass-vaccination campaigns, large British cities exhibited regular measles outbreaks <span class="citation" data-cites="bjornstad_measles">(<a href="#ref-bjornstad_measles" role="doc-biblioref">Bjørnstad, Finkenstädt, and Grenfell 2002</a>)</span>. Our scope is to model the measles disease dynamics over two year periods for various British cities using the classic epidemic SIR model.</p>
<p><strong>Data For Our Model</strong></p>
<p>The data we will be utilizing for this example is publicly avaliable through the Ottar Bjørnstad Lab at Penn State University <span class="citation" data-cites="bjornstad_measles_data">(<a href="#ref-bjornstad_measles_data" role="doc-biblioref">Bjørnstad, Finkenstädt, and Grenfell n.d.</a>)</span>. The data set contains prevalence count data and annual number of births for 60 British cities from 1944 to 1966 (inclusive) as well as the median population size of each city between 1944 and 1966 (inclusive).</p>
<p>Our example will only utilize the prevalence count data from 1944 to 1945 (52 weeks) and the median population size between 1944 and 1966 for the cities of Blackburn, Exeter, and Leeds, as seen in the table below:</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-b7a9f1a721f8ae6d7495" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b7a9f1a721f8ae6d7495">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156"],[44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45],[2,2,2,4,4,4,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,16,16,16,18,18,18,20,20,20,22,22,22,24,24,24,26,26,26,28,28,28,30,30,30,32,32,32,34,34,34,36,36,36,38,38,38,40,40,40,42,42,42,44,44,44,46,46,46,48,48,48,50,50,50,52,52,52,2,2,2,4,4,4,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,16,16,16,18,18,18,20,20,20,22,22,22,24,24,24,26,26,26,28,28,28,30,30,30,32,32,32,34,34,34,36,36,36,38,38,38,40,40,40,42,42,42,44,44,44,46,46,46,48,48,48,50,50,50,52,52,52],["Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds","Blackburn","Exeter","Leeds"],[0,0,6,0,0,7,2,2,9,5,0,8,1,0,4,0,1,12,2,4,21,1,1,32,1,0,25,0,4,17,1,12,26,6,25,29,2,58,20,5,61,26,5,62,10,5,81,12,7,28,6,17,9,3,27,10,1,26,7,3,57,9,10,84,14,40,120,19,56,227,14,65,325,32,179,271,33,133,175,87,289,87,71,525,33,79,1263,10,97,1777,5,82,1963,3,40,1778,2,29,845,3,10,489,1,4,207,1,5,151,2,5,80,0,1,24,0,1,20,2,1,8,1,1,13,1,0,8,0,0,2,0,0,4,1,0,3,0,1,7,0,0,4,1,2,2,2,0,3,0,0,4,0,0,2,0,0,3],[107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000,107150,76900,508000]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>week<\/th>\n      <th>city<\/th>\n      <th>prevalence_count<\/th>\n      <th>population_size<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"year","targets":1},{"name":"week","targets":2},{"name":"city","targets":3},{"name":"prevalence_count","targets":4},{"name":"population_size","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><strong>Understanding Our Model</strong></p>
<p>The data set above contains data for three different British cities, however we are only going to walk through the formulation of an epidemic SIR model for one of them—Blackburn—using the given data which ranges from the beginning of 1944 to the end of 1945.</p>
<p>When formulating a mathematical model, the first question we should ask ourselves is <em>what</em> exactly we are trying to model even looks like. Since we are simply presenting an example of the classic epidemic SIR model, the “disease flow” for measles in Blackburn could be visualized like so:</p>
<p>INSERT FLOW CHART OF SIR MODEL COMPARTMENTS</p>
<p>Putting this into words, at the beginning of 1944 we assume the proportion of susceptible, infected, and recovered individuals as <span class="math inline">\(\tilde{S}(0)\)</span>, <span class="math inline">\(\tilde{I}(0)\)</span>, and <span class="math inline">\(\tilde{R}(0)\)</span>, respectively. Over time, the proportion of people infected with measles grows until the chain of transmission breaks since the people infected with measles at that point will, on average, not be “replacing” themselves with at least one new measles infection to keep the disease “alive.” Once the chain of transmission breaks, the epidemic dies off soon after (which is to say that no people in Blackburn are infected with measles anymore).</p>
<p>We can even see model process reflected in our data: in weeks 2 through 20 of 1944 there are various small introduction of measles into Blackburn, but none manage to spread further and kickstart the epidemic. This is a really important observation because it highlights the random nature of disease spread and infection. In theory, the epidemic should have started from the introduction of <span class="math inline">\(2\)</span> infected people in Blackburn in week 2 since the estimated <span class="math inline">\(R_0\)</span> for measles in England from the years 1944 to 1979 is <span class="math inline">\(13.7\)</span> to <span class="math inline">\(18\)</span> <span class="citation" data-cites="anderson_may_1982">(<a href="#ref-anderson_may_1982" role="doc-biblioref">Anderson and May 1982</a>)</span>. However, remembering back to <a href="#sec-reproduction-numbers" class="quarto-xref">Section&nbsp;2.6</a> <span class="math inline">\(R_0\)</span> is an <em>average</em>, not an absolute, number of secondary infections in a completely susceptible population. Even with a high average number of secondary infections, it is very possible that the people infected with measles from weeks 2 through 20 didn’t manage to spread it to enough people to start the epidemic (maybe they were responsible and quarantined, or those individuals didn’t interact with many people while they had measles, etc.).</p>
<p>However, in week <span class="math inline">\(22\)</span> there is one new measles case that manages to successfully spread further and start the epidemic. The epidemic continues until the chain of transmission breaks sometime around week <span class="math inline">\(50\)</span> to <span class="math inline">\(52\)</span> of <span class="math inline">\(1944\)</span> and declines back down to nearly <span class="math inline">\(0\)</span> cases through most of 1945, with the exception of a few stray cases that don’t manage to re-start the epidemic cycle.</p>
<p>We are looking to model this measles outbreak by following the number of susceptible, infected, and recovered individuals using an epidemic SIR model, giving the following model equations:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS}{dt} &amp;= -\beta \left(\frac{I}{N}\right)  S \\[10pt]
\frac{dI}{dt} &amp;= \beta \left(\frac{I}{N}\right)  S - \gamma I \\[10pt]
\frac{dR}{dt} &amp;= \gamma I
\end{aligned}
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Since our data is given in week intervals, the rates in our model (<span class="math inline">\(\beta\)</span>, <span class="math inline">\(\gamma\)</span>, <span class="math inline">\(\frac{dS}{dt}\)</span>, <span class="math inline">\(\frac{dI}{dt}\)</span>, <span class="math inline">\(\frac{dR}{dt}\)</span>) are in units of weeks as well.</p>
</div>
</div>
<p>Now that we have an outline for our model, our next step is to find suitable values for the transmission rate <span class="math inline">\(\beta\)</span> and recovery rate <span class="math inline">\(\gamma\)</span>.</p>
<p><strong>Finding Our Model Parameters</strong></p>
<p>The epidemic SIR model only has two parameters, the transmission rate <span class="math inline">\(\beta\)</span> and the recovery rate <span class="math inline">\(\gamma\)</span>. From past literature, it is known that the average infectious period of measles is <span class="math inline">\(6\)</span> to <span class="math inline">\(7\)</span> days, which we will estimate to be about <span class="math inline">\(6.5\)</span> days or <span class="math inline">\(\frac{6.5}{7}\approx0.93\)</span> weeks <span class="citation" data-cites="anderson_may_1982">(<a href="#ref-anderson_may_1982" role="doc-biblioref">Anderson and May 1982</a>)</span>. Recalling the average infectious period as equal to <span class="math inline">\(\frac{1}{\gamma}\)</span>, we can obtain and estimated recovery rate of <span class="math inline">\(\gamma=\frac{7}{6.5}=\frac{14}{13}\)</span>.</p>
<p>Now that we have our estimate for <span class="math inline">\(\gamma\)</span>, let’s use the same method covered in <a href="#sec-bbmle" class="quarto-xref">Section&nbsp;2.5.0.2</a> to find the transmission rate <span class="math inline">\(\beta\)</span> using MLE:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbmle)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: stats4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:bbmle':

    slice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing our prevalence count data for Blackburn</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/measles_ex_data.csv"</span>) <span class="sc">|&gt;</span> <span class="fu">filter</span>(city <span class="sc">==</span> <span class="st">"Blackburn"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># SIR model function</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>ModelFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(time,state,parameters){</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> state[<span class="dv">1</span>]</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  I <span class="ot">&lt;-</span> state[<span class="dv">2</span>]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> state[<span class="dv">3</span>]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> parameters[<span class="st">"beta"</span>]</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  gamma <span class="ot">&lt;-</span> parameters[<span class="st">"gamma"</span>]</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> parameters[<span class="st">"N"</span>]</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  dS <span class="ot">&lt;-</span> <span class="sc">-</span>(beta<span class="sc">*</span>I<span class="sc">*</span>S<span class="sc">/</span>N)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  dI <span class="ot">&lt;-</span> (beta<span class="sc">*</span>I<span class="sc">*</span>S<span class="sc">/</span>N) <span class="sc">-</span> (gamma<span class="sc">*</span>I)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  dR <span class="ot">&lt;-</span> (gamma<span class="sc">*</span>I)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(dS,dI,dR))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Outputs predicted prevalence counts</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="cf">function</span>(parameters,t){</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># S = population size - prevalence at first record (week 2)</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I = prevalence at week 2</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># R = 0</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  initial_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(data<span class="sc">$</span>population_size[<span class="dv">1</span>]<span class="sc">-</span>data<span class="sc">$</span>prevalence_count[<span class="dv">1</span>],data<span class="sc">$</span>prevalence_count[<span class="dv">1</span>],<span class="dv">0</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  t_start <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  t_end <span class="ot">&lt;-</span> <span class="fu">max</span>(t)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  step_size <span class="ot">&lt;-</span> t_end <span class="sc">-</span> t_start</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">rk4sys</span>(<span class="at">y0=</span>initial_vals,</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>                 <span class="at">a=</span>t_start,</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>                 <span class="at">b=</span>t_end,</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">f=</span><span class="cf">function</span>(t,y) <span class="fu">ModelFunc</span>(t,y,parameters),</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n=</span>step_size)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extracting predicted prevalences</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  output_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(output)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  prevalences <span class="ot">&lt;-</span> output_df<span class="sc">$</span>y.I[t]</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensuring there are no NaNs or out of bounds numbers in the output</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  prevalences[<span class="fu">is.nan</span>(prevalences) <span class="sc">|</span> prevalences <span class="sc">&lt;</span> <span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(prevalences)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood function</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>poisson_ll <span class="ot">&lt;-</span> <span class="cf">function</span>(b){</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  times <span class="ot">&lt;-</span> data<span class="sc">$</span>week</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">beta=</span>b,<span class="at">gamma=</span><span class="dv">14</span><span class="sc">/</span><span class="dv">13</span>,<span class="at">N=</span>data<span class="sc">$</span>population_size[<span class="dv">1</span>])</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  predicted <span class="ot">&lt;-</span> <span class="fu">pred</span>(parameters,times)</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x=</span>data<span class="sc">$</span>prevalence_count,<span class="at">lambda=</span>predicted,<span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting our initial guess as beta = 2</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">b=</span><span class="dv">9</span>)</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Calling mle2</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">mle2</span>(<span class="at">minuslogl=</span>poisson_ll,</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>                         <span class="at">start=</span>start,</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method=</span><span class="st">"L-BFGS-B"</span>,</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lower=</span><span class="fu">c</span>(<span class="at">b=</span><span class="fl">0.01</span>))</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the maximum likelihood estimate for beta</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>b 
9 </code></pre>
</div>
</div>
<p><strong>Visualizing Our Model</strong></p>
<p><strong>Analyzing and Interpreting Our Model</strong></p>
<p>to find prop to vaccinate use efficacy rates here:</p>
<p>https://ir.nmu.org.ua/server/api/core/bitstreams/e4229560-2fd1-4a9f-bdeb-2c96b88fa29a/content</p>
<p>Include practice questions that ask to repeat process for data from other cities.</p>
</section>
</section>
<section id="the-classic-endemic-model" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> The Classic Endemic Model</h1>
<section id="the-classic-sir-endemic-model" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="the-classic-sir-endemic-model"><span class="header-section-number">3.1</span> The Classic SIR Endemic Model</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li><p>Recall the classic endemic model’s equations.</p></li>
<li><p>Differentiate the classic endemic model from the epidemic model.</p></li>
</ul>
</div>
</div>
<p>Recalling the information in <a href="#sec-the-classic-sir-epidemic-model" class="quarto-xref">Section&nbsp;2.3</a>, the classic epidemic model assumes no demographics (births and deaths) in the population. This is because epidemics occur in such a relatively short timeframe, so the inclusion of births and deaths adds unnecessary complexity since so few will occur over this period.</p>
<p>However, epidemic models are not suitable for all disease; there are some diseases that do not conclude their spread sufficiently fast to neglect the births and deaths that occur during that time. This is when the SIR model with demographics, also known commonly as the classic endemic model, comes in. The classic endemic model includes birth and death rates, but makes the following key assumptions about them:</p>
<ul>
<li><p>Every individual in the population has a natural “lifespan” of <span class="math inline">\(\frac{1}{\mu}\)</span> years, where <span class="math inline">\(\mu\)</span> is the rate at which individuals die due to natural causes</p>
<ul>
<li><span class="math inline">\(\mu\)</span> is independent of the disease and does not represent the pathogenicity of the disease, or its ability to cause death</li>
</ul></li>
<li><p>No deaths outside of natural ones dictated by the rate <span class="math inline">\(\mu\)</span> occur; in other words, there are no separate disease related deaths and <span class="math inline">\(\mu\)</span> is the crude death rate, or the death rate across people in all demographic groups and disease statuses (susceptible, infected, or recovered)</p></li>
<li><p><span class="math inline">\(\mu\)</span> also represents the population’s crude birth rate as well</p>
<ul>
<li>This ensure that the total population size does not change as time goes on; as such, <span class="math inline">\(N\)</span> is a constant in the endemic SIR just as it is in the epidemic model</li>
</ul></li>
<li><p>Every individual is born into the susceptible population</p>
<ul>
<li>Although for many disease (like measles for example) newborns are born with passive immunity due to the passing down of maternal antibodies, the average age at which passive immunity is lost is much lower than the typical age of first infection in developed countries. This tells us that it is reasonable to consider all newborns as being immediately susceptible since the time to their first infection is most likely independent of their initial fading immunity at birth. This is not true of diseases that have a very small mean age of infection, however, since an infection can happen as soon as passive immunity ends.</li>
</ul></li>
</ul>
<p><strong>Section References</strong></p>
<p><span class="citation" data-cites="keeling_modeling_2008">Keeling and Rohani (<a href="#ref-keeling_modeling_2008" role="doc-biblioref">2008</a>)</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The other assumptions made for the classic epidemic SIR apply to the endemic SIR model as well. We are just simply adding these new assumptions about the characteristics of the birth and death rates in the population. These assumptions are common but it should be noted that not all SIR models with demographics will make the same assumptions as above.</p>
</div>
</div>
<p>The flowchart for the classic endemic model can be seen below:</p>
<div class="cell" data-fig-width="8" data-fig-height="5" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="768" height="480" viewbox="0.00 0.00 242.00 221.60" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 217.6)">
<title>SIRend</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-217.6 238,-217.6 238,4 -4,4"></polygon>
<!-- I -->
<g id="node1" class="node">
<title>I</title>
<path fill="none" stroke="black" d="M132,-124.8C132,-124.8 102,-124.8 102,-124.8 96,-124.8 90,-118.8 90,-112.8 90,-112.8 90,-100.8 90,-100.8 90,-94.8 96,-88.8 102,-88.8 102,-88.8 132,-88.8 132,-88.8 138,-88.8 144,-94.8 144,-100.8 144,-100.8 144,-112.8 144,-112.8 144,-118.8 138,-124.8 132,-124.8"></path>
<text text-anchor="middle" x="117" y="-102.6" font-family="Times,serif" font-size="14.00">I</text>
</g>
<!-- R -->
<g id="node2" class="node">
<title>R</title>
<path fill="none" stroke="black" d="M222,-124.8C222,-124.8 192,-124.8 192,-124.8 186,-124.8 180,-118.8 180,-112.8 180,-112.8 180,-100.8 180,-100.8 180,-94.8 186,-88.8 192,-88.8 192,-88.8 222,-88.8 222,-88.8 228,-88.8 234,-94.8 234,-100.8 234,-100.8 234,-112.8 234,-112.8 234,-118.8 228,-124.8 222,-124.8"></path>
<text text-anchor="middle" x="207" y="-102.6" font-family="Times,serif" font-size="14.00">R</text>
</g>
<!-- I&#45;&gt;R -->
<g id="edge3" class="edge">
<title>I-&gt;R</title>
<path fill="none" stroke="black" d="M144,-106.8C152.03,-106.8 160.97,-106.8 169.53,-106.8"></path>
<polygon fill="black" stroke="black" points="169.71,-110.3 179.71,-106.8 169.7,-103.3 169.71,-110.3"></polygon>
<text text-anchor="middle" x="162" y="-114" font-family="Times,serif" font-size="14.00">γ</text>
</g>
<!-- bottomI -->
<g id="node5" class="node">
<title>bottomI</title>
</g>
<!-- I&#45;&gt;bottomI -->
<g id="edge5" class="edge">
<title>I:s-&gt;bottomI</title>
<path fill="none" stroke="black" d="M117,-88.8C117,-74.79 117,-59.19 117,-46.31"></path>
<polygon fill="black" stroke="black" points="120.5,-46.21 117,-36.21 113.5,-46.21 120.5,-46.21"></polygon>
<text text-anchor="middle" x="124" y="-58.2" font-family="Times,serif" font-size="14.00"> &nbsp;μ</text>
</g>
<!-- bottomR -->
<g id="node6" class="node">
<title>bottomR</title>
</g>
<!-- R&#45;&gt;bottomR -->
<g id="edge6" class="edge">
<title>R:s-&gt;bottomR</title>
<path fill="none" stroke="black" d="M207,-88.8C207,-74.79 207,-59.19 207,-46.31"></path>
<polygon fill="black" stroke="black" points="210.5,-46.21 207,-36.21 203.5,-46.21 210.5,-46.21"></polygon>
<text text-anchor="middle" x="214" y="-58.2" font-family="Times,serif" font-size="14.00"> &nbsp;μ</text>
</g>
<!-- topS -->
<g id="node3" class="node">
<title>topS</title>
</g>
<!-- S -->
<g id="node7" class="node">
<title>S</title>
<path fill="none" stroke="black" d="M42,-124.8C42,-124.8 12,-124.8 12,-124.8 6,-124.8 0,-118.8 0,-112.8 0,-112.8 0,-100.8 0,-100.8 0,-94.8 6,-88.8 12,-88.8 12,-88.8 42,-88.8 42,-88.8 48,-88.8 54,-94.8 54,-100.8 54,-100.8 54,-112.8 54,-112.8 54,-118.8 48,-124.8 42,-124.8"></path>
<text text-anchor="middle" x="27" y="-102.6" font-family="Times,serif" font-size="14.00">S</text>
</g>
<!-- topS&#45;&gt;S -->
<g id="edge1" class="edge">
<title>topS-&gt;S:n</title>
<path fill="none" stroke="black" d="M27,-177.39C27,-165.91 27,-150.21 27,-135.1"></path>
<polygon fill="black" stroke="black" points="30.5,-134.8 27,-124.8 23.5,-134.8 30.5,-134.8"></polygon>
<text text-anchor="middle" x="34" y="-147" font-family="Times,serif" font-size="14.00"> &nbsp;μ</text>
</g>
<!-- bottomS -->
<g id="node4" class="node">
<title>bottomS</title>
</g>
<!-- S&#45;&gt;I -->
<g id="edge2" class="edge">
<title>S-&gt;I</title>
<path fill="none" stroke="black" d="M54,-106.8C62.03,-106.8 70.97,-106.8 79.53,-106.8"></path>
<polygon fill="black" stroke="black" points="79.71,-110.3 89.71,-106.8 79.7,-103.3 79.71,-110.3"></polygon>
<text text-anchor="middle" x="72" y="-114" font-family="Times,serif" font-size="14.00">λ</text>
</g>
<!-- S&#45;&gt;bottomS -->
<g id="edge4" class="edge">
<title>S:s-&gt;bottomS</title>
<path fill="none" stroke="black" d="M27,-88.8C27,-74.79 27,-59.19 27,-46.31"></path>
<polygon fill="black" stroke="black" points="30.5,-46.21 27,-36.21 23.5,-46.21 30.5,-46.21"></polygon>
<text text-anchor="middle" x="34" y="-58.2" font-family="Times,serif" font-size="14.00"> &nbsp;μ</text>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>From this flowchart, we can deduce the following equations for the number of people in each compartment according to the endemic SIR model:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS}{dt} &amp;= \mu-\beta \tilde{I} S - \mu S \\[10pt]
\frac{dI}{dt} &amp;= \beta \tilde{I} S - \gamma I - \mu I\\[10pt]
\frac{dR}{dt} &amp;= \gamma I - \mu R
\end{aligned}
\]</span></p>
<p>And just like before, we can divide every equation above by the constant population size <span class="math inline">\(N\)</span> to obtain the following equations for the proportion of individuals in each compartment:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d\tilde{S}}{dt} &amp;= \mu-\beta \tilde{I} \tilde{S} - \mu \tilde{S} \\[10pt]
\frac{d\tilde{I}}{dt} &amp;= \beta \tilde{I} \tilde{S} - \gamma \tilde{I} - \mu \tilde{I}\\[10pt]
\frac{d\tilde{R}}{dt} &amp;= \gamma \tilde{I} - \mu \tilde{R}
\end{aligned}
\]</span></p>
<p>Notice that the force of infection for the endemic model is the same as the epidemic model (<span class="math inline">\(\lambda=\beta \tilde{I}\)</span>).</p>
<p>The following sections are mostly reviews of concepts covered previously in the epidemic model. For this reason, they are mostly short sections but do cover important distinctions between the epidemic and endemic model, including how their reproduction numbers are calculated and how to solve them using <code>rk4sys</code> just to name a few.</p>
</section>
<section id="formulating-the-death-rate" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="formulating-the-death-rate"><span class="header-section-number">3.2</span> Formulating the Death Rate</h2>
<p>Similar to how the recovery rate is formulated as simply the reciprocal of the average duration of infection <span class="math inline">\(d\)</span> (see <a href="#sec-formulating-the-recovery-rate" class="quarto-xref">Section&nbsp;2.3.2</a>), the birth / death rate is often calculated as the reciprocal of the average host lifespan (i.e.&nbsp;the average age to which individuals in the population survive) <span class="citation" data-cites="keeling_modeling_2008">(<a href="#ref-keeling_modeling_2008" role="doc-biblioref">Keeling and Rohani 2008</a>)</span>.</p>
<p>The average host lifespan, like the average duration of infection, is often obtained from past literature.</p>
</section>
<section id="solving-the-endemic-sir-model---example" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="solving-the-endemic-sir-model---example"><span class="header-section-number">3.3</span> Solving the Endemic SIR Model - Example</h2>
<p>The endemic SIR model can be solved using many of the same methods as the epidemic SIR model. In <a href="#sec-solving-sir-equations" class="quarto-xref">Section&nbsp;2.4</a> on solving the epidemic SIR model, we covered two main methods of doing so: Euler’s method and the function <code>rk4sys</code> in the <code>pracma</code> package in R.</p>
<p>Both of these methods can be used to solve the endemic model as well, but we will only show an example of solving the endemic model using <code>rk4sys</code> since Euler’s method is quite lengthy and is the exact same process as for the epidemic model just with different SIR equations.</p>
<p>Below is a complete example of using <code>rk4sys</code> to solve an endemic SIR model and plot the results:</p>
<p><strong>Step 1: Find solutions to the SIR model using <code>rk4sys</code>.</strong></p>
<div class="cell">
<div>
<div id="webr-16" class="exercise-cell">

</div>
<script type="webr-16-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoibGlicmFyeShwcmFjbWEpXG5cbk1vZGVsRnVuYyA8LSBmdW5jdGlvbih0aW1lLHN0YXRlKXtcbiAgIyBFeHRyYWN0aW5nIHRoZSBzdGF0ZSB2YXJpYWJsZXNcbiAgIyBTYW1lIGNvbXBhcnRtZW50cyBhcyBiZWZvcmU6IHN1c2NlcHRpYmxlLCBpbmZlY3Rpb3VzLCBhbmQgcmVjb3ZlcmVkIChTLEksUilcbiAgUyA8LSBzdGF0ZVsxXVxuICBJIDwtIHN0YXRlWzJdXG4gIFIgPC0gc3RhdGVbM11cbiAgXG4gICMgU3BlY2lmeWluZyB0aGUgbW9kZWwgcGFyYW1ldGVyc1xuICAjIFdlIG5vdyBoYXZlIHRocmVlIHBhcmFtZXRlcnMgLSB0aGUgdHJhbnNtaXNzaW9uLCByZWNvdmVyeSwgYW5kIG1vcnRhbGl0eSByYXRlXG4gICMgVGhlc2UgcGFyYW1ldGVycyB3aWxsIGNoYW5nZSBkZXBlbmRpbmcgb24gdGhlIG1vZGVsXG4gIGJldGEgPC0gMS41XG4gIGdhbW1hIDwtIDAuM1xuICBtdSA8LSAwLjJcbiAgXG4gICMgQ29uc3RydWN0aW5nIG91ciBTSVIgbW9kZWwgZXF1YXRpb25zXG4gIGRTIDwtIG11IC0gKGJldGEqSSpTKSAtIG11KlNcbiAgZEkgPC0gKGJldGEqSSpTKSAtIChnYW1tYSpJKSAtIG11KklcbiAgZFIgPC0gKGdhbW1hKkkpIC0gbXUqUlxuICBcbiAgIyBOb3cgd2Ugd2lsbCByZXR1cm4gdGhvc2UgbW9kZWwgZXF1YXRpb25zIGFzIGEgdmVjdG9yXG4gIHJldHVybihjKGRTLGRJLGRSKSlcbn1cblxuIyBTdGFydCBhbmQgZW5kaW5nIHBvaW50cyBvZiB0aGUgc29sdXRpb24gaW50ZXJ2YWxcbnN0YXJ0IDwtIDBcbmVuZCA8LSAyNVxuXG4jIEluaXRpYWwgdmFsdWVzIHRvIGJlIHBhc3NlZCBpbnRvIHRoZSBwYXJhbWV0ZXIgeVxuaW5pdGlhbF92YWxzIDwtIGMoUz0wLjk5LEk9MC4wMSxSPTApXG5cbiMgSG93IG1hbnkgc3RlcHMgdG8gdGFrZSBmcm9tIGEgdG8gYlxuc3RlcF9zaXplIDwtIGVuZC1zdGFydFxuXG4jIENhbGxpbmcgcms0c3lzXG5vdXRwdXQgPC0gcms0c3lzKGY9TW9kZWxGdW5jLFxuICAgICAgICAgICAgICAgICBhPXN0YXJ0LFxuICAgICAgICAgICAgICAgICBiPWVuZCxcbiAgICAgICAgICAgICAgICAgeTA9aW5pdGlhbF92YWxzLFxuICAgICAgICAgICAgICAgICBuPXN0ZXBfc2l6ZSlcblxuIyBDb252ZXJ0aW5nIHRoZSBvdXRwdXQgbWF0cml4IHRvIGEgZGF0YSBmcmFtZSBhbmQgcHJpbnRpbmcgaXRcbm91dHB1dCA8LSBhcy5kYXRhLmZyYW1lKG91dHB1dClcbnByaW50KG91dHB1dCkifQ==
</script>
</div>
</div>
<p><strong>Step 2: Plot the results.</strong></p>
<div class="cell">
<div>
<div id="webr-17" class="exercise-cell">

</div>
<script type="webr-17-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBQbG90dGluZyByZXN1bHRzXG50aW1lcyA8LSBvdXRwdXQkeFxuUyA8LSBvdXRwdXQkeS5TXG5JIDwtIG91dHB1dCR5LklcblIgPC0gb3V0cHV0JHkuUlxuYmV0YSA8LSAxLjVcbmdhbW1hIDwtIDAuM1xubXUgPC0gMC4yXG5cbnBsb3QodGltZXMsIFMsIHR5cGUgPSBcImxcIiwgY29sID0gXCJzdGVlbGJsdWVcIiwgbHdkID0gMixcbiAgICAgeWxpbSA9IGMoMCwgMSksIHhsYWIgPSBcIlRpbWVcIiwgeWxhYiA9IFwiUHJvcG9ydGlvblwiLFxuICAgICBtYWluID0gcGFzdGUwKFwiU0lSIEVuZGVtaWMgKFJ1bmdlLUt1dHRhKSAgfCAgzrI9XCIsIGJldGEsXG4gICAgICAgICAgICAgICAgICAgXCIgIM6zPVwiLCBnYW1tYSwgXCIgIM68PVwiLG11LCBcIiAgUuKCgD1cIiwgcm91bmQoYmV0YS8oZ2FtbWErbXUpLCAyKSkpXG5saW5lcyh0aW1lcywgSSwgY29sID0gXCJmaXJlYnJpY2tcIiwgbHdkID0gMilcbmxpbmVzKHRpbWVzLCBSLCBjb2wgPSBcInNlYWdyZWVuXCIsICBsd2QgPSAyKVxuXG5sZWdlbmQoXCJyaWdodFwiLCBsZWdlbmQgPSBjKFwiU3VzY2VwdGlibGVcIiwgXCJJbmZlY3Rpb3VzXCIsIFwiUmVjb3ZlcmVkXCIpLFxuICAgICAgIGNvbCA9IGMoXCJzdGVlbGJsdWVcIiwgXCJmaXJlYnJpY2tcIiwgXCJzZWFncmVlblwiKSwgbHdkID0gMiwgYnR5ID0gXCJuXCIpIn0=
</script>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice that the curves above seem to “even out” after a while? This is a really important distinction between the epidemic and endemic SIR model, and is explained in detail in <a href="#sec-dfe-ee" class="quarto-xref">Section&nbsp;3.5</a>.</p>
</div>
</div>
</section>
<section id="reproduction-numbers" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="reproduction-numbers"><span class="header-section-number">3.4</span> Reproduction Numbers</h2>
<p>The basic and effective reproduction numbers for the endemic SIR model have the same interpretation as they do for the epidemic SIR model. Refer back to <a href="#sec-reproduction-numbers" class="quarto-xref">Section&nbsp;2.6</a> on reproduction numbers in the epidemic SIR model if you need a refresher of these definitions.</p>
<p>Although they have the same interpretations before, the formulas for the basic and reproductive number are different for the endemic SIR model.</p>
<p>First, let’s formulate the basic reproductive number <span class="math inline">\(R_0\)</span> for the endemic SIR model. We still utilize <span class="math inline">\(\beta\)</span> as the per-capita transmission rate but instead of considering the average time an individual is infectious to be <span class="math inline">\(\frac{1}{\gamma}\)</span> (like it is for the epidemic SIR model), we consider it to be <span class="math inline">\(\frac{1}{\gamma+\mu}\)</span>. On a conceptual level, this is justified because there are now two ways to leave the infectious class: recovery or death. Before in the epidemic model, there was only one way to become noninfectious—through recovery.</p>
<p>Multiplying the tranmission rate <span class="math inline">\(\beta\)</span> by the average time an individual will stay infectious <span class="math inline">\(\frac{1}{\gamma+\mu}\)</span>, we obtain the the basic reproduction number <span class="math inline">\(R_0\)</span> for the epidemic SIR model:</p>
<p><span class="math display">\[
R_0=\frac{\beta}{\gamma+\mu}
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This basic reproduction number for the endemic model is generally similar to, but always smaller than, the basic reproduction number for the epidemic model since the natural morality rate reduces the average time an individual is infectious (we now consider the possibility that individuals can die to natural causes while infectious, thus reducing their “infective potential”).</p>
</div>
</div>
<p>The effective reproduction number <span class="math inline">\(R_e\)</span> for the endemic model is quite similar to the epidemic model. It is still found by multiplying the basic reproduction number <span class="math inline">\(R_0\)</span> by the proportion of susceptible individuals in the population <span class="math inline">\(\tilde{S}\)</span> like so:</p>
<p><span class="math display">\[
R_e=R_0 \tilde{S}=\left(\frac{\beta}{\gamma+\mu} \right) \tilde{S}
\]</span></p>
</section>
<section id="sec-dfe-ee" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="sec-dfe-ee"><span class="header-section-number">3.5</span> Disease Free and Endemic Equilibrium</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li><p>Define what an equilibrium is the context of a system of differential equations.</p></li>
<li><p>Find the values where the disease-free and endemic equilibrium occur.</p></li>
<li><p>Recall when each equilibrium type occurs in relation to R0 and justify it based on the definition of R0.</p></li>
</ul>
</div>
</div>
<p>The inclusion of births in the endemic model means there is a constant “replenishing” of the susceptible population. This allows for the disease to persist in the population in the long-term, unlike the epidemic model which always ends in the disease “dying off.”</p>
<p>To analyze the long-term behavior of the endemic model, we start by analyzing what the model equations look like at <em>equilibrium</em>, or the point when <span class="math inline">\(\frac{dS}{dt}=\frac{dI}{dt}=\frac{dR}{dt}=0\)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is important to note that equilibrium doesn’t mean a lack of individuals flowing between each compartment but rather a <em>balanced</em> flow of individuals between each compartment. This means that the same number or proportion of individuals are entering and leaving each compartment at a given time, so the net change in the number or proportion of individuals in each compartment is <span class="math inline">\(0\)</span>.</p>
<p>We can understand this just by looking at the model equations themselves. Take the susceptible population as an example, dictated by the rate:</p>
<p><span class="math display">\[
\frac{dS}{dt} = \mu-\beta \tilde{I} S - \mu S
\]</span></p>
<p>We can see that for <span class="math inline">\(\frac{dS}{dt}\)</span> to be equal to <span class="math inline">\(0\)</span>, it is not necessary that <span class="math inline">\(0\)</span> people are entering the susceptible population (i.e.&nbsp;being born) and <span class="math inline">\(0\)</span> people are leaving the susceptible population (i.e.&nbsp;getting infected). It is simply necessary that the flow rate <em>into</em> the susceptible population (given by the birth rate term ) is the same as the flow rate <em>out</em> of the susceptible population (given by the infection term <span class="math inline">\(\beta \tilde{I} S\)</span> and the death rate term <span class="math inline">\(\mu S\)</span>).</p>
</div>
</div>
<p>The equilibrium of a system of differential equations is found by setting each rate of change equal to <span class="math inline">\(0\)</span> and finding the solution(s) of the resulting system:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d\tilde{S}}{dt} = 0, \quad \frac{d\tilde{I}}{dt} = 0, \quad \frac{d\tilde{R}}{dt} = 0
&amp; \quad &amp;&amp; \text{Equilibrium set up} \\[10pt]
\frac{d\tilde{I}}{dt} = \beta \tilde{I} \tilde{S} - \gamma \tilde{I} - \mu \tilde{I} = 0
&amp; \quad &amp;&amp; \text{Focus on the infected equation} \\[10pt]
\tilde{I}(\beta \tilde{S} - \gamma - \mu ) = 0
&amp; \quad &amp;&amp; \text{Factor out } \tilde{I} \text{ to solve for equilibrium} \\[10pt]
\tilde{I}^* = 0 \quad \text{or} \quad \tilde{S}^* = \frac{\gamma + \mu}{\beta}=\frac{1}{R_0}
&amp; \quad &amp;&amp; \text{Two potential solutions}
\end{aligned}
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that above equilibrium system is solved using the endemic model equations for the proportion, not number, of individuals in each compartment. A similar procedure can be replicated to solve for the number of individuals in each compartment at the equilibrium.</p>
<p>The values at which the equilibrium occur are often denoted using an asterisk (<span class="math inline">\(*\)</span>) above the variable. For consistency and clarity, the values at which the equilibrium occurs for the proportion endemic model will be denoted with <span class="math inline">\(\tilde{S}^*\)</span>, <span class="math inline">\(\tilde{I}^*\)</span>, and <span class="math inline">\(\tilde{R}^*\)</span>. Likewise, the values at which the equilibrium occurs for the number endemic model will be denoted with <span class="math inline">\(S^*\)</span>, <span class="math inline">\(I^*\)</span>, and <span class="math inline">\(R^*\)</span>.</p>
</div>
</div>
<p>Notice that we actually have two possible solutions for the equilibrium, one where <span class="math inline">\(\tilde{I}^*=0\)</span> and another when <span class="math inline">\(\tilde{S}^* = \frac{1}{R_0}\)</span>. We can solve for the values of the other variables at these points, starting with when <span class="math inline">\(\tilde{I}^*=0\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d\tilde{S}}{dt}=\mu - \mu \tilde{S}=0 \implies \tilde{S}^*=1
&amp; \quad &amp;&amp; \text{Substituting } \tilde{I}=0 \text{ into } \frac{d\tilde{S}}{dt}=0 \\[10pt]
\frac{d\tilde{R}}{dt}= - \mu \tilde{R} =0 \implies \tilde{R}^*=0
&amp; \quad &amp;&amp; \text{Substituting } \tilde{I}=0 \text{ into } \frac{d\tilde{R}}{dt}=0 \\[10pt]
\end{aligned}
\]</span></p>
<p>This gives us one set of values where an equilibrium can occur:</p>
<p><span class="math display">\[
(\tilde{S}^*,\tilde{I}^*,\tilde{R}^*)=(1,0,0)
\]</span> The other set of values corresponding to an equilibrium point can be obtained by solving for the values of <span class="math inline">\(\tilde{I}^*\)</span> and <span class="math inline">\(\tilde{R}^*\)</span> when <span class="math inline">\(\tilde{S}^*=\frac{1}{R_0}\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d\tilde{S}}{dt}=\mu - \beta \tilde{I} \left(\frac{1}{R_0} \right) -\mu \tilde{S}=0 \implies \tilde{I}^*=\frac{\mu}{\beta}(R_0-1)
&amp; \quad &amp;&amp; \text{Substituting } \tilde{S}=\frac{1}{R_0} \text{ into } \frac{d\tilde{S}}{dt}=0 \\[10pt]
\tilde{S}+\tilde{I}+\tilde{R}=1 \implies \tilde{R}^*=1-\frac{1}{R_0}-\frac{\mu}{\beta}(R_0-1)
&amp; \quad &amp;&amp; \text{Using total population equation}\\[10pt]
\end{aligned}
\]</span></p>
<p>Now we have both sets of values where an equilibrium occurs:</p>
<p><span class="math display">\[
\begin{aligned}
(\tilde{S}^*,\tilde{I}^*,\tilde{R}^*) &amp;= (1,0,0) \\[10pt]
(\tilde{S}^*,\tilde{I}^*,\tilde{R}^*) &amp;= \left(\frac{1}{R_0}, \frac{\mu}{\beta}(R_0-1), 1 - \frac{1}{R_0} - \frac{\mu}{\beta}(R_0-1)\right)
\end{aligned}
\]</span></p>
<p>Each of these two sets of values correspond to their own equilibrium points which have their own special names, summarized in the table below:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Name</strong></th>
<th><strong><span class="math inline">\((\tilde{S}^*,\tilde{I}^*,\tilde{R}^*)\)</span></strong></th>
<th><strong>What Is Happening At This Point?</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Disease-Free Equilibrium</td>
<td><span class="math inline">\((1,0,0)\)</span></td>
<td>A stable point wherein the the disease has completely left the population and all recovered individuals have died due to natural causes. It can be interpreted as a population “untouched” by the disease.</td>
</tr>
<tr class="even">
<td>Endemic Equilibrium</td>
<td><span class="math inline">\(\left(\frac{1}{R_0}, \frac{\mu}{\beta}(R_0-1), 1 - \frac{1}{R_0} - \frac{\mu}{\beta}(R_0-1)\right)\)</span></td>
<td>A stable point wherein the disease has established itself in the population and become <em>endemic</em>. A disease is endemic when “it is consistently present but limited to a particular region,” which in the case of the endemic SIR model is our particular region of study <span class="citation" data-cites="endemic_article">(<a href="#ref-endemic_article" role="doc-biblioref"><span>“Epidemic, Endemic, Pandemic: What Are the Differences?”</span> 2021</a>)</span>.</td>
</tr>
</tbody>
</table>
<p>The next question that arises is when do these equilibrium points occur? The answer lies in the value of <span class="math inline">\(R_0\)</span>: the endemic equilibrium is <em>asymptotically stable</em> when <span class="math inline">\(R_0&gt;1\)</span>, otherwise if <span class="math inline">\(R_0\leq1\)</span> then the disease-free equilibrium is stable.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The stability of model systems can be a difficult concept to grasp, but in general we can think of the above statement as saying that when <span class="math inline">\(R_0\leq 1\)</span> or the initial proportion of infected individuals equals 0, all valid solution paths (solutions which exist for all positive time and are unique) approach the disease-free equilibrium given by <span class="math inline">\((\tilde{S}^*,\tilde{I}^*,\tilde{R}^*)=(1,0,0)\)</span>. Similarly, when <span class="math inline">\(R_0&gt;1\)</span>, all valid solution paths with an initial proportion of infected individuals greater than <span class="math inline">\(0\)</span> will approach the endemic equilibrium <span class="citation" data-cites="hethcote_math_infection">(<a href="#ref-hethcote_math_infection" role="doc-biblioref">Hethcote 2000</a>)</span>.</p>
<p>This makes sense intuitively, as if <span class="math inline">\(R_0\leq1\)</span> the pathogen can’t invade the population since every new infectious individual would only, on average, pass on the disease to one or fewer hosts. Eventually the chain of transmission would break and the disease-free equilibrium would be approached asymptotically (over time). Likewise, if <span class="math inline">\(R_0&gt;1\)</span> the pathogen can invade the population with even just the smallest introduction of infectious individuals since they will successively infect more people (who will then infect more even more people, etc.). The chain of transmission will not break either like it does in the epidemic SIR model since the population of susceptibles is constantly being “replenished” via new births, so the disease-free equilibrium is approached asymptotically.</p>
</div>
</div>
<p>The simulation below lets you see which equilibrium will be approached for different values of <span class="math inline">\(R_0\)</span> and initial proportion of infected individuals:</p>
<iframe src="http://127.0.0.1:4569" width="100%" height="700" style="border:none;">
</iframe>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try setting the transmission rate to <span class="math inline">\(1\)</span>, the recovery rate to <span class="math inline">\(0.7\)</span>, and the birth / death rate to <span class="math inline">\(0.4\)</span>. Notice that under these model parameters, the basic reproduction number <span class="math inline">\(R_0\)</span> is barely under <span class="math inline">\(1\)</span> (<span class="math inline">\(R_0\approx0.909\)</span>). Now try changing the initial proportion of infected individuals and observe what happens to the SIR curves over time. Even for an initial infected proportion of <span class="math inline">\(1\)</span> (at the start everyone is infected), the curves still approach the disease-free equilibrium as expected!</p>
<p>Now try setting the parameters to result in <span class="math inline">\(R_0&gt;1\)</span> and observe the proportion of susceptible, infected, and recovered individuals as time progresses (you can see the exact proportions by hovering over each curve). Do these line up exactly with values at the endemic equilibrium point calculated before?</p>
</div>
</div>
<p>ASK JAVI: SHOULD ADD SECTION EXPLAINING USEFULNESS OF EQUILIBRIUM POINTS? CAN WE FIND ANY GOOD APPLICATION QUESTIONS FOR THEM?</p>
<!-- -->

<script type="webr-data">
eyJvcHRpb25zIjp7ImJhc2VVcmwiOiJodHRwczovL3dlYnIuci13YXNtLm9yZy92MC41LjgvIn0sInBhY2thZ2VzIjp7InBrZ3MiOlsiZXZhbHVhdGUiLCJrbml0ciIsImh0bWx0b29scyIsInByYWNtYSIsImJibWxlIiwiZHBseXIiXSwicmVwb3MiOltdfSwicmVuZGVyX2RmIjoiZGVmYXVsdCJ9
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3siY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xNyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTc7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xNyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzE3ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTctY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xNy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xNyA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTcsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xNiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTY7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xNiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzE2ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTYtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xNi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xNiA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTYsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xNSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTU7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xNSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzE1ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTUtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xNS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xNSA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTUsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xNCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTQ7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xNCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzE0ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTQtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xNC1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xNCA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTQsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTM7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzEzID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTMtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xMy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xMyA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTMsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTI7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzEyID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTItY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xMi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xMiA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTIsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTE7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzExID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTEtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xMS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xMSA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTEsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTA7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzEwID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTAtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xMC1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xMCA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTAsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC05IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV85O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItOSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzkgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici05LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHdlYnItOS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV85ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl85LCB7fSk7XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtOCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfODtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTgiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl84ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItOC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTgtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuXG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxuX3dlYnJfdmFsdWVfOCA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfOCwge30pO1xuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTciLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzc7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici03IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfNyA9IHtcbiAgY29uc3QgeyBXZWJSRXhlcmNpc2VFZGl0b3IsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTctY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici03LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzcgPSB3ZWJST2pzLnByb2Nlc3MoX3dlYnJfZWRpdG9yXzcsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC02IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV82O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItNiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzYgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici02LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHdlYnItNi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV82ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl82LCB7fSk7XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtNSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfNTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl81ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItNS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTUtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuXG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxuX3dlYnJfdmFsdWVfNSA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfNSwge30pO1xuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzQ7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici00IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfNCA9IHtcbiAgY29uc3QgeyBXZWJSRXhlcmNpc2VFZGl0b3IsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTQtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici00LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzQgPSB3ZWJST2pzLnByb2Nlc3MoX3dlYnJfZWRpdG9yXzQsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0zIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8zO1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzMgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0zLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHdlYnItMy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8zID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8zLCB7fSk7XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMjtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl8yID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMi1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTItY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuXG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxuX3dlYnJfdmFsdWVfMiA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMiwge30pO1xuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzE7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMSA9IHtcbiAgY29uc3QgeyBXZWJSRXhlcmNpc2VFZGl0b3IsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTEtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzEgPSB3ZWJST2pzLnByb2Nlc3MoX3dlYnJfZWRpdG9yXzEsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXByZWx1ZGUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ3ZWJST2pzID0ge1xuICBjb25zdCB7IFdlYlIsIENoYW5uZWxUeXBlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lLldlYlI7XG4gIGNvbnN0IHtcbiAgICBXZWJSRXZhbHVhdG9yLFxuICAgIFdlYlJFbnZpcm9ubWVudE1hbmFnZXIsXG4gICAgc2V0dXBSLFxuICAgIGI2NERlY29kZSxcbiAgICBjb2xsYXBzZVBhdGhcbiAgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc3RhdHVzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleGVyY2lzZS1sb2FkaW5nLXN0YXR1c1wiKTtcbiAgY29uc3QgaW5kaWNhdG9yQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleGVyY2lzZS1sb2FkaW5nLWluZGljYXRvclwiKTtcbiAgaW5kaWNhdG9yQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJkLW5vbmVcIik7XG5cbiAgbGV0IHN0YXR1c1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gIHN0YXR1c1RleHQuY2xhc3NMaXN0ID0gXCJleGVyY2lzZS1sb2FkaW5nLWRldGFpbHNcIjtcbiAgc3RhdHVzVGV4dCA9IHN0YXR1c0NvbnRhaW5lci5hcHBlbmRDaGlsZChzdGF0dXNUZXh0KTtcbiAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBJbml0aWFsaXNlYDtcblxuICAvLyBIb2lzdCBpbmRpY2F0b3Igb3V0IGZyb20gZmluYWwgc2xpZGUgd2hlbiBydW5uaW5nIHVuZGVyIHJldmVhbFxuICBjb25zdCByZXZlYWxTdGF0dXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJldmVhbCAuZXhlcmNpc2UtbG9hZGluZy1pbmRpY2F0b3JcIik7XG4gIGlmIChyZXZlYWxTdGF0dXMpIHtcbiAgICByZXZlYWxTdGF0dXMucmVtb3ZlKCk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZlYWwgPiAuc2xpZGVzXCIpLmFwcGVuZENoaWxkKHJldmVhbFN0YXR1cyk7XG4gIH1cblxuICAvLyBNYWtlIGFueSByZXZlYWwgc2xpZGVzIHdpdGggbGl2ZSBjZWxscyBzY3JvbGxhYmxlXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucmV2ZWFsIC5leGVyY2lzZS1jZWxsXCIpLmZvckVhY2goKGVsKSA9PiB7XG4gICAgZWwuY2xvc2VzdCgnc2VjdGlvbi5zbGlkZScpLmNsYXNzTGlzdC5hZGQoXCJzY3JvbGxhYmxlXCIpO1xuICB9KVxuXG4gIC8vIHdlYlIgc3VwcGxlbWVudGFsIGRhdGEgYW5kIG9wdGlvbnNcbiAgY29uc3QgZGF0YUNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici1kYXRhXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKGRhdGFDb250ZW50KSk7XG5cbiAgLy8gR3JhYiBsaXN0IG9mIHJlc291cmNlcyB0byBiZSBkb3dubG9hZGVkXG4gIGNvbnN0IGZpbGVzQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ2ZnMtZmlsZVxcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGZpbGVzID0gSlNPTi5wYXJzZShiNjREZWNvZGUoZmlsZXNDb250ZW50KSk7XG5cbiAgLy8gSW5pdGlhbGlzZSB3ZWJSIGFuZCBzZXR1cCBmb3IgUiBjb2RlIGV2YWx1YXRpb25cbiAgbGV0IHdlYlJQcm9taXNlID0gKGFzeW5jICh3ZWJSKSA9PiB7XG4gICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyB3ZWJSYDtcbiAgICBhd2FpdCB3ZWJSLmluaXQoKTtcblxuICAgIC8vIEluc3RhbGwgcHJvdmlkZWQgbGlzdCBvZiBwYWNrYWdlc1xuICAgIC8vIEVuc3VyZSB3ZWJSIGRlZmF1bHQgcmVwbyBpcyBpbmNsdWRlZFxuICAgIGRhdGEucGFja2FnZXMucmVwb3MucHVzaChcImh0dHBzOi8vcmVwby5yLXdhc20ub3JnXCIpXG4gICAgYXdhaXQgZGF0YS5wYWNrYWdlcy5wa2dzLm1hcCgocGtnKSA9PiAoKSA9PiB7XG4gICAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHBhY2thZ2U6ICR7cGtnfWA7XG4gICAgICByZXR1cm4gd2ViUi5ldmFsUlZvaWQoYFxuICAgICAgICB3ZWJyOjppbnN0YWxsKHBrZywgcmVwb3MgPSByZXBvcylcbiAgICAgICAgbGlicmFyeShwa2csIGNoYXJhY3Rlci5vbmx5ID0gVFJVRSlcbiAgICAgIGAsIHsgZW52OiB7XG4gICAgICAgIHBrZzogcGtnLFxuICAgICAgICByZXBvczogZGF0YS5wYWNrYWdlcy5yZXBvcyxcbiAgICAgIH19KTtcbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcblxuICAgIC8vIERvd25sb2FkIGFuZCBpbnN0YWxsIHJlc291cmNlc1xuICAgIGF3YWl0IGZpbGVzLm1hcCgoZmlsZSkgPT4gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbmFtZSA9IGZpbGUuc3Vic3RyaW5nKGZpbGUubGFzdEluZGV4T2YoJy8nKSArIDEpO1xuICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyByZXNvdXJjZTogJHtuYW1lfWA7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGZpbGUpO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbid0IGRvd25sb2FkIFxcYCR7ZmlsZX1cXGAuIEVycm9yICR7cmVzcG9uc2Uuc3RhdHVzfTogXCIke3Jlc3BvbnNlLnN0YXR1c1RleHR9XCIuYCk7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTtcblxuICAgICAgLy8gU3RvcmUgVVJMcyBpbiB0aGUgY3dkIHdpdGhvdXQgYW55IHN1YmRpcmVjdG9yeSBzdHJ1Y3R1cmVcbiAgICAgIGlmIChmaWxlLmluY2x1ZGVzKFwiOi8vXCIpKSB7XG4gICAgICAgIGZpbGUgPSBuYW1lO1xuICAgICAgfVxuXG4gICAgICAvLyBDb2xsYXBzZSBoaWdoZXIgZGlyZWN0b3J5IHN0cnVjdHVyZVxuICAgICAgZmlsZSA9IGNvbGxhcHNlUGF0aChmaWxlKTtcblxuICAgICAgLy8gQ3JlYXRlIGRpcmVjdG9yeSB0cmVlLCBpZ25vcmluZyBcImRpcmVjdG9yeSBleGlzdHNcIiBWRlMgZXJyb3JzXG4gICAgICBjb25zdCBwYXJ0cyA9IGZpbGUuc3BsaXQoJy8nKS5zbGljZSgwLCAtMSk7XG4gICAgICBsZXQgcGF0aCA9ICcnO1xuICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcGF0aCArPSBwYXJ0cy5zaGlmdCgpICsgJy8nO1xuICAgICAgICBjb25zdCBhbmFseXNpcyA9IGF3YWl0IHdlYlIuRlMuYW5hbHl6ZVBhdGgocGF0aCk7XG4gICAgICAgIGlmICghYW5hbHlzaXMuZXhpc3RzKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHdlYlIuRlMubWtkaXIocGF0aCk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGaWxlc3lzdGVtIEVycm9yOiBcIiR7ZS5tZXNzYWdlfVwiLmApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBXcml0ZSB0aGlzIGZpbGUgdG8gdGhlIFZGU1xuICAgICAgcmV0dXJuIGF3YWl0IHdlYlIuRlMud3JpdGVGaWxlKGZpbGUsIG5ldyBVaW50OEFycmF5KGRhdGEpKTtcbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcblxuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgSW5zdGFsbGluZyB3ZWJSIHNoaW1zYDtcbiAgICBhd2FpdCB3ZWJSLmV2YWxSVm9pZChgd2Vicjo6c2hpbV9pbnN0YWxsKClgKTtcblxuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgV2ViUiBlbnZpcm9ubWVudCBzZXR1cGA7XG4gICAgYXdhaXQgc2V0dXBSKHdlYlIsIGRhdGEpO1xuXG4gICAgc3RhdHVzVGV4dC5yZW1vdmUoKTtcbiAgICBpZiAoc3RhdHVzQ29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCA9PSAwKSB7XG4gICAgICBzdGF0dXNDb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHdlYlI7XG4gIH0pKG5ldyBXZWJSKGRhdGEub3B0aW9ucykpO1xuXG4gIC8vIEtlZXAgdHJhY2sgb2YgaW5pdGlhbCBPSlMgYmxvY2sgcmVuZGVyXG4gIGNvbnN0IHJlbmRlcmVkT2pzID0ge307XG5cbiAgY29uc3QgcHJvY2VzcyA9IGFzeW5jIChjb250ZXh0LCBpbnB1dHMpID0+IHtcbiAgICBjb25zdCB3ZWJSID0gYXdhaXQgd2ViUlByb21pc2U7XG4gICAgY29uc3QgZXZhbHVhdG9yID0gbmV3IFdlYlJFdmFsdWF0b3Iod2ViUiwgY29udGV4dClcbiAgICBhd2FpdCBldmFsdWF0b3IucHJvY2VzcyhpbnB1dHMpO1xuICAgIHJldHVybiBldmFsdWF0b3IuY29udGFpbmVyO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBwcm9jZXNzLFxuICAgIHdlYlJQcm9taXNlLFxuICAgIHJlbmRlcmVkT2pzLFxuICB9O1xufVxuIn1dfQ==
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script>

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-anderson_may_1982" class="csl-entry" role="listitem">
Anderson, Roy M., and Robert M. May. 1982. <span>“Directly Transmitted Infectious Diseases: Control by Vaccination.”</span> <em>Science</em> 215 (4536): 1053–60. <a href="http://www.jstor.org/stable/1688362">http://www.jstor.org/stable/1688362</a>.
</div>
<div id="ref-review_measles" class="csl-entry" role="listitem">
Arsal, Shinta R., Dipo Aldila, and Bevina D. Handari. 2020. <span>“Short Review of Mathematical Model of Measles.”</span> <em>AIP Conference Proceedings</em> 2264 (1): 020003. <a href="https://doi.org/10.1063/5.0023439">https://doi.org/10.1063/5.0023439</a>.
</div>
<div id="ref-ode_book" class="csl-entry" role="listitem">
Atkinson, Kendall, Weimin Han, and David Stewart. 2009. <span>“Euler’s Method.”</span> In <em>Numerical Solution of Ordinary Differential Equations</em>, 15–36. John Wiley &amp; Sons, Ltd. <a href="https://doi.org/10.1002/9781118164495.ch2">https://doi.org/10.1002/9781118164495.ch2</a>.
</div>
<div id="ref-bjornstad_measles_data" class="csl-entry" role="listitem">
Bjørnstad, Ottar N., Bärbel F. Finkenstädt, and Bryan T. Grenfell. n.d. <span>“TSIR Analysis of Measles in England and Wales.”</span> Pennsylvania State University; <a href="https://ento.psu.edu/research/labs/ottar-bjornstad/ottar-lab-abstracts/tsir-analysis-of-measles-in-england-and-wales" class="uri">https://ento.psu.edu/research/labs/ottar-bjornstad/ottar-lab-abstracts/tsir-analysis-of-measles-in-england-and-wales</a>.
</div>
<div id="ref-bjornstad_measles" class="csl-entry" role="listitem">
———. 2002. <span>“DYNAMICS OF MEASLES EPIDEMICS: ESTIMATING SCALING OF TRANSMISSION RATES USING a TIME SERIES SIR MODEL.”</span> <em>Ecological Monographs</em> 72 (2): 169–84. <a href="https://doi.org/10.1890/0012-9615(2002)072[0169:DOMEES]2.0.CO;2">https://doi.org/10.1890/0012-9615(2002)072[0169:DOMEES]2.0.CO;2</a>.
</div>
<div id="ref-vaccines13050479" class="csl-entry" role="listitem">
Boccalini, Sara. 2025. <span>“Value of Vaccinations: A Fundamental Public Health Priority to Be Fully Evaluated.”</span> <em>Vaccines</em> 13 (5). <a href="https://doi.org/10.3390/vaccines13050479">https://doi.org/10.3390/vaccines13050479</a>.
</div>
<div id="ref-pracma_cran" class="csl-entry" role="listitem">
Borchers, Hans W. 2025. <em>Pracma: Practical Numerical Math Functions</em> (version 2.4.6). The R Project for Statistical Computing. <a href="https://cran.r-project.org/web/packages/pracma/pracma.pdf">https://cran.r-project.org/web/packages/pracma/pracma.pdf</a>.
</div>
<div id="ref-runge_kutta_background" class="csl-entry" role="listitem">
Cheever, Erik. n.d. <em>Fourth Order Runge-Kutta</em>. Swarthmore College. <a href="https://lpsa.swarthmore.edu/NumInt/NumIntFourth.html">https://lpsa.swarthmore.edu/NumInt/NumIntFourth.html</a>.
</div>
<div id="ref-endemic_article" class="csl-entry" role="listitem">
<span>“Epidemic, Endemic, Pandemic: What Are the Differences?”</span> 2021. <em>Columbia University Mailman School of Public Health</em>. <a href="https://www.publichealth.columbia.edu/news/epidemic-endemic-pandemic-what-are-differences">https://www.publichealth.columbia.edu/news/epidemic-endemic-pandemic-what-are-differences</a>.
</div>
<div id="ref-Handel2021_IDEMA_ch5" class="csl-entry" role="listitem">
Handel, Andreas. 2021. <span>“Reproductive Number.”</span> In <em>Infectious Disease Epidemiology – a Model-Based Approach (IDEMA)</em>. Andreas Handel. <a href="https://andreashandel.github.io/IDEMAbook/R0.html">https://andreashandel.github.io/IDEMAbook/R0.html</a>.
</div>
<div id="ref-hethcote_math_infection" class="csl-entry" role="listitem">
Hethcote, Herbert W. 2000. <span>“The Mathematics of Infectious Diseases.”</span> <em>SIAM Review</em> 42 (4): 599–653. <a href="https://doi.org/10.1137/S0036144500371907">https://doi.org/10.1137/S0036144500371907</a>.
</div>
<div id="ref-keeling_modeling_2008" class="csl-entry" role="listitem">
Keeling, Matt J., and Pejman Rohani. 2008. <em>Modeling <span>Infectious</span> <span>Diseases</span> in <span>Humans</span> and <span>Animals</span></em>. Princeton University Press. <a href="https://doi.org/10.2307/j.ctvcm4gk0">https://doi.org/10.2307/j.ctvcm4gk0</a>.
</div>
<div id="ref-docs_bbmle_mle2" class="csl-entry" role="listitem">
<span>“Mle2: Maximum Likelihood Estimation.”</span> n.d. <em>RDocumentation</em>. <a href="https://www.rdocumentation.org/packages/bbmle/versions/1.0.25.1/topics/mle2">https://www.rdocumentation.org/packages/bbmle/versions/1.0.25.1/topics/mle2</a>.
</div>
<div id="ref-docs_stats_optim" class="csl-entry" role="listitem">
<span>“Optim: General-Purpose Optimization.”</span> n.d. <em>RDocumentation</em>. <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/optim">https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/optim</a>.
</div>
<div id="ref-deer_covid" class="csl-entry" role="listitem">
Rosenblatt, Elias, Jonathan D. Cook, Graziella V. DiRenzo, Evan H. C. Grant, Fernando Arce, Kim M. Pepin, F. Javiera Rudolph, et al. 2023. <span>“Epidemiological Modeling of SARS-CoV-2 in White-Tailed Deer (Odocoileus Virginianus) Reveals Conditions for Introduction and Widespread Transmission.”</span> <em>bioRxiv</em>. <a href="https://doi.org/10.1101/2023.08.30.555493">https://doi.org/10.1101/2023.08.30.555493</a>.
</div>
<div id="ref-parameter_estimation" class="csl-entry" role="listitem">
Senel, Kerem, Mesut Ozdinc, and Selcen Ozturkcan. 2021. <span>“Single Parameter Estimation Approach for Robust Estimation of SIR Model with Limited and Noisy Data: The Case for COVID-19.”</span> <em>Disaster Medicine and Public Health Preparedness</em> 15 (3): e8–22. <a href="https://doi.org/10.1017/dmp.2020.220">https://doi.org/10.1017/dmp.2020.220</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../..";
window._ojs.paths.runtimeToRoot = "../../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb10" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Computational Thinking with SIR Models"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "A Disease Ecology Module"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">  live-html:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-align: "center"</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 4</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> ../reference.bib</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="an">webr:</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">  packages:</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">    - pracma</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">    - bbmle</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">    - dplyr</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>{{&lt; include ./_extensions/r-wasm/live/_knitr.qmd &gt;}}</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction and Course Learning Objectives</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction and The Classic Epidemic Model</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Epidemiology Terms {#sec-epidemiology-terms}</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define basic terms in epidemiology.</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>For the purposes of mathematical models in epidemiology, such as the SIR model, individuals are classified based solely on their ability to transmit a pathogen, not their diseased status (whether or not they exhibit symptoms). For the purposes of epidemiological models, individuals are generally classified into four primary categories:</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Susceptible:** No pathogen is present in the individual. The individual only has a low level of non-specific immunity to incoming infection.</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Exposed:** The individual has encountered an infected individual and is infected with the pathogen. The levels of pathogen in this individual are too low to allow them to transmit the disease to another person. This individual is hence considered "exposed" to the pathogen but not yet able to infect others with it.</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Infectious:** The individual has surpassed the exposed stage and the pathogen levels within them are high enough to allow for transmission. This individual is no longer just exposed to the pathogen, but can actively spread it now.</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Recovered:** The individual has surpassed the infectious stage, their immune system has cleared enough of the pathogen that they can no longer transmit it. This individual has some amount of immunity to the pathogen now, but for how long this immunity lasts depends on the specific pathogen.</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>The individual can still exhibit symptoms of the disease while in the recovered compartment, so it is best to think of this compartment as individuals who have "recovered" from their ability to spread the infection but not necessarily all symptomatic implications of that infection.</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>These categories are not exhaustive, and individuals can be classified into further categories based on their stage of infection or immunity status, just to name a few. These four categories are highlighted since they come up most often while discussing SIR-type models and epidemiological models in general. It is important to note that, at the same time individuals fall into these categories, they can also be classified based on whether or not they exhibit symptoms of infection:</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Incubation Period:** The individual has been infected with the pathogen but does not show disease symptoms. This is also commonly refferred to as the *asymptomatic period*.</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Diseased period:** The individual has surpassed the incubation period and begins to show symptoms of the disease.</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>Although these classifications are more commonly used in a medical, rather than an epidemiological, contexts, we still provide them here to clarify the fact that an individual can still be infectious while in the incubation period and showing no symptoms of the disease. Similarly, an individual can still be in the diseased period and show lingering symptoms of infection while being recovered since their immune system has cleared enough of the pathogen that they are not longer infectious.</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>(PLACE GRAPH HERE OF ALL THESE PERIODS)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>**Section References**</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>@keeling_modeling_2008</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introducing Compartmental Models {#sec-introducing-compartmental-models}</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define what a compartmental model is.</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Identify which differential equation models can be called compartmental models.</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>Generally speaking, compartmental models are a way to represent the flow of populations between different states, known as compartments, using differential equations. Compartmental models show up in a wide variety of fields, not just epidemiology. Any field that can benefit from knowing how information flows between states can benefit from compartmental models.</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>In the epidemiological context, compartmental models are analyzing how people flow through the four categories, which will be referred to simply as "compartments" from now on, introduced in <span class="co">[</span><span class="ot">Section @sec-epidemiology-terms</span><span class="co">]</span>: susceptible (S), exposed (E), infectious (I), and recovered (R). The relationships between these compartments are often represented using flowcharts like the one seen below.</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{dot}</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-width: 8</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-height: 2</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-align: center</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a><span class="kw">digraph</span> <span class="va">SEIR</span> <span class="ot">{</span></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="at">rankdir</span><span class="ot">=</span><span class="va">LR</span><span class="ot">;</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="kw">node</span><span class="co"> </span><span class="ot">[</span><span class="at">shape</span><span class="ot">=</span><span class="va">box</span><span class="co">, </span><span class="at">style</span><span class="ot">=</span><span class="va">rounded</span><span class="co">, </span><span class="at">fontsize</span><span class="ot">=</span><span class="dv">14</span><span class="ot">];</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">S</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"S"</span><span class="ot">];</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">E</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"E"</span><span class="ot">];</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">I</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"I"</span><span class="ot">];</span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">R</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"R"</span><span class="ot">];</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="kw">edge</span><span class="co"> </span><span class="ot">[</span><span class="at">fontsize</span><span class="ot">=</span><span class="dv">12</span><span class="ot">];</span></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">S</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">E</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"λ"</span><span class="co">, </span><span class="at">labelfontsize</span><span class="ot">=</span><span class="dv">12</span><span class="co">, </span><span class="at">labeldistance</span><span class="ot">=</span><span class="dv">2.0</span><span class="co">, </span><span class="at">labelangle</span><span class="ot">=</span><span class="co">-</span><span class="dv">90</span><span class="ot">];</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">E</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">I</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"σ"</span><span class="co">, </span><span class="at">labelfontsize</span><span class="ot">=</span><span class="dv">12</span><span class="co">, </span><span class="at">labeldistance</span><span class="ot">=</span><span class="dv">2.0</span><span class="co">, </span><span class="at">labelangle</span><span class="ot">=</span><span class="co">-</span><span class="dv">90</span><span class="ot">];</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">I</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">R</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"γ"</span><span class="co">,  </span><span class="at">labelfontsize</span><span class="ot">=</span><span class="dv">12</span><span class="co">, </span><span class="at">labeldistance</span><span class="ot">=</span><span class="dv">2.0</span><span class="co">, </span><span class="at">labelangle</span><span class="ot">=</span><span class="co">-</span><span class="dv">90</span><span class="ot">];</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="ot">}</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>The arrows between these compartments represent the direction of flow (susceptible individuals becoming exposed, exposed individuals becoming infectious, etc.) and the symbols above each arrow represent the *flow rates* between each compartment with respect to time.</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>It's easiest to understand this conceptually through an example. Say in a very large population with the established presence of a pathogen, on average, 300 new people become exposed to a pathogen every day. Of those that are exposed to the pathogen, on average, 50 of them reach pathogen levels high enough to become infectious per day. Then, of those that are infectious and able to transmit the pathogen, on average, 40 of them recover from the pathogen (in the sense that they can no longer transmit it). We can model this specific example with the modified flowchart below:</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{dot}</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-width: 8</span></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-height: 2</span></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-align: center</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a><span class="kw">digraph</span> <span class="va">SEIRmod</span> <span class="ot">{</span></span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="at">rankdir</span><span class="ot">=</span><span class="va">LR</span><span class="ot">;</span></span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="kw">node</span><span class="co"> </span><span class="ot">[</span><span class="at">shape</span><span class="ot">=</span><span class="va">box</span><span class="co">, </span><span class="at">style</span><span class="ot">=</span><span class="va">rounded</span><span class="co">, </span><span class="at">fontsize</span><span class="ot">=</span><span class="dv">14</span><span class="ot">];</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">S</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"S"</span><span class="ot">];</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">E</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"E"</span><span class="ot">];</span></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">I</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"I"</span><span class="ot">];</span></span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">R</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"R"</span><span class="ot">];</span></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="kw">edge</span><span class="co"> </span><span class="ot">[</span><span class="at">fontsize</span><span class="ot">=</span><span class="dv">12</span><span class="ot">];</span></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">S</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">E</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"λ = 300"</span><span class="co">, </span><span class="at">labelfontsize</span><span class="ot">=</span><span class="dv">12</span><span class="co">, </span><span class="at">labeldistance</span><span class="ot">=</span><span class="dv">2.0</span><span class="co">, </span><span class="at">labelangle</span><span class="ot">=</span><span class="co">-</span><span class="dv">90</span><span class="ot">];</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">E</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">I</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"σ = 50"</span><span class="co">, </span><span class="at">labelfontsize</span><span class="ot">=</span><span class="dv">12</span><span class="co">, </span><span class="at">labeldistance</span><span class="ot">=</span><span class="dv">2.0</span><span class="co">, </span><span class="at">labelangle</span><span class="ot">=</span><span class="co">-</span><span class="dv">90</span><span class="ot">];</span></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">I</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">R</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"γ = 40"</span><span class="co">,  </span><span class="at">labelfontsize</span><span class="ot">=</span><span class="dv">12</span><span class="co">, </span><span class="at">labeldistance</span><span class="ot">=</span><span class="dv">2.0</span><span class="co">, </span><span class="at">labelangle</span><span class="ot">=</span><span class="co">-</span><span class="dv">90</span><span class="ot">];</span></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a><span class="ot">}</span></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>Which compartments we choose to include depends on the specific pathogen and disease we are modeling. Models where the exposed period is so small it can be considered negligible, or is ommited for the sake of simplicity, are specifically known as *SIR models* (standing for the three different compartments included in the model: susceptible, infectious, and recovered).</span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>Some sources will refer generally to any compartmental epidemiological model as an "SIR model," but in our context we will make the distinction between SIR models and models that include different compartments than just susceptible, infectious, and recovered.</span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>We will, however, refer to the general idea of compartmental epidemiological models as "SIR-type models."</span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Section @sec-the-classic-sir-epidemic-model</span><span class="co">]</span> covers the specific formulation and assumptions of this model.</span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>**Section References**</span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a>@keeling_modeling_2008</span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Classic SIR Epidemic Model {#sec-the-classic-sir-epidemic-model}</span></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Recall the classic epidemic model's equations.</span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Construct equations for novel compartmental models given the flow rates between each of the compartments.</span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Identify the assumptions (and their justifications) made in the formulation of the classic epidemic model, including the assumptions made in relation to how its parameters were obtained / formulated.</span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Recall what parameters go into the construction of the classic epidemic model, including the typical symbols for each.</span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain how the classic epidemic model deviates from reality in relation to the assumptions it makes.</span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Differentiate situations where an empirically deduced transmission rate is more accurate and beneficial to one calculated based on first principles.</span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Discern what situations are best modeled by frequency or density dependent transmission rates, or a combination of both.</span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>The classic SIR epidemic model is a type of compartmental model that makes the following key assumptions:</span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>The epidemic invades the population and concludes itself quickly enough that demographic processes, namely births and deaths, are not very influential to the overall process and can be omitted from the model. This is also known as the *closed population* assumption.</span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Individuals move between the compartments of susceptible, infectious, and recovered only. Other compartments, namely the exposed compartment, are omitted for simplicity.</span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>Since this module covers only the epidemic and endemic SIR models, neither of which include the exposed compartment, the terms "infected" and "infectious" will be used interchangeably moving forward. This is because with only the susceptible, infectious, and recovered compartments, once an individual gets infected with the pathogen we assume they are infectious as well.</span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a>It is important to note that although "infected" and "infectious" are used interchangeably within the context of this learning module, they are not synonymous all the time. As model complexity increases and the exposed compartment is included, a distinction must be made between the two, as an individual can be considered "infected" but not "infectious" (i.e. they belong to the exposed compartment).</span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a>These are not the only assumptions made by the epidemic SIR model, but they do clearly distinguish it from other compartmental models such as the SEIR model, which includes exposed compartment, and the endemic SIR model, which includes the flow in and out of each compartment due to demographics (births and death).</span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a>Moving forward, $S$. $I$, and $R$ will refer to the *number* of individuals in the susceptible, infectious, and recovered compartments, respectively. The variables $\tilde{S}=\frac{S}{N}$, $\tilde{I}=\frac{I}{N}$, and $\tilde{R}=\frac{webr}{N}$, will be used to refer to the *proportion* of individuals in the susceptible, infectious, and recovered compartments, respectively, where $N$ is the total number of individuals in the population defined as $N=S+I+R$.</span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Since the epidemic model assumes a closed population with no births or deaths, $N$ is not a variable that can change but a constant.</span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Notice that $\tilde{S}+\tilde{I}+\tilde{R}=1$</span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a>The following equations provide the rates of change, with respect to time, for the number of individuals in each of the three compartments of the epidemic SIR model:</span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a>\frac{dS}{dt} &amp;= -\lambda S <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a>\frac{dI}{dt} &amp;= \lambda S - \gamma I <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a>\frac{dR}{dt} &amp;= \gamma I</span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a>Dividing each equation by the population size $N$, we can rewrite the SIR equations above to provide the rates of change, with respect to time, for the proportion of individuals in each compartment:</span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{S}}{dt} &amp;= -\lambda \tilde{S} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{I}}{dt} &amp;= \lambda \tilde{S} - \gamma \tilde{I} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{R}}{dt} &amp;= \gamma \tilde{I}</span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a>The rate of change of the number of people in each compartment can be understood as following the basic pattern of $R_i-R_o$ where $R_i$ is the rate that people are flowing into the compartment per unit time and $R_o$ is the rate that people are flowing out of the compartment per unit time. This pattern can be used to construct any number of novel compartmental models.</span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a>Notice that these equations mirror exactly the compartmental flowcharts introduced in the <span class="co">[</span><span class="ot">Section @sec-introducing-compartmental-models</span><span class="co">]</span>. The epidemic SIR model can be representing with the following flowchart:</span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{dot}</span></span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-width: 8</span></span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-height: 1</span></span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-align: center</span></span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a><span class="kw">digraph</span> <span class="va">SIRepi</span> <span class="ot">{</span></span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="at">rankdir</span><span class="ot">=</span><span class="va">LR</span><span class="ot">;</span></span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="kw">node</span><span class="co"> </span><span class="ot">[</span><span class="at">shape</span><span class="ot">=</span><span class="va">box</span><span class="co">, </span><span class="at">style</span><span class="ot">=</span><span class="va">rounded</span><span class="co">, </span><span class="at">fontsize</span><span class="ot">=</span><span class="dv">14</span><span class="ot">];</span></span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">S</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"S"</span><span class="ot">];</span></span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">I</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"I"</span><span class="ot">];</span></span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">R</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"R"</span><span class="ot">];</span></span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="kw">edge</span><span class="co"> </span><span class="ot">[</span><span class="at">fontsize</span><span class="ot">=</span><span class="dv">12</span><span class="ot">];</span></span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">S</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">I</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"λ"</span><span class="co">, </span><span class="at">labelfontsize</span><span class="ot">=</span><span class="dv">12</span><span class="co">, </span><span class="at">labeldistance</span><span class="ot">=</span><span class="dv">2.0</span><span class="co">, </span><span class="at">labelangle</span><span class="ot">=</span><span class="co">-</span><span class="dv">90</span><span class="ot">];</span></span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">I</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">R</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"γ"</span><span class="co">,  </span><span class="at">labelfontsize</span><span class="ot">=</span><span class="dv">12</span><span class="co">, </span><span class="at">labeldistance</span><span class="ot">=</span><span class="dv">2.0</span><span class="co">, </span><span class="at">labelangle</span><span class="ot">=</span><span class="co">-</span><span class="dv">90</span><span class="ot">];</span></span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a><span class="ot">}</span></span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a>The flow rates between each compartment have specific names and symbology, summarized in the table below:</span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Terminology / Name** | **Common Symbol** | **Interpretation** <span class="pp">|</span></span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a><span class="pp">|-------------------|------------------|-----------------------------------|</span></span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Force of Infection <span class="pp">|</span> $\lambda$ <span class="pp">|</span> The per capita rate at which susceptible individuals are becoming infectious per unit time. <span class="pp">|</span></span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Recovery Rate <span class="pp">|</span> $\gamma$ <span class="pp">|</span> The per capita rate at which infectious individuals are recovering from infection per unit time. <span class="pp">|</span></span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a>The phrase "per capita" here refers to a rate that is divided among each person in the given compartment. Take the following example: if 3 people are pouring water into a large bucket and each are adding 5 cups per minute, then the per capita rate at which water is being added is 5 cups per minute. To obtain the total rate at which water is being poured into the bucket, we would multiply the number of people pouring, 3, by their per capita rate, 5, to get a total inflow of 15 cups per minute.</span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a>A similar logic is being utilized in the SIR equations: the number of susceptible people at a given time, $S$, is multiplied by the per capita rate they are becoming infectious to get the total rate at which people are entering the infectious compartment Similarly, the number of infectious people at a given time, $I$, is multiplied by the per capita rate they are recovering to get the total rate at which people are entering the recovered compartment</span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a>**Section References**</span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a>@keeling_modeling_2008</span>
<span id="cb10-254"><a href="#cb10-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a><span class="fu">### Formulating the Force of Infection {#sec-formulating-foi}</span></span>
<span id="cb10-256"><a href="#cb10-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-257"><a href="#cb10-257" aria-hidden="true" tabindex="-1"></a>The force of infection, or the rate at which susceptible individuals are becoming infected per unit time, can be understood and formulated based on first principles in epidemiology as follows:</span>
<span id="cb10-258"><a href="#cb10-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-259"><a href="#cb10-259" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Consider the perspective of a susceptible individual in the population at any given time. Let's say this individual makes, on average, $c$ contacts with other people per unit time. Then, suppose that of those $c$ people this individual makes contact with per unit time, the proportion of them that will be infectious is $\tilde{I}$. Then, of those $c\tilde{I}$ contacts this individual makes with infectious people, the proportion of them that will actually succeed at spreading the infection to them is $p$. Multiplying these together, we can obtain the per capita (per person) rate which susceptible people are becoming infectious, or the force of infection as follows: $$</span></span>
<span id="cb10-260"><a href="#cb10-260" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; \lambda=cp\tilde{I}</span></span>
<span id="cb10-261"><a href="#cb10-261" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; $$</span></span>
<span id="cb10-262"><a href="#cb10-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-263"><a href="#cb10-263" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-264"><a href="#cb10-264" aria-hidden="true" tabindex="-1"></a>Although this formulation for $\lambda$ is based on first principles, there are still a number of assumptions being made. Namely:</span>
<span id="cb10-265"><a href="#cb10-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-266"><a href="#cb10-266" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>We assume every individual in the population comes into contact with other individuals at a constant rate $c$. This means we assume everyone in the population is equally sociable and, on average, comes into contact with the same number of people per unit time.</span>
<span id="cb10-267"><a href="#cb10-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-268"><a href="#cb10-268" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>We assume *homogeneous mixing* of the population. That is, we assume everyone has an equal probability of contacting any other individual in the population. In real life, this is of course not true: infectious individuals are more likely to come into contact with other infectious individuals if they go to the hospital and are less likely to come into contact with susceptible individuals if they quarantine, just to name a few examples.</span>
<span id="cb10-269"><a href="#cb10-269" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-270"><a href="#cb10-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-271"><a href="#cb10-271" aria-hidden="true" tabindex="-1"></a>The force of infection is calculated in many ways; we just provide one of many possible formulations and rationales here. Notice that the terms $c$ and $p$ in the formulation of $\lambda$ are independent of the number of individuals in each compartment throughout time. For this reason, they are grouped together into a singular term, known as the *transmission rate*.</span>
<span id="cb10-272"><a href="#cb10-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-273"><a href="#cb10-273" aria-hidden="true" tabindex="-1"></a>Putting this all together, we can rewrite the SIR model equations from <span class="co">[</span><span class="ot">Section @sec-the-classic-sir-epidemic-model</span><span class="co">]</span> as follows:</span>
<span id="cb10-274"><a href="#cb10-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-275"><a href="#cb10-275" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-276"><a href="#cb10-276" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-277"><a href="#cb10-277" aria-hidden="true" tabindex="-1"></a>\frac{dS}{dt} &amp;= -\beta \tilde{I} S <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-278"><a href="#cb10-278" aria-hidden="true" tabindex="-1"></a>\frac{dI}{dt} &amp;= \beta \tilde{I} S - \gamma I <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-279"><a href="#cb10-279" aria-hidden="true" tabindex="-1"></a>\frac{dR}{dt} &amp;= \gamma I</span>
<span id="cb10-280"><a href="#cb10-280" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-281"><a href="#cb10-281" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-282"><a href="#cb10-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-283"><a href="#cb10-283" aria-hidden="true" tabindex="-1"></a>And for proportions:</span>
<span id="cb10-284"><a href="#cb10-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-285"><a href="#cb10-285" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-286"><a href="#cb10-286" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-287"><a href="#cb10-287" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{S}}{dt} &amp;= -\beta \tilde{I} \tilde{S} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-288"><a href="#cb10-288" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{I}}{dt} &amp;= \beta \tilde{I} \tilde{S} - \gamma \tilde{I} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-289"><a href="#cb10-289" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{R}}{dt} &amp;= \gamma \tilde{I}</span>
<span id="cb10-290"><a href="#cb10-290" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-291"><a href="#cb10-291" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-292"><a href="#cb10-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-293"><a href="#cb10-293" aria-hidden="true" tabindex="-1"></a>Now comes the question of how we even find $\beta$? The table below presents two common methods for calculating $\beta$:</span>
<span id="cb10-294"><a href="#cb10-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-295"><a href="#cb10-295" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Method** | **What is it?** | **Best Used When . . .** <span class="pp">|</span></span>
<span id="cb10-296"><a href="#cb10-296" aria-hidden="true" tabindex="-1"></a><span class="pp">|------------------|----------------------------------|---------------------|</span></span>
<span id="cb10-297"><a href="#cb10-297" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Blackbox method <span class="pp">|</span> This is a data-driven method wherein $\beta$ is calculated empirically using epidemiological data. We can think of this as "fitting" a value of $\beta$ in our model to most accurately reflect the dynamics we observe in the real world. <span class="pp">|</span> There is an abundance of accurate real-world data available on the number of susceptible and infectious people over time. <span class="pp">|</span></span>
<span id="cb10-298"><a href="#cb10-298" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> First-Principles method <span class="pp">|</span> This method utilizes the formulation $\beta=cp$, which was obtained using first-principles, and separately calculates appropriate values for $c$ and $p$. <span class="pp">|</span> Real-world data is scarcer or there the data available lends itself better to calculating $c$ and $p$ separately rather than fitting an overall $\beta$. <span class="pp">|</span></span>
<span id="cb10-299"><a href="#cb10-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-300"><a href="#cb10-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-301"><a href="#cb10-301" aria-hidden="true" tabindex="-1"></a>For the purposes and scope of this introductory module, we will only provide examples and insights into the blackbox method for calculating the transmission rate $\beta$. This is because specifics of how $c$ and $p$ are calculated using the first-principles method depends heavily on model context and complexity, meaning there is no "one size fits all" way of finding $\beta$ using this method. </span>
<span id="cb10-302"><a href="#cb10-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-303"><a href="#cb10-303" aria-hidden="true" tabindex="-1"></a>Models will often formulate $c$ and $p$ as functions of their own depending on a number of external variables. An example of this can be found in this paper <span class="co">[</span><span class="ot">@deer_covid</span><span class="co">]</span>, where the transmission rate $\beta$ is formulated as the product of the proximity rate $\omega_{ij}$, or "frequency per day that host $i$ and recipient $j$ are within 1.5 meters (m) of each other" and $\sigma^{Aero}$, or the "probability of infection from aerosols." The paper further decomposes $\omega_{ij}$ and $\sigma^{Aero}$ into functions of their own depending on a variety of external variables. </span>
<span id="cb10-304"><a href="#cb10-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-305"><a href="#cb10-305" aria-hidden="true" tabindex="-1"></a>The specific formulations for the contact rate (or proximity rate) and infection probability utilized by this paper are unique to its context (the pathogen it is analyzing, the host population(s), etc.) and will vary widely from paper to paper. PROVIDE CITATIONS FOR MORE EXAMPLES OF DIFFERENT BETA CALCULATIONS HERE. </span>
<span id="cb10-306"><a href="#cb10-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-307"><a href="#cb10-307" aria-hidden="true" tabindex="-1"></a>However, there are standardized procedures to obtain $\beta$ using the blackbox approach, of which one common method known as *maximum likelihood estimation*, or MLE for short, is covered in <span class="co">[</span><span class="ot">Section @sec-formulating-transmission-rate</span><span class="co">]</span>. But before we can cover MLE, we must go over how to solve our SIR model equations first, which is the topic of <span class="co">[</span><span class="ot">Section @sec-solving-sir-equations</span><span class="co">]</span>.  </span>
<span id="cb10-308"><a href="#cb10-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-309"><a href="#cb10-309" aria-hidden="true" tabindex="-1"></a><span class="fu">### Formulating the Recovery Rate {#sec-formulating-the-recovery-rate}</span></span>
<span id="cb10-310"><a href="#cb10-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-311"><a href="#cb10-311" aria-hidden="true" tabindex="-1"></a>In the classic epidemic SIR model, there are only two parameters we must estimate: the transmission rate $\beta$ and the recovery rate $\gamma$. In <span class="co">[</span><span class="ot">Section @sec-formulating-foi</span><span class="co">]</span>, we introduce the blackbox and first-principles approach for estimating the value of $\beta$. </span>
<span id="cb10-312"><a href="#cb10-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-313"><a href="#cb10-313" aria-hidden="true" tabindex="-1"></a>The other parameter we must estimate---the recovery rate---is often estimated based on prior literature instead of real-world data like $\beta$. The reason for this is because $\beta$ is heavily dependent on many real-world factors like population density, demographics, and public-health measures, all of which vary greatly depending on the context of the model. The recovery rate, on the other hand, is often formulated as simply the reciprocal of the average duration of infection and thus is considered to be "more stable compared with $\beta$" <span class="co">[</span><span class="ot">@parameter_estimation</span><span class="co">]</span>. </span>
<span id="cb10-314"><a href="#cb10-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-315"><a href="#cb10-315" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb10-316"><a href="#cb10-316" aria-hidden="true" tabindex="-1"></a>When we say the recovery rate is 'more stable' than the transmission rate, we are simply saying that it varies less based on disease context and it stays relatively constant over the course of the epidemic.</span>
<span id="cb10-317"><a href="#cb10-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-318"><a href="#cb10-318" aria-hidden="true" tabindex="-1"></a>To illustrate just how differently disease contexts affect $\beta$ and $\gamma$, suppose the following two situations: we have a measles outbreak in a city that mandates sick individuals wear masks and quarantine themselves of a week and another measles outbreak in a rural town with very little control measures. We would expect the transmission rate for the city with high control measures to be much lower than the transmission rate for the rural town since infectious people in the city are interacting less with individuals (due to the quarantine mandate) and are less likely to spread the disease from those interactions (due to the mask mandates) compared to the rural town. However, we would expect the recovery rate in these two contexts to be approximately the same as sick people in the city will, on average, be infectious for the same amount of time as people in the rural town. </span>
<span id="cb10-319"><a href="#cb10-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-320"><a href="#cb10-320" aria-hidden="true" tabindex="-1"></a>We can think of the recovery rate as dependent on the biology of the disease itself whereas the transmission rate is dependent on context-specific factors. </span>
<span id="cb10-321"><a href="#cb10-321" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-322"><a href="#cb10-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-323"><a href="#cb10-323" aria-hidden="true" tabindex="-1"></a>To recap the methods of estimating our model parameters:</span>
<span id="cb10-324"><a href="#cb10-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-325"><a href="#cb10-325" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Recovery rate ($\gamma$)</span>
<span id="cb10-326"><a href="#cb10-326" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Literature Review: Estimated using past literature on the average duration of infection / infectious period $d$ and calculated as $\gamma=\frac{1}{d}$</span>
<span id="cb10-327"><a href="#cb10-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-328"><a href="#cb10-328" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Transmission rate ($\beta$)</span>
<span id="cb10-329"><a href="#cb10-329" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Blackbox Method: "Fitting" a suitable value of $\beta$ using real-world data from the scenario we are trying to model (i.e. finding which value of $\beta$ produces a model that describes what we see in the real-world most accurately)</span>
<span id="cb10-330"><a href="#cb10-330" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>First-Principles Method: Using a combination of real-world data and theory to produce estimates for the average contact rate $c$ and probability of infection $p$ separately and calculating the transmission rate as $\beta=cp$</span>
<span id="cb10-331"><a href="#cb10-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-332"><a href="#cb10-332" aria-hidden="true" tabindex="-1"></a>The table below provides some empirically-deduced average infectious periods for various common diseases <span class="co">[</span><span class="ot">@anderson_may_1982</span><span class="co">]</span>:</span>
<span id="cb10-333"><a href="#cb10-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-334"><a href="#cb10-334" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Infectious Disease**    | **Infectious Period (days)**  <span class="pp">|</span></span>
<span id="cb10-335"><a href="#cb10-335" aria-hidden="true" tabindex="-1"></a><span class="pp">|------------------------</span>   <span class="pp">|------------------------------</span> <span class="pp">|</span></span>
<span id="cb10-336"><a href="#cb10-336" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Measles                   <span class="pp">|</span> 6 to 7                        <span class="pp">|</span></span>
<span id="cb10-337"><a href="#cb10-337" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Whooping cough            <span class="pp">|</span> 21 to 23                      <span class="pp">|</span></span>
<span id="cb10-338"><a href="#cb10-338" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Poliomyelitis             <span class="pp">|</span> 14 to 20                      <span class="pp">|</span></span>
<span id="cb10-339"><a href="#cb10-339" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Chicken pox               <span class="pp">|</span> 10 to 11                      <span class="pp">|</span></span>
<span id="cb10-340"><a href="#cb10-340" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Rubella                   <span class="pp">|</span> 11 to 12                      <span class="pp">|</span></span>
<span id="cb10-341"><a href="#cb10-341" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Mumps                     <span class="pp">|</span> 4 to 8                        <span class="pp">|</span></span>
<span id="cb10-342"><a href="#cb10-342" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Diphtheria                <span class="pp">|</span> 14 to 21                      <span class="pp">|</span></span>
<span id="cb10-343"><a href="#cb10-343" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Scarlet fever             <span class="pp">|</span> 14 to 21                      <span class="pp">|</span></span>
<span id="cb10-344"><a href="#cb10-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-345"><a href="#cb10-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-346"><a href="#cb10-346" aria-hidden="true" tabindex="-1"></a><span class="fu">## Solving SIR Equations {#sec-solving-sir-equations}</span></span>
<span id="cb10-347"><a href="#cb10-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-348"><a href="#cb10-348" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb10-349"><a href="#cb10-349" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb10-350"><a href="#cb10-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-351"><a href="#cb10-351" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Solve basic SIR model equations using a combination of mathematical and computational techniques.</span>
<span id="cb10-352"><a href="#cb10-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-353"><a href="#cb10-353" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Identify the difference between common methods of solving SIR-type models, including Euler's method and using function in the <span class="in">`pracma`</span> package in R.</span>
<span id="cb10-354"><a href="#cb10-354" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-355"><a href="#cb10-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-356"><a href="#cb10-356" aria-hidden="true" tabindex="-1"></a>Two common methods of solving differential equations that are difficult to solve by hand (in an exact method, that is) is:</span>
<span id="cb10-357"><a href="#cb10-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-358"><a href="#cb10-358" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Euler's method</span>
<span id="cb10-359"><a href="#cb10-359" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The <span class="in">`pracma`</span> package in R</span>
<span id="cb10-360"><a href="#cb10-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-361"><a href="#cb10-361" aria-hidden="true" tabindex="-1"></a>We will go over each method in <span class="co">[</span><span class="ot">Sections @sec-euler-method</span><span class="co">]</span> and <span class="co">[</span><span class="ot">@sec-pracma</span><span class="co">]</span> and the differences between the two.</span>
<span id="cb10-362"><a href="#cb10-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-363"><a href="#cb10-363" aria-hidden="true" tabindex="-1"></a><span class="fu">### Euler's method {#sec-euler-method}</span></span>
<span id="cb10-364"><a href="#cb10-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-365"><a href="#cb10-365" aria-hidden="true" tabindex="-1"></a>Euler's method estimates the solution to a differential equation using a series of short, connected linear approximations at a discrete set of times. Although Euler's method is widely regarded to be a relatively inefficient method for solving otherwise "unsolvable" (at least in the elementary sense) ordinary differential equations, it is still valued for its simplicity and accessibility.</span>
<span id="cb10-366"><a href="#cb10-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-367"><a href="#cb10-367" aria-hidden="true" tabindex="-1"></a>Suppose we have approximate initial values for the variables of interest (which, in the case of the SIR model, is the number or proportion of susceptible, infectious, and recovered individuals at the beginning of our study period). We will denote the number of susceptible, infectious, and recovered individuals at starting time $t$ as $S(0)$, $I(0)$, and $R(0)$, respectively.</span>
<span id="cb10-368"><a href="#cb10-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-369"><a href="#cb10-369" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-370"><a href="#cb10-370" aria-hidden="true" tabindex="-1"></a>To keep it simple, we will only discuss the process of Euler's method as it is applied to the number of individuals in each compartment, but keep in mind this process can be applied in exactly the same way to proportions as well.</span>
<span id="cb10-371"><a href="#cb10-371" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-372"><a href="#cb10-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-373"><a href="#cb10-373" aria-hidden="true" tabindex="-1"></a>Our goal is to find an approximate solutions to $S(t)$, $I(t)$, and $R(t)$---the number of individuals in each compartment at time $t$---using $s(0)$, $i(0)$, and $r(0)$ and the rates of change given by the system of SIR equations formulated in <span class="co">[</span><span class="ot">Section @sec-the-classic-sir-epidemic-model</span><span class="co">]</span>. For clarity, $S(t)$, $I(t)$, and $R(t)$ represent the exact solutions to the SIR equations, and the approximation solutions given by Euler's method are represent as $s(t)$, $i(t)$, and $r(t)$.</span>
<span id="cb10-374"><a href="#cb10-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-375"><a href="#cb10-375" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-376"><a href="#cb10-376" aria-hidden="true" tabindex="-1"></a>These types of problems, one where we are given a set of intial values and corresponding differential equations, are known as initial-value problems (or IVPs).</span>
<span id="cb10-377"><a href="#cb10-377" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-378"><a href="#cb10-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-379"><a href="#cb10-379" aria-hidden="true" tabindex="-1"></a>Euler's method involves repeatedly finding tangent line approximations to $S(t)$, $I(t)$, and $R(t)$ at a discrete set of times (often called nodes):</span>
<span id="cb10-380"><a href="#cb10-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-381"><a href="#cb10-381" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$s_0,\dots,s_t,\dots,s_b$</span>
<span id="cb10-382"><a href="#cb10-382" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$i_0,\dots,i_t,\dots,i_b$</span>
<span id="cb10-383"><a href="#cb10-383" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$r_0,\dots,r_t,\dots,r_b$</span>
<span id="cb10-384"><a href="#cb10-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-385"><a href="#cb10-385" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-386"><a href="#cb10-386" aria-hidden="true" tabindex="-1"></a>$s_t$, $i_t$, and $r_t$ represent approximations to $S(t)$, $I(t)$, and $R(t)$ at a time $t$. Additionally, $s_b$, $i_b$, and $r_b$ just represent the approximation at the final time $b$ of the interval we wish to find an approximate solution to, or $<span class="co">[</span><span class="ot">0,b</span><span class="co">]</span>$ .</span>
<span id="cb10-387"><a href="#cb10-387" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-388"><a href="#cb10-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-389"><a href="#cb10-389" aria-hidden="true" tabindex="-1"></a>These approximations are found using the following recursive formulas:</span>
<span id="cb10-390"><a href="#cb10-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-391"><a href="#cb10-391" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-392"><a href="#cb10-392" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-393"><a href="#cb10-393" aria-hidden="true" tabindex="-1"></a>s_{t+1} &amp;= s_t - \Delta t \, \beta i_t s_t <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-394"><a href="#cb10-394" aria-hidden="true" tabindex="-1"></a>i_{t+1} &amp;= i_t + \Delta t \, (\beta i_t s_t - \gamma i_t) <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-395"><a href="#cb10-395" aria-hidden="true" tabindex="-1"></a>r_{t+1} &amp;= r_t + \Delta t \, \gamma i_t</span>
<span id="cb10-396"><a href="#cb10-396" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-397"><a href="#cb10-397" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-398"><a href="#cb10-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-399"><a href="#cb10-399" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb10-400"><a href="#cb10-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-401"><a href="#cb10-401" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$s_{t+1}$, $i_{t+1}$, and $r_{t+1}$ are the approximations for $S(t)$, $I(t)$, and $R(t)$ at the next node</span>
<span id="cb10-402"><a href="#cb10-402" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$s_{t}$, $i_{t}$, and $r_{t}$ are the approximations for $S(t)$, $I(t)$, and $R(t)$ at the previous node</span>
<span id="cb10-403"><a href="#cb10-403" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\Delta t$ is the step size (how far each node is spaced apart on the $t$-axis)</span>
<span id="cb10-404"><a href="#cb10-404" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\beta$ and $\gamma$ are the transmission and recovery rate, respectively</span>
<span id="cb10-405"><a href="#cb10-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-406"><a href="#cb10-406" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-407"><a href="#cb10-407" aria-hidden="true" tabindex="-1"></a>This formula is just an application of the generalized Euler's method for first-order differential equation $Y'(t)=f(t,Y(t))$, true solution $Y(t)$, and approximate solutions $y_0,\dots,y_t,\dots,y_b$, which are calculated at evenly spaced $t_n$ as:</span>
<span id="cb10-408"><a href="#cb10-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-409"><a href="#cb10-409" aria-hidden="true" tabindex="-1"></a>$y_{t+1}=y_t+ \Delta t f(t_n,Y(t_n)$</span>
<span id="cb10-410"><a href="#cb10-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-411"><a href="#cb10-411" aria-hidden="true" tabindex="-1"></a>Where again $\Delta t$ is how far each $t_n$ are apart.</span>
<span id="cb10-412"><a href="#cb10-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-413"><a href="#cb10-413" aria-hidden="true" tabindex="-1"></a>Specifically, the formulas provided above substitute the rate of change functions $\frac{dS}{dt}$, $\frac{dI}{dt}$, and $\frac{dR}{dt}$ in directly.</span>
<span id="cb10-414"><a href="#cb10-414" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-415"><a href="#cb10-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-416"><a href="#cb10-416" aria-hidden="true" tabindex="-1"></a>This process can be a little confusing to grasp at first, so let's do an example.</span>
<span id="cb10-417"><a href="#cb10-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-418"><a href="#cb10-418" aria-hidden="true" tabindex="-1"></a>Suppose the following SIR model equations with initial values $s(0)=99$, $i(0)=1$, $r(0)=0$, transmission rate $\beta=1.5$, and recovery rate $\gamma=0.5$:</span>
<span id="cb10-419"><a href="#cb10-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-420"><a href="#cb10-420" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-421"><a href="#cb10-421" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-422"><a href="#cb10-422" aria-hidden="true" tabindex="-1"></a>\frac{dS}{dt} &amp;= -1.5 \tilde{I} S <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-423"><a href="#cb10-423" aria-hidden="true" tabindex="-1"></a>\frac{dI}{dt} &amp;= 1.5 \tilde{I} S - 0.5 I <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-424"><a href="#cb10-424" aria-hidden="true" tabindex="-1"></a>\frac{dR}{dt} &amp;= 0.5 I</span>
<span id="cb10-425"><a href="#cb10-425" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-426"><a href="#cb10-426" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-427"><a href="#cb10-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-428"><a href="#cb10-428" aria-hidden="true" tabindex="-1"></a>The following table illustrates the calculation process until $t=5$ with a step size of $\Delta t=1$:</span>
<span id="cb10-429"><a href="#cb10-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-430"><a href="#cb10-430" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Time** | **Approximations** | **Calculation Process** <span class="pp">|</span></span>
<span id="cb10-431"><a href="#cb10-431" aria-hidden="true" tabindex="-1"></a><span class="pp">|-----------------|------------------------|-------------------------------|</span></span>
<span id="cb10-432"><a href="#cb10-432" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=0$ <span class="pp">|</span> $s\left(0\right)=99.0$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(0\right)=1.0$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(0\right)=0.0$ <span class="pp">|</span> — <span class="pp">|</span></span>
<span id="cb10-433"><a href="#cb10-433" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=1$ <span class="pp">|</span> $s\left(1\right)\approx 97.5$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(1\right)\approx 2.0$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(1\right)=0.5$ <span class="pp">|</span> $s\left(1\right)=99-\left(1\right)\left(1.5\right)\left(\frac{1}{100}\right)\left(99\right)$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(1\right)=1+\left(1\right)\left<span class="co">[</span><span class="ot">\left(1.5\right)\left(\frac{1}{100}\right)\left(99\right)-0.5\left(1\right)\right</span><span class="co">]</span>$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(1\right)=0+\left(1\right)\left(0.5\right)\left(1\right)$ <span class="pp">|</span></span>
<span id="cb10-434"><a href="#cb10-434" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=2$ <span class="pp">|</span> $s\left(2\right)\approx 94.6$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(2\right)\approx 3.9$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(2\right)\approx 2.0$ <span class="pp">|</span> $s\left(2\right)=97.5-\left(1\right)\left(1.5\right)\left(\frac{2.0}{100}\right)\left(97.5\right)$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(2\right)=2.0+\left(1\right)\left<span class="co">[</span><span class="ot">\left(1.5\right)\left(\frac{2.0}{100}\right)\left(97.5\right)-0.5\left(2.0\right)\right</span><span class="co">]</span>$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(2\right)=0.5+\left(1\right)\left(0.5\right)\left(2.0\right)$ <span class="pp">|</span></span>
<span id="cb10-435"><a href="#cb10-435" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=3$ <span class="pp">|</span> $s\left(3\right)\approx 89.1$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(3\right)\approx 7.5$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(3\right)\approx 3.4$ <span class="pp">|</span> $s\left(3\right)=94.6-\left(1\right)\left(1.5\right)\left(\frac{3.9}{100}\right)\left(94.6\right)$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(3\right)=3.9+\left(1\right)\left<span class="co">[</span><span class="ot">\left(1.5\right)\left(\frac{3.9}{100}\right)\left(94.6\right)-0.5\left(3.9\right)\right</span><span class="co">]</span>$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(3\right)=2.0+\left(1\right)\left(0.5\right)\left(3.9\right)$ <span class="pp">|</span></span>
<span id="cb10-436"><a href="#cb10-436" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=4$ <span class="pp">|</span> $s\left(4\right)\approx 79.1$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(4\right)\approx 13.7$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(4\right)\approx 7.2$ <span class="pp">|</span> $s\left(4\right)=89.1-\left(1\right)\left(1.5\right)\left(\frac{7.5}{100}\right)\left(89.1\right)$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(4\right)=7.5+\left(1\right)\left<span class="co">[</span><span class="ot">\left(1.5\right)\left(\frac{7.5}{100}\right)\left(89.1\right)-0.5\left(7.5\right)\right</span><span class="co">]</span>$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(4\right)=3.4+\left(1\right)\left(0.5\right)\left(7.5\right)$ <span class="pp">|</span></span>
<span id="cb10-437"><a href="#cb10-437" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=5$ <span class="pp">|</span> $s\left(5\right)\approx 62.8$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(5\right)\approx 23.1$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(5\right)\approx 14.0$ <span class="pp">|</span> $s\left(5\right)=79.1-\left(1\right)\left(1.5\right)\left(\frac{13.7}{100}\right)\left(79.1\right)$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(5\right)=13.7+\left(1\right)\left<span class="co">[</span><span class="ot">\left(1.5\right)\left(\frac{13.7}{100}\right)\left(79.1\right)-0.5\left(13.7\right)\right</span><span class="co">]</span>$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(5\right)=7.2+\left(1\right)\left(0.5\right)\left(13.7\right)$ <span class="pp">|</span></span>
<span id="cb10-438"><a href="#cb10-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-439"><a href="#cb10-439" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Note"}</span>
<span id="cb10-440"><a href="#cb10-440" aria-hidden="true" tabindex="-1"></a>The accuracy of the solution produced by Euler's method is a direct result of what we choose the step size to be. If the step size is larger, then the curvature of the true solution will be lost since we are repeatedly taking linear approximations, resulting in an approximate solution that deviates a lot from the true solution curve. On the other hand, as the step size gets smaller, the approximate solution provided by Euler's method converges to the true solution curve.</span>
<span id="cb10-441"><a href="#cb10-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-442"><a href="#cb10-442" aria-hidden="true" tabindex="-1"></a>See <span class="co">[</span><span class="ot">Section @sec-evaluating-and-comparing-both-methods</span><span class="co">]</span> for a simulation demonstrating what happens when you change the step size.</span>
<span id="cb10-443"><a href="#cb10-443" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-444"><a href="#cb10-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-445"><a href="#cb10-445" aria-hidden="true" tabindex="-1"></a>As you might notice, the calculations above are very tedious, which is why Euler's method is most often calculated using code rather than by hand. Read on to <span class="co">[</span><span class="ot">Section @sec-euler-code</span><span class="co">]</span> for a demonstration on how to code Euler's Method.</span>
<span id="cb10-446"><a href="#cb10-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-447"><a href="#cb10-447" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Euler's Method Code Demonstration {#sec-euler-code}</span></span>
<span id="cb10-448"><a href="#cb10-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-449"><a href="#cb10-449" aria-hidden="true" tabindex="-1"></a>This section contains a step by step walkthrough of how to code an Euler's Method algorithm in R. </span>
<span id="cb10-450"><a href="#cb10-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-451"><a href="#cb10-451" aria-hidden="true" tabindex="-1"></a>**Step 1: Define the biological parameters.**</span>
<span id="cb10-452"><a href="#cb10-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-453"><a href="#cb10-453" aria-hidden="true" tabindex="-1"></a>Every model starts with its parameters: the biological quantities that characterize the disease and host system. Here, we have two: how fast the disease spreads ($\beta$) and how fast individuals recover ($\gamma$).</span>
<span id="cb10-454"><a href="#cb10-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-457"><a href="#cb10-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-458"><a href="#cb10-458" aria-hidden="true" tabindex="-1"></a><span class="in"># Transmission rate: contacts × probability of transmission per unit time</span></span>
<span id="cb10-459"><a href="#cb10-459" aria-hidden="true" tabindex="-1"></a><span class="in">beta &lt;- 1.5</span></span>
<span id="cb10-460"><a href="#cb10-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-461"><a href="#cb10-461" aria-hidden="true" tabindex="-1"></a><span class="in"># Recovery rate: 1/gamma gives the average duration of infection</span></span>
<span id="cb10-462"><a href="#cb10-462" aria-hidden="true" tabindex="-1"></a><span class="in">gamma &lt;- 0.5</span></span>
<span id="cb10-463"><a href="#cb10-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-464"><a href="#cb10-464" aria-hidden="true" tabindex="-1"></a><span class="in"># With these values, the average infectious period is:</span></span>
<span id="cb10-465"><a href="#cb10-465" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Average infectious period:", 1/gamma, "time units")</span></span>
<span id="cb10-466"><a href="#cb10-466" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-467"><a href="#cb10-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-468"><a href="#cb10-468" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb10-469"><a href="#cb10-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-470"><a href="#cb10-470" aria-hidden="true" tabindex="-1"></a>**Step 2: Set the initial conditions.**</span>
<span id="cb10-471"><a href="#cb10-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-472"><a href="#cb10-472" aria-hidden="true" tabindex="-1"></a>Before the model can run, we need to specify where the system starts. In an epidemic model, this means the proportion of the population in each compartment at time zero.</span>
<span id="cb10-473"><a href="#cb10-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-476"><a href="#cb10-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-477"><a href="#cb10-477" aria-hidden="true" tabindex="-1"></a><span class="in"># Starting proportions — must sum to 1</span></span>
<span id="cb10-478"><a href="#cb10-478" aria-hidden="true" tabindex="-1"></a><span class="in">S0 &lt;- 0.99   # 99% susceptible: nearly everyone is susceptible at the start</span></span>
<span id="cb10-479"><a href="#cb10-479" aria-hidden="true" tabindex="-1"></a><span class="in">I0 &lt;- 0.01   # 1% infectious: a small "spark" of infection enters the population</span></span>
<span id="cb10-480"><a href="#cb10-480" aria-hidden="true" tabindex="-1"></a><span class="in">R0_start &lt;- 0.00   # 0% recovered: no prior immunity</span></span>
<span id="cb10-481"><a href="#cb10-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-482"><a href="#cb10-482" aria-hidden="true" tabindex="-1"></a><span class="in"># Verify they sum to 1 (a good sanity check to build into your code)</span></span>
<span id="cb10-483"><a href="#cb10-483" aria-hidden="true" tabindex="-1"></a><span class="in">cat("S0 + I0 + R0 =", S0 + I0 + R0_start, "\n")</span></span>
<span id="cb10-484"><a href="#cb10-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-485"><a href="#cb10-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-486"><a href="#cb10-486" aria-hidden="true" tabindex="-1"></a>This sanity check, confirming that proportions sum to 1 — is a simple example of a habit that will save you debugging time later. When you add more compartments (SEIR, endemic model), this check generalizes naturally.</span>
<span id="cb10-487"><a href="#cb10-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-488"><a href="#cb10-488" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb10-489"><a href="#cb10-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-490"><a href="#cb10-490" aria-hidden="true" tabindex="-1"></a>**Step 3: Set up the time grid.**</span>
<span id="cb10-491"><a href="#cb10-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-492"><a href="#cb10-492" aria-hidden="true" tabindex="-1"></a>Euler's method steps through time discretely. We need to decide how far apart those steps are ($\Delta t$, the step size) and how long to simulate.</span>
<span id="cb10-493"><a href="#cb10-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-496"><a href="#cb10-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-497"><a href="#cb10-497" aria-hidden="true" tabindex="-1"></a><span class="in">dt    &lt;- 0.1   # step size — try making this larger later to see what breaks</span></span>
<span id="cb10-498"><a href="#cb10-498" aria-hidden="true" tabindex="-1"></a><span class="in">t_end &lt;- 50    # total simulation time</span></span>
<span id="cb10-499"><a href="#cb10-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-500"><a href="#cb10-500" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a vector of all time points</span></span>
<span id="cb10-501"><a href="#cb10-501" aria-hidden="true" tabindex="-1"></a><span class="in">times   &lt;- seq(0, t_end, by = dt)</span></span>
<span id="cb10-502"><a href="#cb10-502" aria-hidden="true" tabindex="-1"></a><span class="in">n_steps &lt;- length(times)</span></span>
<span id="cb10-503"><a href="#cb10-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-504"><a href="#cb10-504" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Number of time steps:", n_steps, "\n")</span></span>
<span id="cb10-505"><a href="#cb10-505" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Time points run from", times[1], "to", times[n_steps], "\n")</span></span>
<span id="cb10-506"><a href="#cb10-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-507"><a href="#cb10-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-508"><a href="#cb10-508" aria-hidden="true" tabindex="-1"></a>The step size is a computational choice, not a biological one, but it affects accuracy. A smaller $\Delta t$ gives a more accurate approximation of the continuous solution, at the cost of more computation. We will explore this tradeoff shortly.</span>
<span id="cb10-509"><a href="#cb10-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-510"><a href="#cb10-510" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb10-511"><a href="#cb10-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-512"><a href="#cb10-512" aria-hidden="true" tabindex="-1"></a>**Step 4: Pre-allocate storage.**</span>
<span id="cb10-513"><a href="#cb10-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-514"><a href="#cb10-514" aria-hidden="true" tabindex="-1"></a>Before running the loop, we create empty vectors to hold the results at each time step. This is more efficient than growing a vector inside the loop.</span>
<span id="cb10-515"><a href="#cb10-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-518"><a href="#cb10-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-519"><a href="#cb10-519" aria-hidden="true" tabindex="-1"></a><span class="in"># Empty vectors: one slot per time step, filled with zeros for now</span></span>
<span id="cb10-520"><a href="#cb10-520" aria-hidden="true" tabindex="-1"></a><span class="in">S &lt;- numeric(n_steps)</span></span>
<span id="cb10-521"><a href="#cb10-521" aria-hidden="true" tabindex="-1"></a><span class="in">I &lt;- numeric(n_steps)</span></span>
<span id="cb10-522"><a href="#cb10-522" aria-hidden="true" tabindex="-1"></a><span class="in">R &lt;- numeric(n_steps)</span></span>
<span id="cb10-523"><a href="#cb10-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-524"><a href="#cb10-524" aria-hidden="true" tabindex="-1"></a><span class="in"># Fill in the starting values</span></span>
<span id="cb10-525"><a href="#cb10-525" aria-hidden="true" tabindex="-1"></a><span class="in">S[1] &lt;- S0</span></span>
<span id="cb10-526"><a href="#cb10-526" aria-hidden="true" tabindex="-1"></a><span class="in">I[1] &lt;- I0</span></span>
<span id="cb10-527"><a href="#cb10-527" aria-hidden="true" tabindex="-1"></a><span class="in">R[1] &lt;- R0_start</span></span>
<span id="cb10-528"><a href="#cb10-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-529"><a href="#cb10-529" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Storage ready. First values: S =", S[1], " I =", I[1], " R =", R[1], "\n")</span></span>
<span id="cb10-530"><a href="#cb10-530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-531"><a href="#cb10-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-532"><a href="#cb10-532" aria-hidden="true" tabindex="-1"></a>Think of these vectors as the model's memory: they store the entire trajectory of the epidemic, one row per time step.</span>
<span id="cb10-533"><a href="#cb10-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-534"><a href="#cb10-534" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb10-535"><a href="#cb10-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-536"><a href="#cb10-536" aria-hidden="true" tabindex="-1"></a>**Step 5: Run the Euler loop.**</span>
<span id="cb10-537"><a href="#cb10-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-538"><a href="#cb10-538" aria-hidden="true" tabindex="-1"></a>This is where the model actually runs. At each time step, we calculate the rates of change using the SIR equations and use them to update the compartment values. Each line in the loop maps directly to an equation.</span>
<span id="cb10-539"><a href="#cb10-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-542"><a href="#cb10-542" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-543"><a href="#cb10-543" aria-hidden="true" tabindex="-1"></a><span class="in">for (t in 1:(n_steps - 1)) {</span></span>
<span id="cb10-544"><a href="#cb10-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-545"><a href="#cb10-545" aria-hidden="true" tabindex="-1"></a><span class="in">  # Rate of change: these ARE the SIR equations, written as code</span></span>
<span id="cb10-546"><a href="#cb10-546" aria-hidden="true" tabindex="-1"></a><span class="in">  dS &lt;- -beta * I[t] * S[t]                    # new infections leaving S</span></span>
<span id="cb10-547"><a href="#cb10-547" aria-hidden="true" tabindex="-1"></a><span class="in">  dI &lt;-  beta * I[t] * S[t] - gamma * I[t]     # gain infections, lose recoveries</span></span>
<span id="cb10-548"><a href="#cb10-548" aria-hidden="true" tabindex="-1"></a><span class="in">  dR &lt;-  gamma * I[t]                          # recoveries entering R</span></span>
<span id="cb10-549"><a href="#cb10-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-550"><a href="#cb10-550" aria-hidden="true" tabindex="-1"></a><span class="in">  # Step forward: current value + (step size × rate of change)</span></span>
<span id="cb10-551"><a href="#cb10-551" aria-hidden="true" tabindex="-1"></a><span class="in">  S[t+1] &lt;- S[t] + dt * dS</span></span>
<span id="cb10-552"><a href="#cb10-552" aria-hidden="true" tabindex="-1"></a><span class="in">  I[t+1] &lt;- I[t] + dt * dI</span></span>
<span id="cb10-553"><a href="#cb10-553" aria-hidden="true" tabindex="-1"></a><span class="in">  R[t+1] &lt;- R[t] + dt * dR</span></span>
<span id="cb10-554"><a href="#cb10-554" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-555"><a href="#cb10-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-556"><a href="#cb10-556" aria-hidden="true" tabindex="-1"></a><span class="in"># Quick check: do the compartments still sum to 1 at the end?</span></span>
<span id="cb10-557"><a href="#cb10-557" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Final values: S =", round(S[n_steps], 4),</span></span>
<span id="cb10-558"><a href="#cb10-558" aria-hidden="true" tabindex="-1"></a><span class="in">    " I =", round(I[n_steps], 4),</span></span>
<span id="cb10-559"><a href="#cb10-559" aria-hidden="true" tabindex="-1"></a><span class="in">    " R =", round(R[n_steps], 4), "\n")</span></span>
<span id="cb10-560"><a href="#cb10-560" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Sum:", round(S[n_steps] + I[n_steps] + R[n_steps], 6), "\n")</span></span>
<span id="cb10-561"><a href="#cb10-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-562"><a href="#cb10-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-563"><a href="#cb10-563" aria-hidden="true" tabindex="-1"></a>The loop is doing exactly what the Euler update formulas say, mechanically, one step at a time. This is the computational equivalent of doing the hand calculations from the table shown earlier, just thousands of times faster.</span>
<span id="cb10-564"><a href="#cb10-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-565"><a href="#cb10-565" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb10-566"><a href="#cb10-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-567"><a href="#cb10-567" aria-hidden="true" tabindex="-1"></a>**Step 6: Visualize the results.**</span>
<span id="cb10-568"><a href="#cb10-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-569"><a href="#cb10-569" aria-hidden="true" tabindex="-1"></a>The vectors <span class="in">`S`</span>, <span class="in">`I`</span>, and <span class="in">`R`</span> now hold the full epidemic trajectory. We can plot them against time.</span>
<span id="cb10-570"><a href="#cb10-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-573"><a href="#cb10-573" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-574"><a href="#cb10-574" aria-hidden="true" tabindex="-1"></a><span class="in">plot(times, S, type = "l", col = "steelblue", lwd = 2,</span></span>
<span id="cb10-575"><a href="#cb10-575" aria-hidden="true" tabindex="-1"></a><span class="in">     ylim = c(0, 1), xlab = "Time", ylab = "Proportion",</span></span>
<span id="cb10-576"><a href="#cb10-576" aria-hidden="true" tabindex="-1"></a><span class="in">     main = paste0("SIR Epidemic (Euler)  |  β=", beta,</span></span>
<span id="cb10-577"><a href="#cb10-577" aria-hidden="true" tabindex="-1"></a><span class="in">                   "  γ=", gamma, "  R₀=", round(beta/gamma, 2)))</span></span>
<span id="cb10-578"><a href="#cb10-578" aria-hidden="true" tabindex="-1"></a><span class="in">lines(times, I, col = "firebrick", lwd = 2)</span></span>
<span id="cb10-579"><a href="#cb10-579" aria-hidden="true" tabindex="-1"></a><span class="in">lines(times, R, col = "seagreen",  lwd = 2)</span></span>
<span id="cb10-580"><a href="#cb10-580" aria-hidden="true" tabindex="-1"></a><span class="in">legend("right", legend = c("Susceptible", "Infectious", "Recovered"),</span></span>
<span id="cb10-581"><a href="#cb10-581" aria-hidden="true" tabindex="-1"></a><span class="in">       col = c("steelblue", "firebrick", "seagreen"), lwd = 2, bty = "n")</span></span>
<span id="cb10-582"><a href="#cb10-582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-583"><a href="#cb10-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-584"><a href="#cb10-584" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Try this"}</span>
<span id="cb10-585"><a href="#cb10-585" aria-hidden="true" tabindex="-1"></a>Go back to **Step 1** and try the following changes, re-running each step in order:</span>
<span id="cb10-586"><a href="#cb10-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-587"><a href="#cb10-587" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Change <span class="in">`gamma &lt;- 0.5`</span> to <span class="in">`gamma &lt;- 0.2`</span>. What does a slower recovery rate do to the epidemic peak?</span>
<span id="cb10-588"><a href="#cb10-588" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Change <span class="in">`beta &lt;- 1.5`</span> to <span class="in">`beta &lt;- 0.4`</span>. What happens when $\beta &lt; \gamma$? Can you explain why biologically?</span>
<span id="cb10-589"><a href="#cb10-589" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Go back to **Step 3** and change <span class="in">`dt &lt;- 0.1`</span> to <span class="in">`dt &lt;- 2.0`</span>. What happens to the curves? This is the cost of a large step size.</span>
<span id="cb10-590"><a href="#cb10-590" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-591"><a href="#cb10-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-592"><a href="#cb10-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-593"><a href="#cb10-593" aria-hidden="true" tabindex="-1"></a>**Section References**</span>
<span id="cb10-594"><a href="#cb10-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-595"><a href="#cb10-595" aria-hidden="true" tabindex="-1"></a>@ode_book</span>
<span id="cb10-596"><a href="#cb10-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-597"><a href="#cb10-597" aria-hidden="true" tabindex="-1"></a><span class="fu">### Solving SIR Equations in R Using `pracma` {#sec-pracma}</span></span>
<span id="cb10-598"><a href="#cb10-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-599"><a href="#cb10-599" aria-hidden="true" tabindex="-1"></a>The package <span class="in">`pracma`</span> in R, short for "Practical Numerical Math Functions," provides a large repertoire of functions used in numerical analysis, linear algebra, numerical optimization, and differential equations <span class="co">[</span><span class="ot">@pracma_cran</span><span class="co">]</span>. </span>
<span id="cb10-600"><a href="#cb10-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-601"><a href="#cb10-601" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-602"><a href="#cb10-602" aria-hidden="true" tabindex="-1"></a>The SIR-type models we are going to cover deal with systems of first-order ordinary differential equations.</span>
<span id="cb10-603"><a href="#cb10-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-604"><a href="#cb10-604" aria-hidden="true" tabindex="-1"></a>Breaking up each word in this description, we have:</span>
<span id="cb10-605"><a href="#cb10-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-606"><a href="#cb10-606" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"First-order": This just means we are only dealing with equations involving the first derivative and not subsequent derivatives (the second, third, fourth, etc. derivative)</span>
<span id="cb10-607"><a href="#cb10-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-608"><a href="#cb10-608" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Ordinary": The unknown function which we are trying to solve for depends only one independent variable.</span>
<span id="cb10-609"><a href="#cb10-609" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-610"><a href="#cb10-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-611"><a href="#cb10-611" aria-hidden="true" tabindex="-1"></a>Although <span class="in">`pracma`</span> contains many mathematical functions, we are primarily interested in <span class="in">`rk4sys`</span>, a function to solve systems of differential equations using an advanced method known as the *Classic Fourth-Order Runge-Kutta Method*. This method for solving differential equations is much more complex than Euler's method but outputs solutions to a much greater accuracy. In simple terms, the Fourth-Order Runge–Kutta method estimates the value of a solution at the next point by taking a weighted average of four slope calculations, each computed at different points within the step interval <span class="co">[</span><span class="ot">@runge_kutta_background</span><span class="co">]</span>. </span>
<span id="cb10-612"><a href="#cb10-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-613"><a href="#cb10-613" aria-hidden="true" tabindex="-1"></a>The following table summarizes the values <span class="in">`rk4sys`</span> takes in:</span>
<span id="cb10-614"><a href="#cb10-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-615"><a href="#cb10-615" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Parameter Name** | **What Does It Take In?** <span class="pp">|</span></span>
<span id="cb10-616"><a href="#cb10-616" aria-hidden="true" tabindex="-1"></a><span class="pp">|-------------|-----------------------------------------------------------|</span></span>
<span id="cb10-617"><a href="#cb10-617" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`f`</span> <span class="pp">|</span> A user-defined function that defines the system of differential equations to be solved. <span class="pp">|</span></span>
<span id="cb10-618"><a href="#cb10-618" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`a`</span> <span class="pp">|</span> A number specifying the starting point of the interval we want solutions for.  <span class="pp">|</span></span>
<span id="cb10-619"><a href="#cb10-619" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`b`</span> <span class="pp">|</span> A number specifying the endpoint of the interval we want solutions for. <span class="pp">|</span></span>
<span id="cb10-620"><a href="#cb10-620" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`y0`</span> <span class="pp">|</span> A vector specifying the initial values of the system. A system of $m$ differential equations must have a <span class="in">`y0`</span> of length $m$. <span class="pp">|</span></span>
<span id="cb10-621"><a href="#cb10-621" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`n`</span> <span class="pp">|</span> A number specifying the step size (i.e. the number of steps that should be taken from <span class="in">`a`</span> to <span class="in">`b`</span>. <span class="pp">|</span></span>
<span id="cb10-622"><a href="#cb10-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-623"><a href="#cb10-623" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`rk4sys`</span> returns a matrix. When that matrix is converted to a data frame using the function <span class="in">`as.data.frame`</span>, its first column provides the time points at which the SIR model was solved and subsequent columns are the solutions to the model's state variables at those times. The state variables for an SIR model are the number or proportion of individuals susceptible, infectious, and recovered at a given time.</span>
<span id="cb10-624"><a href="#cb10-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-625"><a href="#cb10-625" aria-hidden="true" tabindex="-1"></a>Before we can call <span class="in">`rk4sys`</span>, let's go over how to code the function to be passed into the parameter <span class="in">`f`</span>. The function below is specifying a classic SIR model on the proportion of individuals in each compartment (see <span class="co">[</span><span class="ot">Section @sec-the-classic-sir-epidemic-model</span><span class="co">]</span>).</span>
<span id="cb10-626"><a href="#cb10-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-627"><a href="#cb10-627" aria-hidden="true" tabindex="-1"></a>**Step 1: Code the model function.**</span>
<span id="cb10-628"><a href="#cb10-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-631"><a href="#cb10-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-632"><a href="#cb10-632" aria-hidden="true" tabindex="-1"></a><span class="in">ModelFunc &lt;- function(time,state){</span></span>
<span id="cb10-633"><a href="#cb10-633" aria-hidden="true" tabindex="-1"></a><span class="in">  # Extracting the state variables</span></span>
<span id="cb10-634"><a href="#cb10-634" aria-hidden="true" tabindex="-1"></a><span class="in">  # We have the state variables susceptible, infected, and recovered (S,I,R)</span></span>
<span id="cb10-635"><a href="#cb10-635" aria-hidden="true" tabindex="-1"></a><span class="in">  S &lt;- state[1]</span></span>
<span id="cb10-636"><a href="#cb10-636" aria-hidden="true" tabindex="-1"></a><span class="in">  I &lt;- state[2]</span></span>
<span id="cb10-637"><a href="#cb10-637" aria-hidden="true" tabindex="-1"></a><span class="in">  R &lt;- state[3]</span></span>
<span id="cb10-638"><a href="#cb10-638" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-639"><a href="#cb10-639" aria-hidden="true" tabindex="-1"></a><span class="in">  # Specifying the model parameters</span></span>
<span id="cb10-640"><a href="#cb10-640" aria-hidden="true" tabindex="-1"></a><span class="in">  # We only have two parameters - the transmission and recovery rate</span></span>
<span id="cb10-641"><a href="#cb10-641" aria-hidden="true" tabindex="-1"></a><span class="in">  # These parameters will change depending on the model</span></span>
<span id="cb10-642"><a href="#cb10-642" aria-hidden="true" tabindex="-1"></a><span class="in">  beta &lt;- 1.5</span></span>
<span id="cb10-643"><a href="#cb10-643" aria-hidden="true" tabindex="-1"></a><span class="in">  gamma &lt;- 0.5</span></span>
<span id="cb10-644"><a href="#cb10-644" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-645"><a href="#cb10-645" aria-hidden="true" tabindex="-1"></a><span class="in">  # Constructing our SIR model equations</span></span>
<span id="cb10-646"><a href="#cb10-646" aria-hidden="true" tabindex="-1"></a><span class="in">  dS &lt;- -(beta*I*S)</span></span>
<span id="cb10-647"><a href="#cb10-647" aria-hidden="true" tabindex="-1"></a><span class="in">  dI &lt;- (beta*I*S) - (gamma*I)</span></span>
<span id="cb10-648"><a href="#cb10-648" aria-hidden="true" tabindex="-1"></a><span class="in">  dR &lt;- (gamma*I)</span></span>
<span id="cb10-649"><a href="#cb10-649" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-650"><a href="#cb10-650" aria-hidden="true" tabindex="-1"></a><span class="in">  # Now we will return those model equations as a vector</span></span>
<span id="cb10-651"><a href="#cb10-651" aria-hidden="true" tabindex="-1"></a><span class="in">  return(c(dS,dI,dR))</span></span>
<span id="cb10-652"><a href="#cb10-652" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-653"><a href="#cb10-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-654"><a href="#cb10-654" aria-hidden="true" tabindex="-1"></a><span class="in"># Example call - Outputs the rates of change for S, I, and R given the inputs</span></span>
<span id="cb10-655"><a href="#cb10-655" aria-hidden="true" tabindex="-1"></a><span class="in">ModelFunc(1,c(S=0.99,I=0.01,R=0))</span></span>
<span id="cb10-656"><a href="#cb10-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-657"><a href="#cb10-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-658"><a href="#cb10-658" aria-hidden="true" tabindex="-1"></a>**Step 2: Specify the other parameters and call `rk4sys`.**</span>
<span id="cb10-659"><a href="#cb10-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-662"><a href="#cb10-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-663"><a href="#cb10-663" aria-hidden="true" tabindex="-1"></a><span class="in">library(pracma)</span></span>
<span id="cb10-664"><a href="#cb10-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-665"><a href="#cb10-665" aria-hidden="true" tabindex="-1"></a><span class="in"># Here we are specifying the start and ending points of the solution interval</span></span>
<span id="cb10-666"><a href="#cb10-666" aria-hidden="true" tabindex="-1"></a><span class="in">start &lt;- 0</span></span>
<span id="cb10-667"><a href="#cb10-667" aria-hidden="true" tabindex="-1"></a><span class="in">end &lt;- 20</span></span>
<span id="cb10-668"><a href="#cb10-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-669"><a href="#cb10-669" aria-hidden="true" tabindex="-1"></a><span class="in"># Here we are specifying the initial values to be passed into the parameter y</span></span>
<span id="cb10-670"><a href="#cb10-670" aria-hidden="true" tabindex="-1"></a><span class="in"># Make sure values line up with the state variables in the model function</span></span>
<span id="cb10-671"><a href="#cb10-671" aria-hidden="true" tabindex="-1"></a><span class="in">initial_vals &lt;- c(S=0.99,I=0.01,R=0)</span></span>
<span id="cb10-672"><a href="#cb10-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-673"><a href="#cb10-673" aria-hidden="true" tabindex="-1"></a><span class="in"># Here we are specifying how many steps to take from a to b</span></span>
<span id="cb10-674"><a href="#cb10-674" aria-hidden="true" tabindex="-1"></a><span class="in"># A common choice is to simply take b-a number of steps </span></span>
<span id="cb10-675"><a href="#cb10-675" aria-hidden="true" tabindex="-1"></a><span class="in"># The more steps we take, the more accurate our resulting solutions will be</span></span>
<span id="cb10-676"><a href="#cb10-676" aria-hidden="true" tabindex="-1"></a><span class="in">step_size &lt;- end-start</span></span>
<span id="cb10-677"><a href="#cb10-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-678"><a href="#cb10-678" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we can call the function rk4sys</span></span>
<span id="cb10-679"><a href="#cb10-679" aria-hidden="true" tabindex="-1"></a><span class="in"># We are wrapping the function ModelFunc in another function so we can pass </span></span>
<span id="cb10-680"><a href="#cb10-680" aria-hidden="true" tabindex="-1"></a><span class="in">output &lt;- rk4sys(f=ModelFunc,</span></span>
<span id="cb10-681"><a href="#cb10-681" aria-hidden="true" tabindex="-1"></a><span class="in">                 a=start,</span></span>
<span id="cb10-682"><a href="#cb10-682" aria-hidden="true" tabindex="-1"></a><span class="in">                 b=end,</span></span>
<span id="cb10-683"><a href="#cb10-683" aria-hidden="true" tabindex="-1"></a><span class="in">                 y0=initial_vals,</span></span>
<span id="cb10-684"><a href="#cb10-684" aria-hidden="true" tabindex="-1"></a><span class="in">                 n=step_size)</span></span>
<span id="cb10-685"><a href="#cb10-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-686"><a href="#cb10-686" aria-hidden="true" tabindex="-1"></a><span class="in"># Converting the output matrix to a data frame and printing it</span></span>
<span id="cb10-687"><a href="#cb10-687" aria-hidden="true" tabindex="-1"></a><span class="in">output &lt;- as.data.frame(output)</span></span>
<span id="cb10-688"><a href="#cb10-688" aria-hidden="true" tabindex="-1"></a><span class="in">print(output)</span></span>
<span id="cb10-689"><a href="#cb10-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-690"><a href="#cb10-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-691"><a href="#cb10-691" aria-hidden="true" tabindex="-1"></a>Now that we have this matrix of the solved SIR model equations are at specified times, we can plot it.</span>
<span id="cb10-692"><a href="#cb10-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-693"><a href="#cb10-693" aria-hidden="true" tabindex="-1"></a>**Step 3: Plot the results.**</span>
<span id="cb10-694"><a href="#cb10-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-697"><a href="#cb10-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-698"><a href="#cb10-698" aria-hidden="true" tabindex="-1"></a><span class="in">times &lt;- output$x</span></span>
<span id="cb10-699"><a href="#cb10-699" aria-hidden="true" tabindex="-1"></a><span class="in">S &lt;- output$y.S</span></span>
<span id="cb10-700"><a href="#cb10-700" aria-hidden="true" tabindex="-1"></a><span class="in">I &lt;- output$y.I</span></span>
<span id="cb10-701"><a href="#cb10-701" aria-hidden="true" tabindex="-1"></a><span class="in">R &lt;- output$y.R</span></span>
<span id="cb10-702"><a href="#cb10-702" aria-hidden="true" tabindex="-1"></a><span class="in">beta &lt;- 1.5</span></span>
<span id="cb10-703"><a href="#cb10-703" aria-hidden="true" tabindex="-1"></a><span class="in">gamma &lt;- 0.5</span></span>
<span id="cb10-704"><a href="#cb10-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-705"><a href="#cb10-705" aria-hidden="true" tabindex="-1"></a><span class="in">plot(times, S, type = "l", col = "steelblue", lwd = 2,</span></span>
<span id="cb10-706"><a href="#cb10-706" aria-hidden="true" tabindex="-1"></a><span class="in">     ylim = c(0, 1), xlab = "Time", ylab = "Proportion",</span></span>
<span id="cb10-707"><a href="#cb10-707" aria-hidden="true" tabindex="-1"></a><span class="in">     main = paste0("SIR Epidemic (Runge-Kutta)  |  β=", beta,</span></span>
<span id="cb10-708"><a href="#cb10-708" aria-hidden="true" tabindex="-1"></a><span class="in">                   "  γ=", gamma, "  R₀=", round(beta/gamma, 2)))</span></span>
<span id="cb10-709"><a href="#cb10-709" aria-hidden="true" tabindex="-1"></a><span class="in">lines(times, I, col = "firebrick", lwd = 2)</span></span>
<span id="cb10-710"><a href="#cb10-710" aria-hidden="true" tabindex="-1"></a><span class="in">lines(times, R, col = "seagreen",  lwd = 2)</span></span>
<span id="cb10-711"><a href="#cb10-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-712"><a href="#cb10-712" aria-hidden="true" tabindex="-1"></a><span class="in">legend("right", legend = c("Susceptible", "Infectious", "Recovered"),</span></span>
<span id="cb10-713"><a href="#cb10-713" aria-hidden="true" tabindex="-1"></a><span class="in">       col = c("steelblue", "firebrick", "seagreen"), lwd = 2, bty = "n")</span></span>
<span id="cb10-714"><a href="#cb10-714" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-715"><a href="#cb10-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-716"><a href="#cb10-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-717"><a href="#cb10-717" aria-hidden="true" tabindex="-1"></a><span class="fu">### Evaluating and Comparing Both Methods {#sec-evaluating-and-comparing-both-methods}</span></span>
<span id="cb10-718"><a href="#cb10-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-719"><a href="#cb10-719" aria-hidden="true" tabindex="-1"></a>The following table summarizes some potential benefits and drawbacks to using Euler's method or <span class="in">`rk4sys`</span> in <span class="in">`pracma`</span>:</span>
<span id="cb10-720"><a href="#cb10-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-721"><a href="#cb10-721" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Solving Method** | **Potential Benefits** | **Potential Drawbacks** <span class="pp">|</span></span>
<span id="cb10-722"><a href="#cb10-722" aria-hidden="true" tabindex="-1"></a><span class="pp">|--------------|-----------------------|------------------------------------|</span></span>
<span id="cb10-723"><a href="#cb10-723" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Euler's Method <span class="pp">|</span> <span class="sc">\-</span> Can be done by hand or implemented in code<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>- Simple to understand<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>- Full control over accuracy of model <span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>- No external packages required <span class="pp">|</span> <span class="sc">\-</span> Low accuracy unless an extremely small step size is used<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>- Computationally inefficient for small step sizes or complex models<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>- Can be tedious to calculate by hand <span class="pp">|</span></span>
<span id="cb10-724"><a href="#cb10-724" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> <span class="in">`rk4sys`</span> <span class="pp">|</span> <span class="sc">\-</span> Uses an advanced solving method (Fourth-Order Runge-Kutta) that has a high accuracy<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>- Handles large models with many system equations well<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>- Efficient for complex models <span class="pp">|</span> <span class="sc">\-</span> Less transparent approach; not much understanding of what is going on "under the hood"<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>- Requires learning new functions and syntax<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>- Depends on the external package <span class="in">`pracma`</span><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span> - Output accuracy depends greatly on step size<span class="pp">|</span></span>
<span id="cb10-725"><a href="#cb10-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-726"><a href="#cb10-726" aria-hidden="true" tabindex="-1"></a>The following simulation shows the difference between the solution curves produced by Euler's method and <span class="in">`rk4sys`</span> for different values of the model parameters and step size:</span>
<span id="cb10-727"><a href="#cb10-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-728"><a href="#cb10-728" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">iframe</span><span class="ot"> src</span><span class="op">=</span><span class="st">"http://127.0.0.1:4570"</span></span>
<span id="cb10-729"><a href="#cb10-729" aria-hidden="true" tabindex="-1"></a><span class="ot">        width</span><span class="op">=</span><span class="st">"100%"</span></span>
<span id="cb10-730"><a href="#cb10-730" aria-hidden="true" tabindex="-1"></a><span class="ot">        height</span><span class="op">=</span><span class="st">"700"</span></span>
<span id="cb10-731"><a href="#cb10-731" aria-hidden="true" tabindex="-1"></a><span class="ot">        style</span><span class="op">=</span><span class="st">"border:none;"</span><span class="dt">&gt;&lt;/</span><span class="kw">iframe</span><span class="dt">&gt;</span></span>
<span id="cb10-732"><a href="#cb10-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-733"><a href="#cb10-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-734"><a href="#cb10-734" aria-hidden="true" tabindex="-1"></a><span class="fu">## Finding the Transmission Rate Using MLE {#sec-formulating-transmission-rate}</span></span>
<span id="cb10-735"><a href="#cb10-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-736"><a href="#cb10-736" aria-hidden="true" tabindex="-1"></a>*Maximum likelihood estimation*, often shorthanded as MLE, is a statistical technique that estimates the value of an unknown parameter to be that which maximizes the probability of observing real-world data from the scenario of interest. Recalling from <span class="co">[</span><span class="ot">Section @sec-formulating-the-recovery-rate</span><span class="co">]</span>, the recovery rate is often found based on prior literature and held as a constant equal to the reciprocal of the average duration of infection. As such, for the epidemic SIR model, we generally only use MLE to estimate the value of the transmission rate $\beta$ <span class="co">[</span><span class="ot">@parameter_estimation</span><span class="co">]</span>. </span>
<span id="cb10-737"><a href="#cb10-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-738"><a href="#cb10-738" aria-hidden="true" tabindex="-1"></a>MLE works by maximizing the *likelihood function*. The likelihood function provides the *likelihood*, or the probability of a given piece of data $D_n$ having occurred under a particular hypothesis (or model) $H$, and is typically noted as $\mathcal{L}(H,D_i)$. In other words, the likelihood function treats the model (i.e. particular values of $\beta$) as an independent variable, or input, and outputs the probability of observing a particular piece of disease data collected. The likelihood function only provides the probability of observing a particular piece of data under different values of $\beta$, but we are generally interested in finding and maximizing the probability of observing entire sets of data not just individual observations. Assuming the entire data set is *independent* (i.e. one observation in the data set does not affect what the other observations in the data set are), we can accomplish this by multiplying the individual likelihood functions $\mathcal{L}(H,D_n)$ for every individual piece of data $D_1,D_2 \cdots , D_n$ in the data set $D$ to get the overall likelihood of the entire set of data $\mathcal{L}(H,D)$:</span>
<span id="cb10-739"><a href="#cb10-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-740"><a href="#cb10-740" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-741"><a href="#cb10-741" aria-hidden="true" tabindex="-1"></a>\mathcal{L}(H,D)=\mathcal{L}(H,D_1) \times \mathcal{L}(H,D_2) \times \cdots \times \mathcal{L}(H,D_n)</span>
<span id="cb10-742"><a href="#cb10-742" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-743"><a href="#cb10-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-744"><a href="#cb10-744" aria-hidden="true" tabindex="-1"></a>What this likelihood function looks like highly depends on the disease data we have available to us. Disease data often comes in two forms:</span>
<span id="cb10-745"><a href="#cb10-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-746"><a href="#cb10-746" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Prevalence Count Data: Data that reports the total number of infected individuals at a time $t$. </span>
<span id="cb10-747"><a href="#cb10-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-748"><a href="#cb10-748" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Incidence Data: Data that reports the number new infected individuals over a period of time from $t$ to $t+\Delta t$</span>
<span id="cb10-749"><a href="#cb10-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-750"><a href="#cb10-750" aria-hidden="true" tabindex="-1"></a>In this learning module, we will only cover the process for finding $\beta$ using MLE when we have prevalence count data, however. The MLE algorithm for prevalence count data follows these general steps:</span>
<span id="cb10-751"><a href="#cb10-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-752"><a href="#cb10-752" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Make an assumption about the distribution of the likelihood function. Oftentimes, this means assuming that every piece of observed data was randomly drawn from a Poisson distribution whose mean $\lambda$ is equal to the predicted value for the number of infectious individuals given by the SIR model at a time $t$. </span>
<span id="cb10-753"><a href="#cb10-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-754"><a href="#cb10-754" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb10-755"><a href="#cb10-755" aria-hidden="true" tabindex="-1"></a>In this context, the Poisson distribution describes the probability of having observed a particular count of infected individuals at a time $t$ when the the average number of infectious individuals $\lambda$ is known. </span>
<span id="cb10-756"><a href="#cb10-756" aria-hidden="true" tabindex="-1"></a>It's important to note that we are not saying the prediction from the SIR model is random but rather that each data point was drawn randomly from a distribution centered around the predicted value given by the SIR model, and that distribution is Poisson. We can imagine that for every time $t$ there is a separate Poisson distribution centered around the predicted prevalence count obtained from the SIR model from which the observed prevalence counts were drawn. </span>
<span id="cb10-757"><a href="#cb10-757" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-758"><a href="#cb10-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-759"><a href="#cb10-759" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Set a range of plausible values for the parameter of interest ($\beta$) and iterate through all of them in tiny increments.</span>
<span id="cb10-760"><a href="#cb10-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-761"><a href="#cb10-761" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>For each plausible value of $\beta$, iterate through every data point in the set and calculate its likelihood $\mathcal{L}(H,D_n)$. Multiply the likelihoods of all the data points together and store that value as $\mathcal{L}(H,D)$.</span>
<span id="cb10-762"><a href="#cb10-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-763"><a href="#cb10-763" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Repeat step 3 for every value of $\beta$ in the plausible range.</span>
<span id="cb10-764"><a href="#cb10-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-765"><a href="#cb10-765" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Now that we have a collection of likelihoods for different SIR models, given by different values of $\beta$, we should find the maximum among them and estimate the value of $\beta$ to be what provides that maximum likelihood (i.e. the maximum likelihood estimator). We can also graph the likelihoods to get a better idea of what pattern they follow and a visual representation of where the maximum occurs.</span>
<span id="cb10-766"><a href="#cb10-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-767"><a href="#cb10-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-768"><a href="#cb10-768" aria-hidden="true" tabindex="-1"></a>There are a few small optimizations we often make to the maximum likelihood algorithm, firstly: </span>
<span id="cb10-769"><a href="#cb10-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-770"><a href="#cb10-770" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We use *log-likelihoods* instead of raw likelihoods. </span>
<span id="cb10-771"><a href="#cb10-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-772"><a href="#cb10-772" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Why do we do this?: The individual likelihoods $\mathcal{L}(H,D_i)$ represent the probability of observing a piece of data under a particular model, they are small numbers between $0$ and $1$ (since probability is always lies in the interval $<span class="co">[</span><span class="ot">0,1</span><span class="co">]</span>$). The MLE algorithm requires multiplying many of these small likelihoods together, and after a certain point (if our data set is big enough and we are multiplying enough individual likelihoods together), the computer might not be precise enough to represent such small number and simply round out our overall likelihood $\mathcal{L}(H,D)$ to be $0$! We obviously want to avoid this, so we often opt to using *log-likelihoods* instead since logarithms convert very small numbers between $0$ and $1$ into numbers larger in magnitude but negative (thus avoiding potential rounding errors). Log-likelihoods are simply obtained by taking the logarithm of the likelihood function $\mathcal{L}(H,D)$. When we do this, we must modify the way we calculate $\mathcal{L}(H,D)$, since we would no longer be multiplying the individual likelihoods $\mathcal{L}(H,D_i)$ but rather adding them. Remembering back to our properties of logarithms, we have:</span>
<span id="cb10-773"><a href="#cb10-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-774"><a href="#cb10-774" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-775"><a href="#cb10-775" aria-hidden="true" tabindex="-1"></a>\log(a \times b) = \log(a) + \log(b)</span>
<span id="cb10-776"><a href="#cb10-776" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-777"><a href="#cb10-777" aria-hidden="true" tabindex="-1"></a>And from this we get:</span>
<span id="cb10-778"><a href="#cb10-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-779"><a href="#cb10-779" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-780"><a href="#cb10-780" aria-hidden="true" tabindex="-1"></a>\log<span class="co">[</span><span class="ot">\mathcal{L}(H,D)</span><span class="co">]</span>=\log<span class="co">[</span><span class="ot">\mathcal{L}(H,D_1) \times \cdots \times \mathcal{L}(H,D_n)</span><span class="co">]</span>=\log<span class="co">[</span><span class="ot">\mathcal{L}(H,D_1)</span><span class="co">]</span> + \cdots +  \log<span class="co">[</span><span class="ot">\mathcal{L}(H,D_n)</span><span class="co">]</span></span>
<span id="cb10-781"><a href="#cb10-781" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-782"><a href="#cb10-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-783"><a href="#cb10-783" aria-hidden="true" tabindex="-1"></a>Taking the logarithm of the likelihood function will not change the results of MLE, making our maximum likelihood estimator for $\beta$ the same whether we use log-likelihoods or raw likelihoods. </span>
<span id="cb10-784"><a href="#cb10-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-785"><a href="#cb10-785" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb10-786"><a href="#cb10-786" aria-hidden="true" tabindex="-1"></a>Why doesn't taking the logarithm of the likelihood function change the results of MLE?: The reason using log-likelihoods doesn't affect MLE is because the logarithm function is always increasing, so it doesn't actually change where the relative maxima of a function occur. If we have a function $f(x)$ with, say, relative maxima at $x=2,3,4$, then $\log<span class="co">[</span><span class="ot">f(x)</span><span class="co">]</span>$ would still have relative maxima at $x=2,3,4$. The process for MLE is dependent directly on finding where the relative maxima of the likelihood function occurs, so taking the logarithm doesn't affect its output.</span>
<span id="cb10-787"><a href="#cb10-787" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-788"><a href="#cb10-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-789"><a href="#cb10-789" aria-hidden="true" tabindex="-1"></a>Including this optimization, our final modified MLE algorithm goes like so:</span>
<span id="cb10-790"><a href="#cb10-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-791"><a href="#cb10-791" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Make an assumption about the distribution of the likelihood function. Oftentimes, this means assuming that every piece of observed data was randomly drawn from a Poisson distribution whose mean $\lambda$ is equal to the predicted value for the number of infectious individuals given by the SIR model at a time $t$. </span>
<span id="cb10-792"><a href="#cb10-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-793"><a href="#cb10-793" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Set a range of plausible values for the parameter of interest ($\beta$) and iterate through all of them in tiny increments.</span>
<span id="cb10-794"><a href="#cb10-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-795"><a href="#cb10-795" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>For each plausible value of $\beta$, iterate through every data point in the set and calculate its log-likelihood $\log<span class="co">[</span><span class="ot">\mathcal{L}(H,D_i)</span><span class="co">]</span>$. Add the log-likelihoods of all the data points together and store that value as $\log<span class="co">[</span><span class="ot">\mathcal{L}(H,D)</span><span class="co">]</span>$.</span>
<span id="cb10-796"><a href="#cb10-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-797"><a href="#cb10-797" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Repeat step 3 for every value of $\beta$ in the plausible range.</span>
<span id="cb10-798"><a href="#cb10-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-799"><a href="#cb10-799" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Now that we have a collection of likelihoods for different SIR models, given by different values of $\beta$, we should find the maximum among them and estimate the value of $\beta$ to be what provides that maximum likelihood (i.e. the maximum likelihood estimator). We can also graph the likelihoods to get a better idea of what pattern they follow and a visual representation of where the maximum occurs.</span>
<span id="cb10-800"><a href="#cb10-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-801"><a href="#cb10-801" aria-hidden="true" tabindex="-1"></a>This whole process can be really hard to conceptualize at first without concrete examples. We go over a few code examples of MLE coded from stratch and MLE using the <span class="in">`bbmle`</span> package in R in <span class="co">[</span><span class="ot">Sections @sec-coding-scratch</span><span class="co">]</span> and <span class="co">[</span><span class="ot">@sec-bbmle</span><span class="co">]</span>. </span>
<span id="cb10-802"><a href="#cb10-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-803"><a href="#cb10-803" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Coding An MLE Algorithm From Scratch {#sec-coding-scratch}</span></span>
<span id="cb10-804"><a href="#cb10-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-805"><a href="#cb10-805" aria-hidden="true" tabindex="-1"></a>Suppose we have the following SIR epidemic model and we wish to use MLE to estimate the value of $\beta$:</span>
<span id="cb10-806"><a href="#cb10-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-807"><a href="#cb10-807" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-808"><a href="#cb10-808" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-809"><a href="#cb10-809" aria-hidden="true" tabindex="-1"></a>\frac{dS}{dt} &amp;= -\beta \left(\frac{I}{N}\right) S <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-810"><a href="#cb10-810" aria-hidden="true" tabindex="-1"></a>\frac{dI}{dt} &amp;= \beta \left(\frac{I}{N}\right)  S - \gamma I <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-811"><a href="#cb10-811" aria-hidden="true" tabindex="-1"></a>\frac{dR}{dt} &amp;= \gamma I</span>
<span id="cb10-812"><a href="#cb10-812" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-813"><a href="#cb10-813" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-814"><a href="#cb10-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-815"><a href="#cb10-815" aria-hidden="true" tabindex="-1"></a>For this model, $t$ is in units of days, the total size of the population we are modelling is $N=1000$ people, and the initial number of susceptible, infected, and recovered individuals is $S=999$, $I=1$, and $R=0$, respectively. </span>
<span id="cb10-816"><a href="#cb10-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-817"><a href="#cb10-817" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb10-818"><a href="#cb10-818" aria-hidden="true" tabindex="-1"></a>These SIR equations are providing the number, not proportion, of individuals in each compartment. This is important because the prevalence count data we will be using to find $\beta$ is also a number, not a proportion. Additionally, our assumption mentioned in <span class="co">[</span><span class="ot">Section @sec-formulating-transmission-rate</span><span class="co">]</span> that the data follows a Poisson distribution is only valid if both our data and model are counts of people, not proportions, since the Poisson distribution is a discrete distribution only able to take on non-negative integer values.</span>
<span id="cb10-819"><a href="#cb10-819" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-820"><a href="#cb10-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-821"><a href="#cb10-821" aria-hidden="true" tabindex="-1"></a>Let's also assume that we know the recovery rate to be $\gamma=0.7$ people per day based on past literature. Substituting this into our SIR equations we have:</span>
<span id="cb10-822"><a href="#cb10-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-823"><a href="#cb10-823" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-824"><a href="#cb10-824" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-825"><a href="#cb10-825" aria-hidden="true" tabindex="-1"></a>\frac{dS}{dt} &amp;= -\beta \left(\frac{I}{N}\right)  S <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-826"><a href="#cb10-826" aria-hidden="true" tabindex="-1"></a>\frac{dI}{dt} &amp;= \beta \left(\frac{I}{N}\right)  S - 0.7 I <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-827"><a href="#cb10-827" aria-hidden="true" tabindex="-1"></a>\frac{dR}{dt} &amp;= 0.7 I</span>
<span id="cb10-828"><a href="#cb10-828" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-829"><a href="#cb10-829" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-830"><a href="#cb10-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-831"><a href="#cb10-831" aria-hidden="true" tabindex="-1"></a>Now that we have our basic model equations, let's code an algorithm to find the maximum likelihood estimator for $\beta$.</span>
<span id="cb10-832"><a href="#cb10-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-833"><a href="#cb10-833" aria-hidden="true" tabindex="-1"></a>**Step 1: Generate test prevalence data.**</span>
<span id="cb10-834"><a href="#cb10-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-837"><a href="#cb10-837" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-838"><a href="#cb10-838" aria-hidden="true" tabindex="-1"></a><span class="in">library(pracma)</span></span>
<span id="cb10-839"><a href="#cb10-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-840"><a href="#cb10-840" aria-hidden="true" tabindex="-1"></a><span class="in"># Ensures that the random processes run the same every time</span></span>
<span id="cb10-841"><a href="#cb10-841" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb10-842"><a href="#cb10-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-843"><a href="#cb10-843" aria-hidden="true" tabindex="-1"></a><span class="in"># Coding the SIR model function</span></span>
<span id="cb10-844"><a href="#cb10-844" aria-hidden="true" tabindex="-1"></a><span class="in">ModelFunc &lt;- function(time,state,parameters){</span></span>
<span id="cb10-845"><a href="#cb10-845" aria-hidden="true" tabindex="-1"></a><span class="in">  S &lt;- state[1]</span></span>
<span id="cb10-846"><a href="#cb10-846" aria-hidden="true" tabindex="-1"></a><span class="in">  I &lt;- state[2]</span></span>
<span id="cb10-847"><a href="#cb10-847" aria-hidden="true" tabindex="-1"></a><span class="in">  R &lt;- state[3]</span></span>
<span id="cb10-848"><a href="#cb10-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-849"><a href="#cb10-849" aria-hidden="true" tabindex="-1"></a><span class="in">  beta &lt;- parameters["beta"]</span></span>
<span id="cb10-850"><a href="#cb10-850" aria-hidden="true" tabindex="-1"></a><span class="in">  gamma &lt;- parameters["gamma"]</span></span>
<span id="cb10-851"><a href="#cb10-851" aria-hidden="true" tabindex="-1"></a><span class="in">  N &lt;- parameters["N"]</span></span>
<span id="cb10-852"><a href="#cb10-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-853"><a href="#cb10-853" aria-hidden="true" tabindex="-1"></a><span class="in">  dS &lt;- -(beta*I*S/N)</span></span>
<span id="cb10-854"><a href="#cb10-854" aria-hidden="true" tabindex="-1"></a><span class="in">  dI &lt;- (beta*I*S/N) - (gamma*I)</span></span>
<span id="cb10-855"><a href="#cb10-855" aria-hidden="true" tabindex="-1"></a><span class="in">  dR &lt;- (gamma*I)</span></span>
<span id="cb10-856"><a href="#cb10-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-857"><a href="#cb10-857" aria-hidden="true" tabindex="-1"></a><span class="in">  return(c(dS,dI,dR))</span></span>
<span id="cb10-858"><a href="#cb10-858" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-859"><a href="#cb10-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-860"><a href="#cb10-860" aria-hidden="true" tabindex="-1"></a><span class="in"># Parameters of the SIR model from which our data will be generated</span></span>
<span id="cb10-861"><a href="#cb10-861" aria-hidden="true" tabindex="-1"></a><span class="in">model_parameters &lt;- c(beta = 1.2, gamma = 0.7, N = 1000)</span></span>
<span id="cb10-862"><a href="#cb10-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-863"><a href="#cb10-863" aria-hidden="true" tabindex="-1"></a><span class="in"># Number of S,I,R at the beginning of the epidemic (initial state variables)</span></span>
<span id="cb10-864"><a href="#cb10-864" aria-hidden="true" tabindex="-1"></a><span class="in">initial_vals &lt;- c(S = 999, I = 1, R = 0)</span></span>
<span id="cb10-865"><a href="#cb10-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-866"><a href="#cb10-866" aria-hidden="true" tabindex="-1"></a><span class="in"># Specifying how many days to generate data for</span></span>
<span id="cb10-867"><a href="#cb10-867" aria-hidden="true" tabindex="-1"></a><span class="in">t_start &lt;- 0</span></span>
<span id="cb10-868"><a href="#cb10-868" aria-hidden="true" tabindex="-1"></a><span class="in">t_end &lt;- 35</span></span>
<span id="cb10-869"><a href="#cb10-869" aria-hidden="true" tabindex="-1"></a><span class="in">step_size &lt;- t_end - t_start</span></span>
<span id="cb10-870"><a href="#cb10-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-871"><a href="#cb10-871" aria-hidden="true" tabindex="-1"></a><span class="in"># Solving SIR equation at specified output times</span></span>
<span id="cb10-872"><a href="#cb10-872" aria-hidden="true" tabindex="-1"></a><span class="in">output &lt;- rk4sys(y0=initial_vals,</span></span>
<span id="cb10-873"><a href="#cb10-873" aria-hidden="true" tabindex="-1"></a><span class="in">                 a = t_start,</span></span>
<span id="cb10-874"><a href="#cb10-874" aria-hidden="true" tabindex="-1"></a><span class="in">                 b = t_end,</span></span>
<span id="cb10-875"><a href="#cb10-875" aria-hidden="true" tabindex="-1"></a><span class="in">                 f = function(t,y) ModelFunc(t,y,model_parameters),</span></span>
<span id="cb10-876"><a href="#cb10-876" aria-hidden="true" tabindex="-1"></a><span class="in">                 n = step_size)</span></span>
<span id="cb10-877"><a href="#cb10-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-878"><a href="#cb10-878" aria-hidden="true" tabindex="-1"></a><span class="in"># Extracting the true prevalence counts</span></span>
<span id="cb10-879"><a href="#cb10-879" aria-hidden="true" tabindex="-1"></a><span class="in">output_df &lt;- as.data.frame(output)</span></span>
<span id="cb10-880"><a href="#cb10-880" aria-hidden="true" tabindex="-1"></a><span class="in">I_true &lt;- output_df$y.I</span></span>
<span id="cb10-881"><a href="#cb10-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-882"><a href="#cb10-882" aria-hidden="true" tabindex="-1"></a><span class="in"># Adding noise to the true prevalence counts (to mimic random sampling)</span></span>
<span id="cb10-883"><a href="#cb10-883" aria-hidden="true" tabindex="-1"></a><span class="in">I_observed &lt;- rpois(length(I_true), lambda = I_true)</span></span>
<span id="cb10-884"><a href="#cb10-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-885"><a href="#cb10-885" aria-hidden="true" tabindex="-1"></a><span class="in"># Saving the true and pseudo-sampled prevalence counts as a data frame</span></span>
<span id="cb10-886"><a href="#cb10-886" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- data.frame(day = t_start:t_end,</span></span>
<span id="cb10-887"><a href="#cb10-887" aria-hidden="true" tabindex="-1"></a><span class="in">                   prevalence_count = I_observed)</span></span>
<span id="cb10-888"><a href="#cb10-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-889"><a href="#cb10-889" aria-hidden="true" tabindex="-1"></a><span class="in">print(data)</span></span>
<span id="cb10-890"><a href="#cb10-890" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-891"><a href="#cb10-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-892"><a href="#cb10-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-893"><a href="#cb10-893" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb10-894"><a href="#cb10-894" aria-hidden="true" tabindex="-1"></a>We can actually test how accurate our estimate for $\beta$ found using MLE is by seeing how close it is to the $\beta$ used to generate the data (i.e. the value of <span class="in">`beta`</span> in the named vector <span class="in">`model_parameters`</span> in the code above)!</span>
<span id="cb10-895"><a href="#cb10-895" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-896"><a href="#cb10-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-897"><a href="#cb10-897" aria-hidden="true" tabindex="-1"></a>Now that we have our data and a function for our SIR model called <span class="in">`ModelFunc`</span>, our next step is to is to code a function to solve our SIR model for any value of $\beta$ and output what it predicts the number of infected individuals to be at various times.</span>
<span id="cb10-898"><a href="#cb10-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-899"><a href="#cb10-899" aria-hidden="true" tabindex="-1"></a>**Step 2: Code a function to return predicted prevalences.**</span>
<span id="cb10-900"><a href="#cb10-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-903"><a href="#cb10-903" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-904"><a href="#cb10-904" aria-hidden="true" tabindex="-1"></a><span class="in"># Function Inputs: Model parameters and a vector of times</span></span>
<span id="cb10-905"><a href="#cb10-905" aria-hidden="true" tabindex="-1"></a><span class="in"># Function Outputs: Predicted prevalence counts at input times</span></span>
<span id="cb10-906"><a href="#cb10-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-907"><a href="#cb10-907" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- function(parameters,t){</span></span>
<span id="cb10-908"><a href="#cb10-908" aria-hidden="true" tabindex="-1"></a><span class="in">  initial_vals &lt;- c(S=999,I=1,R=0)</span></span>
<span id="cb10-909"><a href="#cb10-909" aria-hidden="true" tabindex="-1"></a><span class="in">  t_start &lt;- 0</span></span>
<span id="cb10-910"><a href="#cb10-910" aria-hidden="true" tabindex="-1"></a><span class="in">  t_end &lt;- max(t)</span></span>
<span id="cb10-911"><a href="#cb10-911" aria-hidden="true" tabindex="-1"></a><span class="in">  step_size &lt;- t_end - t_start</span></span>
<span id="cb10-912"><a href="#cb10-912" aria-hidden="true" tabindex="-1"></a><span class="in">  output &lt;- rk4sys(y0=initial_vals,</span></span>
<span id="cb10-913"><a href="#cb10-913" aria-hidden="true" tabindex="-1"></a><span class="in">                 a=t_start,</span></span>
<span id="cb10-914"><a href="#cb10-914" aria-hidden="true" tabindex="-1"></a><span class="in">                 b=t_end,</span></span>
<span id="cb10-915"><a href="#cb10-915" aria-hidden="true" tabindex="-1"></a><span class="in">                 f=function(t,y) ModelFunc(t,y,parameters),</span></span>
<span id="cb10-916"><a href="#cb10-916" aria-hidden="true" tabindex="-1"></a><span class="in">                 n=step_size)</span></span>
<span id="cb10-917"><a href="#cb10-917" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-918"><a href="#cb10-918" aria-hidden="true" tabindex="-1"></a><span class="in">  # Extracting only the predicted prevalences at the input times</span></span>
<span id="cb10-919"><a href="#cb10-919" aria-hidden="true" tabindex="-1"></a><span class="in">  output_df &lt;- as.data.frame(output)</span></span>
<span id="cb10-920"><a href="#cb10-920" aria-hidden="true" tabindex="-1"></a><span class="in">  prevalences &lt;- output_df$y.I[t]</span></span>
<span id="cb10-921"><a href="#cb10-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-922"><a href="#cb10-922" aria-hidden="true" tabindex="-1"></a><span class="in">  # Ensuring there are no NaNs or out of bounds numbers in the output</span></span>
<span id="cb10-923"><a href="#cb10-923" aria-hidden="true" tabindex="-1"></a><span class="in">  # NaNs are produced when a decimal becomes too small to represent</span></span>
<span id="cb10-924"><a href="#cb10-924" aria-hidden="true" tabindex="-1"></a><span class="in">  prevalences[is.nan(prevalences) | prevalences &lt; 0 ] &lt;- 0</span></span>
<span id="cb10-925"><a href="#cb10-925" aria-hidden="true" tabindex="-1"></a><span class="in">  return(prevalences)</span></span>
<span id="cb10-926"><a href="#cb10-926" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-927"><a href="#cb10-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-928"><a href="#cb10-928" aria-hidden="true" tabindex="-1"></a><span class="in"># Example calls</span></span>
<span id="cb10-929"><a href="#cb10-929" aria-hidden="true" tabindex="-1"></a><span class="in">pred(c(beta=1.2,gamma=0.7,N=1000),c(13,14,15))</span></span>
<span id="cb10-930"><a href="#cb10-930" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-931"><a href="#cb10-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-932"><a href="#cb10-932" aria-hidden="true" tabindex="-1"></a>Now that we have our function to output the predicted prevalence counts given by our SIR model, we need to code a function to calculate the log-likelihood of the entire data set given certain model parameters.</span>
<span id="cb10-933"><a href="#cb10-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-934"><a href="#cb10-934" aria-hidden="true" tabindex="-1"></a>**Step 3: Code a function to calculate log-likelihoods given different parameter values.**</span>
<span id="cb10-935"><a href="#cb10-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-938"><a href="#cb10-938" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-939"><a href="#cb10-939" aria-hidden="true" tabindex="-1"></a><span class="in"># Function Inputs: Named vector of model parameters and the data set</span></span>
<span id="cb10-940"><a href="#cb10-940" aria-hidden="true" tabindex="-1"></a><span class="in"># Function Outputs: Log-likelihood of entire data set</span></span>
<span id="cb10-941"><a href="#cb10-941" aria-hidden="true" tabindex="-1"></a><span class="in">log_likelihood &lt;- function(parameters,data){</span></span>
<span id="cb10-942"><a href="#cb10-942" aria-hidden="true" tabindex="-1"></a><span class="in">  times &lt;- data$day</span></span>
<span id="cb10-943"><a href="#cb10-943" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted &lt;- pred(parameters,times)</span></span>
<span id="cb10-944"><a href="#cb10-944" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-945"><a href="#cb10-945" aria-hidden="true" tabindex="-1"></a><span class="in">  # Note: The function dpois gives Poisson probabilities</span></span>
<span id="cb10-946"><a href="#cb10-946" aria-hidden="true" tabindex="-1"></a><span class="in">  sum(dpois(x=data$prevalence_count,lambda=predicted,log=TRUE))</span></span>
<span id="cb10-947"><a href="#cb10-947" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-948"><a href="#cb10-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-949"><a href="#cb10-949" aria-hidden="true" tabindex="-1"></a><span class="in"># Example call</span></span>
<span id="cb10-950"><a href="#cb10-950" aria-hidden="true" tabindex="-1"></a><span class="in">log_likelihood(c(beta=1.4,gamma=0.7,N=1000),data)</span></span>
<span id="cb10-951"><a href="#cb10-951" aria-hidden="true" tabindex="-1"></a><span class="in">log_likelihood(c(beta=2.3,gamma=0.7,N=1000),data)</span></span>
<span id="cb10-952"><a href="#cb10-952" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-953"><a href="#cb10-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-954"><a href="#cb10-954" aria-hidden="true" tabindex="-1"></a>Our final step is to code a driver function that iterates through plausible values of $\beta$, calculating the log-likelihood of the entire set of data for each, and outputs the maximum likelihood estimator for $\beta$ (i.e. the $\beta$ which produces the greatest log-likelihood).</span>
<span id="cb10-955"><a href="#cb10-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-956"><a href="#cb10-956" aria-hidden="true" tabindex="-1"></a>**Step 4: Code a function to return the maximum likelihood estimator.**</span>
<span id="cb10-959"><a href="#cb10-959" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-960"><a href="#cb10-960" aria-hidden="true" tabindex="-1"></a><span class="in"># Function Inputs: Upper limit on the value of beta and the data set</span></span>
<span id="cb10-961"><a href="#cb10-961" aria-hidden="true" tabindex="-1"></a><span class="in"># Function Ouputs: A plot of the log-likelihoods and the estimate for beta</span></span>
<span id="cb10-962"><a href="#cb10-962" aria-hidden="true" tabindex="-1"></a><span class="in">mle &lt;- function(plausible_beta,data){</span></span>
<span id="cb10-963"><a href="#cb10-963" aria-hidden="true" tabindex="-1"></a><span class="in">  range_beta &lt;- seq(1,plausible_beta,by=0.01)</span></span>
<span id="cb10-964"><a href="#cb10-964" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-965"><a href="#cb10-965" aria-hidden="true" tabindex="-1"></a><span class="in">  # Data frame of log-likelihoods for each beta</span></span>
<span id="cb10-966"><a href="#cb10-966" aria-hidden="true" tabindex="-1"></a><span class="in">  all_ll &lt;- data.frame()</span></span>
<span id="cb10-967"><a href="#cb10-967" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-968"><a href="#cb10-968" aria-hidden="true" tabindex="-1"></a><span class="in">  for (beta in range_beta){</span></span>
<span id="cb10-969"><a href="#cb10-969" aria-hidden="true" tabindex="-1"></a><span class="in">    params &lt;- c(beta=beta,gamma=0.7,N=1000)</span></span>
<span id="cb10-970"><a href="#cb10-970" aria-hidden="true" tabindex="-1"></a><span class="in">    new_ll &lt;- data.frame(beta=beta,ll=log_likelihood(params,data))</span></span>
<span id="cb10-971"><a href="#cb10-971" aria-hidden="true" tabindex="-1"></a><span class="in">    all_ll &lt;- rbind(all_ll,new_ll)</span></span>
<span id="cb10-972"><a href="#cb10-972" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb10-973"><a href="#cb10-973" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-974"><a href="#cb10-974" aria-hidden="true" tabindex="-1"></a><span class="in">  # Finding the beta that results in the greatest log-likelihood</span></span>
<span id="cb10-975"><a href="#cb10-975" aria-hidden="true" tabindex="-1"></a><span class="in">  beta_mle &lt;- all_ll$beta[which.max(all_ll$ll)]</span></span>
<span id="cb10-976"><a href="#cb10-976" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-977"><a href="#cb10-977" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-978"><a href="#cb10-978" aria-hidden="true" tabindex="-1"></a><span class="in">  # Plotting all the log-likelihoods against the betas</span></span>
<span id="cb10-979"><a href="#cb10-979" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(all_ll$beta,</span></span>
<span id="cb10-980"><a href="#cb10-980" aria-hidden="true" tabindex="-1"></a><span class="in">       all_ll$ll,</span></span>
<span id="cb10-981"><a href="#cb10-981" aria-hidden="true" tabindex="-1"></a><span class="in">       type="l",xlab="beta",</span></span>
<span id="cb10-982"><a href="#cb10-982" aria-hidden="true" tabindex="-1"></a><span class="in">       ylab="log-likelihood",</span></span>
<span id="cb10-983"><a href="#cb10-983" aria-hidden="true" tabindex="-1"></a><span class="in">       main="Log-likelihood vs Beta")</span></span>
<span id="cb10-984"><a href="#cb10-984" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-985"><a href="#cb10-985" aria-hidden="true" tabindex="-1"></a><span class="in">  # Plotting a separate line where the maximum likelihood estimate for beta is </span></span>
<span id="cb10-986"><a href="#cb10-986" aria-hidden="true" tabindex="-1"></a><span class="in">  beta_mle &lt;- all_ll$beta[which.max(all_ll$ll)]</span></span>
<span id="cb10-987"><a href="#cb10-987" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(v=beta_mle,lty=2)</span></span>
<span id="cb10-988"><a href="#cb10-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-989"><a href="#cb10-989" aria-hidden="true" tabindex="-1"></a><span class="in">  # Returning the estimate</span></span>
<span id="cb10-990"><a href="#cb10-990" aria-hidden="true" tabindex="-1"></a><span class="in">  return(beta_mle)</span></span>
<span id="cb10-991"><a href="#cb10-991" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-992"><a href="#cb10-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-993"><a href="#cb10-993" aria-hidden="true" tabindex="-1"></a><span class="in">mle(5,data)</span></span>
<span id="cb10-994"><a href="#cb10-994" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-995"><a href="#cb10-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-996"><a href="#cb10-996" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Try this"}</span>
<span id="cb10-997"><a href="#cb10-997" aria-hidden="true" tabindex="-1"></a>Go back to **Step 1** and try the following changes, re-running each step in order:</span>
<span id="cb10-998"><a href="#cb10-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-999"><a href="#cb10-999" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Change <span class="in">`model_parameters &lt;- c(beta = 1.2, gamma = 0.7, N = 1000)`</span> to <span class="in">`model_parameters &lt;- c(beta = 1.7, gamma = 0.7, N = 1000)`</span> and re-run the other steps. Does the maximum likelihood estimate for $\beta$ returned in **Step 4** reflect this change? What about for other values of <span class="in">`beta`</span>? </span>
<span id="cb10-1000"><a href="#cb10-1000" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1001"><a href="#cb10-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1002"><a href="#cb10-1002" aria-hidden="true" tabindex="-1"></a>This code might seem like a lot, but not to worry: there is a much easier way of doing MLE in R using the <span class="in">`bbmle`</span> package! Read on to <span class="co">[</span><span class="ot">Section @sec-bbmle</span><span class="co">]</span> to learn how we can utilize the function <span class="in">`mle2`</span> in the <span class="in">`bbmle`</span> package to simplify conducting MLE in R.</span>
<span id="cb10-1003"><a href="#cb10-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1004"><a href="#cb10-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1005"><a href="#cb10-1005" aria-hidden="true" tabindex="-1"></a>**SECTION REFERENCE**</span>
<span id="cb10-1006"><a href="#cb10-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1007"><a href="#cb10-1007" aria-hidden="true" tabindex="-1"></a>https://daphnia.ecology.uga.edu/drakelab/wp-content/uploads/2014/07/likelihood.pdf</span>
<span id="cb10-1008"><a href="#cb10-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1009"><a href="#cb10-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">#### MLE Using the bbmle Package in R {#sec-bbmle}</span></span>
<span id="cb10-1010"><a href="#cb10-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1011"><a href="#cb10-1011" aria-hidden="true" tabindex="-1"></a>Although knowing how to code an MLE algorithm by hand is useful to first grasp the concept, in practicality it is inefficient which is why we often opt to use packages such as <span class="in">`bbmle`</span> in R, which has the function <span class="in">`mle2`</span> that makes it much easier.</span>
<span id="cb10-1012"><a href="#cb10-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1013"><a href="#cb10-1013" aria-hidden="true" tabindex="-1"></a>Before we can use <span class="in">`bbmle`</span> we must generate our data. This is the same code used to generate data in <span class="co">[</span><span class="ot">Section @sec-coding-scratch</span><span class="co">]</span>. </span>
<span id="cb10-1014"><a href="#cb10-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1015"><a href="#cb10-1015" aria-hidden="true" tabindex="-1"></a>**Step 1: Generate test prevalence data.**</span>
<span id="cb10-1016"><a href="#cb10-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1019"><a href="#cb10-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-1020"><a href="#cb10-1020" aria-hidden="true" tabindex="-1"></a><span class="in">library(pracma)</span></span>
<span id="cb10-1021"><a href="#cb10-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1022"><a href="#cb10-1022" aria-hidden="true" tabindex="-1"></a><span class="in"># Ensures that the random processes run the same every time</span></span>
<span id="cb10-1023"><a href="#cb10-1023" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb10-1024"><a href="#cb10-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1025"><a href="#cb10-1025" aria-hidden="true" tabindex="-1"></a><span class="in"># SIR model function</span></span>
<span id="cb10-1026"><a href="#cb10-1026" aria-hidden="true" tabindex="-1"></a><span class="in">ModelFunc &lt;- function(time,state,parameters){</span></span>
<span id="cb10-1027"><a href="#cb10-1027" aria-hidden="true" tabindex="-1"></a><span class="in">  S &lt;- state[1]</span></span>
<span id="cb10-1028"><a href="#cb10-1028" aria-hidden="true" tabindex="-1"></a><span class="in">  I &lt;- state[2]</span></span>
<span id="cb10-1029"><a href="#cb10-1029" aria-hidden="true" tabindex="-1"></a><span class="in">  R &lt;- state[3]</span></span>
<span id="cb10-1030"><a href="#cb10-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1031"><a href="#cb10-1031" aria-hidden="true" tabindex="-1"></a><span class="in">  beta &lt;- parameters["beta"]</span></span>
<span id="cb10-1032"><a href="#cb10-1032" aria-hidden="true" tabindex="-1"></a><span class="in">  gamma &lt;- parameters["gamma"]</span></span>
<span id="cb10-1033"><a href="#cb10-1033" aria-hidden="true" tabindex="-1"></a><span class="in">  N &lt;- parameters["N"]</span></span>
<span id="cb10-1034"><a href="#cb10-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1035"><a href="#cb10-1035" aria-hidden="true" tabindex="-1"></a><span class="in">  dS &lt;- -(beta*I*S/N)</span></span>
<span id="cb10-1036"><a href="#cb10-1036" aria-hidden="true" tabindex="-1"></a><span class="in">  dI &lt;- (beta*I*S/N) - (gamma*I)</span></span>
<span id="cb10-1037"><a href="#cb10-1037" aria-hidden="true" tabindex="-1"></a><span class="in">  dR &lt;- (gamma*I)</span></span>
<span id="cb10-1038"><a href="#cb10-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1039"><a href="#cb10-1039" aria-hidden="true" tabindex="-1"></a><span class="in">  return(c(dS,dI,dR))</span></span>
<span id="cb10-1040"><a href="#cb10-1040" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-1041"><a href="#cb10-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1042"><a href="#cb10-1042" aria-hidden="true" tabindex="-1"></a><span class="in"># Parameters of the SIR model from which our data will be generated</span></span>
<span id="cb10-1043"><a href="#cb10-1043" aria-hidden="true" tabindex="-1"></a><span class="in">model_parameters &lt;- c(beta = 1.2, gamma = 0.7, N = 1000)</span></span>
<span id="cb10-1044"><a href="#cb10-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1045"><a href="#cb10-1045" aria-hidden="true" tabindex="-1"></a><span class="in"># Number of S,I,R at the beginning of the epidemic (initial state variables)</span></span>
<span id="cb10-1046"><a href="#cb10-1046" aria-hidden="true" tabindex="-1"></a><span class="in">initial_vals &lt;- c(S = 999, I = 1, R = 0)</span></span>
<span id="cb10-1047"><a href="#cb10-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1048"><a href="#cb10-1048" aria-hidden="true" tabindex="-1"></a><span class="in"># Specifying how many days to generate data for</span></span>
<span id="cb10-1049"><a href="#cb10-1049" aria-hidden="true" tabindex="-1"></a><span class="in">t_start &lt;- 0</span></span>
<span id="cb10-1050"><a href="#cb10-1050" aria-hidden="true" tabindex="-1"></a><span class="in">t_end &lt;- 35</span></span>
<span id="cb10-1051"><a href="#cb10-1051" aria-hidden="true" tabindex="-1"></a><span class="in">step_size &lt;- t_end - t_start</span></span>
<span id="cb10-1052"><a href="#cb10-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1053"><a href="#cb10-1053" aria-hidden="true" tabindex="-1"></a><span class="in"># Solving SIR equation at specified output times</span></span>
<span id="cb10-1054"><a href="#cb10-1054" aria-hidden="true" tabindex="-1"></a><span class="in">output &lt;- rk4sys(y0=initial_vals,</span></span>
<span id="cb10-1055"><a href="#cb10-1055" aria-hidden="true" tabindex="-1"></a><span class="in">                 a = t_start,</span></span>
<span id="cb10-1056"><a href="#cb10-1056" aria-hidden="true" tabindex="-1"></a><span class="in">                 b = t_end,</span></span>
<span id="cb10-1057"><a href="#cb10-1057" aria-hidden="true" tabindex="-1"></a><span class="in">                 f = function(t,y) ModelFunc(t,y,model_parameters),</span></span>
<span id="cb10-1058"><a href="#cb10-1058" aria-hidden="true" tabindex="-1"></a><span class="in">                 n = step_size)</span></span>
<span id="cb10-1059"><a href="#cb10-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1060"><a href="#cb10-1060" aria-hidden="true" tabindex="-1"></a><span class="in"># Extracting the true prevalence counts</span></span>
<span id="cb10-1061"><a href="#cb10-1061" aria-hidden="true" tabindex="-1"></a><span class="in">output_df &lt;- as.data.frame(output)</span></span>
<span id="cb10-1062"><a href="#cb10-1062" aria-hidden="true" tabindex="-1"></a><span class="in">I_true &lt;- output_df$y.I</span></span>
<span id="cb10-1063"><a href="#cb10-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1064"><a href="#cb10-1064" aria-hidden="true" tabindex="-1"></a><span class="in"># Adding noise to the true prevalence counts (to mimic random sampling)</span></span>
<span id="cb10-1065"><a href="#cb10-1065" aria-hidden="true" tabindex="-1"></a><span class="in">I_observed &lt;- rpois(length(I_true), lambda = I_true)</span></span>
<span id="cb10-1066"><a href="#cb10-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1067"><a href="#cb10-1067" aria-hidden="true" tabindex="-1"></a><span class="in"># Saving the true and pseudo-sampled prevalence counts as a data frame</span></span>
<span id="cb10-1068"><a href="#cb10-1068" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- data.frame(day = t_start:t_end,</span></span>
<span id="cb10-1069"><a href="#cb10-1069" aria-hidden="true" tabindex="-1"></a><span class="in">                   prevalence_count = I_observed)</span></span>
<span id="cb10-1070"><a href="#cb10-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1071"><a href="#cb10-1071" aria-hidden="true" tabindex="-1"></a><span class="in">print(data)</span></span>
<span id="cb10-1072"><a href="#cb10-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-1073"><a href="#cb10-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1074"><a href="#cb10-1074" aria-hidden="true" tabindex="-1"></a>Now that we have our data, let's go over the basics <span class="in">`mle2`</span>. <span class="in">`mle2`</span> has many arguments, which can be read up on in the (R documentation for  the <span class="in">`mle2`</span> function)<span class="co">[</span><span class="ot">@docs_bbmle_mle2</span><span class="co">]</span>, however there are only two required parameters:</span>
<span id="cb10-1075"><a href="#cb10-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1076"><a href="#cb10-1076" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`minuslogl`</span>: A function or formula to calculate the *negative* log-likelihood given a value for our parameter of interest ($\beta$)</span>
<span id="cb10-1077"><a href="#cb10-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1078"><a href="#cb10-1078" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`start`</span>: An initial guess for the value of the parameter of interest ($\beta$)</span>
<span id="cb10-1079"><a href="#cb10-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1080"><a href="#cb10-1080" aria-hidden="true" tabindex="-1"></a>We will also make use of two other parameters to ensure our code runs smoothly:</span>
<span id="cb10-1081"><a href="#cb10-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1082"><a href="#cb10-1082" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`method`</span>: A string indicating what MLE algorithm method should be used. A summary of each method and how they change the MLE algorithm can be read up in the <span class="co">[</span><span class="ot">R Documentation for the `optim` function @docs_stats_optim</span><span class="co">]</span>. We will only make use of the method <span class="in">`"L-BFGS-B"`</span>, or the *box constraint* method. This method allows for us to set a lower / upper bound on our parameter of interest $\beta$. This is useful since we know $\beta&gt;=0$, so we can set our lower bound to be a very small number such as $0.01$ to ensure that no <span class="in">`NaN`</span>s are produced when we call <span class="in">`mle2`</span>. Likewise, we can set an optional upper bound on $\beta$ so we can avoid unnecessary computations if we reasonably know it to be below a certain value.</span>
<span id="cb10-1083"><a href="#cb10-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1084"><a href="#cb10-1084" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`lower`</span> / <span class="in">`upper`</span>: These parameters are specified when using the <span class="in">`"L-BFGS-B"`</span> method. These take a named vector including the lower and upper bounds of the parameter(s) of interest. Note that <span class="in">`lower`</span> is a required parameter when using the <span class="in">`"L-BFGS-B"`</span> method but <span class="in">`upper`</span> is an optional parameter. </span>
<span id="cb10-1085"><a href="#cb10-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1086"><a href="#cb10-1086" aria-hidden="true" tabindex="-1"></a>**Step 2: Call `mle2` and return maximum likelihood estimate.**</span>
<span id="cb10-1087"><a href="#cb10-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1090"><a href="#cb10-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-1091"><a href="#cb10-1091" aria-hidden="true" tabindex="-1"></a><span class="in">library(bbmle)</span></span>
<span id="cb10-1092"><a href="#cb10-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1093"><a href="#cb10-1093" aria-hidden="true" tabindex="-1"></a><span class="in"># Function Inputs: A named vector of model Parameters and a time t</span></span>
<span id="cb10-1094"><a href="#cb10-1094" aria-hidden="true" tabindex="-1"></a><span class="in"># Function Outputs: The predicted prevalence count at time t</span></span>
<span id="cb10-1095"><a href="#cb10-1095" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- function(parameters,t){</span></span>
<span id="cb10-1096"><a href="#cb10-1096" aria-hidden="true" tabindex="-1"></a><span class="in">  initial_vals &lt;- c(S=999,I=1,R=0)</span></span>
<span id="cb10-1097"><a href="#cb10-1097" aria-hidden="true" tabindex="-1"></a><span class="in">  t_start &lt;- 0</span></span>
<span id="cb10-1098"><a href="#cb10-1098" aria-hidden="true" tabindex="-1"></a><span class="in">  t_end &lt;- max(t)</span></span>
<span id="cb10-1099"><a href="#cb10-1099" aria-hidden="true" tabindex="-1"></a><span class="in">  step_size &lt;- t_end - t_start</span></span>
<span id="cb10-1100"><a href="#cb10-1100" aria-hidden="true" tabindex="-1"></a><span class="in">  output &lt;- rk4sys(y0=initial_vals,</span></span>
<span id="cb10-1101"><a href="#cb10-1101" aria-hidden="true" tabindex="-1"></a><span class="in">                 a=t_start,</span></span>
<span id="cb10-1102"><a href="#cb10-1102" aria-hidden="true" tabindex="-1"></a><span class="in">                 b=t_end,</span></span>
<span id="cb10-1103"><a href="#cb10-1103" aria-hidden="true" tabindex="-1"></a><span class="in">                 f=function(t,y) ModelFunc(t,y,parameters),</span></span>
<span id="cb10-1104"><a href="#cb10-1104" aria-hidden="true" tabindex="-1"></a><span class="in">                 n=step_size)</span></span>
<span id="cb10-1105"><a href="#cb10-1105" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-1106"><a href="#cb10-1106" aria-hidden="true" tabindex="-1"></a><span class="in">  # Extracting predicted prevalences</span></span>
<span id="cb10-1107"><a href="#cb10-1107" aria-hidden="true" tabindex="-1"></a><span class="in">  output_df &lt;- as.data.frame(output)</span></span>
<span id="cb10-1108"><a href="#cb10-1108" aria-hidden="true" tabindex="-1"></a><span class="in">  prevalences &lt;- output_df$y.I[t]</span></span>
<span id="cb10-1109"><a href="#cb10-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1110"><a href="#cb10-1110" aria-hidden="true" tabindex="-1"></a><span class="in">  # Ensuring there are no NaNs or out of bounds numbers in the output</span></span>
<span id="cb10-1111"><a href="#cb10-1111" aria-hidden="true" tabindex="-1"></a><span class="in">  prevalences[is.nan(prevalences) | prevalences &lt; 0 ] &lt;- 0</span></span>
<span id="cb10-1112"><a href="#cb10-1112" aria-hidden="true" tabindex="-1"></a><span class="in">  return(prevalences)</span></span>
<span id="cb10-1113"><a href="#cb10-1113" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-1114"><a href="#cb10-1114" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-1115"><a href="#cb10-1115" aria-hidden="true" tabindex="-1"></a><span class="in"># Function Inputs: A named list containing a value for beta</span></span>
<span id="cb10-1116"><a href="#cb10-1116" aria-hidden="true" tabindex="-1"></a><span class="in"># Function Ouputs: The log-likelihood of the data given the input beta</span></span>
<span id="cb10-1117"><a href="#cb10-1117" aria-hidden="true" tabindex="-1"></a><span class="in">poisson_ll &lt;- function(b){</span></span>
<span id="cb10-1118"><a href="#cb10-1118" aria-hidden="true" tabindex="-1"></a><span class="in">  times &lt;- data$day</span></span>
<span id="cb10-1119"><a href="#cb10-1119" aria-hidden="true" tabindex="-1"></a><span class="in">  parameters &lt;- c(beta=b,gamma=0.7,N=1000)</span></span>
<span id="cb10-1120"><a href="#cb10-1120" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted &lt;- pred(parameters,times)</span></span>
<span id="cb10-1121"><a href="#cb10-1121" aria-hidden="true" tabindex="-1"></a><span class="in">  -sum(dpois(x=data$prevalence_count,lambda=predicted,log=TRUE))</span></span>
<span id="cb10-1122"><a href="#cb10-1122" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-1123"><a href="#cb10-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1124"><a href="#cb10-1124" aria-hidden="true" tabindex="-1"></a><span class="in"># Our initial guess for what beta is</span></span>
<span id="cb10-1125"><a href="#cb10-1125" aria-hidden="true" tabindex="-1"></a><span class="in"># Try making the initial guess one that is plausibly close to the true parameter</span></span>
<span id="cb10-1126"><a href="#cb10-1126" aria-hidden="true" tabindex="-1"></a><span class="in"># If our guess is too far off then mle2 might return some errors</span></span>
<span id="cb10-1127"><a href="#cb10-1127" aria-hidden="true" tabindex="-1"></a><span class="in">start &lt;- list(b=2)</span></span>
<span id="cb10-1128"><a href="#cb10-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1129"><a href="#cb10-1129" aria-hidden="true" tabindex="-1"></a><span class="in"># Using the L-BFGS-B algorithm / method for MLE </span></span>
<span id="cb10-1130"><a href="#cb10-1130" aria-hidden="true" tabindex="-1"></a><span class="in"># Setting the lower bound to be small but positive since beta is non-negative</span></span>
<span id="cb10-1131"><a href="#cb10-1131" aria-hidden="true" tabindex="-1"></a><span class="in">result &lt;- mle2(minuslogl=poisson_ll,</span></span>
<span id="cb10-1132"><a href="#cb10-1132" aria-hidden="true" tabindex="-1"></a><span class="in">                         start=start,</span></span>
<span id="cb10-1133"><a href="#cb10-1133" aria-hidden="true" tabindex="-1"></a><span class="in">                         method="L-BFGS-B",</span></span>
<span id="cb10-1134"><a href="#cb10-1134" aria-hidden="true" tabindex="-1"></a><span class="in">                         lower=c(b=0.01))</span></span>
<span id="cb10-1135"><a href="#cb10-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1136"><a href="#cb10-1136" aria-hidden="true" tabindex="-1"></a><span class="in"># Printing the result</span></span>
<span id="cb10-1137"><a href="#cb10-1137" aria-hidden="true" tabindex="-1"></a><span class="in">result</span></span>
<span id="cb10-1138"><a href="#cb10-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1139"><a href="#cb10-1139" aria-hidden="true" tabindex="-1"></a><span class="in"># Extracting just the maximum likelihood estimate for beta</span></span>
<span id="cb10-1140"><a href="#cb10-1140" aria-hidden="true" tabindex="-1"></a><span class="in">coef(result)</span></span>
<span id="cb10-1141"><a href="#cb10-1141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-1142"><a href="#cb10-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1143"><a href="#cb10-1143" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb10-1144"><a href="#cb10-1144" aria-hidden="true" tabindex="-1"></a>You'll notice that the estimate we get for $\beta$ using <span class="in">`mle2`</span> is approximately equal to the one we obtain from our MLE algorithm coded by scratch (as we would expect) except that it is accurate to a far greater decimal place. This is because our MLE algorithm coded by hand is only incrementing through values of $\beta$ in steps of size $0.01$ for computational efficiency. The function <span class="in">`mle2`</span> on the other hand employs much more sophisticated techniques to iterate through values of $\beta$ and calculating their  log-likelihood, making the estimate it returns much more precise.</span>
<span id="cb10-1145"><a href="#cb10-1145" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1146"><a href="#cb10-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1147"><a href="#cb10-1147" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reproduction Numbers {#sec-reproduction-numbers}</span></span>
<span id="cb10-1148"><a href="#cb10-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1149"><a href="#cb10-1149" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb10-1150"><a href="#cb10-1150" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb10-1151"><a href="#cb10-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1152"><a href="#cb10-1152" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define what the basic and effective reproduction number is and recall primary differences between the two.</span>
<span id="cb10-1153"><a href="#cb10-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1154"><a href="#cb10-1154" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpret the basic and effective reproduction number in context.</span>
<span id="cb10-1155"><a href="#cb10-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1156"><a href="#cb10-1156" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Recall the formulas for the basic and effective reproduction numbers.</span>
<span id="cb10-1157"><a href="#cb10-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1158"><a href="#cb10-1158" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain what the "threshold phenomenon" is.</span>
<span id="cb10-1159"><a href="#cb10-1159" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1160"><a href="#cb10-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1161"><a href="#cb10-1161" aria-hidden="true" tabindex="-1"></a>The reproductive number is defined as "the average number of secondary infectious cases caused by one infectious individual (before they recover or die or are otherwise not able to further transmit)" <span class="co">[</span><span class="ot">@Handel2021_IDEMA_ch5</span><span class="co">]</span>.</span>
<span id="cb10-1162"><a href="#cb10-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1163"><a href="#cb10-1163" aria-hidden="true" tabindex="-1"></a>The table below summarizes the two types of reproduction numbers we will focus on:</span>
<span id="cb10-1164"><a href="#cb10-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1165"><a href="#cb10-1165" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Name** | **Symbol** | **Interpretation** <span class="pp">|</span></span>
<span id="cb10-1166"><a href="#cb10-1166" aria-hidden="true" tabindex="-1"></a><span class="pp">|-------------|-------------|-----------------------------------------------|</span></span>
<span id="cb10-1167"><a href="#cb10-1167" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Basic Reproduction Number <span class="pp">|</span> $R_0$ <span class="pp">|</span> The average number of secondary infections produced by a single infectious individual in a *completely susceptible* population. This can also be thought of as the reproduction number calculated at the beginning of an outbreak (when basically everyone is suceptible). <span class="pp">|</span></span>
<span id="cb10-1168"><a href="#cb10-1168" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Effective Reproduction Number <span class="pp">|</span> $R_{e}$ <span class="pp">|</span> The average number of secondary infections produced by a single infectious individual in a population with a susceptible proportion equal to $\frac{S}{N}$ <span class="pp">|</span></span>
<span id="cb10-1169"><a href="#cb10-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1170"><a href="#cb10-1170" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-1171"><a href="#cb10-1171" aria-hidden="true" tabindex="-1"></a>Some common misconceptions about $R_0$ and $R_e$ are:</span>
<span id="cb10-1172"><a href="#cb10-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1173"><a href="#cb10-1173" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Must $R_0$ and $R_e$ be whole numbers because nobody can transmit the disease to, say, half a person?"</span>
<span id="cb10-1174"><a href="#cb10-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1175"><a href="#cb10-1175" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>No, $R_0$ and $R_e$ do not have to be whole numbers because they refer to *averages*, not the exact number of secondary infections produced by one person. An infectious person might infect nobody or tons of people but the reproduction numbers don't capture every detail just the overall picture of how many secondary infectious are produced.</span>
<span id="cb10-1176"><a href="#cb10-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1177"><a href="#cb10-1177" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb10-1178"><a href="#cb10-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1179"><a href="#cb10-1179" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Is the reproduction number a rate?"</span>
<span id="cb10-1180"><a href="#cb10-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1181"><a href="#cb10-1181" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>No, the reproduction number is not a rate. Take the example of HIV and SARS, which both have $R_e\approx4$. However, SARS has an extremely rapid spread while HIV is much slower spreading. One individual infected with SARS might cause 4 secondary infections within the span of a week while an individual with HIV most likely infects 4 other people within the span of a few years. $R_0$ and $R_e$ don't tell us anything about the timeframe of infections, so they are not rates.</span>
<span id="cb10-1182"><a href="#cb10-1182" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1183"><a href="#cb10-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1184"><a href="#cb10-1184" aria-hidden="true" tabindex="-1"></a>The formula for the basic reproduction number is:</span>
<span id="cb10-1185"><a href="#cb10-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1186"><a href="#cb10-1186" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1187"><a href="#cb10-1187" aria-hidden="true" tabindex="-1"></a>R_0=\frac{\beta}{\gamma}</span>
<span id="cb10-1188"><a href="#cb10-1188" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1189"><a href="#cb10-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1190"><a href="#cb10-1190" aria-hidden="true" tabindex="-1"></a>And similarly, the formula for the effective reproduction number is:</span>
<span id="cb10-1191"><a href="#cb10-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1192"><a href="#cb10-1192" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1193"><a href="#cb10-1193" aria-hidden="true" tabindex="-1"></a>R_e=\frac{\beta}{\gamma} \left( \frac{S}{N} \right) =R_0\tilde{S}</span>
<span id="cb10-1194"><a href="#cb10-1194" aria-hidden="true" tabindex="-1"></a>$$ These formulas should make sense, as they are multiplying the transmission rate $\beta$ by the average duration of infection $\frac{1}{\gamma}$ to obtain the average number of secondary infections by one infectious individual throughout their entire duration of infectivity.</span>
<span id="cb10-1195"><a href="#cb10-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1196"><a href="#cb10-1196" aria-hidden="true" tabindex="-1"></a>The point where these two formulas differ is in their assumption about the proportion of susceptible individuals in the population. $R_0$ assumes a completely susceptible population, so it is multiplying the expression $\frac{\beta}{\gamma}$ by an invisible $1$. Meanwhile, $R_e$ assumes a susceptible proportion equal to $\frac{S}{N}$ hence the final expression $\frac{\beta}{\gamma}(\frac{S}{N})$.</span>
<span id="cb10-1197"><a href="#cb10-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1198"><a href="#cb10-1198" aria-hidden="true" tabindex="-1"></a>Make sure you understand the definitions and intuition behind the formulas for $R_0$ and $R_e$. <span class="co">[</span><span class="ot">Section @sec-the-threshold-phenomenon</span><span class="co">]</span> on the threshold phenomenon applies the reproduction number in learning how to control the spread of infection.</span>
<span id="cb10-1199"><a href="#cb10-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1200"><a href="#cb10-1200" aria-hidden="true" tabindex="-1"></a>**Section References**</span>
<span id="cb10-1201"><a href="#cb10-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1202"><a href="#cb10-1202" aria-hidden="true" tabindex="-1"></a>@Handel2021_IDEMA_ch5</span>
<span id="cb10-1203"><a href="#cb10-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1204"><a href="#cb10-1204" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Threshold Phenomenon {#sec-the-threshold-phenomenon}</span></span>
<span id="cb10-1205"><a href="#cb10-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1206"><a href="#cb10-1206" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1207"><a href="#cb10-1207" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{I}}{dt} = \beta \tilde{I} \tilde{S} - \gamma \tilde{I}</span>
<span id="cb10-1208"><a href="#cb10-1208" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb10-1209"><a href="#cb10-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1210"><a href="#cb10-1210" aria-hidden="true" tabindex="-1"></a>Factoring out the $\tilde{I}$, we have:</span>
<span id="cb10-1211"><a href="#cb10-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1212"><a href="#cb10-1212" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1213"><a href="#cb10-1213" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{I}}{dt} = \tilde{I}(\beta \tilde{S} - \gamma)</span>
<span id="cb10-1214"><a href="#cb10-1214" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb10-1215"><a href="#cb10-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1216"><a href="#cb10-1216" aria-hidden="true" tabindex="-1"></a>If we wish to find the point at which the infection either invades or fails to, we can solve for when $\frac{d\tilde{I}}{dt}&lt;0$ (the proportion of infectious individuals is decreasing, or the disease is "dying off") and $\frac{d\tilde{I}}{dt}&gt;0$ (the proportion of infectious individuals is increasing, or the disease is "growing").</span>
<span id="cb10-1217"><a href="#cb10-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1218"><a href="#cb10-1218" aria-hidden="true" tabindex="-1"></a>First, let's analyze when $\frac{d\tilde{I}}{dt}&lt;0$:</span>
<span id="cb10-1219"><a href="#cb10-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1220"><a href="#cb10-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1221"><a href="#cb10-1221" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1222"><a href="#cb10-1222" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1223"><a href="#cb10-1223" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{I}}{dt} &amp;&lt; 0  &amp;&amp; \text{Condition that the infected population is decreasing} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1224"><a href="#cb10-1224" aria-hidden="true" tabindex="-1"></a>\tilde{I}(\beta \tilde{S} - \gamma) &amp;&lt; 0  &amp;&amp; \text{Substitute } \frac{d\tilde{I}}{dt} = \tilde{I}(\beta \tilde{S} - \gamma) <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1225"><a href="#cb10-1225" aria-hidden="true" tabindex="-1"></a>\beta \tilde{S} - \gamma &amp;&lt; 0  &amp;&amp; \text{Divide both sides by } \tilde{I} &gt; 0 <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1226"><a href="#cb10-1226" aria-hidden="true" tabindex="-1"></a>\tilde{S} &amp;&lt; \frac{\gamma}{\beta}  &amp;&amp; \text{Add } \gamma \text{ to both sides, then divide by } \beta &gt; 0</span>
<span id="cb10-1227"><a href="#cb10-1227" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1228"><a href="#cb10-1228" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1229"><a href="#cb10-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1230"><a href="#cb10-1230" aria-hidden="true" tabindex="-1"></a>Reproducing this procedure, we obtain the following similar result:</span>
<span id="cb10-1231"><a href="#cb10-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1232"><a href="#cb10-1232" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1233"><a href="#cb10-1233" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{I}}{dt} &gt; 0 </span>
<span id="cb10-1234"><a href="#cb10-1234" aria-hidden="true" tabindex="-1"></a>\;\Longleftrightarrow\; </span>
<span id="cb10-1235"><a href="#cb10-1235" aria-hidden="true" tabindex="-1"></a>\tilde{S} &gt; \frac{\gamma}{\beta}</span>
<span id="cb10-1236"><a href="#cb10-1236" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1237"><a href="#cb10-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1238"><a href="#cb10-1238" aria-hidden="true" tabindex="-1"></a>From this, we can deduce that for an infection to even invade the population and start spreading, the initial proportion of susceptibles must be greater than $\frac{\gamma}{\beta}$. This result is what is specifically known as the *threshold phenomenon*, with $\frac{\gamma}{\beta}$ known as the *threshold value*. Notice that $\frac{\gamma}{\beta}$ is exactly equal to the inverse of the basic reproduction number $\frac{1}{R_0}$, which means we can also rewrite these conditions like so:</span>
<span id="cb10-1239"><a href="#cb10-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1240"><a href="#cb10-1240" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1241"><a href="#cb10-1241" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1242"><a href="#cb10-1242" aria-hidden="true" tabindex="-1"></a>\text{Disease will not invade the population and / or spread:}</span>
<span id="cb10-1243"><a href="#cb10-1243" aria-hidden="true" tabindex="-1"></a>\qquad</span>
<span id="cb10-1244"><a href="#cb10-1244" aria-hidden="true" tabindex="-1"></a>\tilde{S} &amp;&lt; \frac{1}{R_0}</span>
<span id="cb10-1245"><a href="#cb10-1245" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1246"><a href="#cb10-1246" aria-hidden="true" tabindex="-1"></a>\text{Disease will invade the population and / or spread:}</span>
<span id="cb10-1247"><a href="#cb10-1247" aria-hidden="true" tabindex="-1"></a>\qquad</span>
<span id="cb10-1248"><a href="#cb10-1248" aria-hidden="true" tabindex="-1"></a>\tilde{S} &amp;&gt; \frac{1}{R_0}</span>
<span id="cb10-1249"><a href="#cb10-1249" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1250"><a href="#cb10-1250" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1251"><a href="#cb10-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1252"><a href="#cb10-1252" aria-hidden="true" tabindex="-1"></a>The simulation below let's you see the threshold phenomenon in action:</span>
<span id="cb10-1253"><a href="#cb10-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1254"><a href="#cb10-1254" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">iframe</span><span class="ot"> src</span><span class="op">=</span><span class="st">"http://127.0.0.1:4567"</span></span>
<span id="cb10-1255"><a href="#cb10-1255" aria-hidden="true" tabindex="-1"></a><span class="ot">        width</span><span class="op">=</span><span class="st">"100%"</span></span>
<span id="cb10-1256"><a href="#cb10-1256" aria-hidden="true" tabindex="-1"></a><span class="ot">        height</span><span class="op">=</span><span class="st">"700"</span></span>
<span id="cb10-1257"><a href="#cb10-1257" aria-hidden="true" tabindex="-1"></a><span class="ot">        style</span><span class="op">=</span><span class="st">"border:none;"</span><span class="dt">&gt;&lt;/</span><span class="kw">iframe</span><span class="dt">&gt;</span></span>
<span id="cb10-1258"><a href="#cb10-1258" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-1259"><a href="#cb10-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1260"><a href="#cb10-1260" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-1261"><a href="#cb10-1261" aria-hidden="true" tabindex="-1"></a>Try changing the initial proportion of susceptible individuals $S(0)$ to be above and below the rounded threshold value ($\frac{\gamma}{\beta}$ ) shown. Notice that the proportion of infected individuals never increases if $S(0)&lt;\frac{\gamma}{\beta}$ but does increase if $S(0)&gt;\frac{\gamma}{\beta}$.</span>
<span id="cb10-1262"><a href="#cb10-1262" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1263"><a href="#cb10-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1264"><a href="#cb10-1264" aria-hidden="true" tabindex="-1"></a>Connecting this even further to reproduction numbers, we can rewrite the inequalities found above in terms of $R_e$ as follows:</span>
<span id="cb10-1265"><a href="#cb10-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1266"><a href="#cb10-1266" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1267"><a href="#cb10-1267" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1268"><a href="#cb10-1268" aria-hidden="true" tabindex="-1"></a>\qquad</span>
<span id="cb10-1269"><a href="#cb10-1269" aria-hidden="true" tabindex="-1"></a>\tilde{S} &amp;&lt; \frac{\beta}{\gamma}</span>
<span id="cb10-1270"><a href="#cb10-1270" aria-hidden="true" tabindex="-1"></a>\qquad \Longleftrightarrow \qquad</span>
<span id="cb10-1271"><a href="#cb10-1271" aria-hidden="true" tabindex="-1"></a>R_e &lt; 1</span>
<span id="cb10-1272"><a href="#cb10-1272" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1273"><a href="#cb10-1273" aria-hidden="true" tabindex="-1"></a>\qquad</span>
<span id="cb10-1274"><a href="#cb10-1274" aria-hidden="true" tabindex="-1"></a>\tilde{S} &amp;&gt; \frac{\beta}{\gamma}</span>
<span id="cb10-1275"><a href="#cb10-1275" aria-hidden="true" tabindex="-1"></a>\qquad \Longleftrightarrow \qquad</span>
<span id="cb10-1276"><a href="#cb10-1276" aria-hidden="true" tabindex="-1"></a>R_e &gt; 1</span>
<span id="cb10-1277"><a href="#cb10-1277" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1278"><a href="#cb10-1278" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1279"><a href="#cb10-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1280"><a href="#cb10-1280" aria-hidden="true" tabindex="-1"></a>The result above is a really important one: it tells us that $R_e$ is another threshold for determining whether or not a disease will spread. Specifically, if $R_e&lt;1$, the disease is dying off but if $R_e&gt;1$ the disease is spreading.</span>
<span id="cb10-1281"><a href="#cb10-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1282"><a href="#cb10-1282" aria-hidden="true" tabindex="-1"></a>This should come as no surprise though, as it can be inferred from the definition of $R_e$ itself: if every single infectious person in the population (assuming the true value for the susceptible population, unlike $R_0$ which assumes a completely naive population), on average "replaces" themselves with more than $1$ infection, the disease will spread. Moreover, the point at which $R_e$ reaches exactly $1$ marks the maximum for the infected population since it is the point at which the disease goes from spreading (number of individuals infected rising) to dying off (number of individuals infected falling).</span>
<span id="cb10-1283"><a href="#cb10-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1284"><a href="#cb10-1284" aria-hidden="true" tabindex="-1"></a>The simulation below demonstrates how the infected population increases, decreases, and reaches its maximum at different values of $R_e$:</span>
<span id="cb10-1285"><a href="#cb10-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1286"><a href="#cb10-1286" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">iframe</span><span class="ot"> src</span><span class="op">=</span><span class="st">"http://127.0.0.1:4568"</span></span>
<span id="cb10-1287"><a href="#cb10-1287" aria-hidden="true" tabindex="-1"></a><span class="ot">        width</span><span class="op">=</span><span class="st">"100%"</span></span>
<span id="cb10-1288"><a href="#cb10-1288" aria-hidden="true" tabindex="-1"></a><span class="ot">        height</span><span class="op">=</span><span class="st">"700"</span></span>
<span id="cb10-1289"><a href="#cb10-1289" aria-hidden="true" tabindex="-1"></a><span class="ot">        style</span><span class="op">=</span><span class="st">"border:none;"</span><span class="dt">&gt;&lt;/</span><span class="kw">iframe</span><span class="dt">&gt;</span></span>
<span id="cb10-1290"><a href="#cb10-1290" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb10-1291"><a href="#cb10-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1292"><a href="#cb10-1292" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-1293"><a href="#cb10-1293" aria-hidden="true" tabindex="-1"></a>Notice how $R_e$ starts off at its highest (when the population is almost entirely susceptible and it is equal to $R_0$), then decreases over time to be equal to $1$. At the point $R_e=1$, the proportion of infected individuals reaches a maximum. Then, as $R_e$ further decreases below $1$ the proportion of infected individuals starts decreasing as the epidemic "dies off."</span>
<span id="cb10-1294"><a href="#cb10-1294" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1295"><a href="#cb10-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1296"><a href="#cb10-1296" aria-hidden="true" tabindex="-1"></a>Try expanding the window size in the simulation above and observe what happens to $R_e$ as $t \rightarrow \infty$. Notice that $R_e$ never reaches $0$! This demonstrates another important result: for an epidemic to end, it is not necessary to completely exhaust the susceptible population and attain $R_e=0$. The epidemic will start to end its course as soon as the proportion of susceptibles dips low enough to where $R_e&lt;1$. When this happens, the infectious individuals will, on average, no longer be "replacing" themselves with another infectious person despite there still being a non-zero population of susceptible people. If this goes on for a long enough time, the chain of transmission will break because there will be no more infectious people to spread the infection not because there were no more susceptible people to infect. This means that at the end of every epidemic, there will always be some people who were never infected and are still susceptible.</span>
<span id="cb10-1297"><a href="#cb10-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1298"><a href="#cb10-1298" aria-hidden="true" tabindex="-1"></a>INSERT FLOW DIAGRAM THAT SHOWS EFF R AT VARIOUS FINITE STAGES AND ARROWS BETWEEN PEOPLE SPREADING THE INFECTION AND SAY THAT IF THERE IS LIKE 50 INFECTIOUS PEOPLE AND AN RE = 0.1 THEN 5 PEOPLE WILL GET INFECTED NEXT STAGE; ONCE THIS AVERAGE DIPS BELOW 1 PERSON FOR THE WHOLE INFECTIOUS POPULATION, DISEASE DIES OFF</span>
<span id="cb10-1299"><a href="#cb10-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1300"><a href="#cb10-1300" aria-hidden="true" tabindex="-1"></a>Of course, one of our primary goals is to expedite the natural decrease of $R_e$ to be below $1$ as quickly as possible, thus reducing and eventually fully stopping the spread of infection. One of the most effective public health measures to accomplish this is vaccination <span class="co">[</span><span class="ot">@vaccines13050479</span><span class="co">]</span>. <span class="co">[</span><span class="ot">Section @sec-choosing-how-many-people-to-vaccinate</span><span class="co">]</span> answers the crucial following question: "How many vaccinated people is enough?".</span>
<span id="cb10-1301"><a href="#cb10-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1302"><a href="#cb10-1302" aria-hidden="true" tabindex="-1"></a>**Section References**</span>
<span id="cb10-1303"><a href="#cb10-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1304"><a href="#cb10-1304" aria-hidden="true" tabindex="-1"></a>@keeling_modeling_2008</span>
<span id="cb10-1305"><a href="#cb10-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1306"><a href="#cb10-1306" aria-hidden="true" tabindex="-1"></a><span class="fu">### Choosing How Many People to Vaccinate {#sec-choosing-how-many-people-to-vaccinate}</span></span>
<span id="cb10-1307"><a href="#cb10-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1308"><a href="#cb10-1308" aria-hidden="true" tabindex="-1"></a>Recall from <span class="co">[</span><span class="ot">Section @sec-the-threshold-phenomenon</span><span class="co">]</span> that the disease will begin to die off when $R_e$ drops below $1$. The proportion of susceptible individuals $\tilde{S}$ can be considered to be equal to $1-i$, where $i$ is the proportion of people in the population who are infectious or immune to the disease. We can rearrange the expression $R_e&lt;1$ and solve for $i$:</span>
<span id="cb10-1309"><a href="#cb10-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1310"><a href="#cb10-1310" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb10-1311"><a href="#cb10-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1312"><a href="#cb10-1312" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1313"><a href="#cb10-1313" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1314"><a href="#cb10-1314" aria-hidden="true" tabindex="-1"></a>R_e &amp;&lt; 1 &amp;&amp; \text{Condition for disease to die off} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1315"><a href="#cb10-1315" aria-hidden="true" tabindex="-1"></a>R_0 \tilde{S} &amp;&lt; 1 &amp;&amp; \text{Definition of $R_e$} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1316"><a href="#cb10-1316" aria-hidden="true" tabindex="-1"></a>R_0 (1-i) &amp;&lt; 1 &amp;&amp; \text{$\tilde{S}=1-i$} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1317"><a href="#cb10-1317" aria-hidden="true" tabindex="-1"></a>i &amp;&gt; 1-\frac{1}{R_0} &amp;&amp; \text{Rearranging and solving for $i$}</span>
<span id="cb10-1318"><a href="#cb10-1318" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1319"><a href="#cb10-1319" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1320"><a href="#cb10-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1321"><a href="#cb10-1321" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb10-1322"><a href="#cb10-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1323"><a href="#cb10-1323" aria-hidden="true" tabindex="-1"></a>At the beginning of the outbreak, when nearly all individuals are susceptible and there are very few infectious, the proportion of individuals immune to the disease or infectious with it $i$ can be considered approximately equal to the proportion of individuals *successfully* vaccinated against the disease. This is because, generally speaking, vaccination confers immunity, though most of the time only temporary, to a disease (https://www.who.int/news-room/feature-stories/detail/how-do-vaccines-work). Since we are analyzing a relatively small time-frame with epidemics, the temporary nature of vaccine-conferred immunity can be safely disregarded.</span>
<span id="cb10-1324"><a href="#cb10-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1325"><a href="#cb10-1325" aria-hidden="true" tabindex="-1"></a>Notice the emphasis on the word "successfully." This is because most vaccines are not $100%$ effective; there will always be a percentage of people, though however small, that are vaccinated but can still contract the disease. Assuming a vaccine efficacy rate of $e$, or the proportion of people who are vaccinated $p$ that are truly granted immunity, the proportion of individuals successfully vaccinated is $i=ep$. We can rearrange the expression found previously to find the proportion of the population $p$ that should be vaccinated at the start of the outbreak:</span>
<span id="cb10-1326"><a href="#cb10-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1327"><a href="#cb10-1327" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb10-1328"><a href="#cb10-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1329"><a href="#cb10-1329" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1330"><a href="#cb10-1330" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1331"><a href="#cb10-1331" aria-hidden="true" tabindex="-1"></a>i &amp;&gt; 1-\frac{1}{R_0} &amp;&amp; \text{Minimum proportion of immune individuals i} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1332"><a href="#cb10-1332" aria-hidden="true" tabindex="-1"></a>ep &amp;&gt; 1-\frac{1}{R_0} &amp;&amp; \text{Considering i=ep} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1333"><a href="#cb10-1333" aria-hidden="true" tabindex="-1"></a>p &amp;&gt; \frac{1}{e}\left(1-\frac{1}{R_0} \right) &amp;&amp; \text{Rearranging for p}</span>
<span id="cb10-1334"><a href="#cb10-1334" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1335"><a href="#cb10-1335" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1336"><a href="#cb10-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1337"><a href="#cb10-1337" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb10-1338"><a href="#cb10-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1339"><a href="#cb10-1339" aria-hidden="true" tabindex="-1"></a>This means that, for a vaccine with an efficacy rate $e$, at the proportion of people that should be vaccinated at the start of an outbreak to prevent further spread should be at least $\frac{1}{e}(1-\frac{1}{R_0}$. Not everyone in the population must be vaccinated to stop the spread of a disease, an idea known as *herd immunity*.</span>
<span id="cb10-1340"><a href="#cb10-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1341"><a href="#cb10-1341" aria-hidden="true" tabindex="-1"></a>However, sometimes herd immunity cannot be obtained. Take the case when $R_0=3$ and the best available vaccine has an efficacy rate of $e=0.6$ (meaning that of the people who are vaccinated, only about $60%$ of them will actually be immune and unable to contract the disease). Using the formula above, we find that the proportion of people who are vaccinated at the beginning of the outrbreak must be at least $\frac{1}{0.6}(1-\frac{1}{3})\approx1.1$. However, this is impossible: we cannot possible vaccinate more than $100%$ of the population! This means that, due to a combination of the high transmissibility of the disease and the relatively low vaccine efficacy rate, even if $100%$ of the population were to be vaccinated, there would still be enough susceptible people (i.e. people whose vaccines were not effective) for an outbreak to occur.</span>
<span id="cb10-1342"><a href="#cb10-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1343"><a href="#cb10-1343" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-1344"><a href="#cb10-1344" aria-hidden="true" tabindex="-1"></a>Note that the above calculations and statements are assuming ideal vaccination practices at the beginning of an outbreak when nearly all individuals are susceptible and almost none are recovered or infectious. If vaccination is implemented mid-outbreak, when the number of recovered individuals with natural immunity and infectious people are not negligible, the calculations must be modified. In general, fewer individuals will have to be vaccinated than at the beginning of an outbreak since the proportion of susceptible individuals $\tilde{S}$ will be equal to the complement of the sum of: the proportion of people who are infectious, those who have natural immunity due to recovery, and those who are successfully vaccinated.</span>
<span id="cb10-1345"><a href="#cb10-1345" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1346"><a href="#cb10-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1347"><a href="#cb10-1347" aria-hidden="true" tabindex="-1"></a>**Section References**</span>
<span id="cb10-1348"><a href="#cb10-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1349"><a href="#cb10-1349" aria-hidden="true" tabindex="-1"></a>@Handel2021_IDEMA_ch5</span>
<span id="cb10-1350"><a href="#cb10-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1351"><a href="#cb10-1351" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example of the Classic Epidemic Model</span></span>
<span id="cb10-1352"><a href="#cb10-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1353"><a href="#cb10-1353" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb10-1354"><a href="#cb10-1354" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb10-1355"><a href="#cb10-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1356"><a href="#cb10-1356" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Identify examples of situations where the classic epidemic model is a useful tool for modeling.</span>
<span id="cb10-1357"><a href="#cb10-1357" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1358"><a href="#cb10-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1359"><a href="#cb10-1359" aria-hidden="true" tabindex="-1"></a>https://scholarworks.lib.csusb.edu/cgi/viewcontent.cgi?article=2232&amp;context=etd</span>
<span id="cb10-1360"><a href="#cb10-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1361"><a href="#cb10-1361" aria-hidden="true" tabindex="-1"></a>A disease commonly modeled using SIR-type models is measles due to its high infectivity and life-long immunity once recovered <span class="co">[</span><span class="ot">@review_measles</span><span class="co">]</span>. Although the mathematical modelling of measles epidemics can get very complicated with the inclusion of stochasticity (randomness) and time-series analysis <span class="co">[</span><span class="ot">@bjornstad_measles</span><span class="co">]</span>, the example we present here is a relatively simple one that applies the concepts we discussed previously. </span>
<span id="cb10-1362"><a href="#cb10-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1363"><a href="#cb10-1363" aria-hidden="true" tabindex="-1"></a>**Context**</span>
<span id="cb10-1364"><a href="#cb10-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1365"><a href="#cb10-1365" aria-hidden="true" tabindex="-1"></a>Prior to mass-vaccination campaigns, large British cities exhibited regular measles outbreaks <span class="co">[</span><span class="ot">@bjornstad_measles</span><span class="co">]</span>. Our scope is to model the measles disease dynamics over two year periods for various British cities using the classic epidemic SIR model.</span>
<span id="cb10-1366"><a href="#cb10-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1367"><a href="#cb10-1367" aria-hidden="true" tabindex="-1"></a>**Data For Our Model**</span>
<span id="cb10-1368"><a href="#cb10-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1369"><a href="#cb10-1369" aria-hidden="true" tabindex="-1"></a>The data we will be utilizing for this example is publicly avaliable through the Ottar Bjørnstad Lab at Penn State University <span class="co">[</span><span class="ot">@bjornstad_measles_data</span><span class="co">]</span>. The data set contains prevalence count data and annual number of births for 60 British cities from 1944 to 1966 (inclusive) as well as the median population size of each city between 1944 and 1966 (inclusive). </span>
<span id="cb10-1370"><a href="#cb10-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1371"><a href="#cb10-1371" aria-hidden="true" tabindex="-1"></a>Our example will only utilize the prevalence count data from 1944 to 1945 (52 weeks) and the median population size between 1944 and 1966 for the cities of Blackburn, Exeter, and Leeds, as seen in the table below:</span>
<span id="cb10-1372"><a href="#cb10-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1373"><a href="#cb10-1373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb10-1374"><a href="#cb10-1374" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb10-1375"><a href="#cb10-1375" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb10-1376"><a href="#cb10-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1377"><a href="#cb10-1377" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"../data/measles_ex_data.xlsx"</span>)</span>
<span id="cb10-1378"><a href="#cb10-1378" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(data)</span>
<span id="cb10-1379"><a href="#cb10-1379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-1380"><a href="#cb10-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1381"><a href="#cb10-1381" aria-hidden="true" tabindex="-1"></a>**Understanding Our Model**</span>
<span id="cb10-1382"><a href="#cb10-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1383"><a href="#cb10-1383" aria-hidden="true" tabindex="-1"></a>The data set above contains data for three different British cities, however we are only going to walk through the formulation of an epidemic SIR model for one of them---Blackburn---using the given data which ranges from the beginning of 1944 to the end of 1945. </span>
<span id="cb10-1384"><a href="#cb10-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1385"><a href="#cb10-1385" aria-hidden="true" tabindex="-1"></a>When formulating a mathematical model, the first question we should ask ourselves is *what* exactly we are trying to model even looks like. Since we are simply presenting an example of the classic epidemic SIR model, the "disease flow" for measles in Blackburn could be visualized like so:</span>
<span id="cb10-1386"><a href="#cb10-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1387"><a href="#cb10-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1388"><a href="#cb10-1388" aria-hidden="true" tabindex="-1"></a>INSERT FLOW CHART OF SIR MODEL COMPARTMENTS</span>
<span id="cb10-1389"><a href="#cb10-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1390"><a href="#cb10-1390" aria-hidden="true" tabindex="-1"></a>Putting this into words, at the beginning of 1944 we assume the proportion of susceptible, infected, and recovered individuals as $\tilde{S}(0)$, $\tilde{I}(0)$, and $\tilde{R}(0)$, respectively. Over time, the proportion of people infected with measles grows until the chain of transmission breaks since the people infected with measles at that point will, on average, not be "replacing" themselves with at least one new measles infection to keep the disease "alive." Once the chain of transmission breaks, the epidemic dies off soon after (which is to say that no people in Blackburn are infected with measles anymore). </span>
<span id="cb10-1391"><a href="#cb10-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1392"><a href="#cb10-1392" aria-hidden="true" tabindex="-1"></a>We can even see model process reflected in our data: in weeks 2 through 20 of 1944 there are various small introduction of measles into Blackburn, but none manage to spread further and kickstart the epidemic. This is a really important observation because it highlights the random nature of disease spread and infection. In theory, the epidemic should have started from the introduction of $2$ infected people in Blackburn in week 2 since the estimated $R_0$ for measles in England from the years 1944 to 1979 is $13.7$ to $18$ <span class="co">[</span><span class="ot">@anderson_may_1982</span><span class="co">]</span>. However, remembering back to <span class="co">[</span><span class="ot">Section @sec-reproduction-numbers</span><span class="co">]</span> $R_0$ is an *average*, not an absolute, number of secondary infections in a completely susceptible population. Even with a high average number of secondary infections, it is very possible that the people infected with measles from weeks 2 through 20 didn't manage to spread it to enough people to start the epidemic (maybe they were responsible and quarantined, or those individuals didn't interact with many people while they had measles, etc.). </span>
<span id="cb10-1393"><a href="#cb10-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1394"><a href="#cb10-1394" aria-hidden="true" tabindex="-1"></a>However, in week $22$ there is one new measles case that manages to successfully spread further and start the epidemic. The epidemic continues until the chain of transmission breaks sometime around week $50$ to $52$ of $1944$ and declines back down to nearly $0$ cases through most of 1945, with the exception of a few stray cases that don't manage to re-start the epidemic cycle. </span>
<span id="cb10-1395"><a href="#cb10-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1396"><a href="#cb10-1396" aria-hidden="true" tabindex="-1"></a>We are looking to model this measles outbreak by following the number of susceptible, infected, and recovered individuals using an epidemic SIR model, giving the following model equations:</span>
<span id="cb10-1397"><a href="#cb10-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1398"><a href="#cb10-1398" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1399"><a href="#cb10-1399" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1400"><a href="#cb10-1400" aria-hidden="true" tabindex="-1"></a>\frac{dS}{dt} &amp;= -\beta \left(\frac{I}{N}\right)  S <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1401"><a href="#cb10-1401" aria-hidden="true" tabindex="-1"></a>\frac{dI}{dt} &amp;= \beta \left(\frac{I}{N}\right)  S - \gamma I <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1402"><a href="#cb10-1402" aria-hidden="true" tabindex="-1"></a>\frac{dR}{dt} &amp;= \gamma I</span>
<span id="cb10-1403"><a href="#cb10-1403" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1404"><a href="#cb10-1404" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1405"><a href="#cb10-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1406"><a href="#cb10-1406" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb10-1407"><a href="#cb10-1407" aria-hidden="true" tabindex="-1"></a>Since our data is given in week intervals, the rates in our model ($\beta$, $\gamma$, $\frac{dS}{dt}$,  $\frac{dI}{dt}$,  $\frac{dR}{dt}$) are in units of weeks as well.</span>
<span id="cb10-1408"><a href="#cb10-1408" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1409"><a href="#cb10-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1410"><a href="#cb10-1410" aria-hidden="true" tabindex="-1"></a>Now that we have an outline for our model, our next step is to find suitable values for the transmission rate $\beta$ and recovery rate $\gamma$. </span>
<span id="cb10-1411"><a href="#cb10-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1412"><a href="#cb10-1412" aria-hidden="true" tabindex="-1"></a>**Finding Our Model Parameters**</span>
<span id="cb10-1413"><a href="#cb10-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1414"><a href="#cb10-1414" aria-hidden="true" tabindex="-1"></a>The epidemic SIR model only has two parameters, the transmission rate $\beta$ and the recovery rate $\gamma$. From past literature, it is known that the average infectious period of measles is $6$ to $7$ days, which we will estimate to be about $6.5$ days or $\frac{6.5}{7}\approx0.93$ weeks <span class="co">[</span><span class="ot">@anderson_may_1982</span><span class="co">]</span>. Recalling the average infectious period as equal to $\frac{1}{\gamma}$, we can obtain and estimated recovery rate of $\gamma=\frac{7}{6.5}=\frac{14}{13}$. </span>
<span id="cb10-1415"><a href="#cb10-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1416"><a href="#cb10-1416" aria-hidden="true" tabindex="-1"></a>Now that we have our estimate for $\gamma$, let's use the same method covered in <span class="co">[</span><span class="ot">Section @sec-bbmle</span><span class="co">]</span> to find the transmission rate $\beta$ using MLE:</span>
<span id="cb10-1417"><a href="#cb10-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1420"><a href="#cb10-1420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-1421"><a href="#cb10-1421" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbmle)</span>
<span id="cb10-1422"><a href="#cb10-1422" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-1423"><a href="#cb10-1423" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb10-1424"><a href="#cb10-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1425"><a href="#cb10-1425" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing our prevalence count data for Blackburn</span></span>
<span id="cb10-1426"><a href="#cb10-1426" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/measles_ex_data.csv"</span>) <span class="sc">|&gt;</span> <span class="fu">filter</span>(city <span class="sc">==</span> <span class="st">"Blackburn"</span>)</span>
<span id="cb10-1427"><a href="#cb10-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1428"><a href="#cb10-1428" aria-hidden="true" tabindex="-1"></a><span class="co"># SIR model function</span></span>
<span id="cb10-1429"><a href="#cb10-1429" aria-hidden="true" tabindex="-1"></a>ModelFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(time,state,parameters){</span>
<span id="cb10-1430"><a href="#cb10-1430" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> state[<span class="dv">1</span>]</span>
<span id="cb10-1431"><a href="#cb10-1431" aria-hidden="true" tabindex="-1"></a>  I <span class="ot">&lt;-</span> state[<span class="dv">2</span>]</span>
<span id="cb10-1432"><a href="#cb10-1432" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> state[<span class="dv">3</span>]</span>
<span id="cb10-1433"><a href="#cb10-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1434"><a href="#cb10-1434" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> parameters[<span class="st">"beta"</span>]</span>
<span id="cb10-1435"><a href="#cb10-1435" aria-hidden="true" tabindex="-1"></a>  gamma <span class="ot">&lt;-</span> parameters[<span class="st">"gamma"</span>]</span>
<span id="cb10-1436"><a href="#cb10-1436" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> parameters[<span class="st">"N"</span>]</span>
<span id="cb10-1437"><a href="#cb10-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1438"><a href="#cb10-1438" aria-hidden="true" tabindex="-1"></a>  dS <span class="ot">&lt;-</span> <span class="sc">-</span>(beta<span class="sc">*</span>I<span class="sc">*</span>S<span class="sc">/</span>N)</span>
<span id="cb10-1439"><a href="#cb10-1439" aria-hidden="true" tabindex="-1"></a>  dI <span class="ot">&lt;-</span> (beta<span class="sc">*</span>I<span class="sc">*</span>S<span class="sc">/</span>N) <span class="sc">-</span> (gamma<span class="sc">*</span>I)</span>
<span id="cb10-1440"><a href="#cb10-1440" aria-hidden="true" tabindex="-1"></a>  dR <span class="ot">&lt;-</span> (gamma<span class="sc">*</span>I)</span>
<span id="cb10-1441"><a href="#cb10-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1442"><a href="#cb10-1442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(dS,dI,dR))</span>
<span id="cb10-1443"><a href="#cb10-1443" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-1444"><a href="#cb10-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1445"><a href="#cb10-1445" aria-hidden="true" tabindex="-1"></a><span class="co"># Outputs predicted prevalence counts</span></span>
<span id="cb10-1446"><a href="#cb10-1446" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="cf">function</span>(parameters,t){</span>
<span id="cb10-1447"><a href="#cb10-1447" aria-hidden="true" tabindex="-1"></a>  <span class="co"># S = population size - prevalence at first record (week 2)</span></span>
<span id="cb10-1448"><a href="#cb10-1448" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I = prevalence at week 2</span></span>
<span id="cb10-1449"><a href="#cb10-1449" aria-hidden="true" tabindex="-1"></a>  <span class="co"># R = 0</span></span>
<span id="cb10-1450"><a href="#cb10-1450" aria-hidden="true" tabindex="-1"></a>  initial_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(data<span class="sc">$</span>population_size[<span class="dv">1</span>]<span class="sc">-</span>data<span class="sc">$</span>prevalence_count[<span class="dv">1</span>],data<span class="sc">$</span>prevalence_count[<span class="dv">1</span>],<span class="dv">0</span>)</span>
<span id="cb10-1451"><a href="#cb10-1451" aria-hidden="true" tabindex="-1"></a>  t_start <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-1452"><a href="#cb10-1452" aria-hidden="true" tabindex="-1"></a>  t_end <span class="ot">&lt;-</span> <span class="fu">max</span>(t)</span>
<span id="cb10-1453"><a href="#cb10-1453" aria-hidden="true" tabindex="-1"></a>  step_size <span class="ot">&lt;-</span> t_end <span class="sc">-</span> t_start</span>
<span id="cb10-1454"><a href="#cb10-1454" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">rk4sys</span>(<span class="at">y0=</span>initial_vals,</span>
<span id="cb10-1455"><a href="#cb10-1455" aria-hidden="true" tabindex="-1"></a>                 <span class="at">a=</span>t_start,</span>
<span id="cb10-1456"><a href="#cb10-1456" aria-hidden="true" tabindex="-1"></a>                 <span class="at">b=</span>t_end,</span>
<span id="cb10-1457"><a href="#cb10-1457" aria-hidden="true" tabindex="-1"></a>                 <span class="at">f=</span><span class="cf">function</span>(t,y) <span class="fu">ModelFunc</span>(t,y,parameters),</span>
<span id="cb10-1458"><a href="#cb10-1458" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n=</span>step_size)</span>
<span id="cb10-1459"><a href="#cb10-1459" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-1460"><a href="#cb10-1460" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extracting predicted prevalences</span></span>
<span id="cb10-1461"><a href="#cb10-1461" aria-hidden="true" tabindex="-1"></a>  output_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(output)</span>
<span id="cb10-1462"><a href="#cb10-1462" aria-hidden="true" tabindex="-1"></a>  prevalences <span class="ot">&lt;-</span> output_df<span class="sc">$</span>y.I[t]</span>
<span id="cb10-1463"><a href="#cb10-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1464"><a href="#cb10-1464" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensuring there are no NaNs or out of bounds numbers in the output</span></span>
<span id="cb10-1465"><a href="#cb10-1465" aria-hidden="true" tabindex="-1"></a>  prevalences[<span class="fu">is.nan</span>(prevalences) <span class="sc">|</span> prevalences <span class="sc">&lt;</span> <span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-1466"><a href="#cb10-1466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(prevalences)</span>
<span id="cb10-1467"><a href="#cb10-1467" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-1468"><a href="#cb10-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1469"><a href="#cb10-1469" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood function</span></span>
<span id="cb10-1470"><a href="#cb10-1470" aria-hidden="true" tabindex="-1"></a>poisson_ll <span class="ot">&lt;-</span> <span class="cf">function</span>(b){</span>
<span id="cb10-1471"><a href="#cb10-1471" aria-hidden="true" tabindex="-1"></a>  times <span class="ot">&lt;-</span> data<span class="sc">$</span>week</span>
<span id="cb10-1472"><a href="#cb10-1472" aria-hidden="true" tabindex="-1"></a>  parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">beta=</span>b,<span class="at">gamma=</span><span class="dv">14</span><span class="sc">/</span><span class="dv">13</span>,<span class="at">N=</span>data<span class="sc">$</span>population_size[<span class="dv">1</span>])</span>
<span id="cb10-1473"><a href="#cb10-1473" aria-hidden="true" tabindex="-1"></a>  predicted <span class="ot">&lt;-</span> <span class="fu">pred</span>(parameters,times)</span>
<span id="cb10-1474"><a href="#cb10-1474" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x=</span>data<span class="sc">$</span>prevalence_count,<span class="at">lambda=</span>predicted,<span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb10-1475"><a href="#cb10-1475" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-1476"><a href="#cb10-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1477"><a href="#cb10-1477" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting our initial guess as beta = 2</span></span>
<span id="cb10-1478"><a href="#cb10-1478" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">b=</span><span class="dv">9</span>)</span>
<span id="cb10-1479"><a href="#cb10-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1480"><a href="#cb10-1480" aria-hidden="true" tabindex="-1"></a><span class="co"># Calling mle2</span></span>
<span id="cb10-1481"><a href="#cb10-1481" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">mle2</span>(<span class="at">minuslogl=</span>poisson_ll,</span>
<span id="cb10-1482"><a href="#cb10-1482" aria-hidden="true" tabindex="-1"></a>                         <span class="at">start=</span>start,</span>
<span id="cb10-1483"><a href="#cb10-1483" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method=</span><span class="st">"L-BFGS-B"</span>,</span>
<span id="cb10-1484"><a href="#cb10-1484" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lower=</span><span class="fu">c</span>(<span class="at">b=</span><span class="fl">0.01</span>))</span>
<span id="cb10-1485"><a href="#cb10-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1486"><a href="#cb10-1486" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the maximum likelihood estimate for beta</span></span>
<span id="cb10-1487"><a href="#cb10-1487" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(result)</span>
<span id="cb10-1488"><a href="#cb10-1488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-1489"><a href="#cb10-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1490"><a href="#cb10-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1491"><a href="#cb10-1491" aria-hidden="true" tabindex="-1"></a>**Visualizing Our Model**</span>
<span id="cb10-1492"><a href="#cb10-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1493"><a href="#cb10-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1494"><a href="#cb10-1494" aria-hidden="true" tabindex="-1"></a>**Analyzing and Interpreting Our Model**</span>
<span id="cb10-1495"><a href="#cb10-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1496"><a href="#cb10-1496" aria-hidden="true" tabindex="-1"></a>to find prop to vaccinate use efficacy rates here:</span>
<span id="cb10-1497"><a href="#cb10-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1498"><a href="#cb10-1498" aria-hidden="true" tabindex="-1"></a>https://ir.nmu.org.ua/server/api/core/bitstreams/e4229560-2fd1-4a9f-bdeb-2c96b88fa29a/content</span>
<span id="cb10-1499"><a href="#cb10-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1500"><a href="#cb10-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1501"><a href="#cb10-1501" aria-hidden="true" tabindex="-1"></a>Include practice questions that ask to repeat process for data from other cities. </span>
<span id="cb10-1502"><a href="#cb10-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1503"><a href="#cb10-1503" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Classic Endemic Model</span></span>
<span id="cb10-1504"><a href="#cb10-1504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1505"><a href="#cb10-1505" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Classic SIR Endemic Model</span></span>
<span id="cb10-1506"><a href="#cb10-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1507"><a href="#cb10-1507" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb10-1508"><a href="#cb10-1508" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb10-1509"><a href="#cb10-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1510"><a href="#cb10-1510" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Recall the classic endemic model's equations.</span>
<span id="cb10-1511"><a href="#cb10-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1512"><a href="#cb10-1512" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Differentiate the classic endemic model from the epidemic model.</span>
<span id="cb10-1513"><a href="#cb10-1513" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1514"><a href="#cb10-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1515"><a href="#cb10-1515" aria-hidden="true" tabindex="-1"></a>Recalling the information in <span class="co">[</span><span class="ot">Section @sec-the-classic-sir-epidemic-model</span><span class="co">]</span>, the classic epidemic model assumes no demographics (births and deaths) in the population. This is because epidemics occur in such a relatively short timeframe, so the inclusion of births and deaths adds unnecessary complexity since so few will occur over this period.</span>
<span id="cb10-1516"><a href="#cb10-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1517"><a href="#cb10-1517" aria-hidden="true" tabindex="-1"></a>However, epidemic models are not suitable for all disease; there are some diseases that do not conclude their spread sufficiently fast to neglect the births and deaths that occur during that time. This is when the SIR model with demographics, also known commonly as the classic endemic model, comes in. The classic endemic model includes birth and death rates, but makes the following key assumptions about them:</span>
<span id="cb10-1518"><a href="#cb10-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1519"><a href="#cb10-1519" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Every individual in the population has a natural "lifespan" of $\frac{1}{\mu}$ years, where $\mu$ is the rate at which individuals die due to natural causes</span>
<span id="cb10-1520"><a href="#cb10-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1521"><a href="#cb10-1521" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>$\mu$ is independent of the disease and does not represent the pathogenicity of the disease, or its ability to cause death</span>
<span id="cb10-1522"><a href="#cb10-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1523"><a href="#cb10-1523" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>No deaths outside of natural ones dictated by the rate $\mu$ occur; in other words, there are no separate disease related deaths and $\mu$ is the crude death rate, or the death rate across people in all demographic groups and disease statuses (susceptible, infected, or recovered)</span>
<span id="cb10-1524"><a href="#cb10-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1525"><a href="#cb10-1525" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\mu$ also represents the population's crude birth rate as well</span>
<span id="cb10-1526"><a href="#cb10-1526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1527"><a href="#cb10-1527" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This ensure that the total population size does not change as time goes on; as such, $N$ is a constant in the endemic SIR just as it is in the epidemic model</span>
<span id="cb10-1528"><a href="#cb10-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1529"><a href="#cb10-1529" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Every individual is born into the susceptible population</span>
<span id="cb10-1530"><a href="#cb10-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1531"><a href="#cb10-1531" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Although for many disease (like measles for example) newborns are born with passive immunity due to the passing down of maternal antibodies, the average age at which passive immunity is lost is much lower than the typical age of first infection in developed countries. This tells us that it is reasonable to consider all newborns as being immediately susceptible since the time to their first infection is most likely independent of their initial fading immunity at birth. This is not true of diseases that have a very small mean age of infection, however, since an infection can happen as soon as passive immunity ends.</span>
<span id="cb10-1532"><a href="#cb10-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1533"><a href="#cb10-1533" aria-hidden="true" tabindex="-1"></a>**Section References**</span>
<span id="cb10-1534"><a href="#cb10-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1535"><a href="#cb10-1535" aria-hidden="true" tabindex="-1"></a>@keeling_modeling_2008</span>
<span id="cb10-1536"><a href="#cb10-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1537"><a href="#cb10-1537" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-1538"><a href="#cb10-1538" aria-hidden="true" tabindex="-1"></a>The other assumptions made for the classic epidemic SIR apply to the endemic SIR model as well. We are just simply adding these new assumptions about the characteristics of the birth and death rates in the population. These assumptions are common but it should be noted that not all SIR models with demographics will make the same assumptions as above.</span>
<span id="cb10-1539"><a href="#cb10-1539" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1540"><a href="#cb10-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1541"><a href="#cb10-1541" aria-hidden="true" tabindex="-1"></a>The flowchart for the classic endemic model can be seen below:</span>
<span id="cb10-1542"><a href="#cb10-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1545"><a href="#cb10-1545" aria-hidden="true" tabindex="-1"></a><span class="in">```{dot}</span></span>
<span id="cb10-1546"><a href="#cb10-1546" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-width: 8</span></span>
<span id="cb10-1547"><a href="#cb10-1547" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-height: 5</span></span>
<span id="cb10-1548"><a href="#cb10-1548" aria-hidden="true" tabindex="-1"></a><span class="co">//| fig-align: center</span></span>
<span id="cb10-1549"><a href="#cb10-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1550"><a href="#cb10-1550" aria-hidden="true" tabindex="-1"></a><span class="kw">digraph</span> <span class="va">SIRend</span> <span class="ot">{</span></span>
<span id="cb10-1551"><a href="#cb10-1551" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="at">rankdir</span><span class="ot">=</span><span class="va">TB</span><span class="ot">;</span></span>
<span id="cb10-1552"><a href="#cb10-1552" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="kw">node</span><span class="co"> </span><span class="ot">[</span><span class="at">shape</span><span class="ot">=</span><span class="va">box</span><span class="co">, </span><span class="at">style</span><span class="ot">=</span><span class="va">rounded</span><span class="co">, </span><span class="at">fontsize</span><span class="ot">=</span><span class="dv">14</span><span class="ot">];</span></span>
<span id="cb10-1553"><a href="#cb10-1553" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb10-1554"><a href="#cb10-1554" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">I</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"I"</span><span class="ot">];</span></span>
<span id="cb10-1555"><a href="#cb10-1555" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">R</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"R"</span><span class="ot">];</span></span>
<span id="cb10-1556"><a href="#cb10-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1557"><a href="#cb10-1557" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">topS</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">""</span><span class="co">, </span><span class="at">shape</span><span class="ot">=</span><span class="va">none</span><span class="co">, </span><span class="at">width</span><span class="ot">=</span><span class="dv">0.01</span><span class="ot">];</span></span>
<span id="cb10-1558"><a href="#cb10-1558" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">bottomS</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">""</span><span class="co">, </span><span class="at">shape</span><span class="ot">=</span><span class="va">none</span><span class="co">, </span><span class="at">width</span><span class="ot">=</span><span class="dv">0.01</span><span class="ot">];</span></span>
<span id="cb10-1559"><a href="#cb10-1559" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">bottomI</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">""</span><span class="co">, </span><span class="at">shape</span><span class="ot">=</span><span class="va">none</span><span class="co">, </span><span class="at">width</span><span class="ot">=</span><span class="dv">0.01</span><span class="ot">];</span></span>
<span id="cb10-1560"><a href="#cb10-1560" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">bottomR</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">""</span><span class="co">, </span><span class="at">shape</span><span class="ot">=</span><span class="va">none</span><span class="co">, </span><span class="at">width</span><span class="ot">=</span><span class="dv">0.01</span><span class="ot">];</span></span>
<span id="cb10-1561"><a href="#cb10-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1562"><a href="#cb10-1562" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="ot">{</span><span class="co"> </span><span class="at">rank</span><span class="ot">=</span><span class="va">same</span><span class="ot">;</span><span class="co"> </span><span class="va">S</span><span class="ot">;</span><span class="co"> </span><span class="va">I</span><span class="ot">;</span><span class="co"> </span><span class="va">R</span><span class="ot">;</span><span class="co"> </span><span class="ot">}</span></span>
<span id="cb10-1563"><a href="#cb10-1563" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="ot">{</span><span class="co"> </span><span class="at">rank</span><span class="ot">=</span><span class="va">min</span><span class="ot">;</span><span class="co"> </span><span class="va">topS</span><span class="ot">;</span><span class="co"> </span><span class="ot">}</span></span>
<span id="cb10-1564"><a href="#cb10-1564" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="ot">{</span><span class="co"> </span><span class="at">rank</span><span class="ot">=</span><span class="va">max</span><span class="ot">;</span><span class="co"> </span><span class="va">bottomS</span><span class="ot">;</span><span class="co"> </span><span class="va">bottomI</span><span class="ot">;</span><span class="co"> </span><span class="va">bottomR</span><span class="ot">;</span><span class="co"> </span><span class="ot">}</span></span>
<span id="cb10-1565"><a href="#cb10-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1566"><a href="#cb10-1566" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">topS</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">S</span><span class="co">:</span><span class="va">n</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"  μ"</span><span class="ot">];</span></span>
<span id="cb10-1567"><a href="#cb10-1567" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">S</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">I</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"λ"</span><span class="co">, </span><span class="at">labelfontsize</span><span class="ot">=</span><span class="dv">12</span><span class="co">, </span><span class="at">labeldistance</span><span class="ot">=</span><span class="dv">2.0</span><span class="co">, </span><span class="at">labelangle</span><span class="ot">=</span><span class="co">-</span><span class="dv">90</span><span class="ot">]</span></span>
<span id="cb10-1568"><a href="#cb10-1568" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">I</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">R</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"γ"</span><span class="co">,  </span><span class="at">labelfontsize</span><span class="ot">=</span><span class="dv">12</span><span class="co">, </span><span class="at">labeldistance</span><span class="ot">=</span><span class="dv">2.0</span><span class="co">, </span><span class="at">labelangle</span><span class="ot">=</span><span class="co">-</span><span class="dv">90</span><span class="ot">]</span></span>
<span id="cb10-1569"><a href="#cb10-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1570"><a href="#cb10-1570" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">S</span><span class="co">:</span><span class="va">s</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">bottomS</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"  μ"</span><span class="ot">];</span></span>
<span id="cb10-1571"><a href="#cb10-1571" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">I</span><span class="co">:</span><span class="va">s</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">bottomI</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"  μ"</span><span class="ot">];</span></span>
<span id="cb10-1572"><a href="#cb10-1572" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="va">R</span><span class="co">:</span><span class="va">s</span><span class="co"> </span><span class="ot">-&gt;</span><span class="co"> </span><span class="va">bottomR</span><span class="co"> </span><span class="ot">[</span><span class="at">label</span><span class="ot">=</span><span class="st">"  μ"</span><span class="ot">];</span></span>
<span id="cb10-1573"><a href="#cb10-1573" aria-hidden="true" tabindex="-1"></a><span class="ot">}</span></span>
<span id="cb10-1574"><a href="#cb10-1574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-1575"><a href="#cb10-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1576"><a href="#cb10-1576" aria-hidden="true" tabindex="-1"></a>From this flowchart, we can deduce the following equations for the number of people in each compartment according to the endemic SIR model:</span>
<span id="cb10-1577"><a href="#cb10-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1578"><a href="#cb10-1578" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1579"><a href="#cb10-1579" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1580"><a href="#cb10-1580" aria-hidden="true" tabindex="-1"></a>\frac{dS}{dt} &amp;= \mu-\beta \tilde{I} S - \mu S <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1581"><a href="#cb10-1581" aria-hidden="true" tabindex="-1"></a>\frac{dI}{dt} &amp;= \beta \tilde{I} S - \gamma I - \mu I<span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1582"><a href="#cb10-1582" aria-hidden="true" tabindex="-1"></a>\frac{dR}{dt} &amp;= \gamma I - \mu R</span>
<span id="cb10-1583"><a href="#cb10-1583" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1584"><a href="#cb10-1584" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1585"><a href="#cb10-1585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1586"><a href="#cb10-1586" aria-hidden="true" tabindex="-1"></a>And just like before, we can divide every equation above by the constant population size $N$ to obtain the following equations for the proportion of individuals in each compartment:</span>
<span id="cb10-1587"><a href="#cb10-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1588"><a href="#cb10-1588" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1589"><a href="#cb10-1589" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1590"><a href="#cb10-1590" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{S}}{dt} &amp;= \mu-\beta \tilde{I} \tilde{S} - \mu \tilde{S} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1591"><a href="#cb10-1591" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{I}}{dt} &amp;= \beta \tilde{I} \tilde{S} - \gamma \tilde{I} - \mu \tilde{I}<span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1592"><a href="#cb10-1592" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{R}}{dt} &amp;= \gamma \tilde{I} - \mu \tilde{R}</span>
<span id="cb10-1593"><a href="#cb10-1593" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1594"><a href="#cb10-1594" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1595"><a href="#cb10-1595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1596"><a href="#cb10-1596" aria-hidden="true" tabindex="-1"></a>Notice that the force of infection for the endemic model is the same as the epidemic model ($\lambda=\beta \tilde{I}$).</span>
<span id="cb10-1597"><a href="#cb10-1597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1598"><a href="#cb10-1598" aria-hidden="true" tabindex="-1"></a>The following sections are mostly reviews of concepts covered previously in the epidemic model. For this reason, they are mostly short sections but do cover important distinctions between the epidemic and endemic model, including how their reproduction numbers are calculated and how to solve them using <span class="in">`rk4sys`</span> just to name a few.</span>
<span id="cb10-1599"><a href="#cb10-1599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1600"><a href="#cb10-1600" aria-hidden="true" tabindex="-1"></a><span class="fu">## Formulating the Death Rate</span></span>
<span id="cb10-1601"><a href="#cb10-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1602"><a href="#cb10-1602" aria-hidden="true" tabindex="-1"></a>Similar to how the recovery rate is formulated as simply the reciprocal of the average duration of infection $d$ (see <span class="co">[</span><span class="ot">Section @sec-formulating-the-recovery-rate</span><span class="co">]</span>), the birth / death rate is often calculated as the reciprocal of the average host lifespan (i.e. the average age to which individuals in the population survive) <span class="co">[</span><span class="ot">@keeling_modeling_2008</span><span class="co">]</span>.</span>
<span id="cb10-1603"><a href="#cb10-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1604"><a href="#cb10-1604" aria-hidden="true" tabindex="-1"></a>The average host lifespan, like the average duration of infection, is often obtained from past literature. </span>
<span id="cb10-1605"><a href="#cb10-1605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1606"><a href="#cb10-1606" aria-hidden="true" tabindex="-1"></a><span class="fu">## Solving the Endemic SIR Model - Example</span></span>
<span id="cb10-1607"><a href="#cb10-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1608"><a href="#cb10-1608" aria-hidden="true" tabindex="-1"></a>The endemic SIR model can be solved using many of the same methods as the epidemic SIR model. In <span class="co">[</span><span class="ot">Section @sec-solving-sir-equations</span><span class="co">]</span> on solving the epidemic SIR model, we covered two main methods of doing so: Euler's method and the function <span class="in">`rk4sys`</span> in the <span class="in">`pracma`</span> package in R.</span>
<span id="cb10-1609"><a href="#cb10-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1610"><a href="#cb10-1610" aria-hidden="true" tabindex="-1"></a>Both of these methods can be used to solve the endemic model as well, but we will only show an example of solving the endemic model using <span class="in">`rk4sys`</span> since Euler's method is quite lengthy and is the exact same process as for the epidemic model just with different SIR equations.</span>
<span id="cb10-1611"><a href="#cb10-1611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1612"><a href="#cb10-1612" aria-hidden="true" tabindex="-1"></a>Below is a complete example of using <span class="in">`rk4sys`</span> to solve an endemic SIR model and plot the results:</span>
<span id="cb10-1613"><a href="#cb10-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1614"><a href="#cb10-1614" aria-hidden="true" tabindex="-1"></a>**Step 1: Find solutions to the SIR model using `rk4sys`.**</span>
<span id="cb10-1615"><a href="#cb10-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1618"><a href="#cb10-1618" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-1619"><a href="#cb10-1619" aria-hidden="true" tabindex="-1"></a><span class="in">library(pracma)</span></span>
<span id="cb10-1620"><a href="#cb10-1620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1621"><a href="#cb10-1621" aria-hidden="true" tabindex="-1"></a><span class="in">ModelFunc &lt;- function(time,state){</span></span>
<span id="cb10-1622"><a href="#cb10-1622" aria-hidden="true" tabindex="-1"></a><span class="in">  # Extracting the state variables</span></span>
<span id="cb10-1623"><a href="#cb10-1623" aria-hidden="true" tabindex="-1"></a><span class="in">  # Same compartments as before: susceptible, infectious, and recovered (S,I,R)</span></span>
<span id="cb10-1624"><a href="#cb10-1624" aria-hidden="true" tabindex="-1"></a><span class="in">  S &lt;- state[1]</span></span>
<span id="cb10-1625"><a href="#cb10-1625" aria-hidden="true" tabindex="-1"></a><span class="in">  I &lt;- state[2]</span></span>
<span id="cb10-1626"><a href="#cb10-1626" aria-hidden="true" tabindex="-1"></a><span class="in">  R &lt;- state[3]</span></span>
<span id="cb10-1627"><a href="#cb10-1627" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-1628"><a href="#cb10-1628" aria-hidden="true" tabindex="-1"></a><span class="in">  # Specifying the model parameters</span></span>
<span id="cb10-1629"><a href="#cb10-1629" aria-hidden="true" tabindex="-1"></a><span class="in">  # We now have three parameters - the transmission, recovery, and mortality rate</span></span>
<span id="cb10-1630"><a href="#cb10-1630" aria-hidden="true" tabindex="-1"></a><span class="in">  # These parameters will change depending on the model</span></span>
<span id="cb10-1631"><a href="#cb10-1631" aria-hidden="true" tabindex="-1"></a><span class="in">  beta &lt;- 1.5</span></span>
<span id="cb10-1632"><a href="#cb10-1632" aria-hidden="true" tabindex="-1"></a><span class="in">  gamma &lt;- 0.3</span></span>
<span id="cb10-1633"><a href="#cb10-1633" aria-hidden="true" tabindex="-1"></a><span class="in">  mu &lt;- 0.2</span></span>
<span id="cb10-1634"><a href="#cb10-1634" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-1635"><a href="#cb10-1635" aria-hidden="true" tabindex="-1"></a><span class="in">  # Constructing our SIR model equations</span></span>
<span id="cb10-1636"><a href="#cb10-1636" aria-hidden="true" tabindex="-1"></a><span class="in">  dS &lt;- mu - (beta*I*S) - mu*S</span></span>
<span id="cb10-1637"><a href="#cb10-1637" aria-hidden="true" tabindex="-1"></a><span class="in">  dI &lt;- (beta*I*S) - (gamma*I) - mu*I</span></span>
<span id="cb10-1638"><a href="#cb10-1638" aria-hidden="true" tabindex="-1"></a><span class="in">  dR &lt;- (gamma*I) - mu*R</span></span>
<span id="cb10-1639"><a href="#cb10-1639" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb10-1640"><a href="#cb10-1640" aria-hidden="true" tabindex="-1"></a><span class="in">  # Now we will return those model equations as a vector</span></span>
<span id="cb10-1641"><a href="#cb10-1641" aria-hidden="true" tabindex="-1"></a><span class="in">  return(c(dS,dI,dR))</span></span>
<span id="cb10-1642"><a href="#cb10-1642" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-1643"><a href="#cb10-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1644"><a href="#cb10-1644" aria-hidden="true" tabindex="-1"></a><span class="in"># Start and ending points of the solution interval</span></span>
<span id="cb10-1645"><a href="#cb10-1645" aria-hidden="true" tabindex="-1"></a><span class="in">start &lt;- 0</span></span>
<span id="cb10-1646"><a href="#cb10-1646" aria-hidden="true" tabindex="-1"></a><span class="in">end &lt;- 25</span></span>
<span id="cb10-1647"><a href="#cb10-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1648"><a href="#cb10-1648" aria-hidden="true" tabindex="-1"></a><span class="in"># Initial values to be passed into the parameter y</span></span>
<span id="cb10-1649"><a href="#cb10-1649" aria-hidden="true" tabindex="-1"></a><span class="in">initial_vals &lt;- c(S=0.99,I=0.01,R=0)</span></span>
<span id="cb10-1650"><a href="#cb10-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1651"><a href="#cb10-1651" aria-hidden="true" tabindex="-1"></a><span class="in"># How many steps to take from a to b</span></span>
<span id="cb10-1652"><a href="#cb10-1652" aria-hidden="true" tabindex="-1"></a><span class="in">step_size &lt;- end-start</span></span>
<span id="cb10-1653"><a href="#cb10-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1654"><a href="#cb10-1654" aria-hidden="true" tabindex="-1"></a><span class="in"># Calling rk4sys</span></span>
<span id="cb10-1655"><a href="#cb10-1655" aria-hidden="true" tabindex="-1"></a><span class="in">output &lt;- rk4sys(f=ModelFunc,</span></span>
<span id="cb10-1656"><a href="#cb10-1656" aria-hidden="true" tabindex="-1"></a><span class="in">                 a=start,</span></span>
<span id="cb10-1657"><a href="#cb10-1657" aria-hidden="true" tabindex="-1"></a><span class="in">                 b=end,</span></span>
<span id="cb10-1658"><a href="#cb10-1658" aria-hidden="true" tabindex="-1"></a><span class="in">                 y0=initial_vals,</span></span>
<span id="cb10-1659"><a href="#cb10-1659" aria-hidden="true" tabindex="-1"></a><span class="in">                 n=step_size)</span></span>
<span id="cb10-1660"><a href="#cb10-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1661"><a href="#cb10-1661" aria-hidden="true" tabindex="-1"></a><span class="in"># Converting the output matrix to a data frame and printing it</span></span>
<span id="cb10-1662"><a href="#cb10-1662" aria-hidden="true" tabindex="-1"></a><span class="in">output &lt;- as.data.frame(output)</span></span>
<span id="cb10-1663"><a href="#cb10-1663" aria-hidden="true" tabindex="-1"></a><span class="in">print(output)</span></span>
<span id="cb10-1664"><a href="#cb10-1664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-1665"><a href="#cb10-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1666"><a href="#cb10-1666" aria-hidden="true" tabindex="-1"></a>**Step 2: Plot the results.**</span>
<span id="cb10-1667"><a href="#cb10-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1670"><a href="#cb10-1670" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb10-1671"><a href="#cb10-1671" aria-hidden="true" tabindex="-1"></a><span class="in"># Plotting results</span></span>
<span id="cb10-1672"><a href="#cb10-1672" aria-hidden="true" tabindex="-1"></a><span class="in">times &lt;- output$x</span></span>
<span id="cb10-1673"><a href="#cb10-1673" aria-hidden="true" tabindex="-1"></a><span class="in">S &lt;- output$y.S</span></span>
<span id="cb10-1674"><a href="#cb10-1674" aria-hidden="true" tabindex="-1"></a><span class="in">I &lt;- output$y.I</span></span>
<span id="cb10-1675"><a href="#cb10-1675" aria-hidden="true" tabindex="-1"></a><span class="in">R &lt;- output$y.R</span></span>
<span id="cb10-1676"><a href="#cb10-1676" aria-hidden="true" tabindex="-1"></a><span class="in">beta &lt;- 1.5</span></span>
<span id="cb10-1677"><a href="#cb10-1677" aria-hidden="true" tabindex="-1"></a><span class="in">gamma &lt;- 0.3</span></span>
<span id="cb10-1678"><a href="#cb10-1678" aria-hidden="true" tabindex="-1"></a><span class="in">mu &lt;- 0.2</span></span>
<span id="cb10-1679"><a href="#cb10-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1680"><a href="#cb10-1680" aria-hidden="true" tabindex="-1"></a><span class="in">plot(times, S, type = "l", col = "steelblue", lwd = 2,</span></span>
<span id="cb10-1681"><a href="#cb10-1681" aria-hidden="true" tabindex="-1"></a><span class="in">     ylim = c(0, 1), xlab = "Time", ylab = "Proportion",</span></span>
<span id="cb10-1682"><a href="#cb10-1682" aria-hidden="true" tabindex="-1"></a><span class="in">     main = paste0("SIR Endemic (Runge-Kutta)  |  β=", beta,</span></span>
<span id="cb10-1683"><a href="#cb10-1683" aria-hidden="true" tabindex="-1"></a><span class="in">                   "  γ=", gamma, "  μ=",mu, "  R₀=", round(beta/(gamma+mu), 2)))</span></span>
<span id="cb10-1684"><a href="#cb10-1684" aria-hidden="true" tabindex="-1"></a><span class="in">lines(times, I, col = "firebrick", lwd = 2)</span></span>
<span id="cb10-1685"><a href="#cb10-1685" aria-hidden="true" tabindex="-1"></a><span class="in">lines(times, R, col = "seagreen",  lwd = 2)</span></span>
<span id="cb10-1686"><a href="#cb10-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1687"><a href="#cb10-1687" aria-hidden="true" tabindex="-1"></a><span class="in">legend("right", legend = c("Susceptible", "Infectious", "Recovered"),</span></span>
<span id="cb10-1688"><a href="#cb10-1688" aria-hidden="true" tabindex="-1"></a><span class="in">       col = c("steelblue", "firebrick", "seagreen"), lwd = 2, bty = "n")</span></span>
<span id="cb10-1689"><a href="#cb10-1689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-1690"><a href="#cb10-1690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1691"><a href="#cb10-1691" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-1692"><a href="#cb10-1692" aria-hidden="true" tabindex="-1"></a>Notice that the curves above seem to "even out" after a while? This is a really important distinction between the epidemic and endemic SIR model, and is explained in detail in <span class="co">[</span><span class="ot">Section @sec-dfe-ee</span><span class="co">]</span>. </span>
<span id="cb10-1693"><a href="#cb10-1693" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1694"><a href="#cb10-1694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1695"><a href="#cb10-1695" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reproduction Numbers</span></span>
<span id="cb10-1696"><a href="#cb10-1696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1697"><a href="#cb10-1697" aria-hidden="true" tabindex="-1"></a>The basic and effective reproduction numbers for the endemic SIR model have the same interpretation as they do for the epidemic SIR model. Refer back to <span class="co">[</span><span class="ot">Section @sec-reproduction-numbers</span><span class="co">]</span> on reproduction numbers in the epidemic SIR model if you need a refresher of these definitions. </span>
<span id="cb10-1698"><a href="#cb10-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1699"><a href="#cb10-1699" aria-hidden="true" tabindex="-1"></a>Although they have the same interpretations before, the formulas for the basic and reproductive number are different for the endemic SIR model. </span>
<span id="cb10-1700"><a href="#cb10-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1701"><a href="#cb10-1701" aria-hidden="true" tabindex="-1"></a>First, let's formulate the basic reproductive number $R_0$ for the endemic SIR model. We still utilize $\beta$ as the per-capita transmission rate but instead of considering the average time an individual is infectious to be $\frac{1}{\gamma}$ (like it is for the epidemic SIR model), we consider it to be $\frac{1}{\gamma+\mu}$. On a conceptual level, this is justified because there are now two ways to leave the infectious class: recovery or death. Before in the epidemic model, there was only one way to become noninfectious---through recovery. </span>
<span id="cb10-1702"><a href="#cb10-1702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1703"><a href="#cb10-1703" aria-hidden="true" tabindex="-1"></a>Multiplying the tranmission rate $\beta$ by the average time an individual will stay infectious $\frac{1}{\gamma+\mu}$, we obtain the the basic reproduction number $R_0$ for the epidemic SIR model:</span>
<span id="cb10-1704"><a href="#cb10-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1705"><a href="#cb10-1705" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1706"><a href="#cb10-1706" aria-hidden="true" tabindex="-1"></a>R_0=\frac{\beta}{\gamma+\mu}</span>
<span id="cb10-1707"><a href="#cb10-1707" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1708"><a href="#cb10-1708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1709"><a href="#cb10-1709" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-1710"><a href="#cb10-1710" aria-hidden="true" tabindex="-1"></a>This basic reproduction number for the endemic model is generally similar to, but always smaller than, the basic reproduction number for the epidemic model since the natural morality rate reduces the average time an individual is infectious (we now consider the possibility that individuals can die to natural causes while infectious, thus reducing their "infective potential"). </span>
<span id="cb10-1711"><a href="#cb10-1711" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1712"><a href="#cb10-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1713"><a href="#cb10-1713" aria-hidden="true" tabindex="-1"></a>The effective reproduction number $R_e$ for the endemic model is quite similar to the epidemic model. It is still found by multiplying the basic reproduction number $R_0$ by the proportion of susceptible individuals in the population $\tilde{S}$ like so:</span>
<span id="cb10-1714"><a href="#cb10-1714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1715"><a href="#cb10-1715" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1716"><a href="#cb10-1716" aria-hidden="true" tabindex="-1"></a>R_e=R_0 \tilde{S}=\left(\frac{\beta}{\gamma+\mu} \right) \tilde{S}</span>
<span id="cb10-1717"><a href="#cb10-1717" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1718"><a href="#cb10-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1719"><a href="#cb10-1719" aria-hidden="true" tabindex="-1"></a><span class="fu">## Disease Free and Endemic Equilibrium {#sec-dfe-ee}</span></span>
<span id="cb10-1720"><a href="#cb10-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1721"><a href="#cb10-1721" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb10-1722"><a href="#cb10-1722" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb10-1723"><a href="#cb10-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1724"><a href="#cb10-1724" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define what an equilibrium is the context of a system of differential equations.</span>
<span id="cb10-1725"><a href="#cb10-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1726"><a href="#cb10-1726" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Find the values where the disease-free and endemic equilibrium occur.</span>
<span id="cb10-1727"><a href="#cb10-1727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1728"><a href="#cb10-1728" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Recall when each equilibrium type occurs in relation to R0 and justify it based on the definition of R0.</span>
<span id="cb10-1729"><a href="#cb10-1729" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1730"><a href="#cb10-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1731"><a href="#cb10-1731" aria-hidden="true" tabindex="-1"></a>The inclusion of births in the endemic model means there is a constant "replenishing" of the susceptible population. This allows for the disease to persist in the population in the long-term, unlike the epidemic model which always ends in the disease "dying off." </span>
<span id="cb10-1732"><a href="#cb10-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1733"><a href="#cb10-1733" aria-hidden="true" tabindex="-1"></a>To analyze the long-term behavior of the endemic model, we start by analyzing what the model equations look like at *equilibrium*, or the point when $\frac{dS}{dt}=\frac{dI}{dt}=\frac{dR}{dt}=0$. </span>
<span id="cb10-1734"><a href="#cb10-1734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1735"><a href="#cb10-1735" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-1736"><a href="#cb10-1736" aria-hidden="true" tabindex="-1"></a>It is important to note that equilibrium doesn't mean a lack of individuals flowing between each compartment but rather a *balanced* flow of individuals between each compartment. This means that the same number or proportion of individuals are entering and leaving each compartment at a given time, so the net change in the number or proportion of individuals in each compartment is $0$. </span>
<span id="cb10-1737"><a href="#cb10-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1738"><a href="#cb10-1738" aria-hidden="true" tabindex="-1"></a>We can understand this just by looking at the model equations themselves. Take the susceptible population as an example, dictated by the rate:</span>
<span id="cb10-1739"><a href="#cb10-1739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1740"><a href="#cb10-1740" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1741"><a href="#cb10-1741" aria-hidden="true" tabindex="-1"></a>\frac{dS}{dt} = \mu-\beta \tilde{I} S - \mu S</span>
<span id="cb10-1742"><a href="#cb10-1742" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1743"><a href="#cb10-1743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1744"><a href="#cb10-1744" aria-hidden="true" tabindex="-1"></a>We can see that for $\frac{dS}{dt}$ to be equal to $0$, it is not necessary that $0$ people are entering the susceptible population (i.e. being born) and $0$ people are leaving the susceptible population (i.e. getting infected). It is simply necessary that the flow rate *into* the susceptible population (given by the birth rate term \mu) is the same as the flow rate *out* of the susceptible population (given by the infection term $\beta \tilde{I} S$ and the death rate term $\mu S$). </span>
<span id="cb10-1745"><a href="#cb10-1745" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1746"><a href="#cb10-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1747"><a href="#cb10-1747" aria-hidden="true" tabindex="-1"></a>The equilibrium of a system of differential equations is found by setting each rate of change equal to $0$ and finding the solution(s) of the resulting system:</span>
<span id="cb10-1748"><a href="#cb10-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1749"><a href="#cb10-1749" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1750"><a href="#cb10-1750" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1751"><a href="#cb10-1751" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{S}}{dt} = 0, \quad \frac{d\tilde{I}}{dt} = 0, \quad \frac{d\tilde{R}}{dt} = 0 </span>
<span id="cb10-1752"><a href="#cb10-1752" aria-hidden="true" tabindex="-1"></a>&amp; \quad &amp;&amp; \text{Equilibrium set up} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1753"><a href="#cb10-1753" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{I}}{dt} = \beta \tilde{I} \tilde{S} - \gamma \tilde{I} - \mu \tilde{I} = 0 </span>
<span id="cb10-1754"><a href="#cb10-1754" aria-hidden="true" tabindex="-1"></a>&amp; \quad &amp;&amp; \text{Focus on the infected equation} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1755"><a href="#cb10-1755" aria-hidden="true" tabindex="-1"></a>\tilde{I}(\beta \tilde{S} - \gamma - \mu ) = 0 </span>
<span id="cb10-1756"><a href="#cb10-1756" aria-hidden="true" tabindex="-1"></a>&amp; \quad &amp;&amp; \text{Factor out } \tilde{I} \text{ to solve for equilibrium} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1757"><a href="#cb10-1757" aria-hidden="true" tabindex="-1"></a>\tilde{I}^* = 0 \quad \text{or} \quad \tilde{S}^* = \frac{\gamma + \mu}{\beta}=\frac{1}{R_0}</span>
<span id="cb10-1758"><a href="#cb10-1758" aria-hidden="true" tabindex="-1"></a>&amp; \quad &amp;&amp; \text{Two potential solutions}</span>
<span id="cb10-1759"><a href="#cb10-1759" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1760"><a href="#cb10-1760" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1761"><a href="#cb10-1761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1762"><a href="#cb10-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1763"><a href="#cb10-1763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1764"><a href="#cb10-1764" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-1765"><a href="#cb10-1765" aria-hidden="true" tabindex="-1"></a>Note that above equilibrium system is solved using the endemic model equations for the proportion, not number, of individuals in each compartment. A similar procedure can be replicated to solve for the number of individuals in each compartment at the equilibrium. </span>
<span id="cb10-1766"><a href="#cb10-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1767"><a href="#cb10-1767" aria-hidden="true" tabindex="-1"></a>The values at which the equilibrium occur are often denoted using an asterisk ($*$) above the variable. For consistency and clarity, the values at which the equilibrium occurs for the proportion endemic model will be denoted with $\tilde{S}^*$, $\tilde{I}^*$, and $\tilde{R}^*$. Likewise, the values at which the equilibrium occurs for the number endemic model will be denoted with $S^*$, $I^*$, and $R^*$. </span>
<span id="cb10-1768"><a href="#cb10-1768" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1769"><a href="#cb10-1769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1770"><a href="#cb10-1770" aria-hidden="true" tabindex="-1"></a>Notice that we actually have two possible solutions for the equilibrium, one where $\tilde{I}^*=0$ and another when $\tilde{S}^* = \frac{1}{R_0}$. We can solve for the values of the other variables at these points, starting with when $\tilde{I}^*=0$:</span>
<span id="cb10-1771"><a href="#cb10-1771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1772"><a href="#cb10-1772" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1773"><a href="#cb10-1773" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1774"><a href="#cb10-1774" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{S}}{dt}=\mu - \mu \tilde{S}=0 \implies \tilde{S}^*=1</span>
<span id="cb10-1775"><a href="#cb10-1775" aria-hidden="true" tabindex="-1"></a>&amp; \quad &amp;&amp; \text{Substituting } \tilde{I}=0 \text{ into } \frac{d\tilde{S}}{dt}=0 <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1776"><a href="#cb10-1776" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{R}}{dt}= - \mu \tilde{R} =0 \implies \tilde{R}^*=0</span>
<span id="cb10-1777"><a href="#cb10-1777" aria-hidden="true" tabindex="-1"></a>&amp; \quad &amp;&amp; \text{Substituting } \tilde{I}=0 \text{ into } \frac{d\tilde{R}}{dt}=0 <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1778"><a href="#cb10-1778" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1779"><a href="#cb10-1779" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1780"><a href="#cb10-1780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1781"><a href="#cb10-1781" aria-hidden="true" tabindex="-1"></a>This gives us one set of values where an equilibrium can occur:</span>
<span id="cb10-1782"><a href="#cb10-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1783"><a href="#cb10-1783" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1784"><a href="#cb10-1784" aria-hidden="true" tabindex="-1"></a>(\tilde{S}^*,\tilde{I}^*,\tilde{R}^*)=(1,0,0)</span>
<span id="cb10-1785"><a href="#cb10-1785" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1786"><a href="#cb10-1786" aria-hidden="true" tabindex="-1"></a>The other set of values corresponding to an equilibrium point can be obtained by solving for the values of $\tilde{I}^*$ and $\tilde{R}^*$ when $\tilde{S}^*=\frac{1}{R_0}$:</span>
<span id="cb10-1787"><a href="#cb10-1787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1788"><a href="#cb10-1788" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1789"><a href="#cb10-1789" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1790"><a href="#cb10-1790" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{S}}{dt}=\mu - \beta \tilde{I} \left(\frac{1}{R_0} \right) -\mu \tilde{S}=0 \implies \tilde{I}^*=\frac{\mu}{\beta}(R_0-1)</span>
<span id="cb10-1791"><a href="#cb10-1791" aria-hidden="true" tabindex="-1"></a>&amp; \quad &amp;&amp; \text{Substituting } \tilde{S}=\frac{1}{R_0} \text{ into } \frac{d\tilde{S}}{dt}=0 <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1792"><a href="#cb10-1792" aria-hidden="true" tabindex="-1"></a>\tilde{S}+\tilde{I}+\tilde{R}=1 \implies \tilde{R}^*=1-\frac{1}{R_0}-\frac{\mu}{\beta}(R_0-1)</span>
<span id="cb10-1793"><a href="#cb10-1793" aria-hidden="true" tabindex="-1"></a>&amp; \quad &amp;&amp; \text{Using total population equation}<span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1794"><a href="#cb10-1794" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1795"><a href="#cb10-1795" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1796"><a href="#cb10-1796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1797"><a href="#cb10-1797" aria-hidden="true" tabindex="-1"></a>Now we have both sets of values where an equilibrium occurs:</span>
<span id="cb10-1798"><a href="#cb10-1798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1799"><a href="#cb10-1799" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1800"><a href="#cb10-1800" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb10-1801"><a href="#cb10-1801" aria-hidden="true" tabindex="-1"></a>(\tilde{S}^*,\tilde{I}^*,\tilde{R}^*) &amp;= (1,0,0) <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb10-1802"><a href="#cb10-1802" aria-hidden="true" tabindex="-1"></a>(\tilde{S}^*,\tilde{I}^*,\tilde{R}^*) &amp;= \left(\frac{1}{R_0}, \frac{\mu}{\beta}(R_0-1), 1 - \frac{1}{R_0} - \frac{\mu}{\beta}(R_0-1)\right)</span>
<span id="cb10-1803"><a href="#cb10-1803" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb10-1804"><a href="#cb10-1804" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1805"><a href="#cb10-1805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1806"><a href="#cb10-1806" aria-hidden="true" tabindex="-1"></a>Each of these two sets of values correspond to their own equilibrium points which have their own special names, summarized in the table below:</span>
<span id="cb10-1807"><a href="#cb10-1807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1808"><a href="#cb10-1808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1809"><a href="#cb10-1809" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Name** | **$(\tilde{S}^*,\tilde{I}^*,\tilde{R}^*)$** | **What Is Happening At This Point?** <span class="pp">|</span></span>
<span id="cb10-1810"><a href="#cb10-1810" aria-hidden="true" tabindex="-1"></a><span class="pp">|-------------|-------------|-----------------------------------------------|</span></span>
<span id="cb10-1811"><a href="#cb10-1811" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Disease-Free Equilibrium <span class="pp">|</span> $(1,0,0)$ <span class="pp">|</span> A stable point wherein the the disease has completely left the population and all recovered individuals have died due to natural causes. It can be interpreted as a population "untouched" by the disease. <span class="pp">|</span></span>
<span id="cb10-1812"><a href="#cb10-1812" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Endemic Equilibrium <span class="pp">|</span> $\left(\frac{1}{R_0}, \frac{\mu}{\beta}(R_0-1), 1 - \frac{1}{R_0} - \frac{\mu}{\beta}(R_0-1)\right)$ <span class="pp">|</span> A stable point wherein the disease has established itself in the population and become *endemic*. A disease is endemic when "it is consistently present but limited to a particular region," which in the case of the endemic SIR model is our particular region of study <span class="co">[</span><span class="ot">@endemic_article</span><span class="co">]</span>. <span class="pp">|</span></span>
<span id="cb10-1813"><a href="#cb10-1813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1814"><a href="#cb10-1814" aria-hidden="true" tabindex="-1"></a>The next question that arises is when do these equilibrium points occur? The answer lies in the value of $R_0$: the endemic equilibrium is *asymptotically stable* when $R_0&gt;1$, otherwise if $R_0\leq1$ then the disease-free equilibrium is stable. </span>
<span id="cb10-1815"><a href="#cb10-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1816"><a href="#cb10-1816" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb10-1817"><a href="#cb10-1817" aria-hidden="true" tabindex="-1"></a>The stability of model systems can be a difficult concept to grasp, but in general we can think of the above statement as saying that when $R_0\leq 1$ or the initial proportion of infected individuals equals 0, all valid solution paths (solutions which exist for all positive time and are unique) approach the disease-free equilibrium given by $(\tilde{S}^*,\tilde{I}^*,\tilde{R}^*)=(1,0,0)$. Similarly, when $R_0&gt;1$, all valid solution paths with an initial proportion of infected individuals greater than $0$ will approach the endemic equilibrium <span class="co">[</span><span class="ot">@hethcote_math_infection</span><span class="co">]</span>.</span>
<span id="cb10-1818"><a href="#cb10-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1819"><a href="#cb10-1819" aria-hidden="true" tabindex="-1"></a>This makes sense intuitively, as if $R_0\leq1$ the pathogen can't invade the population since every new infectious individual would only, on average, pass on the disease to one or fewer hosts. Eventually the chain of transmission would break and the disease-free equilibrium  would be approached asymptotically (over time). </span>
<span id="cb10-1820"><a href="#cb10-1820" aria-hidden="true" tabindex="-1"></a>Likewise, if $R_0&gt;1$ the pathogen can invade the population with even just the smallest introduction of infectious individuals since they will successively infect more people (who will then infect more even more people, etc.). The chain of transmission will not break either like it does in the epidemic SIR model since the population of susceptibles is constantly being "replenished" via new births, so the disease-free equilibrium is approached asymptotically. </span>
<span id="cb10-1821"><a href="#cb10-1821" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1822"><a href="#cb10-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1823"><a href="#cb10-1823" aria-hidden="true" tabindex="-1"></a>The simulation below lets you see which equilibrium will be approached for different values of $R_0$ and initial proportion of infected individuals:</span>
<span id="cb10-1824"><a href="#cb10-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1825"><a href="#cb10-1825" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">iframe</span><span class="ot"> src</span><span class="op">=</span><span class="st">"http://127.0.0.1:4569"</span></span>
<span id="cb10-1826"><a href="#cb10-1826" aria-hidden="true" tabindex="-1"></a><span class="ot">        width</span><span class="op">=</span><span class="st">"100%"</span></span>
<span id="cb10-1827"><a href="#cb10-1827" aria-hidden="true" tabindex="-1"></a><span class="ot">        height</span><span class="op">=</span><span class="st">"700"</span></span>
<span id="cb10-1828"><a href="#cb10-1828" aria-hidden="true" tabindex="-1"></a><span class="ot">        style</span><span class="op">=</span><span class="st">"border:none;"</span><span class="dt">&gt;&lt;/</span><span class="kw">iframe</span><span class="dt">&gt;</span></span>
<span id="cb10-1829"><a href="#cb10-1829" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb10-1830"><a href="#cb10-1830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1831"><a href="#cb10-1831" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb10-1832"><a href="#cb10-1832" aria-hidden="true" tabindex="-1"></a>Try setting the transmission rate to $1$, the recovery rate to $0.7$, and the birth / death rate to $0.4$. Notice that under these model parameters, the basic reproduction number $R_0$ is barely under $1$ ($R_0\approx0.909$). Now try changing the initial proportion of infected individuals and observe what happens to the SIR curves over time. Even for an initial infected proportion of $1$ (at the start everyone is infected), the curves still approach the disease-free equilibrium as expected! </span>
<span id="cb10-1833"><a href="#cb10-1833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1834"><a href="#cb10-1834" aria-hidden="true" tabindex="-1"></a>Now try setting the parameters to result in $R_0&gt;1$ and observe the proportion of susceptible, infected, and recovered individuals as time progresses (you can see the exact proportions by hovering over each curve). Do these line up exactly with values at the endemic equilibrium point calculated before? </span>
<span id="cb10-1835"><a href="#cb10-1835" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-1836"><a href="#cb10-1836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1837"><a href="#cb10-1837" aria-hidden="true" tabindex="-1"></a>ASK JAVI: SHOULD ADD SECTION EXPLAINING USEFULNESS OF EQUILIBRIUM POINTS? CAN WE FIND ANY GOOD APPLICATION QUESTIONS FOR THEM?</span>
<span id="cb10-1838"><a href="#cb10-1838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1839"><a href="#cb10-1839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1840"><a href="#cb10-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1841"><a href="#cb10-1841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1842"><a href="#cb10-1842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1843"><a href="#cb10-1843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1844"><a href="#cb10-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1845"><a href="#cb10-1845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1846"><a href="#cb10-1846" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>