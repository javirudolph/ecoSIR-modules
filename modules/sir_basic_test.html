<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Computational Thinking with SIR Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="sir_basic_test_files/libs/clipboard/clipboard.min.js"></script>
<script src="sir_basic_test_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="sir_basic_test_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="sir_basic_test_files/libs/quarto-html/popper.min.js"></script>
<script src="sir_basic_test_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="sir_basic_test_files/libs/quarto-html/anchor.min.js"></script>
<link href="sir_basic_test_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sir_basic_test_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="sir_basic_test_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="sir_basic_test_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="sir_basic_test_files/libs/bootstrap/bootstrap-813c323200a87c37e262811031999de4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="sir_basic_test_files/libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="sir_basic_test_files/libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<script type="module" src="sir_basic_test_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="sir_basic_test_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#about-this-module" id="toc-about-this-module" class="nav-link active" data-scroll-target="#about-this-module">About This Module</a></li>
  <li><a href="#part-i-the-biology-before-the-math" id="toc-part-i-the-biology-before-the-math" class="nav-link" data-scroll-target="#part-i-the-biology-before-the-math">Part I: The Biology Before the Math</a>
  <ul class="collapse">
  <li><a href="#epidemiology-terms" id="toc-epidemiology-terms" class="nav-link" data-scroll-target="#epidemiology-terms">Epidemiology Terms</a></li>
  <li><a href="#introducing-compartmental-models" id="toc-introducing-compartmental-models" class="nav-link" data-scroll-target="#introducing-compartmental-models">Introducing Compartmental Models</a></li>
  </ul></li>
  <li><a href="#part-ii-building-the-sir-model" id="toc-part-ii-building-the-sir-model" class="nav-link" data-scroll-target="#part-ii-building-the-sir-model">Part II: Building the SIR Model</a>
  <ul class="collapse">
  <li><a href="#the-classic-sir-epidemic-model" id="toc-the-classic-sir-epidemic-model" class="nav-link" data-scroll-target="#the-classic-sir-epidemic-model">The Classic SIR Epidemic Model</a></li>
  <li><a href="#formulating-the-force-of-infection" id="toc-formulating-the-force-of-infection" class="nav-link" data-scroll-target="#formulating-the-force-of-infection">Formulating the Force of Infection</a></li>
  </ul></li>
  <li><a href="#part-iii-from-equations-to-code" id="toc-part-iii-from-equations-to-code" class="nav-link" data-scroll-target="#part-iii-from-equations-to-code">Part III: From Equations to Code</a>
  <ul class="collapse">
  <li><a href="#eulers-method" id="toc-eulers-method" class="nav-link" data-scroll-target="#eulers-method">Euler Method: Building the Model from Scratch</a></li>
  </ul></li>
  <li><a href="#conclusion-what-computational-thinking-gets-you" id="toc-conclusion-what-computational-thinking-gets-you" class="nav-link" data-scroll-target="#conclusion-what-computational-thinking-gets-you">Conclusion: What Computational Thinking Gets You</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Computational Thinking with SIR Models</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">A Disease Ecology Module</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="about-this-module" class="level2">
<h2 class="anchored" data-anchor-id="about-this-module">About This Module</h2>
<p>Mathematical models of disease have been around for over a century, and by now there is no shortage of resources explaining the SIR model. So why another one?</p>
<p>This module is different in one specific way: <strong>the goal is not just to understand the SIR model, but to understand how code translates biological ideas into computable form.</strong> This is computational thinking: the practice of structuring a problem so that a computer can help you explore it. It is a skill that belongs to biologists and ecologists just as much as it belongs to computer scientists.</p>
<p>By the end of this module, you should be able to:</p>
<ul>
<li>Read an SIR model equation and immediately identify its biological meaning</li>
<li>Translate that equation into working R code, line by line</li>
<li>Modify that code to explore how the system changes under different conditions</li>
<li>Recognize what assumptions are “baked in” to both the math and the code</li>
<li>Start thinking about real disease ecology problems from a computational perspective</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled" title="How to use this module">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How to use this module
</div>
</div>
<div class="callout-body-container callout-body">
<p>Throughout this document, you will encounter <strong>interactive code blocks</strong>, these are live R sessions running directly in your browser. You do not need R installed. You are encouraged to <strong>change the numbers, re-run the code, and see what happens.</strong> That interaction is the point. Reading the math and reading the code together is how computational literacy develops.</p>
</div>
</div>
<hr>
</section>
<section id="part-i-the-biology-before-the-math" class="level2">
<h2 class="anchored" data-anchor-id="part-i-the-biology-before-the-math">Part I: The Biology Before the Math</h2>
<section id="epidemiology-terms" class="level3">
<h3 class="anchored" data-anchor-id="epidemiology-terms">Epidemiology Terms</h3>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li>Define basic terms in epidemiology and connect them to the compartments they represent in a model.</li>
</ul>
</div>
</div>
<p>For the purposes of mathematical models in epidemiology, individuals are classified based on their ability to transmit a pathogen — not on whether they feel sick. This distinction matters: a person can be infectious before they show symptoms, and can still feel sick after they are no longer infectious.</p>
<p>The four primary categories used in SIR-type models are:</p>
<ul>
<li><strong>Susceptible:</strong> No pathogen is present. The individual can become infected if exposed.</li>
<li><strong>Exposed:</strong> The individual has encountered an infected individual and has been infected, but pathogen levels are too low to allow transmission. This individual is infected but not yet infectious.</li>
<li><strong>Infectious:</strong> Pathogen levels are high enough that this individual can actively transmit the disease to others.</li>
<li><strong>Recovered:</strong> The individual’s immune system has cleared enough of the pathogen that transmission is no longer possible. They may still feel ill, but they cannot spread the disease.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The “recovered” compartment is sometimes better thought of as “removed from transmission”, as individuals are no longer infectious, regardless of whether they feel better.</p>
</div>
</div>
<p>Overlapping with these compartments, individuals can also be described by their clinical status:</p>
<ul>
<li><strong>Incubation period:</strong> Infected but not yet showing symptoms. An individual can be in the infectious compartment while still in the incubation period — this is the basis of asymptomatic transmission.</li>
<li><strong>Diseased period:</strong> Showing symptoms. An individual can still be in the recovered compartment (non-infectious) while experiencing lingering symptoms.</li>
</ul>
<p><em>(Diagram of compartments and clinical periods to be added here)</em></p>
<p><strong>Section References:</strong> <span class="citation" data-cites="keeling_modeling_2008">@keeling_modeling_2008</span></p>
<hr>
</section>
<section id="introducing-compartmental-models" class="level3">
<h3 class="anchored" data-anchor-id="introducing-compartmental-models">Introducing Compartmental Models</h3>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li>Define what a compartmental model is and explain why it is useful.</li>
<li>Identify the flow rates between compartments in a model diagram.</li>
</ul>
</div>
</div>
<p>Compartmental models describe how individuals move between defined states, called <strong>compartments</strong>, over time. The movement between compartments is governed by <strong>flow rates</strong>, which tell us how fast individuals transition from one state to another. The relationships between compartments are typically shown in a flowchart, where arrows represent transitions and symbols above each arrow represent the rate of that transition.</p>
<p>Think of it like water flowing between tanks: each tank is a compartment, and the pipes between them (with their valves set to specific flow rates) determine the dynamics. The question a compartmental model answers is: <em>given how full each tank is right now and how fast the valves are set, what will the water levels look like in an hour? In a day? In a year?</em></p>
<p>In disease ecology, the “tanks” are the susceptible, exposed, infectious, and recovered populations. The “valves” are biological rates: transmission rates, recovery rates, mortality rates, that we estimate from field data or laboratory studies.</p>
<p>Which compartments we include depends on the biology. Models where the exposed period is negligibly short are called <strong>SIR models</strong> — susceptible, infectious, recovered — because we can skip the exposed compartment. This module focuses on the SIR model as the foundational case.</p>
<div class="callout callout-style-default callout-note callout-titled" title="A note on terminology">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A note on terminology
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some sources use “SIR model” to refer to any compartmental epidemiological model. Here we use it specifically to mean the three-compartment model with only S, I, and R. We use “SIR-type models” for the broader family.</p>
</div>
</div>
<p><strong>Learning check:</strong> Given the compartment labels in the acronyms below, try sketching the flowcharts for: SIS, SIRS, SEIR. What biological situations would each one represent?</p>
<p><strong>Section References:</strong> <span class="citation" data-cites="keeling_modeling_2008">@keeling_modeling_2008</span></p>
<hr>
</section>
</section>
<section id="part-ii-building-the-sir-model" class="level2">
<h2 class="anchored" data-anchor-id="part-ii-building-the-sir-model">Part II: Building the SIR Model</h2>
<section id="the-classic-sir-epidemic-model" class="level3">
<h3 class="anchored" data-anchor-id="the-classic-sir-epidemic-model">The Classic SIR Epidemic Model</h3>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li>Write out the SIR epidemic model equations and identify each term’s biological meaning.</li>
<li>List the key assumptions of the epidemic model and explain their justifications.</li>
<li>Distinguish between frequency-dependent and density-dependent transmission.</li>
</ul>
</div>
</div>
<p>The <strong>classic SIR epidemic model</strong> makes two core structural assumptions:</p>
<ol type="1">
<li><p><strong>Closed population:</strong> The epidemic moves fast enough that births and deaths are negligible. Population size <span class="math inline">\(N\)</span> is constant. This is the “epidemic” model as opposed to the “endemic” model, which we cover later.</p></li>
<li><p><strong>No exposed period:</strong> We omit the exposed compartment, assuming individuals become immediately infectious upon infection.</p></li>
</ol>
<p>Throughout this module:</p>
<ul>
<li><span class="math inline">\(S\)</span>, <span class="math inline">\(I\)</span>, <span class="math inline">\(R\)</span> = the <strong>number</strong> of individuals in each compartment</li>
<li><span class="math inline">\(\tilde{S} = S/N\)</span>, <span class="math inline">\(\tilde{I} = I/N\)</span>, <span class="math inline">\(\tilde{R} = R/N\)</span> = the <strong>proportion</strong> in each compartment</li>
<li><span class="math inline">\(\tilde{S} + \tilde{I} + \tilde{R} = 1\)</span> always (closed population)</li>
</ul>
<p>The SIR epidemic model equations for <strong>proportions</strong> are:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d\tilde{S}}{dt} &amp;= -\beta \tilde{I} \tilde{S} \\[10pt]
\frac{d\tilde{I}}{dt} &amp;= \beta \tilde{I} \tilde{S} - \gamma \tilde{I} \\[10pt]
\frac{d\tilde{R}}{dt} &amp;= \gamma \tilde{I}
\end{aligned}
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled" title="Reading the equations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reading the equations
</div>
</div>
<div class="callout-body-container callout-body">
<p>Each equation follows the pattern: rate of change = (flow in) − (flow out).</p>
<ul>
<li>Susceptibles <strong>leave</strong> at rate <span class="math inline">\(\beta \tilde{I} \tilde{S}\)</span> (they get infected).</li>
<li>Infecteds <strong>gain</strong> those susceptibles but <strong>lose</strong> individuals at rate <span class="math inline">\(\gamma \tilde{I}\)</span> (they recover).</li>
<li>Recovered individuals only <strong>gain</strong> — no one leaves once recovered (in the epidemic model).</li>
</ul>
<p>The parameters are:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 17%">
<col style="width: 58%">
</colgroup>
<thead>
<tr class="header">
<th>Symbol</th>
<th>Name</th>
<th>Biological meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\beta\)</span></td>
<td>Transmission rate</td>
<td>Rate at which susceptible–infectious contacts lead to new infections</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\gamma\)</span></td>
<td>Recovery rate</td>
<td>Per-capita rate at which infectious individuals recover</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Section References:</strong> <span class="citation" data-cites="keeling_modeling_2008">@keeling_modeling_2008</span></p>
<hr>
</section>
<section id="formulating-the-force-of-infection" class="level3">
<h3 class="anchored" data-anchor-id="formulating-the-force-of-infection">Formulating the Force of Infection</h3>
<p>The <strong>force of infection</strong> <span class="math inline">\(\lambda\)</span> is the per-capita rate at which susceptible individuals become infectious per unit time. Here is one way to derive it from first principles:</p>
<blockquote class="blockquote">
<p>Consider a susceptible individual. They make <span class="math inline">\(c\)</span> contacts per unit time. Of those contacts, a proportion <span class="math inline">\(\tilde{I}\)</span> are infectious. Of those infectious contacts, a proportion <span class="math inline">\(p\)</span> actually result in transmission. So their per-capita rate of becoming infected is:</p>
<p><span class="math display">\[\lambda = c \cdot \tilde{I} \cdot p = \beta \tilde{I}\]</span></p>
<p>where <span class="math inline">\(\beta = cp\)</span> bundles the contact rate and transmission probability into a single parameter.</p>
</blockquote>
<div class="callout callout-style-default callout-note callout-titled" title="Assumptions inside $\beta$">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Assumptions inside <span class="math inline">\(\beta\)</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>This derivation assumes:</p>
<ol type="1">
<li>Every individual contacts others at the same constant rate <span class="math inline">\(c\)</span> (everyone is equally social).</li>
<li><strong>Homogeneous mixing:</strong> every individual is equally likely to contact any other individual.</li>
</ol>
<p>These are significant simplifications. In reality, sick people may isolate, some individuals have far more contacts than others, and spatial structure matters enormously in wildlife systems. The value of the SIR model lies not in its realism but in its tractability, it gives us a baseline to reason from.</p>
</div>
</div>
<p>The force of infection can be formulated in two main ways:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 48%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Approach</th>
<th>How <span class="math inline">\(\beta\)</span> is obtained</th>
<th>Best used when</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Empirical (blackbox)</strong></td>
<td>Fit <span class="math inline">\(\beta\)</span> to real case data</td>
<td>Abundant time-series data are available</td>
</tr>
<tr class="even">
<td><strong>First-principles</strong></td>
<td>Separately estimate <span class="math inline">\(c\)</span> and <span class="math inline">\(p\)</span></td>
<td>Data on contacts and per-contact transmission probability are available</td>
</tr>
</tbody>
</table>
<p>For this module we focus on the empirical approach, where <span class="math inline">\(\beta\)</span> is estimated by fitting model trajectories to observed case data.</p>
<p><em>(Section on parameter estimation to be expanded — link to MLE methods)</em></p>
<hr>
</section>
</section>
<section id="part-iii-from-equations-to-code" class="level2">
<h2 class="anchored" data-anchor-id="part-iii-from-equations-to-code">Part III: From Equations to Code</h2>
<p>This is the core of computational thinking: <strong>each line of code is a direct translation of a mathematical or biological idea.</strong> Nothing in the code is arbitrary. Reading the code and reading the math should feel like reading the same sentence in two different languages.</p>
<section id="eulers-method" class="level3">
<h3 class="anchored" data-anchor-id="eulers-method">Euler Method: Building the Model from Scratch</h3>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you should be able to:</p>
<ul>
<li>Explain what the Euler method is doing conceptually.</li>
<li>Implement the Euler method for the SIR model in R from scratch.</li>
<li>Modify the implementation to explore how step size affects accuracy.</li>
</ul>
</div>
</div>
<p>Before we use a sophisticated solver, we build the model ourselves using the <strong>Euler method</strong>, a simple numerical technique that approximates the continuous ODE solution by taking small discrete steps through time. You can get an overview from <a href="https://en.wikipedia.org/wiki/Euler_method">Wikipedia</a></p>
<p>The intuition: if we know the rate of change at time <span class="math inline">\(t\)</span>, we can estimate the value at time <span class="math inline">\(t + \Delta t\)</span> by stepping forward:</p>
<div class="callout callout-style-default callout-note callout-titled" title="Reading this notation">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reading this notation
</div>
</div>
<div class="callout-body-container callout-body">
<p>The vertical bar ∣t|_t ​t​ means “evaluated at time tt t” — in other words, take this rate of change and compute it using the values of ss s, ii i, and rr r that exist right now, at this specific moment. It is a reminder that the rate of change is not fixed: as the compartments change, so does the rate. Euler’s method freezes that rate at the current step, uses it to nudge the system forward by Δtt Δt, then recalculates. The smaller Δtt Δt is, the less error accumulates from that freezing.</p>
<p>In plain language, each equation is saying: next value = current value + (step size × current rate of change).</p>
</div>
</div>
<p><span class="math display">\[
\begin{aligned}
s_{t+\Delta t} &amp;= s_t + \Delta t \cdot \frac{ds}{dt}\bigg|_t \\[6pt]
i_{t+\Delta t} &amp;= i_t + \Delta t \cdot \frac{di}{dt}\bigg|_t \\[6pt]
r_{t+\Delta t} &amp;= r_t + \Delta t \cdot \frac{dr}{dt}\bigg|_t
\end{aligned}
\]</span></p>
<p>Substituting the SIR equations for <span class="math inline">\(\frac{ds}{dt}\)</span>, <span class="math inline">\(\frac{di}{dt}\)</span>, <span class="math inline">\(\frac{dr}{dt}\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
s_{t+1} &amp;= s_t - \Delta t \cdot \beta i_t s_t \\[10pt]
i_{t+1} &amp;= i_t + \Delta t \cdot (\beta i_t s_t - \gamma i_t) \\[10pt]
r_{t+1} &amp;= r_t + \Delta t \cdot \gamma i_t
\end{aligned}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(s_{t+1}\)</span>, <span class="math inline">\(i_{t+1}\)</span>, and <span class="math inline">\(r_{t+1}\)</span> are the approximations for <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(I(t)\)</span>, and <span class="math inline">\(R(t)\)</span> at the next node</li>
<li><span class="math inline">\(s_{t}\)</span>, <span class="math inline">\(i_{t}\)</span>, and <span class="math inline">\(r_{t}\)</span> are the approximations for <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(I(t)\)</span>, and <span class="math inline">\(R(t)\)</span> at the previous node</li>
<li><span class="math inline">\(\Delta t\)</span> is the step size (how far each node is spaced apart on the <span class="math inline">\(t\)</span>-axis)</li>
<li><span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span> are the transmission and recovery rate, respectively</li>
</ul>
<p>This process can be a little confusing to grasp at first, so let’s do an example.</p>
<p>Suppose the following SIR model equations with initial values <span class="math inline">\(s(0)=99\)</span>, <span class="math inline">\(i(0)=1\)</span>, <span class="math inline">\(r(0)=0\)</span>, transmission rate <span class="math inline">\(\beta=1.5\)</span>, and recovery rate <span class="math inline">\(\gamma=0.5\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dS}{dt} &amp;= -1.5 \tilde{I} S \\[10pt]
\frac{dI}{dt} &amp;= 1.5 \tilde{I} S - 0.5 I \\[10pt]
\frac{dR}{dt} &amp;= 0.5 I
\end{aligned}
\]</span></p>
<p>The following table illustrates the calculation process until <span class="math inline">\(t=5\)</span> with a step size of <span class="math inline">\(\Delta t=1\)</span>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 33%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Time</strong></th>
<th><strong>Approximations</strong></th>
<th><strong>Calculation Process</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(t=0\)</span></td>
<td><span class="math inline">\(s\left(0\right)=99.0\)</span><br><span class="math inline">\(i\left(0\right)=1.0\)</span><br><span class="math inline">\(r\left(0\right)=0.0\)</span></td>
<td>—</td>
</tr>
<tr class="even">
<td><span class="math inline">\(t=1\)</span></td>
<td><span class="math inline">\(s\left(1\right)\approx 97.5\)</span><br><span class="math inline">\(i\left(1\right)\approx 2.0\)</span><br><span class="math inline">\(r\left(1\right)=0.5\)</span></td>
<td><span class="math inline">\(s\left(1\right)=99-\left(1\right)\left(1.5\right)\left(\frac{1}{100}\right)\left(99\right)\)</span><br><span class="math inline">\(i\left(1\right)=1+\left(1\right)\left[\left(1.5\right)\left(\frac{1}{100}\right)\left(99\right)-0.5\left(1\right)\right]\)</span><br><span class="math inline">\(r\left(1\right)=0+\left(1\right)\left(0.5\right)\left(1\right)\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(t=2\)</span></td>
<td><span class="math inline">\(s\left(2\right)\approx 94.6\)</span><br><span class="math inline">\(i\left(2\right)\approx 3.9\)</span><br><span class="math inline">\(r\left(2\right)\approx 2.0\)</span></td>
<td><span class="math inline">\(s\left(2\right)=97.5-\left(1\right)\left(1.5\right)\left(\frac{2.0}{100}\right)\left(97.5\right)\)</span><br><span class="math inline">\(i\left(2\right)=2.0+\left(1\right)\left[\left(1.5\right)\left(\frac{2.0}{100}\right)\left(97.5\right)-0.5\left(2.0\right)\right]\)</span><br><span class="math inline">\(r\left(2\right)=0.5+\left(1\right)\left(0.5\right)\left(2.0\right)\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(t=3\)</span></td>
<td><span class="math inline">\(s\left(3\right)\approx 89.1\)</span><br><span class="math inline">\(i\left(3\right)\approx 7.5\)</span><br><span class="math inline">\(r\left(3\right)\approx 3.4\)</span></td>
<td><span class="math inline">\(s\left(3\right)=94.6-\left(1\right)\left(1.5\right)\left(\frac{3.9}{100}\right)\left(94.6\right)\)</span><br><span class="math inline">\(i\left(3\right)=3.9+\left(1\right)\left[\left(1.5\right)\left(\frac{3.9}{100}\right)\left(94.6\right)-0.5\left(3.9\right)\right]\)</span><br><span class="math inline">\(r\left(3\right)=2.0+\left(1\right)\left(0.5\right)\left(3.9\right)\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(t=4\)</span></td>
<td><span class="math inline">\(s\left(4\right)\approx 79.1\)</span><br><span class="math inline">\(i\left(4\right)\approx 13.7\)</span><br><span class="math inline">\(r\left(4\right)\approx 7.2\)</span></td>
<td><span class="math inline">\(s\left(4\right)=89.1-\left(1\right)\left(1.5\right)\left(\frac{7.5}{100}\right)\left(89.1\right)\)</span><br><span class="math inline">\(i\left(4\right)=7.5+\left(1\right)\left[\left(1.5\right)\left(\frac{7.5}{100}\right)\left(89.1\right)-0.5\left(7.5\right)\right]\)</span><br><span class="math inline">\(r\left(4\right)=3.4+\left(1\right)\left(0.5\right)\left(7.5\right)\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(t=5\)</span></td>
<td><span class="math inline">\(s\left(5\right)\approx 62.8\)</span><br><span class="math inline">\(i\left(5\right)\approx 23.1\)</span><br><span class="math inline">\(r\left(5\right)\approx 14.0\)</span></td>
<td><span class="math inline">\(s\left(5\right)=79.1-\left(1\right)\left(1.5\right)\left(\frac{13.7}{100}\right)\left(79.1\right)\)</span><br><span class="math inline">\(i\left(5\right)=13.7+\left(1\right)\left[\left(1.5\right)\left(\frac{13.7}{100}\right)\left(79.1\right)-0.5\left(13.7\right)\right]\)</span><br><span class="math inline">\(r\left(5\right)=7.2+\left(1\right)\left(0.5\right)\left(13.7\right)\)</span></td>
</tr>
</tbody>
</table>
<p>As you might notice, the calculations above are very tedious, which is why Euler’s method is most often calculated using code rather than by hand.</p>
<p>Let’s see how we can translate these concepts into code.</p>
<hr>
<p><strong>Step 1: Define the biological parameters.</strong></p>
<p>Every model starts with its parameters: the biological quantities that characterize the disease and host system. Here, we have two: how fast the disease spreads (<span class="math inline">\(\beta\)</span>) and how fast individuals recover (<span class="math inline">\(\gamma\)</span>).</p>
<div class="cell">
<div>
<div id="webr-1" class="exercise-cell">

</div>
<script type="webr-1-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBUcmFuc21pc3Npb24gcmF0ZTogY29udGFjdHMgw5cgcHJvYmFiaWxpdHkgb2YgdHJhbnNtaXNzaW9uIHBlciB1bml0IHRpbWVcbmJldGEgPC0gMS41XG5cbiMgUmVjb3ZlcnkgcmF0ZTogMS9nYW1tYSBnaXZlcyB0aGUgYXZlcmFnZSBkdXJhdGlvbiBvZiBpbmZlY3Rpb25cbmdhbW1hIDwtIDAuNVxuXG4jIFdpdGggdGhlc2UgdmFsdWVzLCB0aGUgYXZlcmFnZSBpbmZlY3Rpb3VzIHBlcmlvZCBpczpcbmNhdChcIkF2ZXJhZ2UgaW5mZWN0aW91cyBwZXJpb2Q6XCIsIDEvZ2FtbWEsIFwidGltZSB1bml0c1wiKSJ9
</script>
</div>
</div>
<hr>
<p><strong>Step 2: Set the initial conditions.</strong></p>
<p>Before the model can run, we need to specify where the system starts. In an epidemic model, this means the proportion of the population in each compartment at time zero.</p>
<div class="cell">
<div>
<div id="webr-2" class="exercise-cell">

</div>
<script type="webr-2-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBTdGFydGluZyBwcm9wb3J0aW9ucyDigJQgbXVzdCBzdW0gdG8gMVxuUzAgPC0gMC45OSAgICMgOTklIHN1c2NlcHRpYmxlOiBuZWFybHkgZXZlcnlvbmUgaXMgc3VzY2VwdGlibGUgYXQgdGhlIHN0YXJ0XG5JMCA8LSAwLjAxICAgIyAxJSBpbmZlY3Rpb3VzOiBhIHNtYWxsIFwic3BhcmtcIiBvZiBpbmZlY3Rpb24gZW50ZXJzIHRoZSBwb3B1bGF0aW9uXG5SMF9zdGFydCA8LSAwLjAwICAgIyAwJSByZWNvdmVyZWQ6IG5vIHByaW9yIGltbXVuaXR5XG5cbiMgVmVyaWZ5IHRoZXkgc3VtIHRvIDEgKGEgZ29vZCBzYW5pdHkgY2hlY2sgdG8gYnVpbGQgaW50byB5b3VyIGNvZGUpXG5jYXQoXCJTMCArIEkwICsgUjAgPVwiLCBTMCArIEkwICsgUjBfc3RhcnQsIFwiXFxuXCIpIn0=
</script>
</div>
</div>
<p>This sanity check, confirming that proportions sum to 1 — is a simple example of a habit that will save you debugging time later. When you add more compartments (SEIR, endemic model), this check generalizes naturally.</p>
<hr>
<p><strong>Step 3: Set up the time grid.</strong></p>
<p>Euler’s method steps through time discretely. We need to decide how far apart those steps are (<span class="math inline">\(\Delta t\)</span>, the step size) and how long to simulate.</p>
<div class="cell">
<div>
<div id="webr-3" class="exercise-cell">

</div>
<script type="webr-3-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZHQgICAgPC0gMC4xICAgIyBzdGVwIHNpemUg4oCUIHRyeSBtYWtpbmcgdGhpcyBsYXJnZXIgbGF0ZXIgdG8gc2VlIHdoYXQgYnJlYWtzXG50X2VuZCA8LSA1MCAgICAjIHRvdGFsIHNpbXVsYXRpb24gdGltZVxuXG4jIENyZWF0ZSBhIHZlY3RvciBvZiBhbGwgdGltZSBwb2ludHNcbnRpbWVzICAgPC0gc2VxKDAsIHRfZW5kLCBieSA9IGR0KVxubl9zdGVwcyA8LSBsZW5ndGgodGltZXMpXG5cbmNhdChcIk51bWJlciBvZiB0aW1lIHN0ZXBzOlwiLCBuX3N0ZXBzLCBcIlxcblwiKVxuY2F0KFwiVGltZSBwb2ludHMgcnVuIGZyb21cIiwgdGltZXNbMV0sIFwidG9cIiwgdGltZXNbbl9zdGVwc10sIFwiXFxuXCIpIn0=
</script>
</div>
</div>
<p>The step size is a computational choice, not a biological one, but it affects accuracy. A smaller <span class="math inline">\(\Delta t\)</span> gives a more accurate approximation of the continuous solution, at the cost of more computation. We will explore this tradeoff shortly.</p>
<hr>
<p><strong>Step 4: Pre-allocate storage.</strong></p>
<p>Before running the loop, we create empty vectors to hold the results at each time step. This is more efficient than growing a vector inside the loop.</p>
<div class="cell">
<div>
<div id="webr-4" class="exercise-cell">

</div>
<script type="webr-4-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBFbXB0eSB2ZWN0b3JzOiBvbmUgc2xvdCBwZXIgdGltZSBzdGVwLCBmaWxsZWQgd2l0aCB6ZXJvcyBmb3Igbm93XG5TIDwtIG51bWVyaWMobl9zdGVwcylcbkkgPC0gbnVtZXJpYyhuX3N0ZXBzKVxuUiA8LSBudW1lcmljKG5fc3RlcHMpXG5cbiMgRmlsbCBpbiB0aGUgc3RhcnRpbmcgdmFsdWVzXG5TWzFdIDwtIFMwXG5JWzFdIDwtIEkwXG5SWzFdIDwtIFIwX3N0YXJ0XG5cbmNhdChcIlN0b3JhZ2UgcmVhZHkuIEZpcnN0IHZhbHVlczogUyA9XCIsIFNbMV0sIFwiIEkgPVwiLCBJWzFdLCBcIiBSID1cIiwgUlsxXSwgXCJcXG5cIikifQ==
</script>
</div>
</div>
<p>Think of these vectors as the model’s memory: they store the entire trajectory of the epidemic, one row per time step.</p>
<hr>
<p><strong>Step 5: Run the Euler loop.</strong></p>
<p>This is where the model actually runs. At each time step, we calculate the rates of change using the SIR equations and use them to update the compartment values. Each line in the loop maps directly to an equation.</p>
<div class="cell">
<div>
<div id="webr-5" class="exercise-cell">

</div>
<script type="webr-5-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZm9yICh0IGluIDE6KG5fc3RlcHMgLSAxKSkge1xuXG4gICMgUmF0ZSBvZiBjaGFuZ2U6IHRoZXNlIEFSRSB0aGUgU0lSIGVxdWF0aW9ucywgd3JpdHRlbiBhcyBjb2RlXG4gIGRTIDwtIC1iZXRhICogSVt0XSAqIFNbdF0gICAgICAgICAgICAgICAgICAgICMgbmV3IGluZmVjdGlvbnMgbGVhdmluZyBTXG4gIGRJIDwtICBiZXRhICogSVt0XSAqIFNbdF0gLSBnYW1tYSAqIElbdF0gICAgICMgZ2FpbiBpbmZlY3Rpb25zLCBsb3NlIHJlY292ZXJpZXNcbiAgZFIgPC0gIGdhbW1hICogSVt0XSAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcmVjb3ZlcmllcyBlbnRlcmluZyBSXG5cbiAgIyBTdGVwIGZvcndhcmQ6IGN1cnJlbnQgdmFsdWUgKyAoc3RlcCBzaXplIMOXIHJhdGUgb2YgY2hhbmdlKVxuICBTW3QrMV0gPC0gU1t0XSArIGR0ICogZFNcbiAgSVt0KzFdIDwtIElbdF0gKyBkdCAqIGRJXG4gIFJbdCsxXSA8LSBSW3RdICsgZHQgKiBkUlxufVxuXG4jIFF1aWNrIGNoZWNrOiBkbyB0aGUgY29tcGFydG1lbnRzIHN0aWxsIHN1bSB0byAxIGF0IHRoZSBlbmQ/XG5jYXQoXCJGaW5hbCB2YWx1ZXM6IFMgPVwiLCByb3VuZChTW25fc3RlcHNdLCA0KSxcbiAgICBcIiBJID1cIiwgcm91bmQoSVtuX3N0ZXBzXSwgNCksXG4gICAgXCIgUiA9XCIsIHJvdW5kKFJbbl9zdGVwc10sIDQpLCBcIlxcblwiKVxuY2F0KFwiU3VtOlwiLCByb3VuZChTW25fc3RlcHNdICsgSVtuX3N0ZXBzXSArIFJbbl9zdGVwc10sIDYpLCBcIlxcblwiKSJ9
</script>
</div>
</div>
<p>The loop is doing exactly what the Euler update formulas say, mechanically, one step at a time. This is the computational equivalent of doing the hand calculations from the table shown earlier, just thousands of times faster.</p>
<hr>
<p><strong>Step 6: Visualize the results.</strong></p>
<p>The vectors <code>S</code>, <code>I</code>, and <code>R</code> now hold the full epidemic trajectory. We can plot them against time.</p>
<div class="cell">
<div>
<div id="webr-6" class="exercise-cell">

</div>
<script type="webr-6-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoicGxvdCh0aW1lcywgUywgdHlwZSA9IFwibFwiLCBjb2wgPSBcInN0ZWVsYmx1ZVwiLCBsd2QgPSAyLFxuICAgICB5bGltID0gYygwLCAxKSwgeGxhYiA9IFwiVGltZVwiLCB5bGFiID0gXCJQcm9wb3J0aW9uXCIsXG4gICAgIG1haW4gPSBwYXN0ZTAoXCJTSVIgRXBpZGVtaWMgKEV1bGVyKSAgfCAgzrI9XCIsIGJldGEsXG4gICAgICAgICAgICAgICAgICAgXCIgIM6zPVwiLCBnYW1tYSwgXCIgIFLigoA9XCIsIHJvdW5kKGJldGEvZ2FtbWEsIDIpKSlcbmxpbmVzKHRpbWVzLCBJLCBjb2wgPSBcImZpcmVicmlja1wiLCBsd2QgPSAyKVxubGluZXModGltZXMsIFIsIGNvbCA9IFwic2VhZ3JlZW5cIiwgIGx3ZCA9IDIpXG5sZWdlbmQoXCJyaWdodFwiLCBsZWdlbmQgPSBjKFwiU3VzY2VwdGlibGVcIiwgXCJJbmZlY3Rpb3VzXCIsIFwiUmVjb3ZlcmVkXCIpLFxuICAgICAgIGNvbCA9IGMoXCJzdGVlbGJsdWVcIiwgXCJmaXJlYnJpY2tcIiwgXCJzZWFncmVlblwiKSwgbHdkID0gMiwgYnR5ID0gXCJuXCIpIn0=
</script>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Try this">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try this
</div>
</div>
<div class="callout-body-container callout-body">
<p>Go back to <strong>Step 1</strong> and try the following changes, re-running each step in order:</p>
<ol type="1">
<li>Change <code>gamma &lt;- 0.5</code> to <code>gamma &lt;- 0.2</code>. What does a slower recovery rate do to the epidemic peak?</li>
<li>Change <code>beta &lt;- 1.5</code> to <code>beta &lt;- 0.4</code>. What happens when <span class="math inline">\(\beta &lt; \gamma\)</span>? Can you explain why biologically?</li>
<li>Go back to <strong>Step 3</strong> and change <code>dt &lt;- 0.1</code> to <code>dt &lt;- 2.0</code>. What happens to the curves? This is the cost of a large step size.</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Computational note: why pre-allocate?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Computational note: why pre-allocate?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice that we create <code>S</code>, <code>I</code>, and <code>R</code> as empty vectors before the loop using <code>numeric(n_steps)</code>. This is more efficient than growing a vector inside the loop. In R (and most languages), pre-allocating memory for results is good practice.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="conclusion-what-computational-thinking-gets-you" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-what-computational-thinking-gets-you">Conclusion: What Computational Thinking Gets You</h2>
<p>The SIR model is simple. Three compartments, two parameters, three equations. And yet, working through this module computationally — not just mathematically — you have done something more than learned a model. You have learned to:</p>
<ul>
<li><strong>Decompose</strong> a biological process (disease spread) into computable pieces (state variables, rates, parameters)</li>
<li><strong>Translate</strong> between mathematical notation and code, and recognize they are the same statement in different languages</li>
<li><strong>Interrogate</strong> a model by changing its parameters and watching what changes and what doesn’t</li>
<li><strong>Verify</strong> analytical results numerically, and notice when they agree or diverge</li>
<li><strong>Extend</strong> the framework: the endemic model uses the same structure as the epidemic model, just with added terms. From here, SEIR, SIRS, and host-pathogen models with predators follow the same logic.</li>
</ul>
<p>This is the computational literacy that makes quantitative ecology accessible. The math does not have to be a black box. The code does not have to be a black box either. When both are visible and connected, the biology becomes clearest.</p>
<hr>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" role="list">

</div>
<!-- -->

<script type="webr-data">
eyJvcHRpb25zIjp7ImJhc2VVcmwiOiJodHRwczovL3dlYnIuci13YXNtLm9yZy92MC41LjgvIn0sInBhY2thZ2VzIjp7InBrZ3MiOlsiZXZhbHVhdGUiLCJrbml0ciIsImh0bWx0b29scyJdLCJyZXBvcyI6W119LCJyZW5kZXJfZGYiOiJkZWZhdWx0In0=
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3siY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC02IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV82O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItNiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzYgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici02LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHdlYnItNi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV82ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl82LCB7fSk7XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtNSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfNTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl81ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItNS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTUtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuXG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxuX3dlYnJfdmFsdWVfNSA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfNSwge30pO1xuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzQ7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici00IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfNCA9IHtcbiAgY29uc3QgeyBXZWJSRXhlcmNpc2VFZGl0b3IsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTQtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici00LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzQgPSB3ZWJST2pzLnByb2Nlc3MoX3dlYnJfZWRpdG9yXzQsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0zIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8zO1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzMgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0zLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHdlYnItMy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8zID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8zLCB7fSk7XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMjtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl8yID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMi1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTItY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuXG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxuX3dlYnJfdmFsdWVfMiA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMiwge30pO1xuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzE7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMSA9IHtcbiAgY29uc3QgeyBXZWJSRXhlcmNpc2VFZGl0b3IsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTEtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzEgPSB3ZWJST2pzLnByb2Nlc3MoX3dlYnJfZWRpdG9yXzEsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXByZWx1ZGUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ3ZWJST2pzID0ge1xuICBjb25zdCB7IFdlYlIsIENoYW5uZWxUeXBlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lLldlYlI7XG4gIGNvbnN0IHtcbiAgICBXZWJSRXZhbHVhdG9yLFxuICAgIFdlYlJFbnZpcm9ubWVudE1hbmFnZXIsXG4gICAgc2V0dXBSLFxuICAgIGI2NERlY29kZSxcbiAgICBjb2xsYXBzZVBhdGhcbiAgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc3RhdHVzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleGVyY2lzZS1sb2FkaW5nLXN0YXR1c1wiKTtcbiAgY29uc3QgaW5kaWNhdG9yQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleGVyY2lzZS1sb2FkaW5nLWluZGljYXRvclwiKTtcbiAgaW5kaWNhdG9yQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJkLW5vbmVcIik7XG5cbiAgbGV0IHN0YXR1c1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gIHN0YXR1c1RleHQuY2xhc3NMaXN0ID0gXCJleGVyY2lzZS1sb2FkaW5nLWRldGFpbHNcIjtcbiAgc3RhdHVzVGV4dCA9IHN0YXR1c0NvbnRhaW5lci5hcHBlbmRDaGlsZChzdGF0dXNUZXh0KTtcbiAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBJbml0aWFsaXNlYDtcblxuICAvLyBIb2lzdCBpbmRpY2F0b3Igb3V0IGZyb20gZmluYWwgc2xpZGUgd2hlbiBydW5uaW5nIHVuZGVyIHJldmVhbFxuICBjb25zdCByZXZlYWxTdGF0dXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJldmVhbCAuZXhlcmNpc2UtbG9hZGluZy1pbmRpY2F0b3JcIik7XG4gIGlmIChyZXZlYWxTdGF0dXMpIHtcbiAgICByZXZlYWxTdGF0dXMucmVtb3ZlKCk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZlYWwgPiAuc2xpZGVzXCIpLmFwcGVuZENoaWxkKHJldmVhbFN0YXR1cyk7XG4gIH1cblxuICAvLyBNYWtlIGFueSByZXZlYWwgc2xpZGVzIHdpdGggbGl2ZSBjZWxscyBzY3JvbGxhYmxlXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucmV2ZWFsIC5leGVyY2lzZS1jZWxsXCIpLmZvckVhY2goKGVsKSA9PiB7XG4gICAgZWwuY2xvc2VzdCgnc2VjdGlvbi5zbGlkZScpLmNsYXNzTGlzdC5hZGQoXCJzY3JvbGxhYmxlXCIpO1xuICB9KVxuXG4gIC8vIHdlYlIgc3VwcGxlbWVudGFsIGRhdGEgYW5kIG9wdGlvbnNcbiAgY29uc3QgZGF0YUNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici1kYXRhXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKGRhdGFDb250ZW50KSk7XG5cbiAgLy8gR3JhYiBsaXN0IG9mIHJlc291cmNlcyB0byBiZSBkb3dubG9hZGVkXG4gIGNvbnN0IGZpbGVzQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ2ZnMtZmlsZVxcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGZpbGVzID0gSlNPTi5wYXJzZShiNjREZWNvZGUoZmlsZXNDb250ZW50KSk7XG5cbiAgLy8gSW5pdGlhbGlzZSB3ZWJSIGFuZCBzZXR1cCBmb3IgUiBjb2RlIGV2YWx1YXRpb25cbiAgbGV0IHdlYlJQcm9taXNlID0gKGFzeW5jICh3ZWJSKSA9PiB7XG4gICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyB3ZWJSYDtcbiAgICBhd2FpdCB3ZWJSLmluaXQoKTtcblxuICAgIC8vIEluc3RhbGwgcHJvdmlkZWQgbGlzdCBvZiBwYWNrYWdlc1xuICAgIC8vIEVuc3VyZSB3ZWJSIGRlZmF1bHQgcmVwbyBpcyBpbmNsdWRlZFxuICAgIGRhdGEucGFja2FnZXMucmVwb3MucHVzaChcImh0dHBzOi8vcmVwby5yLXdhc20ub3JnXCIpXG4gICAgYXdhaXQgZGF0YS5wYWNrYWdlcy5wa2dzLm1hcCgocGtnKSA9PiAoKSA9PiB7XG4gICAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHBhY2thZ2U6ICR7cGtnfWA7XG4gICAgICByZXR1cm4gd2ViUi5ldmFsUlZvaWQoYFxuICAgICAgICB3ZWJyOjppbnN0YWxsKHBrZywgcmVwb3MgPSByZXBvcylcbiAgICAgICAgbGlicmFyeShwa2csIGNoYXJhY3Rlci5vbmx5ID0gVFJVRSlcbiAgICAgIGAsIHsgZW52OiB7XG4gICAgICAgIHBrZzogcGtnLFxuICAgICAgICByZXBvczogZGF0YS5wYWNrYWdlcy5yZXBvcyxcbiAgICAgIH19KTtcbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcblxuICAgIC8vIERvd25sb2FkIGFuZCBpbnN0YWxsIHJlc291cmNlc1xuICAgIGF3YWl0IGZpbGVzLm1hcCgoZmlsZSkgPT4gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbmFtZSA9IGZpbGUuc3Vic3RyaW5nKGZpbGUubGFzdEluZGV4T2YoJy8nKSArIDEpO1xuICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyByZXNvdXJjZTogJHtuYW1lfWA7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGZpbGUpO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbid0IGRvd25sb2FkIFxcYCR7ZmlsZX1cXGAuIEVycm9yICR7cmVzcG9uc2Uuc3RhdHVzfTogXCIke3Jlc3BvbnNlLnN0YXR1c1RleHR9XCIuYCk7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTtcblxuICAgICAgLy8gU3RvcmUgVVJMcyBpbiB0aGUgY3dkIHdpdGhvdXQgYW55IHN1YmRpcmVjdG9yeSBzdHJ1Y3R1cmVcbiAgICAgIGlmIChmaWxlLmluY2x1ZGVzKFwiOi8vXCIpKSB7XG4gICAgICAgIGZpbGUgPSBuYW1lO1xuICAgICAgfVxuXG4gICAgICAvLyBDb2xsYXBzZSBoaWdoZXIgZGlyZWN0b3J5IHN0cnVjdHVyZVxuICAgICAgZmlsZSA9IGNvbGxhcHNlUGF0aChmaWxlKTtcblxuICAgICAgLy8gQ3JlYXRlIGRpcmVjdG9yeSB0cmVlLCBpZ25vcmluZyBcImRpcmVjdG9yeSBleGlzdHNcIiBWRlMgZXJyb3JzXG4gICAgICBjb25zdCBwYXJ0cyA9IGZpbGUuc3BsaXQoJy8nKS5zbGljZSgwLCAtMSk7XG4gICAgICBsZXQgcGF0aCA9ICcnO1xuICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcGF0aCArPSBwYXJ0cy5zaGlmdCgpICsgJy8nO1xuICAgICAgICBjb25zdCBhbmFseXNpcyA9IGF3YWl0IHdlYlIuRlMuYW5hbHl6ZVBhdGgocGF0aCk7XG4gICAgICAgIGlmICghYW5hbHlzaXMuZXhpc3RzKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHdlYlIuRlMubWtkaXIocGF0aCk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGaWxlc3lzdGVtIEVycm9yOiBcIiR7ZS5tZXNzYWdlfVwiLmApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBXcml0ZSB0aGlzIGZpbGUgdG8gdGhlIFZGU1xuICAgICAgcmV0dXJuIGF3YWl0IHdlYlIuRlMud3JpdGVGaWxlKGZpbGUsIG5ldyBVaW50OEFycmF5KGRhdGEpKTtcbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcblxuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgSW5zdGFsbGluZyB3ZWJSIHNoaW1zYDtcbiAgICBhd2FpdCB3ZWJSLmV2YWxSVm9pZChgd2Vicjo6c2hpbV9pbnN0YWxsKClgKTtcblxuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgV2ViUiBlbnZpcm9ubWVudCBzZXR1cGA7XG4gICAgYXdhaXQgc2V0dXBSKHdlYlIsIGRhdGEpO1xuXG4gICAgc3RhdHVzVGV4dC5yZW1vdmUoKTtcbiAgICBpZiAoc3RhdHVzQ29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCA9PSAwKSB7XG4gICAgICBzdGF0dXNDb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHdlYlI7XG4gIH0pKG5ldyBXZWJSKGRhdGEub3B0aW9ucykpO1xuXG4gIC8vIEtlZXAgdHJhY2sgb2YgaW5pdGlhbCBPSlMgYmxvY2sgcmVuZGVyXG4gIGNvbnN0IHJlbmRlcmVkT2pzID0ge307XG5cbiAgY29uc3QgcHJvY2VzcyA9IGFzeW5jIChjb250ZXh0LCBpbnB1dHMpID0+IHtcbiAgICBjb25zdCB3ZWJSID0gYXdhaXQgd2ViUlByb21pc2U7XG4gICAgY29uc3QgZXZhbHVhdG9yID0gbmV3IFdlYlJFdmFsdWF0b3Iod2ViUiwgY29udGV4dClcbiAgICBhd2FpdCBldmFsdWF0b3IucHJvY2VzcyhpbnB1dHMpO1xuICAgIHJldHVybiBldmFsdWF0b3IuY29udGFpbmVyO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBwcm9jZXNzLFxuICAgIHdlYlJQcm9taXNlLFxuICAgIHJlbmRlcmVkT2pzLFxuICB9O1xufVxuIn1dfQ==
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script>
</section>

</main>
<!-- /main column -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../..";
window._ojs.paths.runtimeToRoot = "../../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb1" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Computational Thinking with SIR Models"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "A Disease Ecology Module"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">  live-html:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="an">webr:</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># bibliography: ../reference.bib</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>{{&lt; include ./_extensions/r-wasm/live/_knitr.qmd &gt;}}</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## About This Module</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>Mathematical models of disease have been around for over a century, and by now there is no shortage of resources explaining the SIR model. So why another one?</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>This module is different in one specific way: **the goal is not just to understand the SIR model, but to understand how code translates biological ideas into computable form.** This is computational thinking: the practice of structuring a problem so that a computer can help you explore it. It is a skill that belongs to biologists and ecologists just as much as it belongs to computer scientists.</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>By the end of this module, you should be able to:</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Read an SIR model equation and immediately identify its biological meaning</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Translate that equation into working R code, line by line</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modify that code to explore how the system changes under different conditions</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Recognize what assumptions are "baked in" to both the math and the code</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Start thinking about real disease ecology problems from a computational perspective</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>::: {.callout-important title="How to use this module"}</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>Throughout this document, you will encounter **interactive code blocks**, these are live R sessions running directly in your browser. You do not need R installed. You are encouraged to **change the numbers, re-run the code, and see what happens.** That interaction is the point. Reading the math and reading the code together is how computational literacy develops.</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part I: The Biology Before the Math</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="fu">### Epidemiology Terms</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define basic terms in epidemiology and connect them to the compartments they represent in a model.</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>For the purposes of mathematical models in epidemiology, individuals are classified based on their ability to transmit a pathogen — not on whether they feel sick. This distinction matters: a person can be infectious before they show symptoms, and can still feel sick after they are no longer infectious.</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>The four primary categories used in SIR-type models are:</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Susceptible:** No pathogen is present. The individual can become infected if exposed.</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Exposed:** The individual has encountered an infected individual and has been infected, but pathogen levels are too low to allow transmission. This individual is infected but not yet infectious.</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Infectious:** Pathogen levels are high enough that this individual can actively transmit the disease to others.</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Recovered:** The individual's immune system has cleared enough of the pathogen that transmission is no longer possible. They may still feel ill, but they cannot spread the disease.</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>The "recovered" compartment is sometimes better thought of as "removed from transmission", as individuals are no longer infectious, regardless of whether they feel better.</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>Overlapping with these compartments, individuals can also be described by their clinical status:</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Incubation period:** Infected but not yet showing symptoms. An individual can be in the infectious compartment while still in the incubation period — this is the basis of asymptomatic transmission.</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Diseased period:** Showing symptoms. An individual can still be in the recovered compartment (non-infectious) while experiencing lingering symptoms.</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>*(Diagram of compartments and clinical periods to be added here)*</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>**Section References:** @keeling_modeling_2008</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="fu">### Introducing Compartmental Models {#introducing-compartmental-models}</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define what a compartmental model is and explain why it is useful.</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Identify the flow rates between compartments in a model diagram.</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>Compartmental models describe how individuals move between defined states, called **compartments**, over time. The movement between compartments is governed by **flow rates**, which tell us how fast individuals transition from one state to another. The relationships between compartments are typically shown in a flowchart, where arrows represent transitions and symbols above each arrow represent the rate of that transition.</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>Think of it like water flowing between tanks: each tank is a compartment, and the pipes between them (with their valves set to specific flow rates) determine the dynamics. The question a compartmental model answers is: *given how full each tank is right now and how fast the valves are set, what will the water levels look like in an hour? In a day? In a year?*</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>In disease ecology, the "tanks" are the susceptible, exposed, infectious, and recovered populations. The "valves" are biological rates: transmission rates, recovery rates, mortality rates, that we estimate from field data or laboratory studies.</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>Which compartments we include depends on the biology. Models where the exposed period is negligibly short are called **SIR models** — susceptible, infectious, recovered — because we can skip the exposed compartment. This module focuses on the SIR model as the foundational case.</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>::: {.callout-note title="A note on terminology"}</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>Some sources use "SIR model" to refer to any compartmental epidemiological model. Here we use it specifically to mean the three-compartment model with only S, I, and R. We use "SIR-type models" for the broader family.</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>**Learning check:** Given the compartment labels in the acronyms below, try sketching the flowcharts for: SIS, SIRS, SEIR. What biological situations would each one represent?</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>**Section References:** @keeling_modeling_2008</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part II: Building the SIR Model</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Classic SIR Epidemic Model {#the-classic-sir-epidemic-model}</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Write out the SIR epidemic model equations and identify each term's biological meaning.</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>List the key assumptions of the epidemic model and explain their justifications.</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Distinguish between frequency-dependent and density-dependent transmission.</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>The **classic SIR epidemic model** makes two core structural assumptions:</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Closed population:** The epidemic moves fast enough that births and deaths are negligible. Population size $N$ is constant. This is the "epidemic" model as opposed to the "endemic" model, which we cover later.</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**No exposed period:** We omit the exposed compartment, assuming individuals become immediately infectious upon infection.</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>Throughout this module:</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$S$, $I$, $R$ = the **number** of individuals in each compartment</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\tilde{S} = S/N$, $\tilde{I} = I/N$, $\tilde{R} = R/N$ = the **proportion** in each compartment</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\tilde{S} + \tilde{I} + \tilde{R} = 1$ always (closed population)</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>The SIR epidemic model equations for **proportions** are:</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{S}}{dt} &amp;= -\beta \tilde{I} \tilde{S} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{I}}{dt} &amp;= \beta \tilde{I} \tilde{S} - \gamma \tilde{I} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>\frac{d\tilde{R}}{dt} &amp;= \gamma \tilde{I}</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>::: {.callout-note title="Reading the equations"}</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>Each equation follows the pattern: rate of change = (flow in) − (flow out).</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Susceptibles **leave** at rate $\beta \tilde{I} \tilde{S}$ (they get infected).</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Infecteds **gain** those susceptibles but **lose** individuals at rate $\gamma \tilde{I}$ (they recover).</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Recovered individuals only **gain** — no one leaves once recovered (in the epidemic model).</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>The parameters are:</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Symbol <span class="pp">|</span> Name <span class="pp">|</span> Biological meaning <span class="pp">|</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a><span class="pp">|--------|------|--------------------|</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $\beta$ <span class="pp">|</span> Transmission rate <span class="pp">|</span> Rate at which susceptible–infectious contacts lead to new infections <span class="pp">|</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $\gamma$ <span class="pp">|</span> Recovery rate <span class="pp">|</span> Per-capita rate at which infectious individuals recover <span class="pp">|</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>**Section References:** @keeling_modeling_2008</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a><span class="fu">### Formulating the Force of Infection</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>The **force of infection** $\lambda$ is the per-capita rate at which susceptible individuals become infectious per unit time. Here is one way to derive it from first principles:</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Consider a susceptible individual. They make $c$ contacts per unit time. Of those contacts, a proportion $\tilde{I}$ are infectious. Of those infectious contacts, a proportion $p$ actually result in transmission. So their per-capita rate of becoming infected is:</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; $$\lambda = c \cdot \tilde{I} \cdot p = \beta \tilde{I}$$</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; where $\beta = cp$ bundles the contact rate and transmission probability into a single parameter.</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>::: {.callout-note title="Assumptions inside $\beta$"}</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>This derivation assumes:</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Every individual contacts others at the same constant rate $c$ (everyone is equally social).</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Homogeneous mixing:** every individual is equally likely to contact any other individual.</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>These are significant simplifications. In reality, sick people may isolate, some individuals have far more contacts than others, and spatial structure matters enormously in wildlife systems. The value of the SIR model lies not in its realism but in its tractability, it gives us a baseline to reason from.</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>The force of infection can be formulated in two main ways:</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach <span class="pp">|</span> How $\beta$ is obtained <span class="pp">|</span> Best used when <span class="pp">|</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a><span class="pp">|----------|------------------------|----------------|</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Empirical (blackbox)** <span class="pp">|</span> Fit $\beta$ to real case data <span class="pp">|</span> Abundant time-series data are available <span class="pp">|</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **First-principles** <span class="pp">|</span> Separately estimate $c$ and $p$ <span class="pp">|</span> Data on contacts and per-contact transmission probability are available <span class="pp">|</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>For this module we focus on the empirical approach, where $\beta$ is estimated by fitting model trajectories to observed case data.</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>*(Section on parameter estimation to be expanded — link to MLE methods)*</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part III: From Equations to Code</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>This is the core of computational thinking: **each line of code is a direct translation of a mathematical or biological idea.** Nothing in the code is arbitrary. Reading the code and reading the math should feel like reading the same sentence in two different languages.</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a><span class="fu">### Euler Method: Building the Model from Scratch {#eulers-method}</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>By the end of this section, you should be able to:</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain what the Euler method is doing conceptually.</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Implement the Euler method for the SIR model in R from scratch.</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Modify the implementation to explore how step size affects accuracy.</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>Before we use a sophisticated solver, we build the model ourselves using the **Euler method**, a simple numerical technique that approximates the continuous ODE solution by taking small discrete steps through time. You can get an overview from <span class="co">[</span><span class="ot">Wikipedia</span><span class="co">](https://en.wikipedia.org/wiki/Euler_method)</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>The intuition: if we know the rate of change at time $t$, we can estimate the value at time $t + \Delta t$ by stepping forward:</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>::: {.callout-note title="Reading this notation"}</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>The vertical bar ∣t\bigg|_t</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>​t​ means "evaluated at time tt</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>t" — in other words, take this rate of change and compute it using the values of ss</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>s, ii</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>i, and rr</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>r that exist right now, at this specific moment. It is a reminder that the rate of change is not fixed: as the compartments change, so does the rate. Euler's method freezes that rate at the current step, uses it to nudge the system forward by Δt\Delta t</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>Δt, then recalculates. The smaller Δt\Delta t</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>Δt is, the less error accumulates from that freezing.</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>In plain language, each equation is saying: next value = current value + (step size × current rate of change).</span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>s_{t+\Delta t} &amp;= s_t + \Delta t \cdot \frac{ds}{dt}\bigg|_t <span class="sc">\\</span><span class="co">[</span><span class="ot">6pt</span><span class="co">]</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>i_{t+\Delta t} &amp;= i_t + \Delta t \cdot \frac{di}{dt}\bigg|_t <span class="sc">\\</span><span class="co">[</span><span class="ot">6pt</span><span class="co">]</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>r_{t+\Delta t} &amp;= r_t + \Delta t \cdot \frac{dr}{dt}\bigg|_t</span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>Substituting the SIR equations for $\frac{ds}{dt}$, $\frac{di}{dt}$, $\frac{dr}{dt}$:</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>s_{t+1} &amp;= s_t - \Delta t \cdot \beta i_t s_t <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>i_{t+1} &amp;= i_t + \Delta t \cdot (\beta i_t s_t - \gamma i_t) <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>r_{t+1} &amp;= r_t + \Delta t \cdot \gamma i_t</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$s_{t+1}$, $i_{t+1}$, and $r_{t+1}$ are the approximations for $S(t)$, $I(t)$, and $R(t)$ at the next node</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$s_{t}$, $i_{t}$, and $r_{t}$ are the approximations for $S(t)$, $I(t)$, and $R(t)$ at the previous node</span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\Delta t$ is the step size (how far each node is spaced apart on the $t$-axis)</span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\beta$ and $\gamma$ are the transmission and recovery rate, respectively</span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>This process can be a little confusing to grasp at first, so let's do an example.</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>Suppose the following SIR model equations with initial values $s(0)=99$, $i(0)=1$, $r(0)=0$, transmission rate $\beta=1.5$, and recovery rate $\gamma=0.5$:</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>\frac{dS}{dt} &amp;= -1.5 \tilde{I} S <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>\frac{dI}{dt} &amp;= 1.5 \tilde{I} S - 0.5 I <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>\frac{dR}{dt} &amp;= 0.5 I</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>The following table illustrates the calculation process until $t=5$ with a step size of $\Delta t=1$:</span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Time** | **Approximations** | **Calculation Process** <span class="pp">|</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a><span class="pp">|------------------|------------------------|------------------------------|</span></span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=0$ <span class="pp">|</span> $s\left(0\right)=99.0$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(0\right)=1.0$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(0\right)=0.0$ <span class="pp">|</span> — <span class="pp">|</span></span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=1$ <span class="pp">|</span> $s\left(1\right)\approx 97.5$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(1\right)\approx 2.0$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(1\right)=0.5$ <span class="pp">|</span> $s\left(1\right)=99-\left(1\right)\left(1.5\right)\left(\frac{1}{100}\right)\left(99\right)$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(1\right)=1+\left(1\right)\left<span class="co">[</span><span class="ot">\left(1.5\right)\left(\frac{1}{100}\right)\left(99\right)-0.5\left(1\right)\right</span><span class="co">]</span>$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(1\right)=0+\left(1\right)\left(0.5\right)\left(1\right)$ <span class="pp">|</span></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=2$ <span class="pp">|</span> $s\left(2\right)\approx 94.6$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(2\right)\approx 3.9$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(2\right)\approx 2.0$ <span class="pp">|</span> $s\left(2\right)=97.5-\left(1\right)\left(1.5\right)\left(\frac{2.0}{100}\right)\left(97.5\right)$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(2\right)=2.0+\left(1\right)\left<span class="co">[</span><span class="ot">\left(1.5\right)\left(\frac{2.0}{100}\right)\left(97.5\right)-0.5\left(2.0\right)\right</span><span class="co">]</span>$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(2\right)=0.5+\left(1\right)\left(0.5\right)\left(2.0\right)$ <span class="pp">|</span></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=3$ <span class="pp">|</span> $s\left(3\right)\approx 89.1$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(3\right)\approx 7.5$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(3\right)\approx 3.4$ <span class="pp">|</span> $s\left(3\right)=94.6-\left(1\right)\left(1.5\right)\left(\frac{3.9}{100}\right)\left(94.6\right)$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(3\right)=3.9+\left(1\right)\left<span class="co">[</span><span class="ot">\left(1.5\right)\left(\frac{3.9}{100}\right)\left(94.6\right)-0.5\left(3.9\right)\right</span><span class="co">]</span>$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(3\right)=2.0+\left(1\right)\left(0.5\right)\left(3.9\right)$ <span class="pp">|</span></span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=4$ <span class="pp">|</span> $s\left(4\right)\approx 79.1$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(4\right)\approx 13.7$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(4\right)\approx 7.2$ <span class="pp">|</span> $s\left(4\right)=89.1-\left(1\right)\left(1.5\right)\left(\frac{7.5}{100}\right)\left(89.1\right)$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(4\right)=7.5+\left(1\right)\left<span class="co">[</span><span class="ot">\left(1.5\right)\left(\frac{7.5}{100}\right)\left(89.1\right)-0.5\left(7.5\right)\right</span><span class="co">]</span>$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(4\right)=3.4+\left(1\right)\left(0.5\right)\left(7.5\right)$ <span class="pp">|</span></span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> $t=5$ <span class="pp">|</span> $s\left(5\right)\approx 62.8$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(5\right)\approx 23.1$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(5\right)\approx 14.0$ <span class="pp">|</span> $s\left(5\right)=79.1-\left(1\right)\left(1.5\right)\left(\frac{13.7}{100}\right)\left(79.1\right)$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$i\left(5\right)=13.7+\left(1\right)\left<span class="co">[</span><span class="ot">\left(1.5\right)\left(\frac{13.7}{100}\right)\left(79.1\right)-0.5\left(13.7\right)\right</span><span class="co">]</span>$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$r\left(5\right)=7.2+\left(1\right)\left(0.5\right)\left(13.7\right)$ <span class="pp">|</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>As you might notice, the calculations above are very tedious, which is why Euler's method is most often calculated using code rather than by hand.</span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>Let's see how we can translate these concepts into code.</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>**Step 1: Define the biological parameters.**</span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>Every model starts with its parameters: the biological quantities that characterize the disease and host system. Here, we have two: how fast the disease spreads ($\beta$) and how fast individuals recover ($\gamma$).</span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a><span class="in"># Transmission rate: contacts × probability of transmission per unit time</span></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a><span class="in">beta &lt;- 1.5</span></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a><span class="in"># Recovery rate: 1/gamma gives the average duration of infection</span></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a><span class="in">gamma &lt;- 0.5</span></span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a><span class="in"># With these values, the average infectious period is:</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Average infectious period:", 1/gamma, "time units")</span></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>**Step 2: Set the initial conditions.**</span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>Before the model can run, we need to specify where the system starts. In an epidemic model, this means the proportion of the population in each compartment at time zero.</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a><span class="in"># Starting proportions — must sum to 1</span></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a><span class="in">S0 &lt;- 0.99   # 99% susceptible: nearly everyone is susceptible at the start</span></span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a><span class="in">I0 &lt;- 0.01   # 1% infectious: a small "spark" of infection enters the population</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a><span class="in">R0_start &lt;- 0.00   # 0% recovered: no prior immunity</span></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a><span class="in"># Verify they sum to 1 (a good sanity check to build into your code)</span></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a><span class="in">cat("S0 + I0 + R0 =", S0 + I0 + R0_start, "\n")</span></span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>This sanity check, confirming that proportions sum to 1 — is a simple example of a habit that will save you debugging time later. When you add more compartments (SEIR, endemic model), this check generalizes naturally.</span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>**Step 3: Set up the time grid.**</span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>Euler's method steps through time discretely. We need to decide how far apart those steps are ($\Delta t$, the step size) and how long to simulate.</span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a><span class="in">dt    &lt;- 0.1   # step size — try making this larger later to see what breaks</span></span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a><span class="in">t_end &lt;- 50    # total simulation time</span></span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a vector of all time points</span></span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a><span class="in">times   &lt;- seq(0, t_end, by = dt)</span></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a><span class="in">n_steps &lt;- length(times)</span></span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Number of time steps:", n_steps, "\n")</span></span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Time points run from", times[1], "to", times[n_steps], "\n")</span></span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>The step size is a computational choice, not a biological one, but it affects accuracy. A smaller $\Delta t$ gives a more accurate approximation of the continuous solution, at the cost of more computation. We will explore this tradeoff shortly.</span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>**Step 4: Pre-allocate storage.**</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>Before running the loop, we create empty vectors to hold the results at each time step. This is more efficient than growing a vector inside the loop.</span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a><span class="in"># Empty vectors: one slot per time step, filled with zeros for now</span></span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a><span class="in">S &lt;- numeric(n_steps)</span></span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a><span class="in">I &lt;- numeric(n_steps)</span></span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a><span class="in">R &lt;- numeric(n_steps)</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a><span class="in"># Fill in the starting values</span></span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a><span class="in">S[1] &lt;- S0</span></span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a><span class="in">I[1] &lt;- I0</span></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a><span class="in">R[1] &lt;- R0_start</span></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Storage ready. First values: S =", S[1], " I =", I[1], " R =", R[1], "\n")</span></span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>Think of these vectors as the model's memory: they store the entire trajectory of the epidemic, one row per time step.</span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>**Step 5: Run the Euler loop.**</span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>This is where the model actually runs. At each time step, we calculate the rates of change using the SIR equations and use them to update the compartment values. Each line in the loop maps directly to an equation.</span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a><span class="in">for (t in 1:(n_steps - 1)) {</span></span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a><span class="in">  # Rate of change: these ARE the SIR equations, written as code</span></span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a><span class="in">  dS &lt;- -beta * I[t] * S[t]                    # new infections leaving S</span></span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a><span class="in">  dI &lt;-  beta * I[t] * S[t] - gamma * I[t]     # gain infections, lose recoveries</span></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a><span class="in">  dR &lt;-  gamma * I[t]                           # recoveries entering R</span></span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a><span class="in">  # Step forward: current value + (step size × rate of change)</span></span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a><span class="in">  S[t+1] &lt;- S[t] + dt * dS</span></span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a><span class="in">  I[t+1] &lt;- I[t] + dt * dI</span></span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a><span class="in">  R[t+1] &lt;- R[t] + dt * dR</span></span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a><span class="in"># Quick check: do the compartments still sum to 1 at the end?</span></span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Final values: S =", round(S[n_steps], 4),</span></span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a><span class="in">    " I =", round(I[n_steps], 4),</span></span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a><span class="in">    " R =", round(R[n_steps], 4), "\n")</span></span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Sum:", round(S[n_steps] + I[n_steps] + R[n_steps], 6), "\n")</span></span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a>The loop is doing exactly what the Euler update formulas say, mechanically, one step at a time. This is the computational equivalent of doing the hand calculations from the table shown earlier, just thousands of times faster.</span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a>**Step 6: Visualize the results.**</span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a>The vectors <span class="in">`S`</span>, <span class="in">`I`</span>, and <span class="in">`R`</span> now hold the full epidemic trajectory. We can plot them against time.</span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a><span class="in">plot(times, S, type = "l", col = "steelblue", lwd = 2,</span></span>
<span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a><span class="in">     ylim = c(0, 1), xlab = "Time", ylab = "Proportion",</span></span>
<span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a><span class="in">     main = paste0("SIR Epidemic (Euler)  |  β=", beta,</span></span>
<span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a><span class="in">                   "  γ=", gamma, "  R₀=", round(beta/gamma, 2)))</span></span>
<span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a><span class="in">lines(times, I, col = "firebrick", lwd = 2)</span></span>
<span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a><span class="in">lines(times, R, col = "seagreen",  lwd = 2)</span></span>
<span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a><span class="in">legend("right", legend = c("Susceptible", "Infectious", "Recovered"),</span></span>
<span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a><span class="in">       col = c("steelblue", "firebrick", "seagreen"), lwd = 2, bty = "n")</span></span>
<span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Try this"}</span>
<span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a>Go back to **Step 1** and try the following changes, re-running each step in order:</span>
<span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Change <span class="in">`gamma &lt;- 0.5`</span> to <span class="in">`gamma &lt;- 0.2`</span>. What does a slower recovery rate do to the epidemic peak?</span>
<span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Change <span class="in">`beta &lt;- 1.5`</span> to <span class="in">`beta &lt;- 0.4`</span>. What happens when $\beta &lt; \gamma$? Can you explain why biologically?</span>
<span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Go back to **Step 3** and change <span class="in">`dt &lt;- 0.1`</span> to <span class="in">`dt &lt;- 2.0`</span>. What happens to the curves? This is the cost of a large step size.</span>
<span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a>::: {.callout-note title="Computational note: why pre-allocate?"}</span>
<span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a>Notice that we create <span class="in">`S`</span>, <span class="in">`I`</span>, and <span class="in">`R`</span> as empty vectors before the loop using <span class="in">`numeric(n_steps)`</span>. This is more efficient than growing a vector inside the loop. In R (and most languages), pre-allocating memory for results is good practice.</span>
<span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-419"><a href="#cb1-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-420"><a href="#cb1-420" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion: What Computational Thinking Gets You</span></span>
<span id="cb1-421"><a href="#cb1-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-422"><a href="#cb1-422" aria-hidden="true" tabindex="-1"></a>The SIR model is simple. Three compartments, two parameters, three equations. And yet, working through this module computationally — not just mathematically — you have done something more than learned a model. You have learned to:</span>
<span id="cb1-423"><a href="#cb1-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-424"><a href="#cb1-424" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Decompose** a biological process (disease spread) into computable pieces (state variables, rates, parameters)</span>
<span id="cb1-425"><a href="#cb1-425" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Translate** between mathematical notation and code, and recognize they are the same statement in different languages</span>
<span id="cb1-426"><a href="#cb1-426" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Interrogate** a model by changing its parameters and watching what changes and what doesn't</span>
<span id="cb1-427"><a href="#cb1-427" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Verify** analytical results numerically, and notice when they agree or diverge</span>
<span id="cb1-428"><a href="#cb1-428" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Extend** the framework: the endemic model uses the same structure as the epidemic model, just with added terms. From here, SEIR, SIRS, and host-pathogen models with predators follow the same logic.</span>
<span id="cb1-429"><a href="#cb1-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-430"><a href="#cb1-430" aria-hidden="true" tabindex="-1"></a>This is the computational literacy that makes quantitative ecology accessible. The math does not have to be a black box. The code does not have to be a black box either. When both are visible and connected, the biology becomes clearest.</span>
<span id="cb1-431"><a href="#cb1-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-432"><a href="#cb1-432" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-433"><a href="#cb1-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-434"><a href="#cb1-434" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
<span id="cb1-435"><a href="#cb1-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-436"><a href="#cb1-436" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb1-437"><a href="#cb1-437" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>